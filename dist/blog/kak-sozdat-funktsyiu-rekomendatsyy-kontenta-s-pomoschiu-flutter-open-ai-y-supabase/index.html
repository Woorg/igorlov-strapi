<!DOCTYPE html><html lang="ru"> <head><title>Как создать функцию рекомендации контента с помощью Flutter, Open AI и Supabase - Фул Фронт Дев</title><link rel="canonical" href="https://igorlov.ru/blog/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase"><meta name="description" content="Рекомендация релевантного контента пользователю очень важна для поддержания его интереса к приложению. Хотя это обычная функция, которую мы хотели бы иметь в н"><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.10.0"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.Dg72Zwgc.css">
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#0d52a1;color:rgba(13,82,161,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw)}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.container[data-astro-cid-vcbh62el]{padding:min(2rem,1.2125rem + 1.05vw)}.list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.link[data-astro-cid-vcbh62el]{font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s;padding:.125rem .75rem;font-size:min(1.5rem,1.1625rem + .45vw);line-height:var(--tw-lh)}
</style>
<link rel="stylesheet" href="/_astro/_single_.CzD8Xhhr.css">
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#27292d;border-color:rgba(39,41,45,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.comments[data-v-f9c4118f]{margin:auto;margin-top:1.25rem;width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.comments:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame[data-v-f9c4118f]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/hoisted.CUFolni_.js"></script><style>[data-astro-transition-scope="astro-xdjatz7t-1"] { view-transition-name: blog-image-kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-16 font-inter text-blue fluid:text-lg lg:pt-24 dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <symbol id="ai:local:logo-one"><g fill="currentColor"><path d="M1198.57 596.749c0 329.575-267.171 596.751-596.747 596.751-329.575 0-596.749-267.176-596.749-596.751S272.248 0 601.823 0c329.576 0 596.747 267.174 596.747 596.749Z"/><circle cx="3035.75" cy="617.751" r="596.749" transform="rotate(-90 3035.75 617.751)"/><path d="M3035.75 2736.81c329.57 0 596.75 267.18 596.75 596.75 0 329.58-267.18 596.75-596.75 596.75-329.58 0-596.75-267.17-596.75-596.75 0-329.57 267.17-596.75 596.75-596.75Z"/><circle cx="596.749" cy="1964.8" r="596.749"/><path d="M1193.5 3332.87c0 329.57-267.176 596.75-596.751 596.75S0 3662.44 0 3332.87c0-329.58 267.174-596.75 596.749-596.75 329.575 0 596.751 267.17 596.751 596.75Z"/><circle cx="5062.46" cy="617.751" r="596.749" transform="rotate(-90 5062.46 617.751)"/><circle cx="5062.46" cy="3333.56" r="596.749" transform="rotate(-90 5062.46 3333.56)"/></g></symbol><use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> Меню</button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> Закрыть</button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты </a> </li> </ul> </nav> </div>   <!-- <ThemeToggle client:only /> --> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <div class="container" data-astro-cid-vcbh62el> <ol class="list" role="list" data-astro-cid-vcbh62el> <li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </div> </nav>  <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <article data-astro-cid-axzg2cw6> <figure class="article__image" data-astro-cid-axzg2cw6> <picture data-astro-cid-axzg2cw6> <source srcset="/_astro/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase-Dec-13-2023.wPzxypRt_Z1lwkMY.avif" type="image/avif"><source srcset="/_astro/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase-Dec-13-2023.wPzxypRt_Z110hSD.webp" type="image/webp"> <img src="/_astro/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase-Dec-13-2023.wPzxypRt_1OGUHN.png" alt="Как создать функцию рекомендации контента с помощью Flutter, Open AI и Supabase" class="aspect-video h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-xdjatz7t-1" width="1120" height="580" decoding="async"> </picture> </figure> </article> <div class="container" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <ul class="article__categories categories" data-astro-cid-axzg2cw6> <li class="categories__item" data-astro-cid-axzg2cw6> <a href="/category/учебник" class="categories__link" data-astro-cid-axzg2cw6> Учебник  </a> </li> </ul> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Как создать функцию рекомендации контента с помощью Flutter, Open AI и Supabase </h1> <ul class="article__tags tags" data-astro-cid-axzg2cw6> <li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/open-ai" data-astro-cid-axzg2cw6> Open AI </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/supabase" data-astro-cid-axzg2cw6> Supabase </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/flutter" data-astro-cid-axzg2cw6> Flutter </a> </li> </ul> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 13 дек., 2023 by Igor Gorlov </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div> <div class="article__content prose prose-zinc max-w-full break-words text-blue dark:prose-invert prose-headings:text-blue prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <!-- <TextAds /> --> <!-- <AdfoxTocAds blockId="adfox_17062261612859555" /> --> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как создать функцию рекомендации контента с помощью Flutter, Open AI и Supabase&url=https://igorlov.ru/blog/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase&title=Как создать функцию рекомендации контента с помощью Flutter, Open AI и Supabase&summary=Рекомендация релевантного контента пользователю очень важна для поддержания его интереса к приложению. Хотя это обычная функция, которую мы хотели бы иметь в н&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase&media=&description=Рекомендация релевантного контента пользователю очень важна для поддержания его интереса к приложению. Хотя это обычная функция, которую мы хотели бы иметь в н" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <details open class="toc border-b border-blue text-blue fluid:p-8 overflow-auto cursor-pointer bg-box"><summary class="toc__title text-xl font-medium">Содержание</summary><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#зачем-использовать-векторную-базу-данных-для-рекомендации-контента">Зачем использовать векторную базу данных для рекомендации контента</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#что-мы-будем-строить">Что мы будем строить</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#используемые-инструментытехнологии">Используемые инструменты/технологии</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#создание-приложения">Создание приложения</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-1-создание-таблицы">Шаг 1: Создание таблицы</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-2-получение-данных-о-фильме">Шаг 2: Получение данных о фильме</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-3-генерация-вкраплений">Шаг 3: Генерация вкраплений</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-4-храните-данные-в-базе-данных-supabase">Шаг 4: Храните данные в базе данных Supabase</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-5-создаем-функцию-базы-данных-для-запроса-похожих-фильмов">Шаг 5: Создаем функцию базы данных для запроса похожих фильмов</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-6-создание-интерфейса-flutter">Шаг 6: Создание интерфейса Flutter</a></li></ol></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#afterthoughts">Afterthoughts</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#ресурсы">Ресурсы</a></li></ol></details open><p>Рекомендация релевантного контента пользователю очень важна для поддержания его интереса к приложению. Хотя это обычная функция, которую мы хотели бы иметь в наших приложениях, создать ее не так просто. Ситуация изменилась с появлением векторных баз данных и открытого искусственного интеллекта. Сегодня мы можем выполнять семантический поиск с учетом контекста контента с помощью всего одного запроса к векторной базе данных.<br>
В этой статье мы расскажем, как можно создать приложение для просмотра фильмов на Flutter, которое рекомендует другой фильм на основе того, что просматривает пользователь.</p>
<p>Небольшая оговорка: в этой статье представлен обзор того, что можно создать с помощью векторной базы данных, поэтому в ней не будут рассмотрены все детали реализации. Вы можете найти полную кодовую базу приложения в этой статье <a href="https://github.com/dshukertjr/flutter-movie-recommendation" rel="noopener noreferrer nofollow" target="_blank">здесь</a>, чтобы узнать больше деталей.</p>
<h2 id="зачем-использовать-векторную-базу-данных-для-рекомендации-контента"><a href="https://dev.to/supabase/how-to-build-a-content-recommendation-feature-using-flutter-open-ai-and-supabase-3mg4#why-use-a-vector-database-for-recommending-content" rel="noopener noreferrer nofollow" target="_blank"></a>Зачем использовать векторную базу данных для рекомендации контента<a aria-hidden="true" tabindex="-1" href="#зачем-использовать-векторную-базу-данных-для-рекомендации-контента"><span class="icon icon-link"></span></a></h2>
<p>В машинном обучении часто используется процесс преобразования фрагмента контента в векторное представление, называемое эмбеддингом, поскольку он позволяет математически анализировать семантический контент. Если предположить, что у нас есть движок, способный создавать вкрапления, хорошо учитывающие контекст данных, мы можем посмотреть на расстояние между каждым вкраплением, чтобы понять, похожи или нет два контента. Open AI предоставляет хорошо натренированную модель для преобразования текстового контента в вкрапления, поэтому ее использование позволяет нам создать высококачественный рекомендательный механизм.</p>
<p>Существует множество вариантов векторных баз данных, но мы будем использовать Supabase в качестве нашей векторной базы данных в этой статье, потому что мы хотим хранить также данные без вкраплений, и мы хотим иметь возможность легко запрашивать их из нашего приложения Flutter.</p>
<h2 id="что-мы-будем-строить"><a href="https://dev.to/supabase/how-to-build-a-content-recommendation-feature-using-flutter-open-ai-and-supabase-3mg4#what-we-will-build" rel="noopener noreferrer nofollow" target="_blank"></a>Что мы будем строить<a aria-hidden="true" tabindex="-1" href="#что-мы-будем-строить"><span class="icon icon-link"></span></a></h2>
<p>Мы будем создавать приложение для просмотра фильмов. Подумайте о Netflix, за исключением того, что пользователи не смогут посмотреть фильм. Цель этого приложения - продемонстрировать, как можно выводить на поверхность связанный контент, чтобы удержать пользователей.</p>
<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--FEyPL1G7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w2ayn17ee891t6m3sns2.png" rel="noopener noreferrer nofollow" target="_blank"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--FEyPL1G7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w2ayn17ee891t6m3sns2.png" alt="Интерфейсы приложений"></a></p>
<h2 id="используемые-инструментытехнологии"><a href="https://dev.to/supabase/how-to-build-a-content-recommendation-feature-using-flutter-open-ai-and-supabase-3mg4#tools-technologies-used" rel="noopener noreferrer nofollow" target="_blank"></a>Используемые инструменты/технологии<a aria-hidden="true" tabindex="-1" href="#используемые-инструментытехнологии"><span class="icon icon-link"></span></a></h2>
<ul>
<li><a href="https://flutter.dev/" rel="noopener noreferrer nofollow" target="_blank">Flutter</a> - используется для создания интерфейса приложения</li>
<li><a href="https://supabase.com/" rel="noopener noreferrer nofollow" target="_blank">Supabase</a> - используется для хранения эмбеддингов, а также других данных о фильмах в базе данных</li>
<li><a href="https://openai.com/blog/openai-api" rel="noopener noreferrer nofollow" target="_blank">Open AI API</a> - используется для преобразования данных о фильмах в эмбеддинги</li>
<li><a href="https://developer.themoviedb.org/docs" rel="noopener noreferrer nofollow" target="_blank">TMDB API</a> - Бесплатный API для получения данных о фильмах.</li>
</ul>
<h2 id="создание-приложения"><a href="https://dev.to/supabase/how-to-build-a-content-recommendation-feature-using-flutter-open-ai-and-supabase-3mg4#creating-the-app" rel="noopener noreferrer nofollow" target="_blank"></a>Создание приложения<a aria-hidden="true" tabindex="-1" href="#создание-приложения"><span class="icon icon-link"></span></a></h2>
<p>Сначала нам нужно заполнить базу данных данными о фильмах и их вкраплениях. Для этого мы воспользуемся <a href="https://supabase.com/docs/guides/functions" rel="noopener noreferrer nofollow" target="_blank">Supabase edge functions</a>, чтобы вызвать TMDB API и Open AI API для получения данных о фильмах и генерации вкраплений. Как только мы получим данные, мы сохраним их в базе данных Supabase и запросим их из нашего приложения Flutter.</p>
<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--4akHAVbW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/pufwjkb1vqut4xov9adw.png" rel="noopener noreferrer nofollow" target="_blank"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--4akHAVbW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/pufwjkb1vqut4xov9adw.png" alt="Обзор системы"></a></p>
<h3 id="шаг-1-создание-таблицы"><a href="https://dev.to/supabase/how-to-build-a-content-recommendation-feature-using-flutter-open-ai-and-supabase-3mg4#step-1-create-the-table" rel="noopener noreferrer nofollow" target="_blank"></a>Шаг 1: Создание таблицы<a aria-hidden="true" tabindex="-1" href="#шаг-1-создание-таблицы"><span class="icon icon-link"></span></a></h3>
<p>У нас будет одна таблица для этого проекта, и это таблица <code>films</code>. Таблица <code>films</code> будет хранить некоторую базовую информацию о каждом фильме, например, название или данные о релизе, а также встраивать обзор каждого фильма, чтобы мы могли выполнять векторный поиск сходства друг с другом.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#767C9DB0;font-style:italic">-- Включить расширение pgvector</span></span>
<span class="line"><span style="color:#A6ACCD">создать расширение vector</span></span>
<span class="line"><span style="color:#A6ACCD">с</span></span>
<span class="line"><span style="color:#A6ACCD">  расширениями схем;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">-- Создать таблицу</span></span>
<span class="line"><span style="color:#A6ACCD">создать таблицу public.films (</span></span>
<span class="line"><span style="color:#A6ACCD">  id </span><span style="color:#91B4D5">integer</span><span style="color:#A6ACCD"> первичный ключ,</span></span>
<span class="line"><span style="color:#A6ACCD">  текст названия,</span></span>
<span class="line"><span style="color:#A6ACCD">  текст обзора,</span></span>
<span class="line"><span style="color:#A6ACCD">  дата_релиза дата,</span></span>
<span class="line"><span style="color:#A6ACCD">  backdrop_path </span><span style="color:#91B4D5">text</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">  embedding vector(</span><span style="color:#5DE4C7">1536</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">-- Включите защиту на уровне строки</span></span>
<span class="line"><span style="color:#5DE4C7">alter</span><span style="color:#5DE4C7"> table</span><span style="color:#A6ACCD"> public.films включить защиту на уровне строк;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">-- Создайте политику, позволяющую любому пользователю читать таблицу films</span></span>
<span class="line"><span style="color:#A6ACCD">создать Политика </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Дети публичны.</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD"> на public.films для </span><span style="color:#5DE4C7">select</span><span style="color:#5DE4C7"> using</span><span style="color:#A6ACCD"> (true);</span></span>
<span class="line"></span></code></pre>
<h3 id="шаг-2-получение-данных-о-фильме"><a href="https://dev.to/supabase/how-to-build-a-content-recommendation-feature-using-flutter-open-ai-and-supabase-3mg4#step-2-get-movie-data" rel="noopener noreferrer nofollow" target="_blank"></a>Шаг 2: Получение данных о фильме<a aria-hidden="true" tabindex="-1" href="#шаг-2-получение-данных-о-фильме"><span class="icon icon-link"></span></a></h3>
<p>Получить данные о фильмах относительно просто. TMDB API предоставляет простую в использовании конечную точку <a href="https://developer.themoviedb.org/reference/discover-movie" rel="noopener noreferrer nofollow" target="_blank">movies endpoint</a> для запроса информации о фильмах, а также широкий спектр фильтров для сужения результатов запроса.</p>
<p>Нам нужен бэкэнд для безопасного вызова API, и для этого мы воспользуемся <a href="https://supabase.com/docs/guides/functions" rel="noopener noreferrer nofollow" target="_blank">Supabase Edge Functions</a>. Шаги со 2 по 4 будут заключаться в построении кода этой граничной функции, а полный пример кода можно найти <a href="https://github.com/dshukertjr/flutter-movie-recommendation/blob/main/supabase/functions/get_film_data/index.ts" rel="noopener noreferrer nofollow" target="_blank">здесь</a>.</p>
<p>Следующий код предоставит нам 20 самых популярных фильмов за определенный год.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> searchParams</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7"> new</span><span style="color:#E4F0FBD0"> URLSearchParams</span><span style="color:#A6ACCD">();</span></span>
<span class="line"><span style="color:#E4F0FB">searchParams</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">set</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">sort_by</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">popularity.desc</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">searchParams</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">set</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">page</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">1</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">searchParams</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">set</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">language</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">en-US</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">searchParams</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">set</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">primary_release_year</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#A6ACCD">`${</span><span style="color:#E4F0FB">year</span><span style="color:#A6ACCD">}`</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">searchParams</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">set</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">include_adult</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">false</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">searchParams</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">set</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">include_video</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">false</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">searchParams</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">set</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">region</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">US</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">searchParams</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">set</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">watch_region</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">US</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">searchParams</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">set</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">with_original_language</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">en</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> tmdbResponse</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7C0"> await</span><span style="color:#E4F0FBD0"> fetch</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">	`</span><span style="color:#5DE4C7">https://api.themoviedb.org/3/discover/movie?</span><span style="color:#A6ACCD">${</span><span style="color:#E4F0FB">searchParams</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">toString</span><span style="color:#A6ACCD">()</span><span style="color:#A6ACCD">}`</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">	{</span></span>
<span class="line"><span style="color:#ADD7FF">		метод</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">GET</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#ADD7FF">		заголовки</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#A6ACCD">			'</span><span style="color:#5DE4C7">Content-Type</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">application/json</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#ADD7FF">			Авторизация</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> `</span><span style="color:#5DE4C7">Bearer </span><span style="color:#A6ACCD">${</span><span style="color:#E4F0FB">tmdbApiKey</span><span style="color:#A6ACCD">}`</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">		},</span></span>
<span class="line"><span style="color:#A6ACCD">	},</span></span>
<span class="line"><span style="color:#A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> tmdbJson</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7C0"> await</span><span style="color:#E4F0FB"> tmdbResponse</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">json</span><span style="color:#A6ACCD">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> tmdbStatus</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> tmdbResponse</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">status</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">if (</span><span style="color:#91B4D5">!</span><span style="color:#A6ACCD">(</span><span style="color:#5DE4C7">200</span><span style="color:#91B4D5"> &#x3C;=</span><span style="color:#E4F0FB"> tmdbStatus</span><span style="color:#91B4D5"> &#x26;&#x26;</span><span style="color:#E4F0FB"> tmdbStatus</span><span style="color:#91B4D5"> &#x3C;=</span><span style="color:#5DE4C7"> 299</span><span style="color:#A6ACCD">)) {</span></span>
<span class="line"><span style="color:#5DE4C7C0">	return</span><span style="color:#E4F0FBD0"> returnError</span><span style="color:#A6ACCD">({</span></span>
<span class="line"><span style="color:#ADD7FF">		сообщение</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">Ошибка при получении данных из tmdb API</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">	});</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> films</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> tmdbJson</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">results</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span></code></pre>
<h3 id="шаг-3-генерация-вкраплений"><a href="https://dev.to/supabase/how-to-build-a-content-recommendation-feature-using-flutter-open-ai-and-supabase-3mg4#step-3-generate-embeddings" rel="noopener noreferrer nofollow" target="_blank"></a>Шаг 3: Генерация вкраплений<a aria-hidden="true" tabindex="-1" href="#шаг-3-генерация-вкраплений"><span class="icon icon-link"></span></a></h3>
<p>Мы можем взять данные о фильмах из предыдущего шага и сгенерировать вкрапления для каждого из них. Здесь мы вызываем <a href="https://platform.openai.com/docs/guides/embeddings" rel="noopener noreferrer nofollow" target="_blank">Open AI Embeddings API</a>, чтобы преобразовать <code>overview</code> каждого фильма в эмбеддинги. <code>Обзор</code> содержит краткое описание каждого фильма и является хорошим источником для создания вкраплений, представляющих каждый из фильмов.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> response</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7C0"> await</span><span style="color:#E4F0FBD0"> fetch</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">https://api.openai.com/v1/embeddings</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, {</span></span>
<span class="line"><span style="color:#ADD7FF">	метод</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">POST</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#ADD7FF">	headers</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#A6ACCD">		'</span><span style="color:#5DE4C7">Content-Type</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">application/json</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#ADD7FF">		Authorization</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> `</span><span style="color:#5DE4C7">Bearer </span><span style="color:#A6ACCD">${</span><span style="color:#E4F0FB">openAiApiKey</span><span style="color:#A6ACCD">}`</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">	},</span></span>
<span class="line"><span style="color:#ADD7FF">	body</span><span style="color:#A6ACCD">:</span><span style="color:#ADD7FF"> JSON</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">stringify</span><span style="color:#A6ACCD">({</span></span>
<span class="line"><span style="color:#ADD7FF">		input</span><span style="color:#A6ACCD">:</span><span style="color:#E4F0FB"> film</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">overview</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#ADD7FF">		model</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">text-embedding-ada-002</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">	}),</span></span>
<span class="line"><span style="color:#A6ACCD">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> responseData</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7C0"> await</span><span style="color:#E4F0FB"> response</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">json</span><span style="color:#A6ACCD">();</span></span>
<span class="line"><span style="color:#A6ACCD">if (</span><span style="color:#E4F0FB">responseData</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">error</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#5DE4C7C0">	return</span><span style="color:#E4F0FBD0"> returnError</span><span style="color:#A6ACCD">({</span></span>
<span class="line"><span style="color:#ADD7FF">		сообщение</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> `</span><span style="color:#5DE4C7">Ошибка при получении встраивания Open API: </span><span style="color:#A6ACCD">${</span><span style="color:#E4F0FB">responseData</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">error</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">message</span><span style="color:#A6ACCD">}`</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">	});</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> embedding</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> responseData</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">data</span><span style="color:#A6ACCD">[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].</span><span style="color:#E4F0FB">embedding</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span></code></pre>
<h3 id="шаг-4-храните-данные-в-базе-данных-supabase"><a href="https://dev.to/supabase/how-to-build-a-content-recommendation-feature-using-flutter-open-ai-and-supabase-3mg4#step-4-store-the-data-in-the-supabase-database" rel="noopener noreferrer nofollow" target="_blank"></a>Шаг 4: Храните данные в базе данных Supabase<a aria-hidden="true" tabindex="-1" href="#шаг-4-храните-данные-в-базе-данных-supabase"><span class="icon icon-link"></span></a></h3>
<p>После того как мы получили данные о фильме и данные о вставке, нам осталось их сохранить. Мы можем вызвать функцию <code>upsert()</code> на клиенте Supabase, чтобы легко сохранить данные.</p>
<p>Опять же, я опустил много кода здесь для простоты, но вы можете найти полный код краевых функций с шага 2 по шаг 4 <a href="https://github.com/dshukertjr/flutter-movie-recommendation/blob/main/supabase/functions/get_film_data/index.ts" rel="noopener noreferrer nofollow" target="_blank">здесь</a>.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#767C9DB0;font-style:italic">// Код из шага 2</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">// Получаем данные о фильмах и сохраняем их в переменной `films`.</span></span>
<span class="line"><span style="color:#91B4D5">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">for(</span><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> film</span><span style="color:#91B4D5"> of</span><span style="color:#E4F0FB"> films</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">    // Код из Шага 3</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">  // Получаем вкрапления и сохраняем их в переменной `embeddings`.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E4F0FB">    filmsWithEmbeddings</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">push</span><span style="color:#A6ACCD">({</span></span>
<span class="line"><span style="color:#ADD7FF">      id</span><span style="color:#A6ACCD">:</span><span style="color:#E4F0FB"> film</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">id</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#ADD7FF">      title</span><span style="color:#A6ACCD">:</span><span style="color:#E4F0FB"> film</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">title</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#ADD7FF">      обзор</span><span style="color:#A6ACCD">:</span><span style="color:#E4F0FB"> film</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">overview</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#ADD7FF">      release_date</span><span style="color:#A6ACCD">:</span><span style="color:#E4F0FB"> film</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">release_date</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#ADD7FF">      backdrop_path</span><span style="color:#A6ACCD">:</span><span style="color:#E4F0FB"> film</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">backdrop_path</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#E4F0FB">      embedding</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">    })</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">// Сохраняем каждый фильм, а также его вкрапления в базу данных Supabase</span></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#A6ACCD"> { </span><span style="color:#E4F0FB">error</span><span style="color:#A6ACCD"> } </span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7C0"> await</span><span style="color:#E4F0FB"> supabase</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">from</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">films</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">).</span><span style="color:#E4F0FBD0">upsert</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">filmsWithEmbeddings</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span></code></pre>
<h3 id="шаг-5-создаем-функцию-базы-данных-для-запроса-похожих-фильмов"><a href="https://dev.to/supabase/how-to-build-a-content-recommendation-feature-using-flutter-open-ai-and-supabase-3mg4#step-5-create-a-database-function-to-query-similar-movies" rel="noopener noreferrer nofollow" target="_blank"></a>Шаг 5: Создаем функцию базы данных для запроса похожих фильмов<a aria-hidden="true" tabindex="-1" href="#шаг-5-создаем-функцию-базы-данных-для-запроса-похожих-фильмов"><span class="icon icon-link"></span></a></h3>
<p>Для того чтобы выполнить векторный поиск сходства с помощью Supabase, нам нужно создать <a href="https://supabase.com/docs/guides/database/functions" rel="noopener noreferrer nofollow" target="_blank">функцию базы данных</a>. Эта функция базы данных будет принимать в качестве аргумента <code>embedding</code> и <code>film_id</code>. Аргумент <code>embedding</code> будет являться вставкой для поиска похожих фильмов в базе данных, а аргумент film_id будет использоваться для отсеивания одинаковых фильмов, которые запрашиваются.</p>
<p>Кроме того, мыЧтобы эффективно выполнять запросы даже при больших наборах данных, мы установили <a href="https://supabase.com/blog/increase-performance-pgvector-hnsw" rel="noopener noreferrer nofollow" target="_blank">HSNW-индекс</a> на столбце <code>embedding</code>.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#767C9DB0;font-style:italic">-- Установить индекс на столбце "встраивание</span></span>
<span class="line"><span style="color:#A6ACCD">создайте индекс на фильмах с помощью hnsw (embedding vector_cosine_ops);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">-- Создание функции для поиска связанных фильмов</span></span>
<span class="line"><span style="color:#A6ACCD">создать или заменить функцию get_related_film(embedding vector(</span><span style="color:#5DE4C7">1536</span><span style="color:#A6ACCD">), film_id </span><span style="color:#91B4D5">integer</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">возвращает множество фильмов</span></span>
<span class="line"><span style="color:#A6ACCD">язык </span><span style="color:#5DE4C7">sql</span></span>
<span class="line"><span style="color:#A6ACCD">как $</span></span>
<span class="line"><span style="color:#A6ACCD">    выбрать </span><span style="color:#91B4D5">*</span></span>
<span class="line"><span style="color:#A6ACCD">    из фильмов</span></span>
<span class="line"><span style="color:#5DE4C7">    where</span><span style="color:#A6ACCD"> id </span><span style="color:#91B4D5">!=</span><span style="color:#A6ACCD"> film_id</span></span>
<span class="line"><span style="color:#5DE4C7">    order by</span><span style="color:#A6ACCD"> films.embedding </span><span style="color:#91B4D5">&#x3C;=></span><span style="color:#A6ACCD"> get_related_film.embedding</span></span>
<span class="line"><span style="color:#A6ACCD">    ограничение </span><span style="color:#5DE4C7">6</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">Инвокер безопасности $;</span></span>
<span class="line"></span></code></pre>
<h3 id="шаг-6-создание-интерфейса-flutter"><a href="https://dev.to/supabase/how-to-build-a-content-recommendation-feature-using-flutter-open-ai-and-supabase-3mg4#step-6-create-the-flutter-interface" rel="noopener noreferrer nofollow" target="_blank"></a>Шаг 6: Создание интерфейса Flutter<a aria-hidden="true" tabindex="-1" href="#шаг-6-создание-интерфейса-flutter"><span class="icon icon-link"></span></a></h3>
<p>Теперь, когда у нас готов бэкэнд, нам осталось создать интерфейс для отображения и запроса данных. Поскольку основная цель этой статьи - продемонстрировать поиск по сходству с помощью векторов, я не буду вдаваться во все подробности реализации Flutter, но вы можете найти полную кодовую базу <a href="https://github.com/dshukertjr/flutter-movie-recommendation/tree/main/flutter" rel="noopener noreferrer nofollow" target="_blank">здесь</a>.</p>
<p>В нашем приложении будут следующие страницы:</p>
<ul>
<li><strong>HomePage</strong>: точка входа в приложение и отображение списка фильмов.</li>
<li><strong>DetailsPage</strong>: отображает детали фильма, а также связанные с ним фильмы</li>
</ul>
<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--xnW7ryJu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rf225zrv6gzdbozpabgj.jpg" rel="noopener noreferrer nofollow" target="_blank"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--xnW7ryJu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rf225zrv6gzdbozpabgj.jpg" alt="Структура каталогов Flutter"></a></p>
<p><code>components/film_cell.dart</code> - это общий компонент для отображения настраиваемой ячейки для главной и подробной страницы. <code>models/film.dart</code> содержит модель данных, представляющую один фильм.</p>
<p>Обе страницы выглядят следующим образом. Волшебство происходит в нижней части страницы подробностей в разделе с надписью <code>Вам также может понравиться:</code>. Мы выполняем векторный поиск сходства, чтобы получить список фильмов, похожих на выбранный, используя функцию базы данных, которую мы реализовали ранее.</p>
<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--FEyPL1G7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w2ayn17ee891t6m3sns2.png" rel="noopener noreferrer nofollow" target="_blank"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--FEyPL1G7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w2ayn17ee891t6m3sns2.png" alt="Интерфейсы приложений"></a></p>
<p>Ниже приведен код главной страницы. Это простой ListView со стандартным запросом <code>select</code> из нашей таблицы <code>films</code>. Ничего особенного здесь нет.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="dart"><code><span class="line"><span style="color:#5DE4C7">import</span><span style="color:#5DE4C7"> 'package:filmsearch/components/film_cell.dart'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import</span><span style="color:#5DE4C7"> 'package:filmsearch/main.dart'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import</span><span style="color:#5DE4C7"> 'package:filmsearch/models/film.dart'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7">import</span><span style="color:#5DE4C7"> 'package:flutter/material.dart'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">class </span><span style="color:#ADD7FF">HomePage</span><span style="color:#A6ACCD"> extends </span><span style="color:#ADD7FF">StatefulWidget</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#5DE4C7">  const</span><span style="color:#ADD7FF"> HomePage</span><span style="color:#A6ACCD">({</span><span style="color:#ADD7FF;font-style:italic">super</span><span style="color:#A6ACCD">.key});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">  @override</span></span>
<span class="line"><span style="color:#ADD7FF">  State</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">HomePage</span><span style="color:#A6ACCD">> </span><span style="color:#ADD7FF">createState</span><span style="color:#A6ACCD">() </span><span style="color:#91B4D5">=></span><span style="color:#ADD7FF"> _HomePageState</span><span style="color:#A6ACCD">();</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">class </span><span style="color:#ADD7FF">_HomePageState</span><span style="color:#A6ACCD"> extends </span><span style="color:#ADD7FF">State</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">HomePage</span><span style="color:#A6ACCD">> {</span></span>
<span class="line"><span style="color:#5DE4C7">  final</span><span style="color:#A6ACCD"> filmsFuture </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> supabase</span></span>
<span class="line"><span style="color:#A6ACCD">      .</span><span style="color:#ADD7FF">from</span><span style="color:#A6ACCD">(</span><span style="color:#5DE4C7">'films'</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">      .</span><span style="color:#ADD7FF">select</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">List</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">Map</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">String</span><span style="color:#A6ACCD">, </span><span style="color:#ADD7FF">dynamic</span><span style="color:#A6ACCD">>>()</span></span>
<span class="line"><span style="color:#A6ACCD">      .</span><span style="color:#ADD7FF">withConverter</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">List</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">Film</span><span style="color:#A6ACCD">>>((data) </span><span style="color:#91B4D5">=></span><span style="color:#A6ACCD"> data.</span><span style="color:#ADD7FF">map</span><span style="color:#A6ACCD">(</span><span style="color:#ADD7FF">Film</span><span style="color:#A6ACCD">.fromJson).</span><span style="color:#ADD7FF">toList</span><span style="color:#A6ACCD">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">  @override</span></span>
<span class="line"><span style="color:#ADD7FF">  Widget</span><span style="color:#ADD7FF"> build</span><span style="color:#A6ACCD">(</span><span style="color:#ADD7FF">BuildContext</span><span style="color:#A6ACCD"> context) {</span></span>
<span class="line"><span style="color:#A6ACCD">    return </span><span style="color:#ADD7FF">Scaffold</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">      appBar</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> AppBar</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">        title</span><span style="color:#91B4D5">:</span><span style="color:#5DE4C7"> const</span><span style="color:#ADD7FF"> Text</span><span style="color:#A6ACCD">(</span><span style="color:#5DE4C7">'Films'</span><span style="color:#A6ACCD">),</span></span>
<span class="line"><span style="color:#A6ACCD">      ),</span></span>
<span class="line"><span style="color:#A6ACCD">      body</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> FutureBuilder</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">          future</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> filmsFuture,</span></span>
<span class="line"><span style="color:#A6ACCD">          builder</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> (context, snapshot) {</span></span>
<span class="line"><span style="color:#A6ACCD">            if (snapshot.hasError) {</span></span>
<span class="line"><span style="color:#A6ACCD">              return </span><span style="color:#ADD7FF">Center</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">                child</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> Text</span><span style="color:#A6ACCD">(snapshot.error.</span><span style="color:#ADD7FF">toString</span><span style="color:#A6ACCD">()),</span></span>
<span class="line"><span style="color:#A6ACCD">              );</span></span>
<span class="line"><span style="color:#A6ACCD">            }</span></span>
<span class="line"><span style="color:#A6ACCD">            if (</span><span style="color:#91B4D5">!</span><span style="color:#A6ACCD">snapshot.hasData) {</span></span>
<span class="line"><span style="color:#A6ACCD">              return </span><span style="color:#5DE4C7">const</span><span style="color:#ADD7FF"> Center</span><span style="color:#A6ACCD">(child</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> CircularProgressIndicator</span><span style="color:#A6ACCD">());</span></span>
<span class="line"><span style="color:#A6ACCD">            }</span></span>
<span class="line"><span style="color:#5DE4C7">            final</span><span style="color:#A6ACCD"> films </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> snapshot.data</span><span style="color:#91B4D5">!</span></span>
<span class="line"><span style="color:#A6ACCD">            return </span><span style="color:#ADD7FF">ListView</span><span style="color:#A6ACCD">.</span><span style="color:#ADD7FF">builder</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">              itemBuilder</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> (context, index) {</span></span>
<span class="line"><span style="color:#5DE4C7">                final</span><span style="color:#A6ACCD"> film </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> films[index];</span></span>
<span class="line"><span style="color:#A6ACCD">                return </span><span style="color:#ADD7FF">FilmCell</span><span style="color:#A6ACCD">(film</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> film);</span></span>
<span class="line"><span style="color:#A6ACCD">              },</span></span>
<span class="line"><span style="color:#A6ACCD">              itemCount</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> films.length,</span></span>
<span class="line"><span style="color:#A6ACCD">            );</span></span>
<span class="line"><span style="color:#A6ACCD">          }),</span></span>
<span class="line"><span style="color:#A6ACCD">    );</span></span>
<span class="line"><span style="color:#A6ACCD">  }</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span></code></pre>
<p>На странице подробностей мы вызываем функцию базы данных <code>get_related_film</code>, созданную в шаге 5, чтобы получить 6 наиболее связанных фильмов и отобразить их.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="dart"><code><span class="line"><span style="color:#5DE4C7">import</span><span style="color:#5DE4C7"> 'package:filmsearch/components/film_cell.dart'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import</span><span style="color:#5DE4C7"> 'package:filmsearch/main.dart'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import</span><span style="color:#5DE4C7"> 'package:filmsearch/models/film.dart'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import</span><span style="color:#5DE4C7"> 'package:flutter/material.dart'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import</span><span style="color:#5DE4C7"> 'package:intl/intl.dart'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">class </span><span style="color:#ADD7FF">DetailsPage</span><span style="color:#A6ACCD"> extends </span><span style="color:#ADD7FF">StatefulWidget</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#5DE4C7">  const</span><span style="color:#ADD7FF"> DetailsPage</span><span style="color:#A6ACCD">({</span><span style="color:#ADD7FF;font-style:italic">super</span><span style="color:#A6ACCD">.key, </span><span style="color:#5DE4C7">required</span><span style="color:#ADD7FF;font-style:italic"> this</span><span style="color:#A6ACCD">.film});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7">  final</span><span style="color:#ADD7FF"> Film</span><span style="color:#A6ACCD"> film;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">  @override</span></span>
<span class="line"><span style="color:#ADD7FF">  State</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">DetailsPage</span><span style="color:#A6ACCD">> </span><span style="color:#ADD7FF">createState</span><span style="color:#A6ACCD">() </span><span style="color:#91B4D5">=></span><span style="color:#ADD7FF"> _DetailsPageState</span><span style="color:#A6ACCD">();</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">class </span><span style="color:#ADD7FF">_DetailsPageState</span><span style="color:#A6ACCD"> extends </span><span style="color:#ADD7FF">State</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">DetailsPage</span><span style="color:#A6ACCD">> {</span></span>
<span class="line"><span style="color:#5DE4C7">  late</span><span style="color:#5DE4C7"> final</span><span style="color:#ADD7FF"> Future</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">List</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">Film</span><span style="color:#A6ACCD">>> relatedFilmsFuture;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">  @override</span></span>
<span class="line"><span style="color:#91B4D5">  void</span><span style="color:#ADD7FF"> initState</span><span style="color:#A6ACCD">() {</span></span>
<span class="line"><span style="color:#ADD7FF;font-style:italic">    super</span><span style="color:#A6ACCD">.</span><span style="color:#ADD7FF">initState</span><span style="color:#A6ACCD">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">        // Создаем будущее, которое вызывает функцию get_related_film для запроса</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">        // связанные фильмы.</span></span>
<span class="line"><span style="color:#A6ACCD">    relatedFilmsFuture </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> supabase.</span><span style="color:#ADD7FF">rpc</span><span style="color:#A6ACCD">(</span><span style="color:#5DE4C7">'get_related_film'</span><span style="color:#A6ACCD">, params</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#5DE4C7">      'embedding'</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> widget.film.embedding,</span></span>
<span class="line"><span style="color:#5DE4C7">      'film_id'</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> widget.film.id,</span></span>
<span class="line"><span style="color:#A6ACCD">    }).</span><span style="color:#ADD7FF">withConverter</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">List</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">Film</span><span style="color:#A6ACCD">>>((data) </span><span style="color:#91B4D5">=></span></span>
<span class="line"><span style="color:#ADD7FF">        List</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">Map</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">String</span><span style="color:#A6ACCD">, </span><span style="color:#ADD7FF">dynamic</span><span style="color:#A6ACCD">>>.</span><span style="color:#ADD7FF">from</span><span style="color:#A6ACCD">(data).</span><span style="color:#ADD7FF">map</span><span style="color:#A6ACCD">(</span><span style="color:#ADD7FF">Film</span><span style="color:#A6ACCD">.fromJson).</span><span style="color:#ADD7FF">toList</span><span style="color:#A6ACCD">())</span></span>
<span class="line"><span style="color:#A6ACCD">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">  @override</span></span>
<span class="line"><span style="color:#ADD7FF">  Widget</span><span style="color:#ADD7FF"> build</span><span style="color:#A6ACCD">(</span><span style="color:#ADD7FF">BuildContext</span><span style="color:#A6ACCD"> context) {</span></span>
<span class="line"><span style="color:#A6ACCD">    return </span><span style="color:#ADD7FF">Scaffold</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">      appBar</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> AppBar</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">        title</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> Text</span><span style="color:#A6ACCD">(widget.film.title),</span></span>
<span class="line"><span style="color:#A6ACCD">      ),</span></span>
<span class="line"><span style="color:#A6ACCD">      body</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> ListView</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">        children</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> [</span></span>
<span class="line"><span style="color:#A6ACCD">          герой(</span></span>
<span class="line"><span style="color:#A6ACCD">            tag</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> widget.film.imageUrl,</span></span>
<span class="line"><span style="color:#A6ACCD">            дочерний</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> Image</span><span style="color:#A6ACCD">.</span><span style="color:#ADD7FF">network</span><span style="color:#A6ACCD">(widget.film.imageUrl),</span></span>
<span class="line"><span style="color:#A6ACCD">          ),</span></span>
<span class="line"><span style="color:#ADD7FF">          Padding</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">            padding</span><span style="color:#91B4D5">:</span><span style="color:#5DE4C7"> const</span><span style="color:#ADD7FF"> EdgeInsets</span><span style="color:#A6ACCD">.</span><span style="color:#ADD7FF">all</span><span style="color:#A6ACCD">(</span><span style="color:#5DE4C7">8.0</span><span style="color:#A6ACCD">),</span></span>
<span class="line"><span style="color:#A6ACCD">            дочерний</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> Column</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">              crossAxisAlignment</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> CrossAxisAlignment</span><span style="color:#A6ACCD">.stretch,</span></span>
<span class="line"><span style="color:#A6ACCD">              children</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> [</span></span>
<span class="line"><span style="color:#ADD7FF">                Text</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#ADD7FF">                  DateFormat</span><span style="color:#A6ACCD">.</span><span style="color:#ADD7FF">yMMMd</span><span style="color:#A6ACCD">().</span><span style="color:#ADD7FF">format</span><span style="color:#A6ACCD">(widget.film.releaseDate),</span></span>
<span class="line"><span style="color:#A6ACCD">                  стиль</span><span style="color:#91B4D5">:</span><span style="color:#5DE4C7"> const</span><span style="color:#ADD7FF"> TextStyle</span><span style="color:#A6ACCD">(цвет</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> Colors</span><span style="color:#A6ACCD">.grey),</span></span>
<span class="line"><span style="color:#A6ACCD">                ),</span></span>
<span class="line"><span style="color:#5DE4C7">                const</span><span style="color:#ADD7FF"> SizedBox</span><span style="color:#A6ACCD">(высота</span><span style="color:#91B4D5">:</span><span style="color:#5DE4C7"> 8</span><span style="color:#A6ACCD">),</span></span>
<span class="line"><span style="color:#ADD7FF">                Text</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">                  widget.film.overview,</span></span>
<span class="line"><span style="color:#A6ACCD">                  style</span><span style="color:#91B4D5">:</span><span style="color:#5DE4C7"> const</span><span style="color:#ADD7FF"> TextStyle</span><span style="color:#A6ACCD">(fontSize</span><span style="color:#91B4D5">:</span><span style="color:#5DE4C7"> 16</span><span style="color:#A6ACCD">),</span></span>
<span class="line"><span style="color:#A6ACCD">                ),</span></span>
<span class="line"><span style="color:#5DE4C7">                const</span><span style="color:#ADD7FF"> SizedBox</span><span style="color:#A6ACCD">(высота</span><span style="color:#91B4D5">:</span><span style="color:#5DE4C7"> 24</span><span style="color:#A6ACCD">),</span></span>
<span class="line"><span style="color:#5DE4C7">                const</span><span style="color:#ADD7FF"> Text</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#5DE4C7">                  'Вам также может понравиться:'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">                  style</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> TextStyle</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">                    fontSize</span><span style="color:#91B4D5">:</span><span style="color:#5DE4C7"> 16</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">                    fontWeight</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> FontWeight</span><span style="color:#A6ACCD">.bold,</span></span>
<span class="line"><span style="color:#A6ACCD">                  ),</span></span>
<span class="line"><span style="color:#A6ACCD">                ),</span></span>
<span class="line"><span style="color:#A6ACCD">              ],</span></span>
<span class="line"><span style="color:#A6ACCD">            ),</span></span>
<span class="line"><span style="color:#A6ACCD">          ),</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">                    // Отображение списка связанных фильмов</span></span>
<span class="line"><span style="color:#ADD7FF">          FutureBuilder</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">List</span><span style="color:#A6ACCD">&#x3C;</span><span style="color:#ADD7FF">Film</span><span style="color:#A6ACCD">>>(</span></span>
<span class="line"><span style="color:#A6ACCD">              future</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> relatedFilmsFuture,</span></span>
<span class="line"><span style="color:#A6ACCD">              builder</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> (context, snapshot) {</span></span>
<span class="line"><span style="color:#A6ACCD">                if (snapshot.hasError) {</span></span>
<span class="line"><span style="color:#A6ACCD">                  return </span><span style="color:#ADD7FF">Center</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">                    child</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> Text</span><span style="color:#A6ACCD">(snapshot.error.</span><span style="color:#ADD7FF">toString</span><span style="color:#A6ACCD">()),</span></span>
<span class="line"><span style="color:#A6ACCD">                  );</span></span>
<span class="line"><span style="color:#A6ACCD">                }</span></span>
<span class="line"><span style="color:#A6ACCD">                if (</span><span style="color:#91B4D5">!</span><span style="color:#A6ACCD">snapshot.hasData) {</span></span>
<span class="line"><span style="color:#A6ACCD">                  return </span><span style="color:#5DE4C7">const</span><span style="color:#ADD7FF"> Center</span><span style="color:#A6ACCD">(child</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> CircularProgressIndicator</span><span style="color:#A6ACCD">());</span></span>
<span class="line"><span style="color:#A6ACCD">                }</span></span>
<span class="line"><span style="color:#5DE4C7">                final</span><span style="color:#A6ACCD"> films </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> snapshot.data</span><span style="color:#91B4D5">!</span></span>
<span class="line"><span style="color:#A6ACCD">                return </span><span style="color:#ADD7FF">Wrap</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">                  children</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> films</span></span>
<span class="line"><span style="color:#A6ACCD">                      .</span><span style="color:#ADD7FF">map</span><span style="color:#A6ACCD">((film) </span><span style="color:#91B4D5">=></span><span style="color:#ADD7FF"> InkWell</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">                            onTap</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> () {</span></span>
<span class="line"><span style="color:#ADD7FF">                              Navigator</span><span style="color:#A6ACCD">.</span><span style="color:#ADD7FF">of</span><span style="color:#A6ACCD">(context).</span><span style="color:#ADD7FF">push</span><span style="color:#A6ACCD">(</span><span style="color:#ADD7FF">MaterialPageRoute</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">                                  builder</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> (context) </span><span style="color:#91B4D5">=></span></span>
<span class="line"><span style="color:#ADD7FF">                                      DetailsPage</span><span style="color:#A6ACCD">(film</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> film))))</span></span>
<span class="line"><span style="color:#A6ACCD">                            },</span></span>
<span class="line"><span style="color:#A6ACCD">                            child</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> FractionallySizedBox</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">                              widthFactor</span><span style="color:#91B4D5">:</span><span style="color:#5DE4C7"> 0.5</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">                              дочерний</span><span style="color:#91B4D5">:</span><span style="color:#ADD7FF"> FilmCell</span><span style="color:#A6ACCD">(</span></span>
<span class="line"><span style="color:#A6ACCD">                                фильм</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCD"> фильм,</span></span>
<span class="line"><span style="color:#A6ACCD">                                isHeroEnabled</span><span style="color:#91B4D5">:</span><span style="color:#5DE4C7"> false</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">                                fontSize</span><span style="color:#91B4D5">:</span><span style="color:#5DE4C7"> 16</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">                              ),</span></span>
<span class="line"><span style="color:#A6ACCD">                            ),</span></span>
<span class="line"><span style="color:#A6ACCD">                          ))</span></span>
<span class="line"><span style="color:#A6ACCD">                      .</span><span style="color:#ADD7FF">toList</span><span style="color:#A6ACCD">(),</span></span>
<span class="line"><span style="color:#A6ACCD">                );</span></span>
<span class="line"><span style="color:#A6ACCD">              }),</span></span>
<span class="line"><span style="color:#A6ACCD">        ],</span></span>
<span class="line"><span style="color:#A6ACCD">      ),</span></span>
<span class="line"><span style="color:#A6ACCD">    );</span></span>
<span class="line"><span style="color:#A6ACCD">  }</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span></code></pre>
<p>Вот и все. Теперь у нас есть функционирующая система рекомендаций по сходству на основе Open AI, встроенная в наше приложение Flutter. В качестве контекста сегодня использовались фильмы, но вы можете легко представить, что эту же концепцию можно применить и к другим типам контента.</p>
<h2 id="afterthoughts"><a href="https://dev.to/supabase/how-to-build-a-content-recommendation-feature-using-flutter-open-ai-and-supabase-3mg4#afterthoughts" rel="noopener noreferrer nofollow" target="_blank"></a>Afterthoughts<a aria-hidden="true" tabindex="-1" href="#afterthoughts"><span class="icon icon-link"></span></a></h2>
<p>В этой статье мы рассмотрели, как можно взять один фильм и порекомендовать список фильмов, похожих на выбранный. Это хорошо работает, но у нас есть только один образец для получения сходства. А что, если мы хотим рекомендовать список фильмов для просмотра, основываясь, скажем, на последних 10 фильмах, которые смотрел пользователь? Существует множество способов решения подобных проблем, и я надеюсь, что прочтение этой статьи пробудило ваше интеллектуальное любопытство к решению подобных проблем.</p>
<h2 id="ресурсы"><a href="https://dev.to/supabase/how-to-build-a-content-recommendation-feature-using-flutter-open-ai-and-supabase-3mg4#resources" rel="noopener noreferrer nofollow" target="_blank"></a>Ресурсы<a aria-hidden="true" tabindex="-1" href="#ресурсы"><span class="icon icon-link"></span></a></h2>
<ul>
<li><a href="https://github.com/dshukertjr/flutter-movie-recommendation" rel="noopener noreferrer nofollow" target="_blank">Полная кодовая база приложения из этой статьи</a></li>
<li>
<div class="remark-oembed-inline remark-oembed-you-tube" data-oembed=""><iframe width="200" height="150" src="https://www.youtube.com/embed/pG95GO0Kcxs?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen title="Using OpenAI embeddings on Supabase database - SupabaseTips"></iframe></div>
</li>
<li><a href="https://supabase.com/docs/guides/database/extensions/pgvector" rel="noopener noreferrer nofollow" target="_blank">Supabase pgvector guide</a></li>
<li><a href="https://supabase.com/docs/guides/database/extensions/pgvector" rel="noopener noreferrer nofollow" target="_blank">Хранение вкраплений OpenAI в Postgres с помощью pgvector</a></li>
</ul> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как создать функцию рекомендации контента с помощью Flutter, Open AI и Supabase&url=https://igorlov.ru/blog/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase&title=Как создать функцию рекомендации контента с помощью Flutter, Open AI и Supabase&summary=Рекомендация релевантного контента пользователю очень важна для поддержания его интереса к приложению. Хотя это обычная функция, которую мы хотели бы иметь в н&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-sozdat-funktsyiu-rekomendatsyy-kontenta-s-pomoschiu-flutter-open-ai-y-supabase&media=&description=Рекомендация релевантного контента пользователю очень важна для поддержания его интереса к приложению. Хотя это обычная функция, которую мы хотели бы иметь в н" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/kak-sozdat-ffekt-lypkoi-prokrutky-s-pomoschiu-javascript" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> Как создать эффект липкой прокрутки с помощью JavaScript </a> <a href="/blog/kak-razvernut-full-stack-amazon-clone-s-pomoschiu-next-js-tailwind-css-zustand-y-nest-js-na-aptible" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Как развернуть Full Stack Amazon Clone с помощью Next.js, Tailwind CSS, Zustand и Nest.js на Aptible </a> </nav>  </div> </div> </article> <div class="container" data-astro-cid-axzg2cw6> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.D-6fTqBY.js" component-export="default" renderer-url="/_astro/client.Bd2Qst3j.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> </div> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="Z2a8j9B" component-url="/_astro/CommentBlock.ChJFdf82.js" component-export="default" renderer-url="/_astro/client.44T8euMP.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>