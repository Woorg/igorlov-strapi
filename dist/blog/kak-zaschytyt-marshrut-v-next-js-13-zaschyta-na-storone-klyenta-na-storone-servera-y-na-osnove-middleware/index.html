<!DOCTYPE html><html lang="ru"> <head><title>Как защитить маршруты в Next.js 13 - защита на стороне клиента, на стороне сервера и на основе Middleware - Фул Фронт Дев</title><link rel="canonical" href="https://igorlov.ru/blog/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware"><meta name="description" content="Вебприложения часто работают с конфиденциальными данными и административными функциями, которые должны быть доступны только аутентифицированным пользователям."><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.10.0"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.Dg72Zwgc.css">
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#0d52a1;color:rgba(13,82,161,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw)}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.container[data-astro-cid-vcbh62el]{padding:min(2rem,1.2125rem + 1.05vw)}.list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.link[data-astro-cid-vcbh62el]{font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s;padding:.125rem .75rem;font-size:min(1.5rem,1.1625rem + .45vw);line-height:var(--tw-lh)}
</style>
<link rel="stylesheet" href="/_astro/_single_.CzD8Xhhr.css">
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#27292d;border-color:rgba(39,41,45,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.comments[data-v-f9c4118f]{margin:auto;margin-top:1.25rem;width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.comments:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame[data-v-f9c4118f]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/hoisted.CUFolni_.js"></script><style>[data-astro-transition-scope="astro-xdjatz7t-1"] { view-transition-name: blog-image-kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-16 font-inter text-blue fluid:text-lg lg:pt-24 dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <symbol id="ai:local:logo-one"><g fill="currentColor"><path d="M1198.57 596.749c0 329.575-267.171 596.751-596.747 596.751-329.575 0-596.749-267.176-596.749-596.751S272.248 0 601.823 0c329.576 0 596.747 267.174 596.747 596.749Z"/><circle cx="3035.75" cy="617.751" r="596.749" transform="rotate(-90 3035.75 617.751)"/><path d="M3035.75 2736.81c329.57 0 596.75 267.18 596.75 596.75 0 329.58-267.18 596.75-596.75 596.75-329.58 0-596.75-267.17-596.75-596.75 0-329.57 267.17-596.75 596.75-596.75Z"/><circle cx="596.749" cy="1964.8" r="596.749"/><path d="M1193.5 3332.87c0 329.57-267.176 596.75-596.751 596.75S0 3662.44 0 3332.87c0-329.58 267.174-596.75 596.749-596.75 329.575 0 596.751 267.17 596.751 596.75Z"/><circle cx="5062.46" cy="617.751" r="596.749" transform="rotate(-90 5062.46 617.751)"/><circle cx="5062.46" cy="3333.56" r="596.749" transform="rotate(-90 5062.46 3333.56)"/></g></symbol><use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> Меню</button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> Закрыть</button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты </a> </li> </ul> </nav> </div>   <!-- <ThemeToggle client:only /> --> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <div class="container" data-astro-cid-vcbh62el> <ol class="list" role="list" data-astro-cid-vcbh62el> <li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </div> </nav>  <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <article data-astro-cid-axzg2cw6> <figure class="article__image" data-astro-cid-axzg2cw6> <picture data-astro-cid-axzg2cw6> <source srcset="/_astro/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware-Dec-15-2023.1bD10gtk_Z1LY6Tv.avif" type="image/avif"><source srcset="/_astro/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware-Dec-15-2023.1bD10gtk_ZiKLpu.webp" type="image/webp"> <img src="/_astro/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware-Dec-15-2023.1bD10gtk_h3EXY.png" alt="Как защитить маршруты в Next.js 13 - защита на стороне клиента, на стороне сервера и на основе Middleware" class="aspect-video h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-xdjatz7t-1" width="1120" height="580" decoding="async"> </picture> </figure> </article> <div class="container" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <ul class="article__categories categories" data-astro-cid-axzg2cw6> <li class="categories__item" data-astro-cid-axzg2cw6> <a href="/category/как-закодить" class="categories__link" data-astro-cid-axzg2cw6> Как закодить  </a> </li> </ul> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Как защитить маршруты в Next.js 13 - защита на стороне клиента, на стороне сервера и на основе Middleware </h1> <ul class="article__tags tags" data-astro-cid-axzg2cw6> <li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/nextjs" data-astro-cid-axzg2cw6> Next.js </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/secure-routes" data-astro-cid-axzg2cw6> Secure Routes </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/middleware" data-astro-cid-axzg2cw6> Middleware </a> </li> </ul> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 15 дек., 2023 by Igor Gorlov </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div> <div class="article__content prose prose-zinc max-w-full break-words text-blue dark:prose-invert prose-headings:text-blue prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <!-- <TextAds /> --> <!-- <AdfoxTocAds blockId="adfox_17062261612859555" /> --> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как защитить маршруты в Next.js 13 - защита на стороне клиента, на стороне сервера и на основе Middleware&url=https://igorlov.ru/blog/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware&title=Как защитить маршруты в Next.js 13 - защита на стороне клиента, на стороне сервера и на основе Middleware&summary=Вебприложения часто работают с конфиденциальными данными и административными функциями, которые должны быть доступны только аутентифицированным пользователям.&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware&media=&description=Вебприложения часто работают с конфиденциальными данными и административными функциями, которые должны быть доступны только аутентифицированным пользователям." target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <details open class="toc border-b border-blue text-blue fluid:p-8 overflow-auto cursor-pointer bg-box"><summary class="toc__title text-xl font-medium">Содержание</summary><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#введение">Введение</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#маршрутизация-в-nextjs">Маршрутизация в Next.js</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#как-создать-маршрут-в-nextjs">Как создать маршрут в Next.js</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#защита-маршрутов-на-стороне-клиента">Защита маршрутов на стороне клиента</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#защита-маршрутов-на-стороне-сервера">Защита маршрутов на стороне сервера</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#защита-маршрутов-на-основе-промежуточного-по">Защита маршрутов на основе промежуточного ПО</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#заключение">Заключение</a></li></ol></details open><p>Веб-приложения часто работают с конфиденциальными данными и административными функциями, которые должны быть доступны только аутентифицированным пользователям. В таких случаях защита маршрутов приобретает решающее значение для защиты этих маршрутов от несанкционированного доступа.</p>
<p>В этом уроке мы рассмотрим, как защитить маршруты в Next.js 13 с помощью трех различных методов. Мы узнаем, как защитить маршруты на стороне клиента и на стороне сервера, а также с помощью промежуточного ПО.</p>
<h2 id="введение">Введение<a aria-hidden="true" tabindex="-1" href="#введение"><span class="icon icon-link"></span></a></h2>
<p>Защита маршрутов - важный аспект разработки веб-приложений. Она очень нужна при обработке процесса аутентификации в вашем приложении.</p>
<p>Она включает в себя контроль доступа к определенным маршрутам в зависимости от статуса аутентификации пользователя. Например, вы не хотите, чтобы неавторизованный пользователь получил доступ к панели администратора или просмотрел конфиденциальные данные пользователя.</p>
<p>Прежде чем мы отправимся в это путешествие, приведем некоторые предварительные условия, чтобы вы получили максимум пользы от этого руководства:</p>
<ul>
<li>Базовое понимание Next.js, Node.js и JavaScript</li>
<li>Знакомство с менеджерами пакетов, такими как NPM или Yarn</li>
<li>Редактор кода по вашему выбору (например, Visual Studio Code)</li>
<li>Node.js и npm (или yarn) установлены на вашей машине.</li>
</ul>
<p>Давайте вкратце обсудим, что такое Next.js. Согласно официальной [документации] (<a href="https://nextjs.org/docs/getting-started/installation" rel="noopener noreferrer nofollow" target="_blank">https://nextjs.org/docs/getting-started/installation</a>), компания Vercel создала Next.js - фреймворк React, используемый в основном для создания полнофункциональных веб-приложений. Next.js предлагает различные возможности, включая маршрутизацию системы на основе файлов, рендеринг как на стороне клиента, так и на стороне сервера, оптимизацию изображений и расширенную поддержку TypeScript.</p>
<p>Чтобы начать создавать веб-приложения с помощью Next.js, вы можете создать новый проект Next.js с помощью следующих команд:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">npx</span><span style="color:#ADD7FF"> create-next-app@latest</span></span>
<span class="line"></span></code></pre>
<p>После успешной установки вы получите несколько предложений по настройке вашего приложения Next.js. Я рекомендую выбрать маршрутизатор приложений, так как это рекомендуемый выбор для маршрутизации в Next.js 13. В этом руководстве мы будем использовать Tailwind CSS для стилизации и TypeScript.</p>
<h2 id="маршрутизация-в-nextjs">Маршрутизация в Next.js<a aria-hidden="true" tabindex="-1" href="#маршрутизация-в-nextjs"><span class="icon icon-link"></span></a></h2>
<p>В отличие от приложений React, которые часто полагаются на сторонние пакеты вроде <strong>react-router-dom</strong> для маршрутизации, Next.js 13 имеет свой собственный встроенный маршрутизатор приложений. Этот маршрутизатор поддерживает общие макеты, вложенную маршрутизацию, состояния загрузки, обработку ошибок и многое другое.</p>
<p>Next.js использует файловую систему маршрутизации. Это означает, что папки, содержащие файлы page.js, определяют маршруты. Папка также может содержать одну или несколько вложенных папок.</p>
<p>Next.js упрощает реализацию защищенных маршрутов. Прежде чем перейти к созданию защищенных маршрутов в Next.js, давайте разберемся, как создаются маршруты.</p>
<h2 id="как-создать-маршрут-в-nextjs">Как создать маршрут в Next.js<a aria-hidden="true" tabindex="-1" href="#как-создать-маршрут-в-nextjs"><span class="icon icon-link"></span></a></h2>
<p>Чтобы продемонстрировать различные способы защиты маршрутов в Next.js 13, мы создадим маршруты: <strong>Дома</strong>, <strong>Панели</strong>, <strong>Админа</strong>, <strong>Настройки</strong> и <strong>Профиль</strong>.</p>
<p>Давайте выполним некоторую очистку кода. Удалите весь код, находящийся в файле <strong>“page.tsx ”</strong> папки app, и вставьте следующий код:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="tsx"><code><span class="line"><span style="color:#767C9DB0;font-style:italic">// app/page.tsx</span></span>
<span class="line"><span style="color:#E4F0FB">&#x3C;</span><span style="color:#5DE4C7">main</span><span style="color:#91B4D5;font-style:italic"> className</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">flex h-screen items-center justify-center text-center</span><span style="color:#A6ACCD">"</span><span style="color:#E4F0FB">>Домашняя страница&#x3C;/</span><span style="color:#5DE4C7">main</span><span style="color:#E4F0FB">></span></span>
<span class="line"></span></code></pre>
<p>Файл <strong>“page.tsx ”</strong> в папке app будет служить домашней страницей для этого руководства. Внутри папки app создайте папку “Profile”, а в ней - файл “page.tsx”. Добавьте в него следующий код:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="tsx"><code><span class="line"><span style="color:#767C9DB0;font-style:italic">// profile/page.tsx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E4F0FB">&#x3C;</span><span style="color:#5DE4C7">main</span><span style="color:#91B4D5;font-style:italic"> className</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">flex h-screen items-center justify-center text-center</span><span style="color:#A6ACCD">"</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">	&#x3C;</span><span style="color:#5DE4C7">div</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;</span><span style="color:#5DE4C7">h1</span><span style="color:#E4F0FB">>Страница профиля&#x3C;/</span><span style="color:#5DE4C7">h1</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">	&#x3C;/</span><span style="color:#5DE4C7">div</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">&#x3C;/</span><span style="color:#5DE4C7">main</span><span style="color:#E4F0FB">></span></span>
<span class="line"></span></code></pre>
<p>Повторите этот процесс для папок “Dashboard”, “Admin” и “Settings”. Каждая из них должна содержать файл “page.tsx”. Если вы выполнили эти действия, значит, вы успешно настроили свои маршруты.</p>
<p>Как уже говорилось ранее, мы обсудим различные способы защиты маршрутов.</p>
<h2 id="защита-маршрутов-на-стороне-клиента">Защита маршрутов на стороне клиента<a aria-hidden="true" tabindex="-1" href="#защита-маршрутов-на-стороне-клиента"><span class="icon icon-link"></span></a></h2>
<p>Защита маршрутов на стороне клиента подходит для сценариев, в которых вы хотите предотвратить доступ неаутентифицированных пользователей к определенным частям вашего приложения на стороне клиента.</p>
<p>Вы захотите использовать этот способ, если вам нужен быстрый и простой способ защиты маршрутов без сложных процессов аутентификации. Он идеально подходит для публичных веб-сайтов или областей с минимальными требованиями к безопасности.</p>
<p>Мы не будем использовать процессы аутентификации, чтобы не усложнять учебник. Вместо этого мы создадим функцию, которая будет хранить значение аутентификации.</p>
<p>Чтобы упростить аутентификацию, создайте файл “Auth.ts” в папке Utils, которая должна находиться в корне приложения Next.js. Файл должен содержать следующий код:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#5DE4C7">export</span><span style="color:#91B4D5"> const</span><span style="color:#E4F0FB"> isAuthenticated</span><span style="color:#91B4D5"> =</span><span style="color:#D0679D"> false</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span></code></pre>
<p>Чтобы защитить маршрут <code>Profile</code> внутри клиентского компонента, мы будем использовать <code>useLayoutEffect</code>. Давайте посмотрим, как это работает, рассмотрев приведенный ниже код:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="tsx"><code><span class="line"><span style="color:#767C9DB0;font-style:italic">// profile/page.tsx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">use client</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import </span><span style="color:#A6ACCD">{</span><span style="color:#ADD7FF"> isAuthenticated</span><span style="color:#A6ACCD"> }</span><span style="color:#A6ACCD"> from</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">@/Utils/Auth</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import </span><span style="color:#A6ACCD">{</span><span style="color:#ADD7FF"> redirect</span><span style="color:#A6ACCD"> }</span><span style="color:#A6ACCD"> from</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">next/navigation</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import </span><span style="color:#A6ACCD">{</span><span style="color:#ADD7FF"> useLayoutEffect</span><span style="color:#A6ACCD"> }</span><span style="color:#A6ACCD"> from</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">react</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#ADD7FF"> Profile</span><span style="color:#91B4D5"> =</span><span style="color:#A6ACCD"> () </span><span style="color:#91B4D5">=></span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#E4F0FBD0">	useLayoutEffect</span><span style="color:#A6ACCD">(() </span><span style="color:#91B4D5">=></span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#91B4D5">		const</span><span style="color:#E4F0FB"> isAuth</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> isAuthenticated</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">		if (</span><span style="color:#91B4D5">!</span><span style="color:#E4F0FB">isAuth</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#E4F0FBD0">			redirect</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">/</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#A6ACCD">		}</span></span>
<span class="line"><span style="color:#A6ACCD">	}, []);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7C0">	return</span><span style="color:#A6ACCD"> (</span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;</span><span style="color:#5DE4C7">main</span><span style="color:#91B4D5;font-style:italic"> className</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">flex h-screen items-center justify-center text-center</span><span style="color:#A6ACCD">"</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">			&#x3C;</span><span style="color:#5DE4C7">div</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">				&#x3C;</span><span style="color:#5DE4C7">h1</span><span style="color:#E4F0FB">>Профиль&#x3C;/</span><span style="color:#5DE4C7">h1</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">			&#x3C;/</span><span style="color:#5DE4C7">div</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;/</span><span style="color:#5DE4C7">main</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#A6ACCD">	);</span></span>
<span class="line"><span style="color:#A6ACCD">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7">export default </span><span style="color:#E4F0FB">Profile</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span></code></pre>
<p>В этом примере кода мы продемонстрировали простой, но эффективный метод защиты маршрутов в клиентском компоненте.</p>
<p>Объединив хук <code>useLayoutEffect</code> с проверкой аутентификации и функцией <strong>redirect</strong>, мы создали базовый механизм защиты маршрутов. Неавторизованные пользователи перенаправляются с защищенного маршрута на маршрут “Home”, что повышает безопасность вашего приложения.</p>
<p>Внутри компонента <code>Profile</code> мы используем хук <code>useLayoutEffect</code> для проверки статуса аутентификации пользователя при установке компонента. Мы вызываем функцию <code>isAuthenticated</code> и сохраняем ее результат в переменной <code>isAuth</code>.</p>
<p>Если пользователь аутентифицирован, <code>isAuth</code> будет true - в противном случае, false. Мы проверяем, не прошел ли пользователь аутентификацию (то есть, если <code>isAuth</code> равно false). Если нет, мы используем функцию <code>redirect</code>, чтобы отправить его обратно на главную или другую целевую страницу. Это эффективно предотвращает доступ неаутентифицированных пользователей к защищенному маршруту.</p>
<p>В качестве альтернативы мы можем рефакторить приведенный выше код для защиты маршрута <code>Profile</code> с помощью <strong>Higher Order Component (HOC)</strong>, что является более чистым способом защиты маршрута на стороне клиента.</p>
<p>Чтобы использовать HOC, мы создадим файл в папке “components” под названием <code>isAuth</code> и добавим в него следующий код:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="tsx"><code><span class="line"><span style="color:#767C9DB0;font-style:italic">// isAuth.tsx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">use client</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import </span><span style="color:#A6ACCD">{</span><span style="color:#ADD7FF"> isAuthenticated</span><span style="color:#A6ACCD"> }</span><span style="color:#A6ACCD"> from</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">@/Utils/Auth</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import </span><span style="color:#A6ACCD">{</span><span style="color:#ADD7FF"> useEffect</span><span style="color:#A6ACCD"> }</span><span style="color:#A6ACCD"> from</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">react</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import </span><span style="color:#A6ACCD">{</span><span style="color:#ADD7FF"> redirect</span><span style="color:#A6ACCD"> }</span><span style="color:#A6ACCD"> from</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">next/navigation</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7">export default </span><span style="color:#91B4D5">function</span><span style="color:#ADD7FF"> isAuth</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">Component</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCDC0"> any</span><span style="color:#A6ACCD">)</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#5DE4C7C0">	return</span><span style="color:#91B4D5"> function</span><span style="color:#ADD7FF"> IsAuth</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">props</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCDC0"> any</span><span style="color:#A6ACCD">)</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#91B4D5">		const</span><span style="color:#E4F0FB"> auth</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> isAuthenticated</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E4F0FBD0">		useEffect</span><span style="color:#A6ACCD">(()</span><span style="color:#91B4D5"> =></span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#A6ACCD">			if</span><span style="color:#A6ACCD"> (</span><span style="color:#91B4D5">!</span><span style="color:#E4F0FB">auth</span><span style="color:#A6ACCD">)</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#5DE4C7C0">				return</span><span style="color:#E4F0FBD0"> redirect</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">/</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#A6ACCD">			}</span></span>
<span class="line"><span style="color:#A6ACCD">		},</span><span style="color:#A6ACCD"> []);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">		if</span><span style="color:#A6ACCD"> (</span><span style="color:#91B4D5">!</span><span style="color:#E4F0FB">auth</span><span style="color:#A6ACCD">)</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#5DE4C7C0">			return</span><span style="color:#D0679D"> null</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7C0">		return</span><span style="color:#E4F0FB"> &#x3C;</span><span style="color:#5DE4C7">Component</span><span style="color:#E4F0FB"> {</span><span style="color:#91B4D5">...</span><span style="color:#E4F0FB">props} /></span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">	};</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span></code></pre>
<p>В приведенном выше коде определен компонент высшего порядка (isAuth), который проверяет статус аутентификации пользователя. Если пользователь не аутентифицирован, он предотвращает отрисовку защищенного компонента и перенаправляет его на домашнюю страницу.</p>
<p>Этот компонент высшего порядка будет использоваться для защиты маршрута “Dashboard” в нашем приложении путем обертывания им защищенного компонента, как показано ниже:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="tsx"><code><span class="line"><span style="color:#767C9DB0;font-style:italic">// dashboard/page.tsx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7">import </span><span style="color:#ADD7FF">isAuth</span><span style="color:#A6ACCD"> from</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">@/Components/isAuth</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#ADD7FF"> Dashboard</span><span style="color:#91B4D5"> =</span><span style="color:#A6ACCD"> () </span><span style="color:#91B4D5">=></span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#5DE4C7C0">	return</span><span style="color:#E4F0FB"> &#x3C;</span><span style="color:#5DE4C7">main</span><span style="color:#91B4D5;font-style:italic"> className</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7"> flex h-screen items-center justify-center</span><span style="color:#A6ACCD">"</span><span style="color:#E4F0FB">>Панель управления&#x3C;/</span><span style="color:#5DE4C7">main</span><span style="color:#E4F0FB">></span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7">export default </span><span style="color:#E4F0FBD0">isAuth</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">Dashboard</span><span style="color:#A6ACCD">);</span></span>
<span class="line"></span></code></pre>
<p>Приведенный выше код интегрирует HOC <code>isAuth</code> с компонентом Dashboard, гарантируя, что приборная панель защищена и доступ к ней могут получить только аутентифицированные пользователи. Если пользователь не прошел аутентификацию, он будет перенаправлен на другой маршрут, определенный HOC <code>isAuth</code>.</p>
<p>Ура! Мы успешно защитили наши маршруты на стороне клиента, используя <code>useLayoutEffect</code> и компоненты высшего порядка.</p>
<h2 id="защита-маршрутов-на-стороне-сервера">Защита маршрутов на стороне сервера<a aria-hidden="true" tabindex="-1" href="#защита-маршрутов-на-стороне-сервера"><span class="icon icon-link"></span></a></h2>
<p>Защита на стороне сервера используется по умолчанию для компонентов Next.js. Она отлично подходит для обеспечения защиты содержимого, рендеримого на сервере. Обычно ее используют, когда нужно защитить маршруты, которые не должны быть доступны для неаутентифицированных пользователей, чтобы не допустить раскрытия конфиденциальной информации.</p>
<p>Защита маршрутов на стороне сервера не представляет собой ничего сложного. Мы можем согласиться с тем, что все компоненты в Next.js по умолчанию являются серверными компонентами. Вы можете защитить свои маршруты на стороне сервера, как показано ниже:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="tsx"><code><span class="line"><span style="color:#767C9DB0;font-style:italic">// admin/page.tsx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7">import </span><span style="color:#A6ACCD">{</span><span style="color:#ADD7FF"> isAuthenticated</span><span style="color:#A6ACCD"> }</span><span style="color:#A6ACCD"> from</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">@/Utils/Auth</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import </span><span style="color:#A6ACCD">{</span><span style="color:#ADD7FF"> redirect</span><span style="color:#A6ACCD"> }</span><span style="color:#A6ACCD"> from</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">next/navigation</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#ADD7FF"> Admin</span><span style="color:#91B4D5"> =</span><span style="color:#A6ACCD"> () </span><span style="color:#91B4D5">=></span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#91B4D5">	const</span><span style="color:#E4F0FB"> isAuth</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> isAuthenticated</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">	if (</span><span style="color:#91B4D5">!</span><span style="color:#E4F0FB">isAuth</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#E4F0FBD0">		redirect</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">/</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#A6ACCD">	}</span></span>
<span class="line"><span style="color:#5DE4C7C0">	return</span><span style="color:#A6ACCD"> (</span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;</span><span style="color:#5DE4C7">main</span><span style="color:#91B4D5;font-style:italic"> className</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">flex h-screen items-center justify-center text-center</span><span style="color:#A6ACCD">"</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">			&#x3C;</span><span style="color:#5DE4C7">div</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">				&#x3C;</span><span style="color:#5DE4C7">h1</span><span style="color:#E4F0FB">>Страница администратора&#x3C;/</span><span style="color:#5DE4C7">h1</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">			&#x3C;/</span><span style="color:#5DE4C7">div</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;/</span><span style="color:#5DE4C7">main</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#A6ACCD">	);</span></span>
<span class="line"><span style="color:#A6ACCD">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7">export default </span><span style="color:#E4F0FB">Admin</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span></code></pre>
<p>Приведенный выше код демонстрирует защиту маршрутов в серверных компонентах, гарантируя, что только аутентифицированные пользователи смогут получить доступ к странице администратора. Если неавторизованный пользователь попытается получить доступ к этому маршруту, он будет перенаправлен на домашнюю страницу.</p>
<h2 id="защита-маршрутов-на-основе-промежуточного-по">Защита маршрутов на основе промежуточного ПО<a aria-hidden="true" tabindex="-1" href="#защита-маршрутов-на-основе-промежуточного-по"><span class="icon icon-link"></span></a></h2>
<p>Защита маршрутов на основе промежуточного ПО в Next.js - это мощный подход к обеспечению безопасности и контролю доступа к определенным маршрутам в приложении Next.js. Он включает в себя использование функций промежуточного ПО для перехвата входящих запросов и применения правил, касающихся доступности маршрутов.</p>
<p>Это мощный подход, подходящий для сценариев, в которых вам нужен тонкий контроль над доступом к маршрутам. Его часто используют для более сложных приложений, особенно при работе с конфиденциальными данными или ролями и разрешениями пользователей.</p>
<p>Среднее ПО позволяет перехватывать запросы и применять пользовательские правила, что делает его идеальным для применения строгих политик безопасности.</p>
<p>Эта концепция очень важна для обеспечения доступа только авторизованных пользователей к защищенным маршрутам, которые часто содержат конфиденциальные данные или требуют особых привилегий. Защита маршрутов на основе ПО Middleware может использоваться как на сервере, так и на клиентских компонентах.</p>
<p>Мы собираемся защитить маршрут ”Настройки” с помощью middleware. Для этого мы создадим файл <code>middleware.ts</code>. Файл middleware принято создавать в корневой папке (на том же уровне, что и папка приложения или страницы) или в папке <strong>src</strong>, если это применимо.</p>
<p>Затем мы защитим наш маршрут <code>Settings</code>, добавив следующий код:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#767C9DB0;font-style:italic">//middleware.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7">import </span><span style="color:#A6ACCD">{</span><span style="color:#ADD7FF"> isAuthenticated</span><span style="color:#A6ACCD"> }</span><span style="color:#A6ACCD"> from</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">@/Utils/Auth</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import </span><span style="color:#A6ACCD">{</span><span style="color:#ADD7FF"> NextResponse</span><span style="color:#A6ACCD"> }</span><span style="color:#A6ACCD"> from</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">next/server</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#5DE4C7">import </span><span style="color:#A6ACCD">type</span><span style="color:#A6ACCD"> {</span><span style="color:#ADD7FF"> NextRequest</span><span style="color:#A6ACCD"> }</span><span style="color:#A6ACCD"> from</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">next/server</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> protectedRoutes</span><span style="color:#91B4D5"> =</span><span style="color:#A6ACCD"> [</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">/settings</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7">export default </span><span style="color:#91B4D5">function</span><span style="color:#ADD7FF"> middleware</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">req</span><span style="color:#91B4D5">:</span><span style="color:#A6ACCDC0"> NextRequest</span><span style="color:#A6ACCD">)</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#A6ACCD">	if</span><span style="color:#A6ACCD"> (</span><span style="color:#91B4D5">!</span><span style="color:#E4F0FB">isAuthenticated</span><span style="color:#91B4D5"> &#x26;&#x26;</span><span style="color:#E4F0FB"> protectedRoutes</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">includes</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">req</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">nextUrl</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">pathname</span><span style="color:#A6ACCD">))</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#91B4D5">		const</span><span style="color:#E4F0FB"> absoluteURL</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7"> new </span><span style="color:#E4F0FBD0">URL</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">/</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span><span style="color:#E4F0FB"> req</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">nextUrl</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">origin</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#5DE4C7C0">		return</span><span style="color:#E4F0FB"> NextResponse</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">redirect</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">absoluteURL</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">toString</span><span style="color:#A6ACCD">());</span></span>
<span class="line"><span style="color:#A6ACCD">	}</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span></code></pre>
<p>Приведенный выше код обеспечивает основанный на промежуточном программном обеспечении подход к защите страницы ”Настройки” в приложении Next.js. Он проверяет, не аутентифицирован ли пользователь, и соответствует ли запрашиваемый путь одному из защищенных маршрутов.</p>
<p>В приведенном выше коде функция <code>isAuthenticated</code> импортируется из модуля @/Utils/Auth. Эта функция отвечает за проверку статуса аутентификации пользователя. Если пользователь аутентифицирован, она возвращает true, в противном случае - false.</p>
<p><code>NextResponse</code> и <code>NextRequest</code> являются частью API бессерверных функций Next.js для обработки HTTP-запросов и ответов.</p>
<p>Определяется массив <code>protectedRoutes</code>, содержащий путь(и) маршрута(ов), нуждающегося(ихся) в защите. В данном случае в него входит маршрут <code>/settings</code>. Функция промежуточного ПО выполняется перед обработкой запроса и служит промежуточным ПО, отвечающим за защиту маршрутов.</p>
<p>Внутри функции промежуточного ПО проверяется, не аутентифицирован ли пользователь (<code>!isAuthenticated</code>) и не совпадает ли запрашиваемый путь (<code>req.nextUrl.pathname</code>) с одним из защищенных маршрутов. Если оба условия выполнены, создается абсолютный URL, указывающий на корневой путь (”/”) приложения, с использованием нового URL (”/”, req.nextUrl.origin). Затем используется <code>NextResponse.redirect</code> для выполнения перенаправления на построенный абсолютный URL.</p>
<h2 id="заключение">Заключение<a aria-hidden="true" tabindex="-1" href="#заключение"><span class="icon icon-link"></span></a></h2>
<p>Защита маршрутов - неотъемлемый аспект разработки веб-приложений, особенно при работе с конфиденциальными данными или ограничении доступа к определенным функциям.</p>
<p>В этом руководстве мы рассмотрели три комплексных метода защиты маршрутов в Next.js 13, обеспечивающих защиту неавторизованных пользователей. Применяя эти методы, вы сможете укрепить безопасность своего приложения и улучшить общий пользовательский опыт.</p>
<p>Благодаря знаниям, полученным из этого руководства, вы сможете защитить маршруты своего приложения Next.js, создав более безопасную и удобную работу. Независимо от того, какую защиту вы выберете - клиентскую, серверную или на основе промежуточного ПО, - цель остается неизменной: обеспечить целостность приложения и защитить данные пользователей.</p>
<p>Если у вас возникли вопросы или вам нужна дополнительная помощь, не стесняйтесь изучить дополнительные ресурсы или обратиться к сообществу Next.js. Вы также можете получить доступ к CodeSandbox для этого руководства <a href="https://codesandbox.io/p/sandbox/next-private-route-tutorial-456dmq?file=%2Fmiddleware.ts%3A9%2C2" rel="noopener noreferrer nofollow" target="_blank">здесь</a>.</p>
<p>Удачного кодирования и безопасной маршрутизации в ваших приложениях Next.js!</p> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как защитить маршруты в Next.js 13 - защита на стороне клиента, на стороне сервера и на основе Middleware&url=https://igorlov.ru/blog/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware&title=Как защитить маршруты в Next.js 13 - защита на стороне клиента, на стороне сервера и на основе Middleware&summary=Вебприложения часто работают с конфиденциальными данными и административными функциями, которые должны быть доступны только аутентифицированным пользователям.&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-zaschytyt-marshrut-v-next-js-13-zaschyta-na-storone-klyenta-na-storone-servera-y-na-osnove-middleware&media=&description=Вебприложения часто работают с конфиденциальными данными и административными функциями, которые должны быть доступны только аутентифицированным пользователям." target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/kak-yzbezhat-tormozhenyia-microsoft-graph-api-y-optymyzyrovat-setevoi-trafyk" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> Как избежать торможения Microsoft Graph API и оптимизировать сетевой трафик </a> <a href="/blog/kak-dobavyt-google-analytics-na-vash-sait-astro" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Как добавить Google Analytics на ваш сайт Astro </a> </nav>  </div> </div> </article> <div class="container" data-astro-cid-axzg2cw6> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.D-6fTqBY.js" component-export="default" renderer-url="/_astro/client.Bd2Qst3j.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> </div> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="Z1U3gfI" component-url="/_astro/CommentBlock.ChJFdf82.js" component-export="default" renderer-url="/_astro/client.44T8euMP.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>