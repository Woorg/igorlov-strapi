<!DOCTYPE html><html lang="ru"> <head><title>Как я оптимизировал работу своего Active Admin с помощью 4 простых приемов | Игорь Горлов - Фронтeндер</title><link rel="canonical" href="https://igorlov.ru/blog/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov"><meta name="description" content="ActiveAdmin  это широко используемый инструмент для создания интерфейсов администратора в приложениях на Ruby on Rails. Он невероятно полезен для быстрой наст"><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.5.1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.uIaUWrkB.css" />
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw);padding-left:min(2rem,1.2125rem + 1.05vw);padding-right:min(2rem,1.2125rem + 1.05vw);padding-top:1rem;padding-bottom:1rem}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.breadcrumbs__list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.breadcrumbs__link[data-astro-cid-vcbh62el]{border-radius:9999px;--tw-bg-opacity: 1;background-color:#fef9f8;background-color:rgba(254,249,248,var(--tw-bg-opacity));font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.breadcrumbs__link[data-astro-cid-vcbh62el]:hover{--tw-bg-opacity: 1;background-color:#fce4e1;background-color:rgba(252,228,225,var(--tw-bg-opacity))}.breadcrumbs__link[data-astro-cid-vcbh62el]{padding:.125rem .75rem}.breadcrumbs__link[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#6a6a6a;background-color:rgba(106,106,106,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.breadcrumbs__link[data-astro-cid-vcbh62el]:hover:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#8a8a93;background-color:rgba(138,138,147,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}
</style>
<link rel="stylesheet" href="/_astro/_single_.CyWP_2Jq.css" />
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#020202;border-color:rgba(2,2,2,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-bg-opacity: 1;background-color:#fef9f8;background-color:rgba(254,249,248,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.theme-toggle[data-v-8d8d9c54]{width:1.25rem;height:1.25rem}
.comments[data-v-533071ec]{margin:auto;margin-top:1.25rem;max-width:42rem;--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity))}.comments:where([class=dark][data-v-533071ec],[class=dark] *[data-v-533071ec]){--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity))}.giscus-frame[data-v-533071ec]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-533071ec],[class=dark] *[data-v-533071ec]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/hoisted.DYPnEDpO.js"></script><style>[data-astro-transition-scope="astro-vgmtzcrq-1"] { view-transition-name: blog-image-kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-14 font-inter text-dark fluid:text-lg dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-extrabold lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-dark  dark:text-gray" aria-label="logo" data-astro-cid-ijoll5s5>ИГ ФCВР</a>  <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> <span class="nav__open-line" data-astro-cid-7wkmezxd></span> <span class="nav__open-line" data-astro-cid-7wkmezxd></span> <span class="nav__open-line" data-astro-cid-7wkmezxd></span> </button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> <span class="nav__close-line" data-astro-cid-7wkmezxd></span> <span class="nav__close-line" data-astro-cid-7wkmezxd></span> <span class="nav__close-line" data-astro-cid-7wkmezxd></span> </button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/projects" class="nav__link" data-astro-cid-7wkmezxd> Работы. </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог. </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты. </a> </li> </ul> </nav> </div>   <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var v=Object.defineProperty;var A=(c,s,a)=>s in c?v(c,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[s]=a;var d=(c,s,a)=>(A(c,typeof s!="symbol"?s+"":s,a),a);var u;{let c={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},s=t=>{let[e,n]=t;return e in c?c[e](n):void 0},a=t=>t.map(s),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,s(n)]));customElements.get("astro-island")||customElements.define("astro-island",(u=class extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var f;if(!this.hydrator||!this.isConnected)return;let e=(f=this.parentElement)==null?void 0:f.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),r={},l=this.querySelectorAll("template[data-astro-template]");for(let o of l){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("data-astro-template")||"default"]=o.innerHTML,o.remove())}for(let o of n){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("name")||"default"]=o.innerHTML)}let h;try{h=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(o){let i=this.getAttribute("component-url")||"<unknown>",b=this.getAttribute("component-export");throw b&&(i+=` (export ${b})`),console.error(`[hydrate] Error parsing props for component ${i}`,this.getAttribute("props"),o),o}let p;await this.hydrator(this)(this.Component,h,r,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),n.disconnect(),this.childrenConnectedCallback()},n=new MutationObserver(()=>{var r;((r=this.lastChild)==null?void 0:r.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});n.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}try{await Astro[n](async()=>{let r=this.getAttribute("renderer-url"),[l,{default:h}]=await Promise.all([import(this.getAttribute("component-url")),r?import(r):()=>()=>{}]),p=this.getAttribute("component-export")||"default";if(!p.includes("."))this.Component=l[p];else{this.Component=l;for(let y of p.split("."))this.Component=this.Component[y]}return this.hydrator=h,this.hydrate},e,this)}catch(r){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,r)}}attributeChangedCallback(){this.hydrate()}},d(u,"observedAttributes",["props"]),u))}})();</script><astro-island uid="IJ3dh" component-url="/_astro/ThemeToggle.kpN4JrWQ.js" component-export="default" renderer-url="/_astro/client.DtEXyQF-.js" props="{&quot;data-astro-cid-rq644orq&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;ThemeToggle&quot;,&quot;value&quot;:true}"></astro-island> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <div class="blocks__container container"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <ol class="breadcrumbs__list" role="list" data-astro-cid-vcbh62el> <li class="breadcrumbs__item" role="listitem" data-astro-cid-vcbh62el> <a class="breadcrumbs__link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="breadcrumbs__item" role="listitem" data-astro-cid-vcbh62el> <a class="breadcrumbs__link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="breadcrumbs__item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </nav>  </div> <div class="blocks__container container"> <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <ul class="article__categories categories" data-astro-cid-axzg2cw6> <li class="categories__item" data-astro-cid-axzg2cw6> <a href="/category/учебник" class="categories__link" data-astro-cid-axzg2cw6> Учебник  </a> </li> </ul> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Как я оптимизировал работу своего Active Admin с помощью 4 простых приемов </h1> <ul class="article__tags tags" data-astro-cid-axzg2cw6> <li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/ruby" data-astro-cid-axzg2cw6> Ruby </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/active-admin" data-astro-cid-axzg2cw6> Active Admin </a> </li> </ul> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 18 янв., 2024 by Игорь Горлов </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 30 мар., 2024 </time> </div>  <figure class="article__image" data-astro-cid-axzg2cw6> <picture> <source srcset="/_astro/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov-Jan-18-2024.CqJn0QIX_GI7Lw.avif" type="image/avif"><source srcset="/_astro/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov-Jan-18-2024.CqJn0QIX_6LUlo.webp" type="image/webp"> <img src="/_astro/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov-Jan-18-2024.CqJn0QIX_1TQEqX.png" alt="Как я оптимизировал работу своего Active Admin с помощью 4 простых приемов" class="aspect-auto h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-vgmtzcrq-1" width="1200" height="500" decoding="async"> </picture> </figure>  <div class="article__content prose prose-zinc max-w-full dark:prose-invert prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:-mx-12 prose-figure:w-screen prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <div id="adfox_17062261612859555"></div> <script>(function(){const blockId = "adfox_17062261612859555";

	window.yaContextCb = window.yaContextCb || [];
	window.yaContextCb.push(() => {
		Ya.adfoxCode.createAdaptive(
			{
				ownerId: 1493338,
				containerId: blockId,
				params: {
					p1: 'dawgg',
					p2: 'p',
				},
			},
			['desktop', 'tablet', 'phone'],
			{
				tabletWidth: 830,
				phoneWidth: 480,
				isAutoReloads: true,
			},
		);
	});
})();</script> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как я оптимизировал работу своего Active Admin с помощью 4 простых приемов&#38;url=https://igorlov.ru/blog/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://igorlov.ru/blog/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov&#38;title=Как я оптимизировал работу своего Active Admin с помощью 4 простых приемов&#38;summary=ActiveAdmin  это широко используемый инструмент для создания интерфейсов администратора в приложениях на Ruby on Rails. Он невероятно полезен для быстрой наст&#38;source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov&#38;media=&#38;description=ActiveAdmin  это широко используемый инструмент для создания интерфейсов администратора в приложениях на Ruby on Rails. Он невероятно полезен для быстрой наст" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <details class="toc px-5 border border-gray-light lg:px-10 py-2 cursor-pointer"><summary class="title">Содержание</summary><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#представление-набора-данных">Представление набора данных</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#введение-в-activeadmin">Введение в ActiveAdmin</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#фильтры">Фильтры</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#1️⃣-всегда-используйте-пользовательские-фильтры">1️⃣ Всегда используйте пользовательские фильтры</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#2️⃣-предварительная-загрузка-собственной-коллекции-и-ее-кэширование">2️⃣ Предварительная загрузка собственной коллекции и ее кэширование</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#индекс">Индекс</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#3️⃣-предварительная-загрузка-данных-в-контроллер">3️⃣ Предварительная загрузка данных в контроллер</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#4️⃣-предварительная-загрузка-данных-в-представление">4️⃣ Предварительная загрузка данных в представление</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#результаты">Результаты</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#заключение">Заключение</a></li></ol></details><p>ActiveAdmin - это широко используемый инструмент для создания интерфейсов администратора в приложениях на Ruby on Rails. Он невероятно полезен для быстрой настройки интерфейса администратора, ориентированного исключительно на данные, которые вы хотите отображать. Однако мы часто сталкиваемся со страницами, которые делают множество SQL-запросов и долго загружаются.</p>
<p>Сегодня мы рассмотрим три вещи, которые я всегда делаю, чтобы оптимизировать свои представления ActiveAdmin.</p>
<h2 id="представление-набора-данных">Представление набора данных<a aria-hidden="true" tabindex="-1" href="#представление-набора-данных"><span class="icon icon-link"></span></a></h2>
<p>Чтобы проиллюстрировать наши примеры, давайте представим, что вам нужно интегрировать интерфейс администратора для агентства по подбору персонала.</p>
<p>У вас будет 4 таблицы:</p>
<p>Таблица для хранения клиентов, которые платят за поиск временных работников (Owner) Таблица для хранения всех доступных временных работников (User) Таблица для хранения всех миссий (Mission) Таблица для хранения всех смен миссий (MissionShift)</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#A6ACCD">create_table </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">users</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD"> do |</span><span style="color:#E4F0FB">t</span><span style="color:#A6ACCD">|</span></span>
<span class="line"><span style="color:#A6ACCD">  t.string </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">email</span><span style="color:#A6ACCD">"</span></span>
<span class="line"><span style="color:#A6ACCD">  t.string </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">first_name</span><span style="color:#A6ACCD">"</span></span>
<span class="line"><span style="color:#A6ACCD">  t.string </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">last_name</span><span style="color:#A6ACCD">"</span></span>
<span class="line"><span style="color:#A6ACCD">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">create_table </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">owner</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD"> do |</span><span style="color:#E4F0FB">t</span><span style="color:#A6ACCD">|</span></span>
<span class="line"><span style="color:#A6ACCD">  t.string </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">"</span></span>
<span class="line"><span style="color:#A6ACCD">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">create_table </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">missions</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD"> do |</span><span style="color:#E4F0FB">t</span><span style="color:#A6ACCD">|</span></span>
<span class="line"><span style="color:#A6ACCD">  t.string </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">description</span><span style="color:#A6ACCD">"</span></span>
<span class="line"><span style="color:#A6ACCD">  t.string </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">title</span><span style="color:#A6ACCD">"</span></span>
<span class="line"><span style="color:#A6ACCD">  t.bigint </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">client_id</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">null</span><span style="color:#A6ACCD">: </span><span style="color:#5DE4C7">false</span></span>
<span class="line"><span style="color:#A6ACCD">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">create_table </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">mission_shifts</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD"> do |</span><span style="color:#E4F0FB">t</span><span style="color:#A6ACCD">|</span></span>
<span class="line"><span style="color:#A6ACCD">  t.bigint </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">mission_id</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">null</span><span style="color:#A6ACCD">: </span><span style="color:#5DE4C7">false</span></span>
<span class="line"><span style="color:#A6ACCD">  t.date </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">day</span><span style="color:#A6ACCD">"</span></span>
<span class="line"><span style="color:#A6ACCD">  t.datetime </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">begin_time</span><span style="color:#A6ACCD">"</span></span>
<span class="line"><span style="color:#A6ACCD">  t.datetime </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">end_time</span><span style="color:#A6ACCD">"</span></span>
<span class="line"><span style="color:#A6ACCD">  t.bigint </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">user_id</span><span style="color:#A6ACCD">"</span></span>
<span class="line"><span style="color:#A6ACCD">end</span></span>
<span class="line"></span></code></pre>
<p>Отношения</p>
<p>У пользователя есть множество MissionShift. MissionShift принадлежит миссии. Миссия принадлежит владельцу.</p>
<p>Итак, давайте разберемся в нашем примере!</p>
<h2 id="введение-в-activeadmin">Введение в ActiveAdmin<a aria-hidden="true" tabindex="-1" href="#введение-в-activeadmin"><span class="icon icon-link"></span></a></h2>
<p>Наша цель - использовать ActiveAdmin для создания интерфейса администратора как можно быстрее. Вам нужна страница, на которой будут отображаться:</p>
<p>Названия миссий Клиент, которому принадлежит миссия Сколько смен укомплектовано пользователем</p>
<p>Прочитав немного документации, вы открываете для себя замечательный DSL ActiveAdmin.</p>
<p>Вы быстро придумали такой код:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#ADD7FF">ActiveAdmin</span><span style="color:#A6ACCD">.register </span><span style="color:#E4F0FB">Mission</span><span style="color:#A6ACCD"> do</span></span>
<span class="line"><span style="color:#A6ACCD">  index do</span></span>
<span class="line"><span style="color:#A6ACCD">    selectable_column</span></span>
<span class="line"><span style="color:#A6ACCD">    column :</span><span style="color:#5DE4C7">title</span></span>
<span class="line"><span style="color:#A6ACCD">    column :</span><span style="color:#5DE4C7">owner</span></span>
<span class="line"><span style="color:#A6ACCD">    column(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">Mission Shifts</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">) do |</span><span style="color:#E4F0FB">mission</span><span style="color:#A6ACCD">|</span></span>
<span class="line"><span style="color:#A6ACCD">      mission_shifts </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> mission.mission_shifts</span></span>
<span class="line"><span style="color:#A6ACCD">      "</span><span style="color:#E4F0FB">#{</span><span style="color:#5DE4C7">mission_shifts</span><span style="color:#A6ACCD">.</span><span style="color:#5DE4C7">count</span><span style="color:#A6ACCD">(:</span><span style="color:#5DE4C7">user_id</span><span style="color:#A6ACCD">)</span><span style="color:#E4F0FB">}</span><span style="color:#5DE4C7">/</span><span style="color:#E4F0FB">#{</span><span style="color:#5DE4C7">mission_shifts</span><span style="color:#A6ACCD">.</span><span style="color:#5DE4C7">size</span><span style="color:#E4F0FB">}</span><span style="color:#A6ACCD">"</span></span>
<span class="line"><span style="color:#A6ACCD">    end</span></span>
<span class="line"><span style="color:#A6ACCD">    actions</span></span>
<span class="line"><span style="color:#A6ACCD">  end</span></span>
<span class="line"><span style="color:#A6ACCD">end</span></span>
<span class="line"></span></code></pre>
<p>В результате получается следующее:</p>
<figure class="igorlov-figure"><img  src="/_astro/16f7rkznufs3jr99pnrn.RAr5XQnT_siK7j.webp" alt="16f7rkznufs3jr99pnrn.png" width="800" height="528" loading="lazy" decoding="async"><figcaption>16f7rkznufs3jr99pnrn.png</figcaption></figure>
<p>Вы готовы покорить мир с этой страницей администратора!</p>
<p>Тем не менее, вы должны знать, что эта страница содержит 3 источника N+1 запросов. Чтобы доказать это, мы воспользуемся гемом “rack-mini-profiler”. Этот гем позволяет проследить путь сервера при рендеринге страницы.</p>
<p>Вот скриншот того, что показывает нам rack-mini-profiler:</p>
<p>У нас 148 SQL-вызовов в представлении 😲. Это очень много!</p>
<p>Если посмотреть на серверную часть, то вот информация, которую мы получаем при загрузке страницы:</p>
<p><code>Completed 200 OK in 741ms (Views: 455.5ms | ActiveRecord: 266.5ms | Allocations: 1035126)</code>.</p>
<p>Страница загружается очень долго и выделяет огромное количество памяти!</p>
<p>Цель этой статьи - показать вам, как значительно сократить количество SQL-вызовов и выделение памяти, тем самым оптимизировав время отрисовки страницы и уменьшив утечки памяти!</p>
<h2 id="фильтры">Фильтры<a aria-hidden="true" tabindex="-1" href="#фильтры"><span class="icon icon-link"></span></a></h2>
<h3 id="1️⃣-всегда-используйте-пользовательские-фильтры">1️⃣ Всегда используйте пользовательские фильтры<a aria-hidden="true" tabindex="-1" href="#1️⃣-всегда-используйте-пользовательские-фильтры"><span class="icon icon-link"></span></a></h3>
<p>Первый совет, которым я хотел бы поделиться сегодня, хорошо известен. Он не решает проблему N+1, но значительно сокращает объем памяти, выделяемой странице:</p>
<p>Никогда не оставляйте фильтры по умолчанию включенными!</p>
<p>На самом деле ActiveAdmin старается быть полезным и генерирует фильтры для всех атрибутов вашей таблицы.</p>
<p>Если у вас много атрибутов, вам будет трудно ориентироваться. Если у вас есть связи с другими моделями, ActiveAdmin будет предварительно загружать всю коллекцию ActiveRecord. В нашем случае по умолчанию включены модели <code>Owner</code> и <code>MissionShift</code>.</p>
<p>Всегда указывайте хотя бы один фильтр:</p>
<p><code>ActiveAdmin.register Mission do filter :title [...] end</code>.</p>
<p>Вот рендеринг на стороне сервера при загрузке страницы:</p>
<p>До модификации: <code>Completed 200 OK in 620ms (Views: 422.9ms | ActiveRecord: 186.0ms | Allocations: 928758)</code>.</p>
<p>После модификации: <code>Completed 200 OK in 581ms (Views: 403.4ms | ActiveRecord: 168.0ms | Allocations: 703878)</code>.</p>
<p>Огромная разница в выделении памяти!</p>
<h3 id="2️⃣-предварительная-загрузка-собственной-коллекции-и-ее-кэширование">2️⃣ Предварительная загрузка собственной коллекции и ее кэширование<a aria-hidden="true" tabindex="-1" href="#2️⃣-предварительная-загрузка-собственной-коллекции-и-ее-кэширование"><span class="icon icon-link"></span></a></h3>
<p>Если вам все еще нужен фильтр для Модели, напишите собственный запрос для загрузки данных:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#ADD7FF">ActiveAdmin</span><span style="color:#A6ACCD">.register </span><span style="color:#E4F0FB">Mission</span><span style="color:#A6ACCD"> do</span></span>
<span class="line"><span style="color:#A6ACCD">  filter :</span><span style="color:#5DE4C7">owner</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">as</span><span style="color:#A6ACCD">: :</span><span style="color:#5DE4C7">select</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">collection</span><span style="color:#A6ACCD">: lambda { </span><span style="color:#ADD7FF">Owner</span><span style="color:#A6ACCD">.pluck(:</span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">, :</span><span style="color:#5DE4C7">id</span><span style="color:#A6ACCD">) }</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">  # ...</span></span>
<span class="line"><span style="color:#A6ACCD">end</span></span>
<span class="line"></span></code></pre>
<p>Вот рендеринг на стороне сервера при загрузке страницы:</p>
<p><code>Completed 200 OK in 666ms (Views: 337.9ms | ActiveRecord: 316.7ms | Allocations: 761030)</code>.</p>
<p>Это все еще лучше, чем с фильтрами по умолчанию.</p>
<p>Если вы хотите пойти еще дальше в оптимизации, вы также можете настроитьлогику кэширования, например, так:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#ADD7FF">ActiveAdmin</span><span style="color:#A6ACCD">.register </span><span style="color:#E4F0FB">Mission</span><span style="color:#A6ACCD"> do</span></span>
<span class="line"><span style="color:#A6ACCD">  filter :</span><span style="color:#5DE4C7">owner</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">as</span><span style="color:#A6ACCD">: :</span><span style="color:#5DE4C7">select</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">collection</span><span style="color:#A6ACCD">: lambda {</span></span>
<span class="line"><span style="color:#ADD7FF">    Rails</span><span style="color:#A6ACCD">.cache.fetch(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">owners_name_id</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">expires_in</span><span style="color:#A6ACCD">: </span><span style="color:#5DE4C7">1</span><span style="color:#A6ACCD">.hour) do</span></span>
<span class="line"><span style="color:#ADD7FF">      Owner</span><span style="color:#A6ACCD">.pluck(:</span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">, :</span><span style="color:#5DE4C7">id</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">    end</span></span>
<span class="line"><span style="color:#A6ACCD">  }</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">  # ...</span></span>
<span class="line"><span style="color:#A6ACCD">end</span></span>
<span class="line"></span></code></pre>
<p>Это дает нам:</p>
<p><code>Completed 200 OK in 816ms (Views: 531.6ms | ActiveRecord: 248.3ms | Allocations: 711373)</code>.</p>
<p>С точки зрения распределения, мы проделали долгий путь!</p>
<h2 id="индекс">Индекс<a aria-hidden="true" tabindex="-1" href="#индекс"><span class="icon icon-link"></span></a></h2>
<p>На нашей индексной странице у нас две проблемы:</p>
<p>Отображение колонки <code>Владелец</code> Отображение количества смен, в которых есть пользователь на миссию</p>
<p>Если кратко описать работу ActiveAdmin, то для каждой строки он делает 3 SQL-запроса:</p>
<p>Один для поиска владельца Один для поиска MissionShifts Один для подсчета MissionShifts, в которых есть пользователь</p>
<p>Как вы можете видеть, все наши N+1 фактически сосредоточены здесь.</p>
<p>Единственный способ решить наши проблемы - это предварительно загрузить как можно больше данных. Для этого у нас есть два пути:</p>
<p>Предварительно загрузить данные в контроллер Загрузить данные один раз и мемоизировать их в представлении</p>
<h3 id="3️⃣-предварительная-загрузка-данных-в-контроллер">3️⃣ Предварительная загрузка данных в контроллер<a aria-hidden="true" tabindex="-1" href="#3️⃣-предварительная-загрузка-данных-в-контроллер"><span class="icon icon-link"></span></a></h3>
<p>ActiveAdmin позволяет нам создавать собственные методы контроллера. До сих пор мы работали только с методом <code>#index</code>, так что если мы хотим предварительно загрузить данные, то это самое подходящее место!</p>
<p>Давайте изменим наш файл, чтобы предварительно загрузить данные <code>Owner</code> непосредственно из контроллера:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#ADD7FF">ActiveAdmin</span><span style="color:#A6ACCD">.register </span><span style="color:#E4F0FB">Mission</span><span style="color:#A6ACCD"> do</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">  # ... other code ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">  index do</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">    # ... other code ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">    column(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">Owner</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">) do |</span><span style="color:#E4F0FB">mission</span><span style="color:#A6ACCD">|</span></span>
<span class="line"><span style="color:#A6ACCD">      owners.fetch(mission.owner_id)</span></span>
<span class="line"><span style="color:#A6ACCD">    end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">    # ... other code ...</span></span>
<span class="line"><span style="color:#A6ACCD">  end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">  controller do</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">    # перед загрузкой чего-либо, мы предварительно загружаем Owners</span></span>
<span class="line"><span style="color:#A6ACCD">    def </span><span style="color:#ADD7FF">index</span></span>
<span class="line"><span style="color:#A6ACCD">      @</span><span style="color:#E4F0FB">owners</span><span style="color:#91B4D5"> =</span><span style="color:#ADD7FF"> Owner</span><span style="color:#A6ACCD">.pluck(:</span><span style="color:#5DE4C7">id</span><span style="color:#A6ACCD">, :</span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">).to_h</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">      # вызов метода начального индекса</span></span>
<span class="line"><span style="color:#A6ACCD">      super</span></span>
<span class="line"><span style="color:#A6ACCD">    end</span></span>
<span class="line"><span style="color:#A6ACCD">  end</span></span>
<span class="line"><span style="color:#A6ACCD">end</span></span>
<span class="line"></span></code></pre>
<p>Если мы посмотрим на rack-mini-profiler, то получим следующее:</p>
<figure class="igorlov-figure"><img  src="/_astro/yhojx6a25u0ajlvf1ccx.Dv2c6MwS_Z2hdGil.webp" alt="yhojx6a25u0ajlvf1ccx.png" width="800" height="356" loading="lazy" decoding="async"><figcaption>yhojx6a25u0ajlvf1ccx.png</figcaption></figure>
<p>Мы сократили количество обращений к базе данных на ~30. Почему именно на столько? Так как один и тот же владелец был у нас несколько раз на разных миссиях, ActiveAdmin сохранял вызов в кэше и извлекал информацию, а не делал новый запрос.</p>
<p>Эта техника хорошо работает, если у вас нет большого объема данных в таблице <code>Owner</code>. Если вы хотите оптимизировать еще немного, вы также можете использовать кэш. А если вы хотите оптимизировать еще больше, вы можете повторно использовать кэш, который мы вместе создали в фильтрах, чтобы дважды использовать одни и те же значения на странице.</p>
<h3 id="4️⃣-предварительная-загрузка-данных-в-представление">4️⃣ Предварительная загрузка данных в представление<a aria-hidden="true" tabindex="-1" href="#4️⃣-предварительная-загрузка-данных-в-представление"><span class="icon icon-link"></span></a></h3>
<p>Предварительная загрузка данных в контроллере - это хорошо, но мы можем загрузить слишком много данных. Таблица Mission имеет больший объем, чем Owner, поэтому мы не можем позволить себе предварительно загрузить всю таблицу. К сожалению, мы не знаем, какие миссии будут загружены на страницу на уровне контроллера.</p>
<p>Но есть одно место, где мы знаем, какие миссии будут отображаться: в представлении!</p>
<p>Другими словами:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#ADD7FF">ActiveAdmin</span><span style="color:#A6ACCD">.register </span><span style="color:#E4F0FB">Mission</span><span style="color:#A6ACCD"> do</span></span>
<span class="line"><span style="color:#A6ACCD">  index do</span></span>
<span class="line"><span style="color:#A6ACCD">    column(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">Sample Column</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">) do</span></span>
<span class="line"><span style="color:#A6ACCD">      missions.count </span><span style="color:#767C9DB0;font-style:italic"># => 50</span></span>
<span class="line"><span style="color:#A6ACCD">    end</span></span>
<span class="line"><span style="color:#A6ACCD">  end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">  controller do</span></span>
<span class="line"><span style="color:#A6ACCD">    def </span><span style="color:#ADD7FF">index</span></span>
<span class="line"><span style="color:#A6ACCD">      pp missions.count </span><span style="color:#767C9DB0;font-style:italic"># => NameError - undefined local variable or method `missions' for #&#x3C;Admin::MissionsController:0x000000000a4128>:</span></span>
<span class="line"><span style="color:#A6ACCD">      super</span></span>
<span class="line"><span style="color:#A6ACCD">    end</span></span>
<span class="line"><span style="color:#A6ACCD">  end</span></span>
<span class="line"><span style="color:#A6ACCD">end</span></span>
<span class="line"></span></code></pre>
<p>Наша цель - предварительно загрузить количество MissionShifts у пользователя, а также общее количество MissionShifts за миссию.</p>
<p>Первый шаг - найти запрос для предварительной загрузки этих данных для набора миссий:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#A6ACCD">class </span><span style="color:#ADD7FF">Mission</span><span style="color:#91B4D5"> &#x3C;</span><span style="color:#ADD7FF"> ApplicationRecord</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">  # выведет миссии с "id", "total_shifts" и "shifts_with_user"</span></span>
<span class="line"><span style="color:#A6ACCD">  def </span><span style="color:#ADD7FF">self.mission_shifts_with_users</span></span>
<span class="line"><span style="color:#ADD7FF;font-style:italic">    self</span><span style="color:#A6ACCD">.left_joins(:</span><span style="color:#5DE4C7">mission_shifts</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">      .select(</span></span>
<span class="line"><span style="color:#A6ACCD">        :</span><span style="color:#5DE4C7">id</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">        '</span><span style="color:#5DE4C7">COUNT(mission_shifts.id) AS total_shifts</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">        '</span><span style="color:#5DE4C7">COUNT(DISTINCT CASE WHEN mission_shifts.user_id IS NOT NULL THEN mission_shifts.id END) AS shifts_with_user</span><span style="color:#A6ACCD">'</span></span>
<span class="line"><span style="color:#A6ACCD">      )</span></span>
<span class="line"><span style="color:#A6ACCD">      .group(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">missions.id</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">  end</span></span>
<span class="line"><span style="color:#A6ACCD">end</span></span>
<span class="line"></span></code></pre>
<p>Мы хотим использовать этот запрос в нашем представлении, чтобы нам нужно было только искать в нем нашу миссию и извлекать нужную информацию.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#ADD7FF">ActiveAdmin</span><span style="color:#A6ACCD">.register </span><span style="color:#E4F0FB">Mission</span><span style="color:#A6ACCD"> do</span></span>
<span class="line"><span style="color:#A6ACCD">  index do</span></span>
<span class="line"><span style="color:#A6ACCD">    column(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">Mission Shifts</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">) do |</span><span style="color:#E4F0FB">mission</span><span style="color:#A6ACCD">|</span></span>
<span class="line"><span style="color:#A6ACCD">      @</span><span style="color:#E4F0FB">missions_with_mission_shifts</span><span style="color:#91B4D5"> ||=</span><span style="color:#A6ACCD"> missions.mission_shifts_with_users</span></span>
<span class="line"><span style="color:#A6ACCD">      mission_shifts </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> @</span><span style="color:#E4F0FB">missions_with_mission_shifts</span><span style="color:#A6ACCD">.find { |</span><span style="color:#E4F0FB">m</span><span style="color:#A6ACCD">| m.id </span><span style="color:#91B4D5">==</span><span style="color:#A6ACCD"> mission.id }</span></span>
<span class="line"><span style="color:#A6ACCD">      "</span><span style="color:#E4F0FB">#{</span><span style="color:#5DE4C7">миссия_смены</span><span style="color:#A6ACCD">.</span><span style="color:#5DE4C7">смены_с_пользователями</span><span style="color:#E4F0FB">}</span><span style="color:#5DE4C7">/</span><span style="color:#E4F0FB">#{</span><span style="color:#5DE4C7">миссия_смены</span><span style="color:#A6ACCD">.</span><span style="color:#5DE4C7">общие_смены</span><span style="color:#E4F0FB">}</span><span style="color:#A6ACCD">"</span></span>
<span class="line"><span style="color:#A6ACCD">    end</span></span>
<span class="line"><span style="color:#A6ACCD">  end</span></span>
<span class="line"><span style="color:#A6ACCD">end</span></span>
<span class="line"></span></code></pre>
<p>Используя мемоизацию, мы делаем запрос только один раз, и он используется для всех наших миссий.</p>
<p>Если мы выполним тур по rack-mini-profiler, то получим:</p>
<figure class="igorlov-figure"><img  src="/_astro/xcqrvnwbab7ss9n1gzev.DBoPXcP3_1kmH7J.webp" alt="xcqrvnwbab7ss9n1gzev.png" width="800" height="356" loading="lazy" decoding="async"><figcaption>xcqrvnwbab7ss9n1gzev.png</figcaption></figure>
<p>Мы избавились почти от 100 обращений к базе данных, предварительно загрузив данные для Owners и MissionShifts.</p>
<h2 id="результаты">Результаты<a aria-hidden="true" tabindex="-1" href="#результаты"><span class="icon icon-link"></span></a></h2>
<p>Вот результаты с применением всех советов:</p>
<p>Рендеринг на стороне сервера:</p>
<p>До: <code>Завершено 200 OK за 741 мс (Views: 455.5 мс | ActiveRecord: 266.5 мс | Allocations: 1035126)</code>.</p>
<p>После: <code>Completed 200 OK in 200ms (Views: 187.3ms | ActiveRecord: 5.9ms | Allocations: 517789)</code>.</p>
<p>Выделение памяти сократилось вдвое.</p>
<p>Время отклика составляет около 200 мс (что вполне приемлемо).</p>
<p>Rack-mini-profiler:</p>
<figure class="igorlov-figure"><img  src="/_astro/p1rmxtxpayjd3ugne0ok.CdpgG6AG_ZISVVJ.webp" alt="p1rmxtxpayjd3ugne0ok.png" width="800" height="356" loading="lazy" decoding="async"><figcaption>p1rmxtxpayjd3ugne0ok.png</figcaption></figure>
<figure class="igorlov-figure"><img  src="/_astro/xcqtwpjkrhfpx0jngiac.CUR7Wh9b_Jeouk.webp" alt="xcqtwpjkrhfpx0jngiac.png" width="800" height="356" loading="lazy" decoding="async"><figcaption>xcqtwpjkrhfpx0jngiac.png</figcaption></figure>
<p>Цифры говорят сами за себя: всего 6 SQL-запросов против 148 ранее. IЭто огромный зазор для производительности ваших приложений.</p>
<p>Важным показателем, на который следует обратить внимание, является <code>% в sql</code>, который мы снизили с 15,6 до 3,5%, что является огромной разницей!</p>
<h2 id="заключение">Заключение<a aria-hidden="true" tabindex="-1" href="#заключение"><span class="icon icon-link"></span></a></h2>
<p>В заключение этой статьи мы показали, как превратить изначально тяжелый и неэффективный интерфейс ActiveAdmin в значительно более эффективную и быструю версию. Благодаря четырем простым, но мощным приемам мы значительно сократили количество SQL-запросов, улучшили управление памятью и оптимизировали время загрузки. Эти улучшения - не просто технические достижения; они воплотились в более плавном и профессиональном пользовательском опыте. Для разработчиков Ruby on Rails, использующих ActiveAdmin, эти методы предлагают конкретный способ повысить производительность своих приложений, сохранив при этом простоту и скорость разработки, которые предлагает этот камень.</p> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как я оптимизировал работу своего Active Admin с помощью 4 простых приемов&#38;url=https://igorlov.ru/blog/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://igorlov.ru/blog/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov&#38;title=Как я оптимизировал работу своего Active Admin с помощью 4 простых приемов&#38;summary=ActiveAdmin  это широко используемый инструмент для создания интерфейсов администратора в приложениях на Ruby on Rails. Он невероятно полезен для быстрой наст&#38;source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-ya-optymyzyroval-rabotu-svoeho-active-admin-s-pomoschiu-4-prost-kh-pryemov&#38;media=&#38;description=ActiveAdmin  это широко используемый инструмент для создания интерфейсов администратора в приложениях на Ruby on Rails. Он невероятно полезен для быстрой наст" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/kak-ukazat-format-dann-kh-pry-sokhranenyy-excel-cherez-python" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> Как указать формат данных при сохранении Excel через Python? </a> <a href="/blog/lyksyr-mashyna-beam" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Эликсир: Машина BEAM </a> </nav>  </div> </article> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.svLg6TOn.js" component-export="default" renderer-url="/_astro/client.D9Vng9vH.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> <astro-island uid="Z2a8j9B" component-url="/_astro/CommentBlock.BwogX8bT.js" component-export="default" renderer-url="/_astro/client.DtEXyQF-.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  </div> <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-extrabold lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-dark  dark:text-gray" aria-label="logo" data-astro-cid-ijoll5s5>ИГ ФCВР</a>  <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>