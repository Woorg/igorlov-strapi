<!DOCTYPE html><html lang="ru"> <head><title>Kubernetes Для Сисадмина - Вводим KubeVirt - Фул Фронт Дев
</title><link rel="canonical" href="https://igorlov.ru/blog/kubernetes-dlya-sisadmina-vvodim-kubevirt"><meta name="description" content="Всегда существовал какой-то вид разделения между разработчиками и инженерами по инфраструктуре/системными администраторами. Одни писали код, а другие...
"><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.9.1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.CyGIBtQS.css">
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#0d52a1;color:rgba(13,82,161,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw)}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.container[data-astro-cid-vcbh62el]{padding:min(2rem,1.2125rem + 1.05vw)}.list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.link[data-astro-cid-vcbh62el]{font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s;padding:.125rem .75rem;font-size:min(1.5rem,1.1625rem + .45vw);line-height:var(--tw-lh)}
</style>
<link rel="stylesheet" href="/_astro/_single_.C0aKA9dM.css">
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#27292d;border-color:rgba(39,41,45,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.comments[data-v-f9c4118f]{margin:auto;margin-top:1.25rem;width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.comments:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame[data-v-f9c4118f]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/hoisted.CUFolni_.js"></script><style>[data-astro-transition-scope="astro-r75ddqls-1"] { view-transition-name: blog-image-kubernetes-dlya-sisadmina-vvodim-kubevirt; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-16 font-inter text-blue fluid:text-lg lg:pt-24 dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <symbol id="ai:local:logo-one"><g fill="currentColor"><path d="M1198.57 596.749c0 329.575-267.171 596.751-596.747 596.751-329.575 0-596.749-267.176-596.749-596.751S272.248 0 601.823 0c329.576 0 596.747 267.174 596.747 596.749Z"/><circle cx="3035.75" cy="617.751" r="596.749" transform="rotate(-90 3035.75 617.751)"/><path d="M3035.75 2736.81c329.57 0 596.75 267.18 596.75 596.75 0 329.58-267.18 596.75-596.75 596.75-329.58 0-596.75-267.17-596.75-596.75 0-329.57 267.17-596.75 596.75-596.75Z"/><circle cx="596.749" cy="1964.8" r="596.749"/><path d="M1193.5 3332.87c0 329.57-267.176 596.75-596.751 596.75S0 3662.44 0 3332.87c0-329.58 267.174-596.75 596.749-596.75 329.575 0 596.751 267.17 596.751 596.75Z"/><circle cx="5062.46" cy="617.751" r="596.749" transform="rotate(-90 5062.46 617.751)"/><circle cx="5062.46" cy="3333.56" r="596.749" transform="rotate(-90 5062.46 3333.56)"/></g></symbol><use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> Меню</button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> Закрыть</button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты </a> </li> </ul> </nav> </div>   <!-- <ThemeToggle client:only /> --> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <div class="container" data-astro-cid-vcbh62el> <ol class="list" role="list" data-astro-cid-vcbh62el> <li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </div> </nav>  <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <div class="container" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <ul class="article__categories categories" data-astro-cid-axzg2cw6> <li class="categories__item" data-astro-cid-axzg2cw6> <a href="/category/как-закодить" class="categories__link" data-astro-cid-axzg2cw6> Как закодить  </a> </li> </ul> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Kubernetes для сисадмина - вводим KubeVirt </h1> <ul class="article__tags tags" data-astro-cid-axzg2cw6> <li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/devops" data-astro-cid-axzg2cw6> DevOps </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/kubernetes" data-astro-cid-axzg2cw6> Kubernetes </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/kubevirt" data-astro-cid-axzg2cw6> KubeVirt </a> </li> </ul> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 24 окт., 2023 by Igor Gorlov </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div> <article data-astro-cid-axzg2cw6> <figure class="article__image" data-astro-cid-axzg2cw6> <picture data-astro-cid-axzg2cw6> <source srcset="/_astro/kubernetes-dlya-sisadmina-vvodim-kubevirt-Oct-24-2023.68yIhjW4_ZceUba.avif" type="image/avif"><source srcset="/_astro/kubernetes-dlya-sisadmina-vvodim-kubevirt-Oct-24-2023.68yIhjW4_ZOFVOj.webp" type="image/webp"> <img src="/_astro/kubernetes-dlya-sisadmina-vvodim-kubevirt-Oct-24-2023.68yIhjW4_LFdjg.png" alt="Kubernetes для сисадмина - вводим KubeVirt" class="aspect-video h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-r75ddqls-1" width="1120" height="580" decoding="async"> </picture> </figure> </article> <div class="article__content prose prose-zinc max-w-full break-words text-blue dark:prose-invert prose-headings:text-blue prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <div id="adfox_17062261612859555"></div> <script>(function(){const blockId = "adfox_17062261612859555";

	window.yaContextCb = window.yaContextCb || [];
	window.yaContextCb.push(() => {
		Ya.adfoxCode.createAdaptive(
			{
				ownerId: 1493338,
				containerId: blockId,
				params: {
					p1: 'dawgg',
					p2: 'p',
				},
			},
			['desktop', 'tablet', 'phone'],
			{
				tabletWidth: 830,
				phoneWidth: 480,
				isAutoReloads: true,
			},
		);
	});
})();</script> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kubernetes-dlya-sisadmina-vvodim-kubevirt" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kubernetes-dlya-sisadmina-vvodim-kubevirt" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Kubernetes для сисадмина - вводим KubeVirt&url=https://igorlov.ru/blog/kubernetes-dlya-sisadmina-vvodim-kubevirt" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kubernetes-dlya-sisadmina-vvodim-kubevirt&title=Kubernetes для сисадмина - вводим KubeVirt&summary=Всегда существовал какой-то вид разделения между разработчиками и инженерами по инфраструктуре/системными администраторами. Одни писали код, а другие...
&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kubernetes-dlya-sisadmina-vvodim-kubevirt&media=&description=Всегда существовал какой-то вид разделения между разработчиками и инженерами по инфраструктуре/системными администраторами. Одни писали код, а другие...
" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <details open class="toc border-b border-blue text-blue fluid:p-8 overflow-auto cursor-pointer bg-box"><summary class="toc__title text-xl font-medium">Содержание</summary><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#что-такое-kubevirt">Что такое KubeVirt?</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#почему-kubevirt">Почему KubeVirt</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#разбор-kubevirt">Разбор KubeVirt</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#устройство-на-базе-arm-например-mac-m1">Устройство на базе ARM (например, Mac M1).</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#развертывание-виртуальной-машины">Развертывание виртуальной машины</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#установка-kubevirt">Установка KubeVirt</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#создание-виртуальной-машины">Создание виртуальной машины</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#доступ-к-виртуальной-машине">Доступ к виртуальной машине</a></li></ol></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#золотые-образы">Золотые образы</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#подготовка-windows">Подготовка Windows</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#размещение-вм">Размещение ВМ</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#подключение">Подключение</a></li></ol></li></ol></details open><p>Всегда существовал какой-то вид разделения между разработчиками и инженерами по инфраструктуре/системными администраторами. Одни писали код, а другие создавали окружения, в которых этот код работал. С различными движениями, произошедшими в области облачных вычислений, DevOps и внесением вклада в open source проекты, границы между ними стали размытыми. Все начали писать код и работать в облаке.</p>
<p>С появлением Kubernetes эти грани еще более размыты. Все начали писать небольшие куски кода и управлять такими вещами, как масштабирование, сети и хранилище. Но что же насчет тех сред, которые все еще требуют виртуальных машин (VMs)? Организации все равно нужны VMs и стандартная инфраструктура, несмотря на размытие линий между Dev и Ops.</p>
<p>И здесь на сцену выходит KubeVirt.</p>
<h2 id="что-такое-kubevirt">Что такое KubeVirt?<a aria-hidden="true" tabindex="-1" href="#что-такое-kubevirt"><span class="icon icon-link"></span></a></h2>
<p>Когда речь идет о платформенной инженерии и Kubernetes, нам все равно нужно думать о виртуальных машинах. В мире по-прежнему работает миллионы виртуальных машин, и, честно говоря, это, вероятно, не прекратится в течение очень долгого времени, если вообще когда-либо. Подумайте об этом – главныефреймы до сих пор работают.</p>
<p>Не все приложения будут контейнеризированы.</p>
<p>Из-за этого нам нужен способ управления виртуальными машинами в Kubernetes, если Kubernetes собирается быть будущей платформой по выбору.</p>
<p>Вводим KubeVirt.</p>
<p>KubeVirt представляет собой метод, по сути, контейнеризации виртуальных машин. Это почти похоже на вложенную виртуализацию. Вы берете образ операционной системы в формате ISO или .img и выполняете его в Kubernetes. Вы можете управлять им декларативно, как с любым другим подом, но он “регистрируется” в Kubernetes как виртуальная машина.</p>
<h2 id="почему-kubevirt">Почему KubeVirt<a aria-hidden="true" tabindex="-1" href="#почему-kubevirt"><span class="icon icon-link"></span></a></h2>
<p>KubeVirt устанавливается так же, как и любая другая рабочая нагрузка в Kubernetes – как Pod с компонентами оператора (CRD и контроллерами).</p>
<p>KubeVirt делает возможным управление виртуальными машинами в Kubernetes. Вам в основном нужно импортировать существующую виртуальную машину или создать новую, скопировав и переместив ее жесткий диск в том Kubernetes, а затем запустив ее из этого тома.</p>
<p>Это декларативный подход к работе с виртуальными машинами. Подобно тому, как это можно видеть, возможно, с Ansible или Chef для VMs, но теперь это работает на Kubernetes. Если Kubernetes должен стать стандартом для нижележащих платформ, должен существовать метод для управления и выполнения нагрузок, которые не ограничиваются контейнерами, потому что не все приложения будут контейнеризированы.</p>
<p>Важно отметить: вы не ПОДКЛЮЧАЕТЕСЬ к существующим виртуальным машинам, которые все еще работают. Вы берете нагрузки, которые работали бы на этих существующих виртуальных машинах, и запускаете их внутри Kubernetes.</p>
<p>Вы выполняете новый стиль виртуализации, а не подключаетесь напрямую к уже работающей виртуальной машине.</p>
<h2 id="разбор-kubevirt">Разбор KubeVirt<a aria-hidden="true" tabindex="-1" href="#разбор-kubevirt"><span class="icon icon-link"></span></a></h2>
<p>При использовании KubeVirt у вас есть возможность выбрать императивный подход, декларативный подход или оба.</p>
<p>Декларативный подход будет использовать оператора. Есть CRD и операторы, которые вы можете установить, и как это делается, вы увидите в практической части этой статьи. С декларативным подходом вы будете использовать API kubevirt.io/v1 с доступными пользовательскими ресурсами. Например, одним из пользовательских ресурсов является ресурс/объект VirtualMachine.</p>
<p>Императивный подход использует утилиту командной строки virtctl для KubeVirt. Kubernetes по своей природе декларативен, поэтому цель всегда использовать декларативный подход, но существует определенный функционал, для которого требуется использовать CLI. Например, использование команды image-upload для загрузки файлов ISO или .dmg для использования в Kubernetes в качестве виртуальной машины выполняется с помощью CLI.</p>
<!-- wp:image -->
<figure class="wp-block-image"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--oMQP_UmC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ps6fsfeiimffkotzolc9.png" alt="Описание изображения"></figure>
<!-- /wp:image -->
<p>Чтобы установить интерфейс командной строки (CLI), существуют два подхода:</p>
<p>Krew - это способ управления плагинами для Kubernetes. Дополнительную информацию можно найти по следующей ссылке: <a href="https://krew.sigs.k8s.io/"></a><a href="https://krew.sigs.k8s.io/" rel="noopener noreferrer nofollow" target="_blank">https://krew.sigs.k8s.io/</a></p>
<p>Для установки <code>virtctl</code> с использованием Krew выполните следующие шаги:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">kubectl</span><span style="color:#ADD7FF"> krew</span><span style="color:#ADD7FF"> install</span><span style="color:#ADD7FF"> virt</span></span>
<span class="line"></span></code></pre>
<h2 id="устройство-на-базе-arm-например-mac-m1">Устройство на базе ARM (например, Mac M1).<a aria-hidden="true" tabindex="-1" href="#устройство-на-базе-arm-например-mac-m1"><span class="icon icon-link"></span></a></h2>
<p>На момент написания этого текста плагин virtctl не работает с Krew, если вы используете систему на базе ARM, например, Mac M1. К счастью, с версии 1.0 KubeVirt существует обходной путь, позволяющий получить его напрямую из исходных файлов.</p>
<p>Сначала загрузите virtctl для ARM по следующей ссылке: <a href="https://github.com/kubevirt/kubevirt/releases/tag/v1.1.0-alpha.0"></a><a href="https://github.com/kubevirt/kubevirt/releases/tag/v1.1.0-alpha.0" rel="noopener noreferrer nofollow" target="_blank">https://github.com/kubevirt/kubevirt/releases/tag/v1.1.0-alpha.0</a></p>
<p>Затем запустите его через терминал. Например, чтобы запустить новую виртуальную машину с именем “deployvm” с помощью командной строки, выполните следующее:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">./virtctl-v1.1.0-alpha.0-darwin-arm64</span><span style="color:#ADD7FF"> start</span><span style="color:#ADD7FF"> deployvm</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Вы также можете добавить virtctl в ваш $PATH.</p>
<h2 id="развертывание-виртуальной-машины">Развертывание виртуальной машины<a aria-hidden="true" tabindex="-1" href="#развертывание-виртуальной-машины"><span class="icon icon-link"></span></a></h2>
<p>В этом разделе вы узнаете, как развернуть виртуальную машину Ubuntu в Kubernetes с использованием KubeVirt.</p>
<h3 id="установка-kubevirt">Установка KubeVirt<a aria-hidden="true" tabindex="-1" href="#установка-kubevirt"><span class="icon icon-link"></span></a></h3>
<p>Сначала вам нужно установить KubeVirt:</p>
<ul>
<li>Указав версию KubeVirt, которую вы хотите использовать, которая может быть последней.</li>
<li>Установив CRD (Custom Resource Definitions) из последней версии.</li>
<li>Установив оператора из последней версии.</li>
</ul>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#5DE4C7">export</span><span style="color:#E4F0FB"> VERSION</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">$(</span><span style="color:#91B4D5">curl</span><span style="color:#ADD7FF"> -s</span><span style="color:#ADD7FF"> https://api.github.com/repos/kubevirt/kubevirt/releases</span><span style="color:#91B4D5"> |</span><span style="color:#91B4D5"> grep</span><span style="color:#ADD7FF"> tag_name</span><span style="color:#91B4D5"> |</span><span style="color:#91B4D5"> grep</span><span style="color:#ADD7FF"> -v</span><span style="color:#ADD7FF"> --</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">-rc</span><span style="color:#A6ACCD">'</span><span style="color:#91B4D5"> |</span><span style="color:#91B4D5"> sort</span><span style="color:#ADD7FF"> -r</span><span style="color:#91B4D5"> |</span><span style="color:#91B4D5"> head</span><span style="color:#ADD7FF"> -1</span><span style="color:#91B4D5"> |</span><span style="color:#91B4D5"> awk</span><span style="color:#ADD7FF"> -F</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">: </span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">{print $2}</span><span style="color:#A6ACCD">'</span><span style="color:#91B4D5"> |</span><span style="color:#91B4D5"> sed</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">s/,//</span><span style="color:#A6ACCD">'</span><span style="color:#91B4D5"> |</span><span style="color:#91B4D5"> xargs</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">echo</span><span style="color:#E4F0FB"> $VERSION</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">kubectl</span><span style="color:#ADD7FF"> apply</span><span style="color:#ADD7FF"> -f</span><span style="color:#ADD7FF"> https://github.com/kubevirt/kubevirt/releases/download/</span><span style="color:#E4F0FB">$VERSION</span><span style="color:#ADD7FF">/kubevirt-operator.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">kubectl</span><span style="color:#ADD7FF"> apply</span><span style="color:#ADD7FF"> -f</span><span style="color:#ADD7FF"> https://github.com/kubevirt/kubevirt/releases/download/</span><span style="color:#E4F0FB">$VERSION</span><span style="color:#ADD7FF">/kubevirt-cr.yaml</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>После установки вышеуказанного, выполните команду <code>kubectl get all -n kubevirt</code>, и вы должны увидеть вывод, подобный приведенному ниже:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">kubectl</span><span style="color:#ADD7FF"> get</span><span style="color:#ADD7FF"> all</span><span style="color:#ADD7FF"> -n</span><span style="color:#ADD7FF"> kubevirt</span></span>
<span class="line"><span style="color:#91B4D5">                               READY</span><span style="color:#ADD7FF">   STATUS</span><span style="color:#ADD7FF">    RESTARTS</span><span style="color:#ADD7FF">      AGE</span></span>
<span class="line"><span style="color:#91B4D5">pod/virt-api-5db54b85bd-65j59</span><span style="color:#5DE4C7">          1</span><span style="color:#ADD7FF">/1</span><span style="color:#ADD7FF">     Running</span><span style="color:#5DE4C7">   1</span><span style="color:#A6ACCD"> (22h </span><span style="color:#ADD7FF">ago</span><span style="color:#A6ACCD">)   26h</span></span>
<span class="line"><span style="color:#91B4D5">pod/virt-api-5db54b85bd-th5z8</span><span style="color:#5DE4C7">          1</span><span style="color:#ADD7FF">/1</span><span style="color:#ADD7FF">     Running</span><span style="color:#5DE4C7">   1</span><span style="color:#A6ACCD"> (22h </span><span style="color:#ADD7FF">ago</span><span style="color:#A6ACCD">)   26h</span></span>
<span class="line"><span style="color:#91B4D5">pod/virt-controller-594d556ff5-gmqdr</span><span style="color:#5DE4C7">   1</span><span style="color:#ADD7FF">/1</span><span style="color:#ADD7FF">     Running</span><span style="color:#5DE4C7">   1</span><span style="color:#A6ACCD"> (22h </span><span style="color:#ADD7FF">ago</span><span style="color:#A6ACCD">)   26h</span></span>
<span class="line"><span style="color:#91B4D5">pod/virt-controller-594d556ff5-r2vmr</span><span style="color:#5DE4C7">   1</span><span style="color:#ADD7FF">/1</span><span style="color:#ADD7FF">     Running</span><span style="color:#5DE4C7">   1</span><span style="color:#A6ACCD"> (22h </span><span style="color:#ADD7FF">ago</span><span style="color:#A6ACCD">)   26h</span></span>
<span class="line"><span style="color:#91B4D5">pod/virt-handler-ch522</span><span style="color:#5DE4C7">                 1</span><span style="color:#ADD7FF">/1</span><span style="color:#ADD7FF">     Running</span><span style="color:#5DE4C7">   0</span><span style="color:#5DE4C7">             26</span><span style="color:#ADD7FF">h</span></span>
<span class="line"><span style="color:#91B4D5">pod/virt-handler-sx7cs</span><span style="color:#5DE4C7">                 1</span><span style="color:#ADD7FF">/1</span><span style="color:#ADD7FF">     Running</span><span style="color:#5DE4C7">   0</span><span style="color:#5DE4C7">             26</span><span style="color:#ADD7FF">h</span></span>
<span class="line"><span style="color:#91B4D5">pod/virt-handler-wzdnr</span><span style="color:#5DE4C7">                 1</span><span style="color:#ADD7FF">/1</span><span style="color:#ADD7FF">     Running</span><span style="color:#5DE4C7">   0</span><span style="color:#5DE4C7">             25</span><span style="color:#ADD7FF">h</span></span>
<span class="line"><span style="color:#91B4D5">pod/virt-handler-xxkq8</span><span style="color:#5DE4C7">                 1</span><span style="color:#ADD7FF">/1</span><span style="color:#ADD7FF">     Running</span><span style="color:#5DE4C7">   0</span><span style="color:#5DE4C7">             26</span><span style="color:#ADD7FF">h</span></span>
<span class="line"><span style="color:#91B4D5">pod/virt-operator-599794b899-pmcj5</span><span style="color:#5DE4C7">     1</span><span style="color:#ADD7FF">/1</span><span style="color:#ADD7FF">     Running</span><span style="color:#5DE4C7">   0</span><span style="color:#5DE4C7">             26</span><span style="color:#ADD7FF">h</span></span>
<span class="line"><span style="color:#91B4D5">pod/virt-operator-599794b899-qkvcp</span><span style="color:#5DE4C7">     1</span><span style="color:#ADD7FF">/1</span><span style="color:#ADD7FF">     Running</span><span style="color:#5DE4C7">   0</span><span style="color:#5DE4C7">             26</span><span style="color:#ADD7FF">h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">NAME</span><span style="color:#ADD7FF">                                  TYPE</span><span style="color:#ADD7FF">        CLUSTER-IP</span><span style="color:#ADD7FF">     EXTERNAL-IP</span><span style="color:#ADD7FF">   PORT</span><span style="color:#A6ACCD">(</span><span style="color:#91B4D5">S</span><span style="color:#A6ACCD">)   </span><span style="color:#ADD7FF">AGE</span></span>
<span class="line"><span style="color:#91B4D5">service/kubevirt-operator-webhook</span><span style="color:#ADD7FF">     ClusterIP</span><span style="color:#5DE4C7">   10.0</span><span style="color:#ADD7FF">.217.253</span><span style="color:#91B4D5">   &#x3C;</span><span style="color:#ADD7FF">non</span><span style="color:#A6ACCD">e</span><span style="color:#91B4D5">></span><span style="color:#5DE4C7">        443</span><span style="color:#ADD7FF">/TCP</span><span style="color:#5DE4C7">   26</span><span style="color:#ADD7FF">h</span></span>
<span class="line"><span style="color:#91B4D5">service/kubevirt-prometheus-metrics</span><span style="color:#ADD7FF">   ClusterIP</span><span style="color:#ADD7FF">   None</span><span style="color:#91B4D5">           &#x3C;</span><span style="color:#ADD7FF">non</span><span style="color:#A6ACCD">e</span><span style="color:#91B4D5">></span><span style="color:#5DE4C7">        443</span><span style="color:#ADD7FF">/TCP</span><span style="color:#5DE4C7">   26</span><span style="color:#ADD7FF">h</span></span>
<span class="line"><span style="color:#91B4D5">service/virt-api</span><span style="color:#ADD7FF">                      ClusterIP</span><span style="color:#5DE4C7">   10.0</span><span style="color:#ADD7FF">.226.106</span><span style="color:#91B4D5">   &#x3C;</span><span style="color:#ADD7FF">non</span><span style="color:#A6ACCD">e</span><span style="color:#91B4D5">></span><span style="color:#5DE4C7">        443</span><span style="color:#ADD7FF">/TCP</span><span style="color:#5DE4C7">   26</span><span style="color:#ADD7FF">h</span></span>
<span class="line"><span style="color:#91B4D5">service/virt-exportproxy</span><span style="color:#ADD7FF">              ClusterIP</span><span style="color:#5DE4C7">   10.0</span><span style="color:#ADD7FF">.206.74</span><span style="color:#91B4D5">    &#x3C;</span><span style="color:#ADD7FF">non</span><span style="color:#A6ACCD">e</span><span style="color:#91B4D5">></span><span style="color:#5DE4C7">        443</span><span style="color:#ADD7FF">/TCP</span><span style="color:#5DE4C7">   26</span><span style="color:#ADD7FF">h</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<h3 id="создание-виртуальной-машины">Создание виртуальной машины<a aria-hidden="true" tabindex="-1" href="#создание-виртуальной-машины"><span class="icon icon-link"></span></a></h3>
<p>После установки KubeVirt вы можете использовать объект VirtualMachine для создания новой виртуальной машины. Например, ниже приведен манифест, который создаст новую виртуальную машину с именем “deployvm” и образом Ubuntu.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#5DE4C7">apiVersion</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">kubevirt.io/v1</span></span>
<span class="line"><span style="color:#5DE4C7">kind</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">VirtualMachine</span></span>
<span class="line"><span style="color:#5DE4C7">metadata</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">  name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">deployvm</span></span>
<span class="line"><span style="color:#5DE4C7">spec</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">  running</span><span style="color:#A6ACCD">: </span><span style="color:#5DE4C7">true</span></span>
<span class="line"><span style="color:#5DE4C7">  template</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">    metadata</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">      labels</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">        kubevirt.io/size</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">medium</span></span>
<span class="line"><span style="color:#5DE4C7">        kubevirt.io/domain</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">test</span></span>
<span class="line"><span style="color:#5DE4C7">    spec</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">      domain</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">        devices</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">          disks</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#A6ACCD">            - </span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">containerdisk</span></span>
<span class="line"><span style="color:#5DE4C7">              disk</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">                bus</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">virtio</span></span>
<span class="line"><span style="color:#A6ACCD">            - </span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">cloudinitdisk</span></span>
<span class="line"><span style="color:#5DE4C7">              disk</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">                bus</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">virtio</span></span>
<span class="line"><span style="color:#5DE4C7">          interfaces</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#A6ACCD">            - </span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">default</span></span>
<span class="line"><span style="color:#5DE4C7">              masquerade</span><span style="color:#A6ACCD">: {}</span></span>
<span class="line"><span style="color:#5DE4C7">        resources</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">          requests</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">            memory</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">64M</span></span>
<span class="line"><span style="color:#5DE4C7">      networks</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#A6ACCD">        - </span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">default</span></span>
<span class="line"><span style="color:#5DE4C7">          pod</span><span style="color:#A6ACCD">: {}</span></span>
<span class="line"><span style="color:#5DE4C7">      volumes</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#A6ACCD">        - </span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">containerdisk</span></span>
<span class="line"><span style="color:#5DE4C7">          containerDisk</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">            image</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">mcas/kubevirt-ubuntu-20.04:latest</span></span>
<span class="line"><span style="color:#A6ACCD">        - </span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">cloudinitdisk</span></span>
<span class="line"><span style="color:#5DE4C7">          cloudInitNoCloud</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">            userDataBase64</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">SGkuXG4=</span></span>
<span class="line"></span></code></pre>
<p>💡 Вы также можете запустить виртуальную машину, используя команду <code>start vm</code> внутри <code>virtctl</code>.</p>
<p>После запуска манифеста VirtualMachine, вы можете использовать команду <code>kubectl get vms</code>, чтобы увидеть, как виртуальная машина запускается.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">NAME</span><span style="color:#ADD7FF">       AGE</span><span style="color:#ADD7FF">   STATUS</span><span style="color:#ADD7FF">     READY</span></span>
<span class="line"><span style="color:#91B4D5">deployvm</span><span style="color:#5DE4C7">   3</span><span style="color:#ADD7FF">s</span><span style="color:#ADD7FF">    Starting</span><span style="color:#ADD7FF">   False</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Через примерно 30 секунд, статус должен измениться на “Running”.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">NAME</span><span style="color:#ADD7FF">       AGE</span><span style="color:#ADD7FF">   STATUS</span><span style="color:#ADD7FF">    READY</span></span>
<span class="line"><span style="color:#91B4D5">deployvm</span><span style="color:#5DE4C7">   42</span><span style="color:#ADD7FF">s</span><span style="color:#ADD7FF">   Running</span><span style="color:#ADD7FF">   True</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<h3 id="доступ-к-виртуальной-машине">Доступ к виртуальной машине<a aria-hidden="true" tabindex="-1" href="#доступ-к-виртуальной-машине"><span class="icon icon-link"></span></a></h3>
<p>Для доступа к виртуальной машине через то, что по сути является SSH-консолью, вы можете использовать команду <code>console</code> внутри CLI <code>virtctl</code>.</p>
<p>Например, если ваша виртуальная машина называется “deployvm”, используйте следующую команду:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">virtctl</span><span style="color:#ADD7FF"> console</span><span style="color:#ADD7FF"> deployvm</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<h2 id="золотые-образы">Золотые образы<a aria-hidden="true" tabindex="-1" href="#золотые-образы"><span class="icon icon-link"></span></a></h2>
<p>Если у вас есть опыт системного администратора или инженера инфраструктуры, термин “золотой образ” наверняка знаком вам. С точки зрения облачной инженерии, вы можете знать его как AMI (Amazon Machine Image).</p>
<p>Это образ, разработанный именно для ваших нужд. Нужен образ Ubuntu с определенными приложениями и программным обеспечением? Создайте клон образа, чтобы использовать его позже. Нужен образ Windows Server 2019 с Active Directory? Создайте такой образ, сделайте его клон и сохраните этот клон как “золотой образ”.</p>
<p>В Kubernetes есть два разных подхода:</p>
<!-- wp:list {"ordered":true} -->
<ol><!-- wp:list-item -->
<li>Containerized Data Importer (CDI).</li>
<!-- /wp:list-item -->
<!-- wp:list-item -->
<li>Хранение ISO-образа в контейнерном образе.</li>
<!-- /wp:list-item --></ol>
<!-- /wp:list -->
<p>CDI - это способ взять .img или ISO, сохранить его в томе и использовать его позже при создании виртуальной машины. CDI имеет собственную CRD (Custom Resource Definition) и конфигурацию оператора, независимую от KubeVirt.</p>
<p>Хранение ISO-образа в контейнерном образе - это другой подход, который кажется более прямолинейным на момент написания этой статьи. Именно поэтому данная статья будет рассматривать подход с “ISO в контейнерном образе”.</p>
<p>В данной статье будет использоваться ISO-образ Windows Server 2019.</p>
<h3 id="подготовка-windows">Подготовка Windows<a aria-hidden="true" tabindex="-1" href="#подготовка-windows"><span class="icon icon-link"></span></a></h3>
<p>Сначала скачайте следующий ISO-образ: <a href="https://www.microsoft.com/en-US/evalcenter/evaluate-windows-server-2019?filetype=ISO">ссылка на ISO Windows Server 2019</a></p>
<p>Затем создайте Dockerfile, который позволит использовать ISO-</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#ADD7FF">FROM scratch</span></span>
<span class="line"><span style="color:#ADD7FF">ADD  17763.3650.221105-1748.rs5_release_svc_refresh_SERVER_EVAL_x64FRE_en-us.iso /disk/</span></span>
<span class="line"></span></code></pre>
<!-- wp:image -->
<figure class="wp-block-image"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--_xP_kwc---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/z9w2if8biw68w72zc9xh.png" alt="Image description"></figure>
<!-- /wp:image -->
<p>После завершения этого процесса, загрузите контейнерный образ на Dockerhub. Если у вас нет учетной записи Dockerhub, вы можете бесплатно зарегистрироваться здесь: <a href="https://hub.docker.com/signup">ссылка для регистрации на Dockerhub</a></p>
<p>После регистрации вам потребуется войти в учетную запись Dockerhub через командную строку.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">docker</span><span style="color:#ADD7FF"> login</span><span style="color:#ADD7FF"> name_of_dockerhub_org</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Вас попросят ввести пароль.</p>
<p>После входа в систему создайте контейнерный образ, пометьте его и отправьте его на Dockerhub. Например, моя организация Dockerhub называется adminturneddevops, поэтому я использую ее имя в примере ниже.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">docker</span><span style="color:#ADD7FF"> build</span><span style="color:#ADD7FF"> -t</span><span style="color:#ADD7FF"> adminturneddevops/winkube/w2k9_iso:sep2020</span><span style="color:#ADD7FF"> .</span></span>
<span class="line"><span style="color:#91B4D5">docker</span><span style="color:#ADD7FF"> tag</span><span style="color:#ADD7FF"> docker_id</span><span style="color:#ADD7FF"> adminturneddevops/winkube:latest</span></span>
<span class="line"><span style="color:#91B4D5">docker</span><span style="color:#ADD7FF"> push</span><span style="color:#ADD7FF"> adminturneddevops/winkube:latest</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<h3 id="размещение-вм">Размещение ВМ<a aria-hidden="true" tabindex="-1" href="#размещение-вм"><span class="icon icon-link"></span></a></h3>
<p>Теперь, когда образ контейнера создан и хранится на Dockerhub, вы можете использовать его для развёртывания ВМ.</p>
<p>Сначала создайте постоянный том (PVC). Как упоминалось выше, том используется для хранения данных, необходимых для работы ВМ. Это можно сравнить с жестким диском на компьютере.</p>
<p>💡 Убедитесь, что вы изучили, какой Storage Class вам нужен для вашей конкретной среды.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#ADD7FF">kubectl apply -f - &#x3C;&#x3C;EOF</span></span>
<span class="line"><span style="color:#5DE4C7">apiVersion</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">v1</span></span>
<span class="line"><span style="color:#5DE4C7">kind</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#5DE4C7">metadata</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">  name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">winhd</span></span>
<span class="line"><span style="color:#5DE4C7">spec</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">  accessModes</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#A6ACCD">    - </span><span style="color:#ADD7FF">ReadWriteOnce</span></span>
<span class="line"><span style="color:#5DE4C7">  resources</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">    requests</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">      storage</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">100Gi</span></span>
<span class="line"><span style="color:#5DE4C7">  storageClassName</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">name_of_storageclass</span></span>
<span class="line"><span style="color:#ADD7FF">EOF</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Далее создайте ВМ. ВМ создается с использованием объекта/ресурса VirtualMachine из API KubeVirt.</p>
<p>Убедитесь, что в строке image: вы указали имя вашей организации на Dockerhub.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#ADD7FF">kubectl apply -f - &#x3C;&#x3C;EOF</span></span>
<span class="line"><span style="color:#5DE4C7">apiVersion</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">kubevirt.io/v1</span></span>
<span class="line"><span style="color:#5DE4C7">kind</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">VirtualMachine</span></span>
<span class="line"><span style="color:#5DE4C7">metadata</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">  generation</span><span style="color:#A6ACCD">: </span><span style="color:#5DE4C7">1</span></span>
<span class="line"><span style="color:#5DE4C7">  labels</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">    kubevirt.io/os</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">windows</span></span>
<span class="line"><span style="color:#5DE4C7">  name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">windowsonkubernetes</span></span>
<span class="line"><span style="color:#5DE4C7">spec</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">  running</span><span style="color:#A6ACCD">: </span><span style="color:#5DE4C7">true</span></span>
<span class="line"><span style="color:#5DE4C7">  template</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">    metadata</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">      labels</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">        kubevirt.io/domain</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">vm1</span></span>
<span class="line"><span style="color:#5DE4C7">    spec</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">      domain</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">        cpu</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">          cores</span><span style="color:#A6ACCD">: </span><span style="color:#5DE4C7">2</span></span>
<span class="line"><span style="color:#5DE4C7">        devices</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">          disks</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#A6ACCD">          - </span><span style="color:#5DE4C7">cdrom</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">              bus</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">sata</span></span>
<span class="line"><span style="color:#5DE4C7">            bootOrder</span><span style="color:#A6ACCD">: </span><span style="color:#5DE4C7">1</span></span>
<span class="line"><span style="color:#5DE4C7">            name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">iso</span></span>
<span class="line"><span style="color:#A6ACCD">          - </span><span style="color:#5DE4C7">disk</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">              bus</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">virtio</span></span>
<span class="line"><span style="color:#5DE4C7">            name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">harddrive</span></span>
<span class="line"><span style="color:#A6ACCD">          - </span><span style="color:#5DE4C7">cdrom</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">              bus</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">sata</span></span>
<span class="line"><span style="color:#5DE4C7">              readonly</span><span style="color:#A6ACCD">: </span><span style="color:#5DE4C7">true</span></span>
<span class="line"><span style="color:#5DE4C7">            name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">virtio-drivers</span></span>
<span class="line"><span style="color:#5DE4C7">        machine</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">          type</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">q35</span></span>
<span class="line"><span style="color:#5DE4C7">        resources</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">          requests</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">            memory</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">4096M</span></span>
<span class="line"><span style="color:#5DE4C7">      volumes</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#A6ACCD">      - </span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">harddrive</span></span>
<span class="line"><span style="color:#5DE4C7">        persistentVolumeClaim</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">          claimName</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">winhd</span></span>
<span class="line"><span style="color:#A6ACCD">      - </span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">iso</span></span>
<span class="line"><span style="color:#5DE4C7">        containerDisk</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">          image</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">YOUR_DOCKER_HUB_ORG/winkube:latest</span></span>
<span class="line"><span style="color:#A6ACCD">      - </span><span style="color:#5DE4C7">name</span><span style="color:#A6ACCD">:  </span><span style="color:#ADD7FF">virtio-drivers</span></span>
<span class="line"><span style="color:#5DE4C7">        containerDisk</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#5DE4C7">          image</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">kubevirt/virtio-container-disk</span></span>
<span class="line"><span style="color:#ADD7FF">EOF</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Запустите kubectl get vm, и через 2-3 минуты вы должны увидеть, что ВМ запущена.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">kubectl</span><span style="color:#ADD7FF"> get</span><span style="color:#ADD7FF"> vm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">NAME</span><span style="color:#ADD7FF">                  AGE</span><span style="color:#ADD7FF">   STATUS</span><span style="color:#ADD7FF">    READY</span></span>
<span class="line"><span style="color:#91B4D5">windowsonkubernetes</span><span style="color:#5DE4C7">   21</span><span style="color:#ADD7FF">m</span><span style="color:#ADD7FF">   Running</span><span style="color:#ADD7FF">   True</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<h3 id="подключение">Подключение<a aria-hidden="true" tabindex="-1" href="#подключение"><span class="icon icon-link"></span></a></h3>
<p>Для подключения через VNC, вам потребуется программа remote-viewer. Если у вас её нет, вы можете воспользоваться следующей ссылкой: <a href="https://www.realvnc.com/en/connect/download/viewer/macos/"></a><a href="https://www.realvnc.com/en/connect/download/viewer/macos/" rel="noopener noreferrer nofollow" target="_blank">https://www.realvnc.com/en/connect/download/viewer/macos/</a></p>
<p>Если у вас установлен virtctl через Krew, используйте следующую команду для подключения через VNC:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">kubectl</span><span style="color:#ADD7FF"> virt</span><span style="color:#ADD7FF"> vnc</span><span style="color:#ADD7FF"> windowsonkubernetes</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Если вы установили virtctl из исходного кода, используйте следующую команду:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">virtctl</span><span style="color:#ADD7FF"> vnc</span><span style="color:#ADD7FF"> windowsonkubernetes</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Теперь вы должны увидеть появление консоли VNC.</p>
<!-- wp:image -->
<figure class="wp-block-image"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--qO_Y6QlK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/h0mirxuxqgg2zrp8x83i.png" alt="Image description"></figure>
<!-- /wp:image -->
<p>Поздравляю! Вы успешно запустили полноценную виртуальную машину с Windows в Kubernetes.</p> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kubernetes-dlya-sisadmina-vvodim-kubevirt" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kubernetes-dlya-sisadmina-vvodim-kubevirt" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Kubernetes для сисадмина - вводим KubeVirt&url=https://igorlov.ru/blog/kubernetes-dlya-sisadmina-vvodim-kubevirt" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kubernetes-dlya-sisadmina-vvodim-kubevirt&title=Kubernetes для сисадмина - вводим KubeVirt&summary=Всегда существовал какой-то вид разделения между разработчиками и инженерами по инфраструктуре/системными администраторами. Одни писали код, а другие...
&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kubernetes-dlya-sisadmina-vvodim-kubevirt&media=&description=Всегда существовал какой-то вид разделения между разработчиками и инженерами по инфраструктуре/системными администраторами. Одни писали код, а другие...
" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/kak-dekoratory-mogut-uprostitь-razrabotku-veb-form" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> Как декораторы могут упростить разработку веб-форм </a> <a href="/blog/udalennaya-konfiguraciya-firebase" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Удаленная конфигурация Firebase </a> </nav>  </div> </div> </article> <div class="container" data-astro-cid-axzg2cw6> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.D-6fTqBY.js" component-export="default" renderer-url="/_astro/client.Bd2Qst3j.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> </div> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="Z2a8j9B" component-url="/_astro/CommentBlock.ChJFdf82.js" component-export="default" renderer-url="/_astro/client.44T8euMP.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>