<!DOCTYPE html><html lang="ru"> <head><title>Как обучить классификатор для набора данных Iris с помощью Tinygrad | Игорь Горлов - Фронтeндер</title><link rel="canonical" href="https://igorlov.ru/blog/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad"><meta name="description" content="В этом уроке мы рассмотрим процесс построения простой модели классификации ирисов с помощью TinyGrad, легкого фреймворка глубокого обучения. Мы рассмотрим след"><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.10.0"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.Dg72Zwgc.css">
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#0d52a1;color:rgba(13,82,161,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw)}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.container[data-astro-cid-vcbh62el]{padding:min(2rem,1.2125rem + 1.05vw)}.list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.link[data-astro-cid-vcbh62el]{font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s;padding:.125rem .75rem;font-size:min(1.5rem,1.1625rem + .45vw);line-height:var(--tw-lh)}
</style>
<link rel="stylesheet" href="/_astro/_single_.CzD8Xhhr.css">
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#27292d;border-color:rgba(39,41,45,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.comments[data-v-f9c4118f]{margin:auto;margin-top:1.25rem;width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.comments:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame[data-v-f9c4118f]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/hoisted.CUFolni_.js"></script><style>[data-astro-transition-scope="astro-xdjatz7t-1"] { view-transition-name: blog-image-kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-16 font-inter text-blue fluid:text-lg lg:pt-24 dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <symbol id="ai:local:logo-one"><g fill="currentColor"><path d="M1198.57 596.749c0 329.575-267.171 596.751-596.747 596.751-329.575 0-596.749-267.176-596.749-596.751S272.248 0 601.823 0c329.576 0 596.747 267.174 596.747 596.749Z"/><circle cx="3035.75" cy="617.751" r="596.749" transform="rotate(-90 3035.75 617.751)"/><path d="M3035.75 2736.81c329.57 0 596.75 267.18 596.75 596.75 0 329.58-267.18 596.75-596.75 596.75-329.58 0-596.75-267.17-596.75-596.75 0-329.57 267.17-596.75 596.75-596.75Z"/><circle cx="596.749" cy="1964.8" r="596.749"/><path d="M1193.5 3332.87c0 329.57-267.176 596.75-596.751 596.75S0 3662.44 0 3332.87c0-329.58 267.174-596.75 596.749-596.75 329.575 0 596.751 267.17 596.751 596.75Z"/><circle cx="5062.46" cy="617.751" r="596.749" transform="rotate(-90 5062.46 617.751)"/><circle cx="5062.46" cy="3333.56" r="596.749" transform="rotate(-90 5062.46 3333.56)"/></g></symbol><use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> Меню</button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> Закрыть</button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты </a> </li> </ul> </nav> </div>   <!-- <ThemeToggle client:only /> --> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <div class="container" data-astro-cid-vcbh62el> <ol class="list" role="list" data-astro-cid-vcbh62el> <li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </div> </nav>  <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <article data-astro-cid-axzg2cw6> <figure class="article__image" data-astro-cid-axzg2cw6> <picture data-astro-cid-axzg2cw6> <source srcset="/_astro/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad-Dec-16-2023.BJNEZUZt_Dobqw.avif" type="image/avif"><source srcset="/_astro/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad-Dec-16-2023.BJNEZUZt_21f51W.webp" type="image/webp"> <img src="/_astro/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad-Dec-16-2023.BJNEZUZt_Z13vzTw.png" alt="Как обучить классификатор для набора данных Iris с помощью Tinygrad" class="aspect-video h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-xdjatz7t-1" width="1120" height="580" decoding="async"> </picture> </figure> </article> <div class="container" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <ul class="article__categories categories" data-astro-cid-axzg2cw6> <li class="categories__item" data-astro-cid-axzg2cw6> <a href="/category/учебник" class="categories__link" data-astro-cid-axzg2cw6> Учебник  </a> </li> </ul> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Как обучить классификатор для набора данных Iris с помощью Tinygrad </h1> <ul class="article__tags tags" data-astro-cid-axzg2cw6> <li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/ai" data-astro-cid-axzg2cw6> Ai </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/tinygrad" data-astro-cid-axzg2cw6> Tinygrad </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/машинное-обучение" data-astro-cid-axzg2cw6> Машинное обучение </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/python" data-astro-cid-axzg2cw6> Python </a> </li> </ul> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 16 дек., 2023 by Игорь Горлов </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div> <div class="article__content prose prose-zinc max-w-full break-words text-blue dark:prose-invert prose-headings:text-blue prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <!-- <TextAds /> --> <!-- <AdfoxTocAds blockId="adfox_17062261612859555" /> --> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как обучить классификатор для набора данных Iris с помощью Tinygrad&url=https://igorlov.ru/blog/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad&title=Как обучить классификатор для набора данных Iris с помощью Tinygrad&summary=В этом уроке мы рассмотрим процесс построения простой модели классификации ирисов с помощью TinyGrad, легкого фреймворка глубокого обучения. Мы рассмотрим след&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad&media=&description=В этом уроке мы рассмотрим процесс построения простой модели классификации ирисов с помощью TinyGrad, легкого фреймворка глубокого обучения. Мы рассмотрим след" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <details open class="toc border-b border-blue text-blue fluid:p-8 overflow-auto cursor-pointer bg-box"><summary class="toc__title text-xl font-medium">Содержание</summary><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#знакомство-с-набором-данных-iris">Знакомство с набором данных Iris</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#настройка-среды">Настройка среды</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#предварительная-обработка-данных-и-обучение">Предварительная обработка данных и обучение</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#переходим-к-собственно-обучению">Переходим к собственно обучению</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#давайте-объясним-что-делают-optzero_grad-lossbackward-и-optstep">Давайте объясним, что делают opt.zero_grad(), loss.backward() и opt.step()</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#optzero_grad">opt.zero_grad()</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#lossbackward">loss.backward()</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#optstep">opt.step()</a></li></ol></li></ol></details open><p>В этом уроке мы рассмотрим процесс построения простой модели классификации ирисов с помощью TinyGrad, легкого фреймворка глубокого обучения. Мы рассмотрим следующие темы:</p>
<p>Этот учебник предполагает, что у вас есть хотя бы базовое понимание нейронных сетей и линейных функций.</p>
<p>Давайте шаг за шагом перейдем к построению нашей модели классификации Iris.</p>
<h2 id="знакомство-с-набором-данных-iris">Знакомство с набором данных Iris<a aria-hidden="true" tabindex="-1" href="#знакомство-с-набором-данных-iris"><span class="icon icon-link"></span></a></h2>
<p>Набор данных Iris - это классический набор данных в машинном обучении. Он содержит образцы трех видов цветков ириса, каждый из которых имеет четыре характеристики: длина чашелистика, ширина чашелистика, длина лепестка и ширина лепестка. Задача состоит в том, чтобы классифицировать виды на основе этих признаков.</p>
<h2 id="настройка-среды">Настройка среды<a aria-hidden="true" tabindex="-1" href="#настройка-среды"><span class="icon icon-link"></span></a></h2>
<p>Прежде чем мы начнем, убедитесь, что у вас установлен TinyGrad и необходимые зависимости. Инструкции по установке можно найти здесь.</p>
<p>Модель</p>
<p>Давайте начнем с создания модели в файле <code>model.py</code>.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> tinygrad.tensor </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> Tensor</span></span>
<span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> tinygrad.nn </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> Linear</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">class</span><span style="color:#ADD7FF"> IrisModel</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#91B4D5">    def</span><span style="color:#A6ACCD"> __init__(</span><span style="color:#E4F0FB">self</span><span style="color:#A6ACCD">):</span></span>
<span class="line"><span style="color:#ADD7FF;font-style:italic">        self</span><span style="color:#A6ACCD">.linear1 </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> Linear(</span><span style="color:#5DE4C7">4</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">16</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#ADD7FF;font-style:italic">        self</span><span style="color:#A6ACCD">.linear2 </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> Linear(</span><span style="color:#5DE4C7">16</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">3</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">    def</span><span style="color:#ADD7FF"> forward</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">self</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">x</span><span style="color:#A6ACCD">):</span></span>
<span class="line"><span style="color:#A6ACCD">        x </span><span style="color:#91B4D5">=</span><span style="color:#ADD7FF;font-style:italic"> self</span><span style="color:#A6ACCD">.linear1(x).relu()</span></span>
<span class="line"><span style="color:#A6ACCD">        x </span><span style="color:#91B4D5">=</span><span style="color:#ADD7FF;font-style:italic"> self</span><span style="color:#A6ACCD">.linear2(x)</span></span>
<span class="line"><span style="color:#5DE4C7C0">        return</span><span style="color:#A6ACCD"> x.log_softmax()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">    @</span><span style="color:#A6ACCDC0">property</span></span>
<span class="line"><span style="color:#91B4D5">    def</span><span style="color:#ADD7FF"> params</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">self</span><span style="color:#A6ACCD">):</span></span>
<span class="line"><span style="color:#5DE4C7C0">        return</span><span style="color:#A6ACCD"> [</span><span style="color:#ADD7FF;font-style:italic">self</span><span style="color:#A6ACCD">.linear1.weight, </span><span style="color:#ADD7FF;font-style:italic">self</span><span style="color:#A6ACCD">.linear2.weight]</span></span>
<span class="line"></span></code></pre>
<p>Начнем с импорта необходимых классов из tinygrad</p>
<p>Как и в pytorch, мы можем создать класс для нашей модели. Поскольку набор данных радужной оболочки глаза содержит четыре поля [float, float, float, float], мы можем использовать простые линейные слои для построения нашей модели.</p>
<p>Функция forward принимает входной тензор, x, и передает его нашим слоям классов, l1 и l2. В конце мы используем функцию log_softmax(), чтобы получить тензор вероятностей для каждого поля.</p>
<h2 id="предварительная-обработка-данных-и-обучение">Предварительная обработка данных и обучение<a aria-hidden="true" tabindex="-1" href="#предварительная-обработка-данных-и-обучение"><span class="icon icon-link"></span></a></h2>
<p>Мы создадим новый файл <code>training.py</code>, в котором будем обрабатывать наши данные из sklearn.datasets и использовать их для обучения нашей модели</p>
<p>Сначала импортируем все необходимое:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#767C9DB0;font-style:italic"># Import necessary modules</span></span>
<span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> tinygrad.nn.optim </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> SGD</span></span>
<span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> tinygrad.tensor </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> Tensor</span></span>
<span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> tinygrad.nn </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> Linear</span></span>
<span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> sklearn.datasets </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> load_iris </span><span style="color:#5DE4C7">as</span><span style="color:#A6ACCD"> iris</span></span>
<span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> sklearn.model_selection </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> train_test_split </span><span style="color:#5DE4C7">as</span><span style="color:#A6ACCD"> dataset_split</span></span>
<span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> model </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> IrisModel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"># Load iris dataset</span></span>
<span class="line"><span style="color:#A6ACCD">iris_data </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> iris()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"># Split the dataset into training and testing sets</span></span>
<span class="line"><span style="color:#A6ACCD">train_data, test_data, train_labels, test_labels </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> dataset_split(iris_data.data, iris_data.target, </span><span style="color:#E4F0FB">test_size</span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7">0.2</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">random_state</span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7">42</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"># Create a model instance</span></span>
<span class="line"><span style="color:#A6ACCD">model </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> IrisModel()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"># Define the optimizer</span></span>
<span class="line"><span style="color:#A6ACCD">optimizer </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> SGD(model.parameters(), </span><span style="color:#E4F0FB">lr</span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7">0.01</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"># Train the model</span></span>
<span class="line"><span style="color:#5DE4C7C0">for</span><span style="color:#A6ACCD"> epoch </span><span style="color:#5DE4C7C0">in</span><span style="color:#E4F0FBD0"> range</span><span style="color:#A6ACCD">(</span><span style="color:#5DE4C7">100</span><span style="color:#A6ACCD">):</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">    # Forward pass</span></span>
<span class="line"><span style="color:#A6ACCD">    output </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> model.forward(train_data)</span></span>
<span class="line"><span style="color:#A6ACCD">    loss </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> ((output </span><span style="color:#91B4D5">-</span><span style="color:#A6ACCD"> train_labels) </span><span style="color:#91B4D5">**</span><span style="color:#5DE4C7"> 2</span><span style="color:#A6ACCD">).sum()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">    # Backward pass</span></span>
<span class="line"><span style="color:#A6ACCD">    loss.backward()</span></span>
<span class="line"><span style="color:#A6ACCD">    optimizer.step()</span></span>
<span class="line"><span style="color:#A6ACCD">    optimizer.zero_grad()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"># Evaluate the model</span></span>
<span class="line"><span style="color:#A6ACCD">test_output </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> model.forward(test_data)</span></span>
<span class="line"><span style="color:#A6ACCD">accuracy </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> np.mean(np.argmax(test_output, </span><span style="color:#E4F0FB">axis</span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7">1</span><span style="color:#A6ACCD">) </span><span style="color:#91B4D5">==</span><span style="color:#A6ACCD"> test_labels)</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Test Accuracy:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, accuracy)</span></span>
<span class="line"></span></code></pre>
<p>Используя load_iris, мы загрузим наши данные, затем разделим их на обучающее и тестовое подмножество</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> sklearn.datasets </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> load_iris</span></span>
<span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> sklearn.model_selection </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> train_test_split</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"># Load the iris dataset</span></span>
<span class="line"><span style="color:#A6ACCD">iris </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> load_iris()</span></span>
<span class="line"><span style="color:#A6ACCD">X </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> iris.data</span></span>
<span class="line"><span style="color:#A6ACCD">y </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> iris.target</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"># Split the dataset into training and testing sets</span></span>
<span class="line"><span style="color:#A6ACCD">X_train, X_test, y_train, y_test </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> train_test_split(X, y, </span><span style="color:#E4F0FB">test_size</span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7">0.2</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">random_state</span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7">42</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span></code></pre>
<p>Далее нам нужно создать экземпляр базовой модели, создать оптимизатор и установить размер партии и количество эпох</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> sklearn.linear_model </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> SGDClassifier</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">model </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> SGDClassifier()</span></span>
<span class="line"><span style="color:#A6ACCD">optimizer </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> SGDClassifier(</span><span style="color:#E4F0FB">alpha</span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7">1e-3</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">epochs </span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7"> 10000</span></span>
<span class="line"><span style="color:#A6ACCD">batch_size </span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7"> 32</span></span>
<span class="line"></span></code></pre>
<p>В отличие от библиотек типа pytorch или tensorflow, нам нужно указать параметры, которые будут обновляться в нашей модели при использовании оптимизатора, для удобства я создал функцию params, возвращающую список весов каждого линейного слоя, иначе вы бы написали что-то вроде:</p>
<p><code>opt = SGD([model.l1.weight, model.l2.weight], lr=1e-3)</code>.</p>
<h2 id="переходим-к-собственно-обучению">Переходим к собственно обучению<a aria-hidden="true" tabindex="-1" href="#переходим-к-собственно-обучению"><span class="icon icon-link"></span></a></h2>
<p>Используя похожий на pytorch for loop подход, мы возьмем случайную выборку из обучающих данных, преобразуем ее в тензор, а затем передадим этот входной тензор в нашу модель для обучения.</p>
<p>Обычно функции потерь имеют свой собственный класс, но в tinygrad к ним можно обращаться с помощью Tensor.</p>
<p>В данном случае мы используем Tensor.sparse_categorial_crossentropy, поскольку мы имеем дело с многоклассовой классификацией.</p>
<p>Эта функция потерь принимает два входа: наш тензор выходов (out) и тензор меток (target).</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#5DE4C7C0">for</span><span style="color:#A6ACCD"> epoch </span><span style="color:#5DE4C7C0">in</span><span style="color:#E4F0FBD0"> range</span><span style="color:#A6ACCD">(epochs):</span></span>
<span class="line"><span style="color:#A6ACCD">    sample_indices </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> np.random.randint(</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">, X_train.shape[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">], </span><span style="color:#E4F0FB">size</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">(</span><span style="color:#5DE4C7">32</span><span style="color:#A6ACCD">))</span></span>
<span class="line"><span style="color:#A6ACCD">    batch </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> Tensor(X_train[sample_indices], </span><span style="color:#E4F0FB">requires_grad</span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7">False</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">    target </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> Tensor(y_train[sample_indices])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">    out </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> model.forward(batch)</span></span>
<span class="line"><span style="color:#A6ACCD">    loss </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> Tensor.sparse_categorical_crossentropy(out, target)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">    opt.zero_grad()</span></span>
<span class="line"><span style="color:#A6ACCD">    loss.backward()</span></span>
<span class="line"><span style="color:#A6ACCD">    opt.step()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">    preds </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> out.numpy().argmax(</span><span style="color:#E4F0FB">axis</span><span style="color:#91B4D5">=-</span><span style="color:#5DE4C7">1</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">    acc </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> (preds </span><span style="color:#91B4D5">==</span><span style="color:#A6ACCD"> target.numpy()).mean()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7C0">    if</span><span style="color:#A6ACCD"> epoch </span><span style="color:#91B4D5">%</span><span style="color:#5DE4C7"> 100</span><span style="color:#91B4D5"> ==</span><span style="color:#5DE4C7"> 0</span><span style="color:#A6ACCD">:</span></span>
<span class="line"><span style="color:#E4F0FBD0">        print</span><span style="color:#A6ACCD">(</span><span style="color:#91B4D5">f</span><span style="color:#5DE4C7">"Epoch </span><span style="color:#5DE4C7">{</span><span style="color:#A6ACCD">epoch</span><span style="color:#5DE4C7">}</span><span style="color:#5DE4C7">, loss: </span><span style="color:#5DE4C7">{</span><span style="color:#A6ACCD">loss.numpy()</span><span style="color:#5DE4C7">}</span><span style="color:#5DE4C7">, acc: </span><span style="color:#5DE4C7">{</span><span style="color:#A6ACCD">acc</span><span style="color:#5DE4C7">}</span><span style="color:#5DE4C7">"</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span></code></pre>
<p>При выполнении кода вы можете увидеть такие строки</p>
<p>Эпоха 9990, потери: 0.20084689557552338, acc: 0.96875 Эпоха 9991, потери: 0.1804082840681076, acc: 1.0 Эпоха 9992, убыток: 0.28833892941474915, acc: 0.90625 Эпоха 9993, потери: 0.15084490180015564, acc: 0.96875 Эпоха 9994, потери: 0.1843332201242447, acc: 1.0 Эпоха 9995, потери: 0.21117405593395233, acc: 0.96875 Эпоха 9996, потери: 0.2075180560350418, acc: 0.96875 Эпоха 9997, потери: 0.13138934969902039, акк: 1.0`</p>
<p>Если потери уменьшаются, значит, наша модель обучается правильно. Также полезно рассчитать точность тестирования нашей модели, чтобы определить, правильно ли она делает прогнозы.</p>
<h2 id="давайте-объясним-что-делают-optzero_grad-lossbackward-и-optstep">Давайте объясним, что делают opt.zero_grad(), loss.backward() и opt.step()<a aria-hidden="true" tabindex="-1" href="#давайте-объясним-что-делают-optzero_grad-lossbackward-и-optstep"><span class="icon icon-link"></span></a></h2>
<h3 id="optzero_grad">opt.zero_grad()<a aria-hidden="true" tabindex="-1" href="#optzero_grad"><span class="icon icon-link"></span></a></h3>
<p>Эта строка отвечает за очистку или обнулениевычисление градиентов параметров модели. В контексте глубокого обучения в процессе обратного распространения вычисляются градиенты потерь относительно параметров модели. Эти градиенты используются для обновления параметров модели с целью минимизации потерь. Прежде чем вычислять новые градиенты для текущей партии данных, необходимо очистить градиенты предыдущей партии. Эта строка гарантирует, что градиенты будут инициализированы нулем.</p>
<h3 id="lossbackward">loss.backward()<a aria-hidden="true" tabindex="-1" href="#lossbackward"><span class="icon icon-link"></span></a></h3>
<p>После очистки градиентов эта строка вычисляет градиенты потерь относительно параметров модели. Она выполняет обратное распространение по вычислительному графу модели. Другими словами, она вычисляет, насколько нужно изменить каждый параметр, чтобы уменьшить потери. Градиенты сохраняются в параметрах модели и будут использоваться на следующем шаге для обновления модели.</p>
<h3 id="optstep">opt.step()<a aria-hidden="true" tabindex="-1" href="#optstep"><span class="icon icon-link"></span></a></h3>
<p>Наконец, эта строка обновляет параметры модели, используя вычисленные градиенты. Это шаг, на котором модель обучается и адаптируется к данным. Оптимизатор (в данном случае opt) отвечает за настройку параметров таким образом, чтобы уменьшить потери. Обычные оптимизаторы, такие как стохастический градиентный спуск (SGD) или его разновидности, например Adam или RMSprop, используют градиенты для определения направления и величины обновления параметров. Скорость обучения, которая часто является гиперпараметром, управляет размером шага обновления.</p>
<p>На выходе мы получаем тензор вероятностей, некоторые из которых отрицательные, а некоторые положительные. Мы используем np.argmax для получения индекса значения с наибольшей вероятностью. Этот индекс соответствует одной из 3 меток, предлагаемых набором данных радужной оболочки глаза.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#A6ACCD">classes </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> { </span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">iris-setosa</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">1</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">iris-versicolor</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">2</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">iris-virginica</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD"> }</span></span>
<span class="line"></span></code></pre>
<p>Подробнее об этом позже</p>
<p>Последний шаг - оценить нашу модель на тестовом подмножестве, чтобы проверить ее точность на данных, на которых она не обучалась</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="py"><code><span class="line"><span style="color:#767C9DB0;font-style:italic">#avg_acc = 0</span></span>
<span class="line"><span style="color:#5DE4C7C0">for</span><span style="color:#A6ACCD"> i </span><span style="color:#5DE4C7C0">in</span><span style="color:#E4F0FBD0"> range</span><span style="color:#A6ACCD">(</span><span style="color:#5DE4C7">100</span><span style="color:#A6ACCD">):</span></span>
<span class="line"><span style="color:#A6ACCD">    samp </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> np.random.randint(</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">, X_test.shape[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">], </span><span style="color:#E4F0FB">size</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">(</span><span style="color:#5DE4C7">32</span><span style="color:#A6ACCD">))</span></span>
<span class="line"><span style="color:#A6ACCD">    batch </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> Tensor(X_test[samp], </span><span style="color:#E4F0FB">requires_grad</span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7">False</span><span style="color:#A6ACCD">).to(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">cuda</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">    target </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> Tensor(y_test[samp]).to(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">cuda</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">    out </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> model.forward(batch)</span></span>
<span class="line"><span style="color:#A6ACCD">    preds </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> out.argmax(</span><span style="color:#E4F0FB">axis</span><span style="color:#91B4D5">=-</span><span style="color:#5DE4C7">1</span><span style="color:#A6ACCD">).numpy()</span></span>
<span class="line"><span style="color:#A6ACCD">    avg_acc </span><span style="color:#91B4D5">+=</span><span style="color:#A6ACCD"> (preds </span><span style="color:#91B4D5">==</span><span style="color:#A6ACCD"> target.numpy()).mean()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#91B4D5">f</span><span style="color:#5DE4C7">"Точность теста: </span><span style="color:#5DE4C7">{</span><span style="color:#A6ACCD">avg_acc</span><span style="color:#91B4D5">/</span><span style="color:#5DE4C7">100}</span><span style="color:#5DE4C7">"</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span></code></pre>
<p>Я не буду слишком подробно объяснять этот шаг, потому что он похож на шаг обучения, за исключением того, что мы не изменяем веса модели с помощью обратного распространения и вычисления функции потерь.</p>
<p>Все, что мы хотим сделать, - это проверить, совпадает ли вывод нашей модели с реальной меткой для данной выборки обучающих данных.</p>
<p>Если вы получили точность выше 0,9, поздравляем! Вы только что построили свою первую модель с помощью tinygrad и использовали ее для обучения классификатора цветов ириса.</p>
<p>PyTorch и Tensorflow могут быть хороши, но Tinygrad позволяет по-новому взглянуть на машинное обучение, позволяя нам увидеть операции, происходящие на более низком уровне.</p>
<p>Использование переменной окружения “DEBUG=4” позволяет нам увидеть различные операции машинного обучения (mlops).</p> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как обучить классификатор для набора данных Iris с помощью Tinygrad&url=https://igorlov.ru/blog/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad&title=Как обучить классификатор для набора данных Iris с помощью Tinygrad&summary=В этом уроке мы рассмотрим процесс построения простой модели классификации ирисов с помощью TinyGrad, легкого фреймворка глубокого обучения. Мы рассмотрим след&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-obuchyt-klassyfykator-dlia-nabora-dann-kh-iris-s-pomoschiu-tinygrad&media=&description=В этом уроке мы рассмотрим процесс построения простой модели классификации ирисов с помощью TinyGrad, легкого фреймворка глубокого обучения. Мы рассмотрим след" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/kak-yspolzovat-tanstack-query-dlia-napysanyia-bolee-chystoho-koda-react-v-kachestve-mladsheho-razrabotchyka" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> Как использовать TanStack-Query для написания более чистого кода React в качестве младшего разработчика </a> <a href="/blog/kak-pomeniat-mestamy-znachenyia-dvukh-peremenn-kh-bez-vremennoi-peremennoi-v-python" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Как поменять местами значения двух переменных без временной переменной в Python </a> </nav>  </div> </div> </article> <div class="container" data-astro-cid-axzg2cw6> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.D-6fTqBY.js" component-export="default" renderer-url="/_astro/client.Bd2Qst3j.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> </div> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="Z2a8j9B" component-url="/_astro/CommentBlock.ChJFdf82.js" component-export="default" renderer-url="/_astro/client.44T8euMP.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>