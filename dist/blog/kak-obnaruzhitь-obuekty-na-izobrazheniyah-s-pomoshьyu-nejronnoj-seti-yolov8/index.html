<!DOCTYPE html><html lang="ru"> <head><title>Как Обнаружить Объекты На Изображениях С Помощью...
</title><link rel="canonical" href="https://igorlov.ru/blog/kak-obnaruzhit%D1%8C-obuekty-na-izobrazheniyah-s-pomosh%D1%8Cyu-nejronnoj-seti-yolov8"><meta name="description" content="Обнаружение объектов - это задача компьютерного зрения, связанная с идентификацией и определением местоположения объектов на изображениях или видео. Она...
"><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.9.1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.CyGIBtQS.css">
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#0d52a1;color:rgba(13,82,161,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw)}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.container[data-astro-cid-vcbh62el]{padding:min(2rem,1.2125rem + 1.05vw)}.list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.link[data-astro-cid-vcbh62el]{font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s;padding:.125rem .75rem;font-size:min(1.5rem,1.1625rem + .45vw);line-height:var(--tw-lh)}
</style>
<link rel="stylesheet" href="/_astro/_single_.C0aKA9dM.css">
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#27292d;border-color:rgba(39,41,45,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.comments[data-v-f9c4118f]{margin:auto;margin-top:1.25rem;width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.comments:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame[data-v-f9c4118f]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/hoisted.CUFolni_.js"></script><style>[data-astro-transition-scope="astro-r75ddqls-1"] { view-transition-name: blog-image-kak-obnaruzhit\44C-obuekty-na-izobrazheniyah-s-pomosh\44Cyu-nejronnoj-seti-yolov8; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-16 font-inter text-blue fluid:text-lg lg:pt-24 dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <symbol id="ai:local:logo-one"><g fill="currentColor"><path d="M1198.57 596.749c0 329.575-267.171 596.751-596.747 596.751-329.575 0-596.749-267.176-596.749-596.751S272.248 0 601.823 0c329.576 0 596.747 267.174 596.747 596.749Z"/><circle cx="3035.75" cy="617.751" r="596.749" transform="rotate(-90 3035.75 617.751)"/><path d="M3035.75 2736.81c329.57 0 596.75 267.18 596.75 596.75 0 329.58-267.18 596.75-596.75 596.75-329.58 0-596.75-267.17-596.75-596.75 0-329.57 267.17-596.75 596.75-596.75Z"/><circle cx="596.749" cy="1964.8" r="596.749"/><path d="M1193.5 3332.87c0 329.57-267.176 596.75-596.751 596.75S0 3662.44 0 3332.87c0-329.58 267.174-596.75 596.749-596.75 329.575 0 596.751 267.17 596.751 596.75Z"/><circle cx="5062.46" cy="617.751" r="596.749" transform="rotate(-90 5062.46 617.751)"/><circle cx="5062.46" cy="3333.56" r="596.749" transform="rotate(-90 5062.46 3333.56)"/></g></symbol><use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> Меню</button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> Закрыть</button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты </a> </li> </ul> </nav> </div>   <!-- <ThemeToggle client:only /> --> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <div class="container" data-astro-cid-vcbh62el> <ol class="list" role="list" data-astro-cid-vcbh62el> <li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </div> </nav>  <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <div class="container" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <ul class="article__categories categories" data-astro-cid-axzg2cw6> <li class="categories__item" data-astro-cid-axzg2cw6> <a href="/category/как-закодить" class="categories__link" data-astro-cid-axzg2cw6> Как закодить  </a> </li> </ul> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Как обнаружить объекты на изображениях с помощью нейронной сети YOLOv8 </h1> <ul class="article__tags tags" data-astro-cid-axzg2cw6> <li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/машинное-обучение" data-astro-cid-axzg2cw6> Машинное обучение </a> </li> </ul> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 11 нояб., 2023 by Igor Gorlov </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div> <article data-astro-cid-axzg2cw6> <figure class="article__image" data-astro-cid-axzg2cw6> <picture data-astro-cid-axzg2cw6> <source srcset="/_astro/kak-obnaruzhit%D1%8C-obuekty-na-izobrazheniyah-s-pomosh%D1%8Cyu-nejronnoj-seti-yolov8-Nov-11-2023.DL1tJCAS_ZxSPxJ.avif" type="image/avif"><source srcset="/_astro/kak-obnaruzhit%D1%8C-obuekty-na-izobrazheniyah-s-pomosh%D1%8Cyu-nejronnoj-seti-yolov8-Nov-11-2023.DL1tJCAS_ZKdmCr.webp" type="image/webp"> <img src="/_astro/kak-obnaruzhit%D1%8C-obuekty-na-izobrazheniyah-s-pomosh%D1%8Cyu-nejronnoj-seti-yolov8-Nov-11-2023.DL1tJCAS_10srDw.png" alt="Как обнаружить объекты на изображениях с помощью нейронной сети YOLOv8" class="aspect-video h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-r75ddqls-1" width="1120" height="580" decoding="async"> </picture> </figure> </article> <div class="article__content prose prose-zinc max-w-full break-words text-blue dark:prose-invert prose-headings:text-blue prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <div id="adfox_17062261612859555"></div> <script>(function(){const blockId = "adfox_17062261612859555";

	window.yaContextCb = window.yaContextCb || [];
	window.yaContextCb.push(() => {
		Ya.adfoxCode.createAdaptive(
			{
				ownerId: 1493338,
				containerId: blockId,
				params: {
					p1: 'dawgg',
					p2: 'p',
				},
			},
			['desktop', 'tablet', 'phone'],
			{
				tabletWidth: 830,
				phoneWidth: 480,
				isAutoReloads: true,
			},
		);
	});
})();</script> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-obnaruzhitь-obuekty-na-izobrazheniyah-s-pomoshьyu-nejronnoj-seti-yolov8" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-obnaruzhitь-obuekty-na-izobrazheniyah-s-pomoshьyu-nejronnoj-seti-yolov8" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как обнаружить объекты на изображениях с помощью нейронной сети YOLOv8&url=https://igorlov.ru/blog/kak-obnaruzhitь-obuekty-na-izobrazheniyah-s-pomoshьyu-nejronnoj-seti-yolov8" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-obnaruzhitь-obuekty-na-izobrazheniyah-s-pomoshьyu-nejronnoj-seti-yolov8&title=Как обнаружить объекты на изображениях с помощью нейронной сети YOLOv8&summary=Обнаружение объектов - это задача компьютерного зрения, связанная с идентификацией и определением местоположения объектов на изображениях или видео. Она...
&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-obnaruzhitь-obuekty-na-izobrazheniyah-s-pomoshьyu-nejronnoj-seti-yolov8&media=&description=Обнаружение объектов - это задача компьютерного зрения, связанная с идентификацией и определением местоположения объектов на изображениях или видео. Она...
" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <details open class="toc border-b border-blue text-blue fluid:p-8 overflow-auto cursor-pointer bg-box"><summary class="toc__title text-xl font-medium">Содержание</summary><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#задачи-которые-может-решать-yolov8">Задачи, которые может решать YOLOv8</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#как-начать-работу-с-yolov8">Как начать работу с YOLOv8</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#как-создать-веб-сервис-для-обнаружения-объектов">Как создать веб-сервис для обнаружения объектов</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#как-создать-веб-сервис-для-обнаружения-объектов-1">Как создать веб-сервис для обнаружения объектов</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#как-создать-фронтенд">Как создать фронтенд</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#как-создать-бэкенд">Как создать бэкенд</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#заключение">Заключение</a></li></ol></details open><p>Обнаружение объектов - это задача компьютерного зрения, связанная с идентификацией и определением местоположения объектов на изображениях или видео. Она является важной частью многих приложений, таких как самоуправляемые автомобили, робототехника и видеонаблюдение.</p>
<p>За прошедшие годы было разработано множество методов и алгоритмов, позволяющих находить объекты на изображениях и определять их положение. Отличное качество при выполнении этих задач достигается при использовании сверточных нейронных сетей.</p>
<p>Одной из самых популярных нейронных сетей для решения этой задачи является YOLO, созданная в 2015 году Джозефом Редмоном, Сантошем Диввалой, Россом Гиршиком и Али Фархади в их известной научной работе “You Only Look Once: Unified, Real-Time Object Detection”.</p>
<p>С тех пор появилось довольно много версий YOLO. Последние версии могут делать даже больше, чем обнаружение объектов. Самой новой версией является YOLOv8, которую мы будем использовать в этом учебном пособии.</p>
<p>Здесь я покажу основные возможности этой сети для обнаружения объектов. Сначала мы используем предварительно обученную модель для обнаружения таких распространенных классов объектов, как кошки и собаки. Затем я покажу, как обучить собственную модель для обнаружения конкретных типов объектов, которые вы выберете, и как подготовить данные для этого процесса. Наконец, мы создадим веб-приложение для обнаружения объектов на изображениях прямо в веб-браузере с использованием собственной обученной модели.</p>
<p>Для того чтобы следовать этому руководству, вы должны быть знакомы с языком Python и иметь базовое представление о машинном обучении, нейронных сетях и их применении для обнаружения объектов. Для ознакомления со всей необходимой теорией машинного обучения можно посмотреть этот краткий видеокурс.</p>
<p>После того как вы освежили теорию, давайте приступим к практике!</p>
<h2 id="задачи-которые-может-решать-yolov8">Задачи, которые может решать YOLOv8<a aria-hidden="true" tabindex="-1" href="#задачи-которые-может-решать-yolov8"><span class="icon icon-link"></span></a></h2>
<p>С помощью сети YOLOv8 можно решать задачи классификации, обнаружения объектов и сегментации изображений. Все эти методы по-разному обнаруживают объекты на изображениях или видео, как показано на рисунке ниже:</p>
<figure class="igorlov-figure"><img src="https://www.freecodecamp.org/news/content/images/2023/04/compvision_tasks.png" alt="задачи компьютерного зрения"><figcaption>задачи компьютерного зрения</figcaption></figure>
<p>Общие проблемы компьютерного зрения - классификация, обнаружение и сегментация</p>
<p>Нейронная сеть, созданная и обученная для классификации изображений, определяет класс объекта на изображении и выдает его название, а также вероятность такого прогноза.</p>
<p>Например, на левом изображении было получено, что это “кошка” и что уровень доверия к этому предсказанию составляет 92% (0,92).</p>
<p>Нейронная сеть обнаружения объектов, помимо типа объекта и вероятности, возвращает координаты объекта на изображении: x, y, ширину и высоту, как показано на втором изображении. Нейронные сети обнаружения объектов могут также определять несколько объектов на изображении и их ограничительные рамки.</p>
<p>Наконец, в дополнение к типам объектов и ограничительным рамкам нейронная сеть, обученная для сегментации изображений, определяет формы объектов, как показано на правом изображении.</p>
<p>Для этих задач разработано множество различных архитектур нейронных сетей, и для каждой из них раньше приходилось использовать отдельную сеть. К счастью, после создания YOLO ситуация изменилась. Теперь для решения всех этих задач можно использовать единую платформу.</p>
<p>В этой статье мы рассмотрим обнаружение объектов с помощью YOLOv8. Я расскажу вам о том, как создать веб-приложение, которое будет обнаруживать на изображениях светофоры и дорожные знаки. В последующих статьях я расскажу о других функциях, включая сегментацию изображений.</p>
<p>В следующих разделах мы рассмотрим все шаги, необходимые для создания детектора объектов. К концу этого урока у вас будет готовое веб-приложение с поддержкой искусственного интеллекта.</p>
<h2 id="как-начать-работу-с-yolov8">Как начать работу с YOLOv8<a aria-hidden="true" tabindex="-1" href="#как-начать-работу-с-yolov8"><span class="icon icon-link"></span></a></h2>
<p>С технической точки зрения YOLOv8 - это группа моделей конволюционных нейронных сетей, созданных и обученных с помощью фреймворка PyTorch.</p>
<p>Кроме того, пакет YOLOv8 предоставляет единый Python API для работы со всеми моделями с помощью одних и тех же методов. Поэтому для его использования необходима среда для выполнения Python-кода. Я настоятельно рекомендую использовать Jupyter Notebook.</p>
<p>Убедившись, что на компьютере установлены Python и Jupyter, запустите блокнот и установите в него пакет YOLOv8, выполнив следующую команду:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">!pip</span><span style="color:#ADD7FF"> install</span><span style="color:#ADD7FF"> ultralytics</span></span>
<span class="line"></span></code></pre>
<p>В пакете ultralytics имеется класс YOLO, используемый для создания нейросетевых моделей.</p>
<p>Чтобы получить к нему доступ, импортируйте его в свой Python-код:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> ultralytics </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> YOLO</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Теперь все готово для создания нейросетевой модели:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#A6ACCD">model </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> YOLO(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">yolov8m.pt</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Как я уже упоминал, YOLOv8 представляет собой группу нейросетевых моделей. Эти модели были созданы и обучены с помощью PyTorch и экспортированы в файлы с расширением .pt.</p>
<p>Существует три типа моделей и по 5 моделей разного размера для каждого типа:</p>
<table>
<tbody>
<tr>
<td>
<strong>Classification</strong>
</td>
<td>
<strong>Detection</strong>
</td>
<td>
<strong>Segmentation</strong>
</td>
<td>
<strong>Kind</strong>
</td>
</tr>
<tr>
<td>
yolov8n-cls.pt
</td>
<td>
yolov8n.pt
</td>
<td>
yolov8n-seg.pt
</td>
<td>Nano</td>
</tr>
<tr>
<td>
yolov8s-cls.pt
</td>
<td>
yolov8s.pt
</td>
<td>
yolov8s-seg.pt
</td>
<td>Small</td>
</tr>
<tr>
<td>
yolov8m-cls.pt
</td>
<td>
yolov8m.pt
</td>
<td>
yolov8m-seg.pt
</td>
<td>Medium</td>
</tr>
<tr>
<td>
yolov8l-cls.pt
</td>
<td>
yolov8l.pt
</td>
<td>
yolov8l-seg.pt
</td>
<td>Large</td>
</tr>
<tr>
<td>
yolov8x-cls.pt
</td>
<td>
yolov8x.pt
</td>
<td>
yolov8x-seg.pt
</td>
<td>Huge</td>
</tr>
</tbody>
</table>
<p>Чем больше модель, тем выше качество предсказания, но тем медленнее она будет работать.</p>
<p>В данном руководстве я буду рассматривать обнаружение объектов, поэтому в предыдущем фрагменте кода я выбрал модель “yolov8m.pt”, которая является моделью среднего размера для обнаружения объектов.</p>
<p>При первом запуске этого кода он загрузит файл yolov8m.pt с сервера Ultralytics в текущую папку. Затем будет построен объект модели. Теперь можно обучать эту модель, обнаруживать объекты и экспортировать ее для использования в производстве. Для всех этих задач существуют удобные методы:</p>
<ul>
<li>train({путь к файлу дескриптора набора данных}) - используется для обучения модели на наборе данных изображений.</li>
<li>predict({image}) - используется для предсказания для заданного изображения, например, для определения ограничивающих рамок всех объектов, которые модель может найти на изображении.</li>
<li>export({формат}) - используется для экспорта модели из стандартного формата PyTorch в заданный формат.</li>
</ul>
<p>Все модели YOLOv8 для обнаружения объектов уже предварительно обучены на наборе данных COCO, который представляет собой огромную коллекцию изображений 80 различных типов. Поэтому, если у вас нет специфических потребностей, то вы можете просто запустить ее как есть, без дополнительного обучения.</p>
<p>Например, вы можете загрузить это изображение как “cat_dog.jpg”:</p>
<figure class="igorlov-figure"><img src="https://www.freecodecamp.org/news/content/images/2023/04/cat_dog.jpg" alt="кошка собака"><figcaption>кошка собака</figcaption></figure>
<p>Пример изображения с кошкой и собакой</p>
<p>и запустить предсказание для обнаружения всех объектов на нем:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#A6ACCD">results </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> model.predict(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">cat_dog.jpg</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span></code></pre>
<p>Метод predict принимает множество различных типов входных данных, включая путь к одному изображению, массив путей к изображениям, объект Image известной библиотеки PIL Python и другие.</p>
<p>После прогона входных данных через модель он возвращает массив результатов для каждого входного изображения. Поскольку мы предоставили только одно изображение, возвращается массив с одним элементом, который можно извлечь следующим образом:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#A6ACCD">result </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> results[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Результат содержит обнаруженные объекты и удобные свойства для работы с ними. Наиболее важным из них является массив boxes, содержащий информацию об обнаруженных ограничительных границах на изображении. Количество обнаруженных объектов можно определить, выполнив функцию len:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E4F0FBD0">len</span><span style="color:#A6ACCD">(result.boxes)</span></span>
<span class="line"></span></code></pre>
<p>При запуске я получил значение “2”, что означает, что обнаружено две коробки: одна для собаки, другая для кошки.</p>
<p>Далее можно проанализировать каждый ящик либо в цикле, либо вручную. Возьмем первый:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#A6ACCD">box </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> result.boxes[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">]</span></span>
<span class="line"></span></code></pre>
<p>Объект box содержит свойства ограничивающей рамки, в том числе:</p>
<ul>
<li>xyxy - координаты рамки в виде массива [x1,y1,x2,y2].</li>
<li>cls - идентификатор типа объекта</li>
<li>conf - уровень доверия модели к данному объекту. Если он очень низкий, например &#x3C; 0.5, то коробку можно просто игнорировать.</li>
</ul>
<p>Выведем информацию об обнаруженном ящике:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Object type:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, box.cls)</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Coordinates:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, box.xyxy)</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Probability:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, box.conf)</span></span>
<span class="line"></span></code></pre>
<p>Для первой коробки вы получите следующую информацию:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#A6ACCD">Object </span><span style="color:#A6ACCDC0">type</span><span style="color:#A6ACCD">: tensor([</span><span style="color:#5DE4C7">16</span><span style="color:#A6ACCD">.])</span></span>
<span class="line"><span style="color:#A6ACCD">Coordinates: tensor([[</span><span style="color:#5DE4C7">261.1901</span><span style="color:#A6ACCD">,  </span><span style="color:#5DE4C7">94.3429</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">460.5649</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">312.9910</span><span style="color:#A6ACCD">]])</span></span>
<span class="line"><span style="color:#A6ACCD">Probability: tensor([</span><span style="color:#5DE4C7">0.9528</span><span style="color:#A6ACCD">])</span></span>
<span class="line"></span></code></pre>
<p>Как я уже объяснял выше, YOLOv8 содержит модели PyTorch. Выходы моделей PyTorch закодированы в виде массива объектов PyTorch Tensor, поэтому необходимо извлечь первый элемент из каждого из этих массивов:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Object type:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">,box.cls[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">])</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Coordinates:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">,box.xyxy[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">])</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Probability:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">,box.conf[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">])</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#A6ACCD">Object </span><span style="color:#A6ACCDC0">type</span><span style="color:#A6ACCD">: tensor(</span><span style="color:#5DE4C7">16</span><span style="color:#A6ACCD">.)</span></span>
<span class="line"><span style="color:#A6ACCD">Coordinates: tensor([</span><span style="color:#5DE4C7">261.1901</span><span style="color:#A6ACCD">,  </span><span style="color:#5DE4C7">94.3429</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">460.5649</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">312.9910</span><span style="color:#A6ACCD">])</span></span>
<span class="line"><span style="color:#A6ACCD">Probability: tensor(</span><span style="color:#5DE4C7">0.9528</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span></code></pre>
<p>Теперь вы видите данные в виде объектов Tensor. Для распаковки фактических значений из Tensor необходимо использовать метод .tolist() для тензоров с массивом внутри, а также метод .item() для тензоров со скалярными значениями.</p>
<p>Извлечем данные в соответствующие переменные:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#A6ACCD">cords </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> box.xyxy[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].tolist()</span></span>
<span class="line"><span style="color:#A6ACCD">class_id </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> box.cls[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].item()</span></span>
<span class="line"><span style="color:#A6ACCD">conf </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> box.conf[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].item()</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Object type:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, class_id)</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Coordinates:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, cords)</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Probability:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, conf)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#A6ACCD">Object </span><span style="color:#A6ACCDC0">type</span><span style="color:#A6ACCD">: </span><span style="color:#5DE4C7">16.0</span></span>
<span class="line"><span style="color:#A6ACCD">Coordinates: [</span><span style="color:#5DE4C7">261.1900634765625</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">94.3428955078125</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">460.5649108886719</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">312.9909973144531</span><span style="color:#A6ACCD">]</span></span>
<span class="line"><span style="color:#A6ACCD">Probability: </span><span style="color:#5DE4C7">0.9528293609619141</span></span>
<span class="line"></span></code></pre>
<p>Теперь вы видите фактические данные. Координаты можно округлять, и вероятность также можно округлять до двух цифр после точки.</p>
<p>Тип объекта здесь равен 16. Что это означает? Давайте поговорим об этом подробнее.</p>
<p>Все объекты, которые может обнаружить нейронная сеть, имеют числовые идентификаторы. В случае предварительно обученной модели YOLOv8 существует 80 типов объектов с идентификаторами от 0 до 79. Классы объектов COCO хорошо известны, и их можно легко найти в Интернете. Кроме того, объект результата YOLOv8 содержит удобное свойство names для получения этих классов:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(result.names)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#A6ACCD">{</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">person</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 1</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">bicycle</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 2</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">car</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 3</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">motorcycle</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 4</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">airplane</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 5</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">bus</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 6</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">train</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 7</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">truck</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 8</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">boat</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 9</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">traffic light</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 10</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">fire hydrant</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 11</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">stop sign</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 12</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">parking meter</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 13</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">bench</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 14</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">bird</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 15</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">cat</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 16</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">dog</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 17</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">horse</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 18</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">sheep</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 19</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">cow</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 20</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">elephant</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 21</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">bear</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 22</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">zebra</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 23</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">giraffe</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 24</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">backpack</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 25</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">umbrella</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 26</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">handbag</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 27</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">tie</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 28</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">suitcase</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 29</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">frisbee</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 30</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">skis</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 31</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">snowboard</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 32</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">sports ball</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 33</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">kite</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 34</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">baseball bat</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 35</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">baseball glove</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 36</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">skateboard</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 37</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">surfboard</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 38</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">tennis racket</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 39</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">bottle</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 40</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">wine glass</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 41</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">cup</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 42</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">fork</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 43</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">knife</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 44</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">spoon</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 45</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">bowl</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 46</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">banana</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 47</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">apple</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 48</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">sandwich</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 49</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">orange</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 50</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">broccoli</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 51</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">carrot</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 52</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">hot dog</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 53</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">pizza</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 54</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">donut</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 55</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">cake</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 56</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">chair</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 57</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">couch</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 58</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">potted plant</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 59</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">bed</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 60</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">dining table</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 61</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">toilet</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 62</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">tv</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 63</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">laptop</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 64</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">mouse</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 65</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">remote</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 66</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">keyboard</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 67</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">cell phone</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 68</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">microwave</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 69</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">oven</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 70</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">toaster</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 71</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">sink</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 72</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">refrigerator</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 73</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">book</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 74</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">clock</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 75</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">vase</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 76</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">scissors</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 77</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">teddy bear</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 78</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">hair drier</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#5DE4C7"> 79</span><span style="color:#A6ACCD">: </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">toothbrush</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">}</span></span>
<span class="line"></span></code></pre>
<p>В этом словаре есть все, что может обнаружить данная модель. Теперь вы можете обнаружить, что 16 - это “собака”, так что это ограничительное поле является ограничительным полем для обнаруженной DOG.</p>
<p>Давайте изменим вывод, чтобы показать результаты более репрезентативно:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#A6ACCD">cords </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> box.xyxy[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].tolist()</span></span>
<span class="line"><span style="color:#A6ACCD">cords </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> [</span><span style="color:#E4F0FBD0">round</span><span style="color:#A6ACCD">(x) </span><span style="color:#5DE4C7C0">for</span><span style="color:#A6ACCD"> x </span><span style="color:#5DE4C7C0">in</span><span style="color:#A6ACCD"> cords]</span></span>
<span class="line"><span style="color:#A6ACCD">class_id </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> result.names[box.cls[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].item()]</span></span>
<span class="line"><span style="color:#A6ACCD">conf </span><span style="color:#91B4D5">=</span><span style="color:#E4F0FBD0"> round</span><span style="color:#A6ACCD">(box.conf[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].item(), </span><span style="color:#5DE4C7">2</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Object type:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, class_id)</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Coordinates:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, cords)</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Probability:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, conf)</span></span>
<span class="line"></span></code></pre>
<p>В этом коде я округлил все координаты, используя списочное понимание Python. Затем я получил имя класса обнаруженного объекта по ID, используя словарь result.names. Вероятность также была округлена. Вы должны получить следующий результат:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#A6ACCD">Object </span><span style="color:#A6ACCDC0">type</span><span style="color:#A6ACCD">: dog</span></span>
<span class="line"><span style="color:#A6ACCD">Coordinates: [</span><span style="color:#5DE4C7">261</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">94</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">461</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">313</span><span style="color:#A6ACCD">]</span></span>
<span class="line"><span style="color:#A6ACCD">Probability: </span><span style="color:#5DE4C7">0.95</span></span>
<span class="line"></span></code></pre>
<p>Эти данные отлично подходят для отображения в пользовательском интерфейсе. Теперь напишем код для получения этой информации для всех обнаруженных ящиков в цикле:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#5DE4C7C0">for</span><span style="color:#A6ACCD"> box </span><span style="color:#5DE4C7C0">in</span><span style="color:#A6ACCD"> result.boxes:</span></span>
<span class="line"><span style="color:#A6ACCD">  class_id </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> result.names[box.cls[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].item()]</span></span>
<span class="line"><span style="color:#A6ACCD">  cords </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> box.xyxy[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].tolist()</span></span>
<span class="line"><span style="color:#A6ACCD">  cords </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> [</span><span style="color:#E4F0FBD0">round</span><span style="color:#A6ACCD">(x) </span><span style="color:#5DE4C7C0">for</span><span style="color:#A6ACCD"> x </span><span style="color:#5DE4C7C0">in</span><span style="color:#A6ACCD"> cords]</span></span>
<span class="line"><span style="color:#A6ACCD">  conf </span><span style="color:#91B4D5">=</span><span style="color:#E4F0FBD0"> round</span><span style="color:#A6ACCD">(box.conf[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].item(), </span><span style="color:#5DE4C7">2</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#E4F0FBD0">  print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Object type:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, class_id)</span></span>
<span class="line"><span style="color:#E4F0FBD0">  print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Coordinates:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, cords)</span></span>
<span class="line"><span style="color:#E4F0FBD0">  print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">Probability:</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, conf)</span></span>
<span class="line"><span style="color:#E4F0FBD0">  print</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">---</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span></code></pre>
<p>Этот код выполнит аналогичные действия для каждого ящика и выдаст следующее:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#A6ACCD">Object </span><span style="color:#A6ACCDC0">type</span><span style="color:#A6ACCD">: dog</span></span>
<span class="line"><span style="color:#A6ACCD">Coordinates: [</span><span style="color:#5DE4C7">261</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">94</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">461</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">313</span><span style="color:#A6ACCD">]</span></span>
<span class="line"><span style="color:#A6ACCD">Probability: </span><span style="color:#5DE4C7">0.95</span></span>
<span class="line"><span style="color:#D0679D">--</span><span style="color:#91B4D5">-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">Object </span><span style="color:#A6ACCDC0">type</span><span style="color:#A6ACCD">: cat</span></span>
<span class="line"><span style="color:#A6ACCD">Coordinates: [</span><span style="color:#5DE4C7">140</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">170</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">256</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">316</span><span style="color:#A6ACCD">]</span></span>
<span class="line"><span style="color:#A6ACCD">Probability: </span><span style="color:#5DE4C7">0.92</span></span>
<span class="line"><span style="color:#D0679D">--</span><span style="color:#91B4D5">-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D0679D">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">Таким образом, можно запустить обнаружение объектов на других изображениях и увидеть все, что может обнаружить на них модель, обученная COCO.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">В этом видеоролике показана вся сессия кодирования этого раздела в Jupyter Notebook, если, конечно, он у вас установлен.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">https:</span><span style="color:#91B4D5">//</span><span style="color:#A6ACCD">www.youtube.com</span><span style="color:#91B4D5">/</span><span style="color:#A6ACCD">watch</span><span style="color:#D0679D">?</span><span style="color:#A6ACCD">v</span><span style="color:#91B4D5">=</span><span style="color:#D0679D">8Q87QYlonRU</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">Для начала можно использовать модели, предварительно обученные на известных объектах. Но на практике может потребоваться решение для обнаружения конкретных объектов для решения конкретной бизнес</span><span style="color:#91B4D5">-</span><span style="color:#A6ACCD">задачи.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">Например, может потребоваться обнаружить конкретные товары на полках супермаркетов или обнаружить опухоли мозга на рентгеновских снимках. Вполне вероятно, что такая информация отсутствует в открытых наборах данных, а бесплатных моделей, которые знают обо всем, не существует.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">Поэтому необходимо обучить собственную модель обнаружению объектов такого типа. Для этого необходимо создать базу данных аннотированных изображений по вашей проблеме и обучить модель на этих изображениях.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">## Как подготовить данные для обучения модели YOLOv8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">Для обучения модели необходимо подготовить аннотированные изображения и разделить их на обучающий и проверочный наборы данных.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">Тренировочный набор будет использоваться для обучения модели, а проверочный </span><span style="color:#91B4D5">-</span><span style="color:#A6ACCD"> для проверки результатов исследования и измерения качества обученной модели. В обучающий набор можно поместить </span><span style="color:#5DE4C7">80</span><span style="color:#91B4D5">%</span><span style="color:#A6ACCD"> изображений, а в проверочный </span><span style="color:#91B4D5">-</span><span style="color:#5DE4C7"> 20</span><span style="color:#91B4D5">%</span><span style="color:#A6ACCD">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">Вот шаги, которые необходимо выполнить для создания каждого из наборов данных:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">-</span><span style="color:#A6ACCD"> Определите и закодируйте классы объектов, которые вы хотите научить свою модель обнаруживать. Например, если вы хотите обнаруживать только кошек и собак, то можно указать, что </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">"</span><span style="color:#91B4D5"> -</span><span style="color:#A6ACCD"> это кошка, а </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">1</span><span style="color:#A6ACCD">"</span><span style="color:#91B4D5"> -</span><span style="color:#A6ACCD"> собака.</span></span>
<span class="line"><span style="color:#91B4D5">-</span><span style="color:#A6ACCD"> Создайте папку для набора данных и две подпапки в ней: </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">images</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD"> и </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">labels</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">.</span></span>
<span class="line"><span style="color:#91B4D5">-</span><span style="color:#A6ACCD"> Добавьте изображения в подпапку </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">images</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">. Чем больше изображений вы соберете, тем лучше для обучения.</span></span>
<span class="line"><span style="color:#91B4D5">-</span><span style="color:#A6ACCD"> Для каждого изображения создайте текстовый файл с аннотацией в подпапке </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">labels</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">. Текстовые файлы аннотаций должны иметь те же имена, что и файлы изображений, и расширение </span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">.txt</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">. В файлы аннотаций необходимо добавить записи о каждом объекте, существующем на соответствующем изображении, в следующем формате:</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>{object_class_id} {x_center} {y_center} {width} {height}</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span></span></span>
<span class="line"><span>![ограничивающая рамка](https://www.freecodecamp.org/news/content/images/2023/04/bounding_box.png)</span></span>
<span class="line"><span>Параметры ограничивающей рамки</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Это самая трудоемкая ручная работа в процессе машинного обучения: измерить ограничительные рамки для всех объектов и добавить их в файлы аннотаций.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>При этом необходимо нормализовать координаты, чтобы они укладывались в диапазон от 0 до 1. Для их расчета необходимо использовать следующие формулы:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- x_center = (box_x_left+box_x_width/2)/image_width</span></span>
<span class="line"><span>- y_center = (box_y_top+box_height/2)/image_height</span></span>
<span class="line"><span>- width = box_width/image_width</span></span>
<span class="line"><span>- height = box_height/image_height</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Например, если вы хотите добавить в набор данных изображение "cat_dog.jpg", которое мы использовали ранее, необходимо скопировать его в папку "images", а затем измерить и собрать следующие данные об этом изображении и его ограничительных границах:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Изображение:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ширина_изображения = 612</span></span>
<span class="line"><span>image_height = 415</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Объекты:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&#x3C;table></span></span>
<span class="line"><span>&#x3C;tbody></span></span>
<span class="line"><span>&#x3C;tr></span></span>
<span class="line"><span>&#x3C;td>&#x3C;strong>Dog&#x3C;/strong>&#x3C;/td></span></span>
<span class="line"><span>&#x3C;td>&#x3C;strong>Cat&#x3C;/strong>&#x3C;/td></span></span>
<span class="line"><span>&#x3C;/tr></span></span>
<span class="line"><span>&#x3C;tr></span></span>
<span class="line"><span>&#x3C;td></span></span>
<span class="line"><span>box_x_left=261</span></span>
<span class="line"><span>box_x_top=94</span></span>
<span class="line"><span>box_width=200</span></span>
<span class="line"><span>box_height=219</span></span>
<span class="line"><span>&#x3C;/td></span></span>
<span class="line"><span>&#x3C;td></span></span>
<span class="line"><span>box_x_left=140</span></span>
<span class="line"><span>box_x_top=170</span></span>
<span class="line"><span>box_width=116</span></span>
<span class="line"><span>box_height=146</span></span>
<span class="line"><span>&#x3C;/td></span></span>
<span class="line"><span>&#x3C;/tr></span></span>
<span class="line"><span>&#x3C;/tbody></span></span>
<span class="line"><span>&#x3C;/table></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Затем создайте файл "cat_dog.txt" в папке "labels" и, используя приведенные выше формулы, рассчитайте координаты:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Собака (id класса=1):</span></span>
<span class="line"><span></span></span>
<span class="line"><span>x_center = (261+200/2)/612 = 0.589869281</span></span>
<span class="line"><span>y_center = (94+219/2)/415 = 0.490361446</span></span>
<span class="line"><span>ширина = 200/612 = 0.326797386</span></span>
<span class="line"><span>высота = 219/415 = 0.527710843</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Кошка (id класса=0)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>x_center = (140+116/2)/612 = 0.323529412</span></span>
<span class="line"><span>y_center = (170+146/2)/415 = 0.585542169</span></span>
<span class="line"><span>ширина = 116/612 = 0.189542484</span></span>
<span class="line"><span>высота = 146/415 = 0.351807229</span></span>
<span class="line"><span></span></span>
<span class="line"><span>и добавьте в файл следующие строки:</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span></code></pre>
<p>1 0.589869281 0.490361446 0.326797386 0.527710843
0 0.323529412 0.585542169 0.189542484 0.351807229</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span></span></span>
<span class="line"><span>Первая строка содержит ограничительную рамку для собаки (class id=1). Вторая строка содержит ограничительную рамку для кошки (class id=0). Разумеется, на изображении может быть одновременно много собак и много кошек, и для всех них можно добавить ограничительные рамки.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>После добавления и аннотирования всех изображений набор данных готов. Необходимо создать два набора данных и поместить их в разные папки. Окончательная структура папок может выглядеть следующим образом:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>![структура набора данных](https://www.freecodecamp.org/news/content/images/2023/04/dataset_structure.png)</span></span>
<span class="line"><span>Структура набора данных</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Как видно, обучающий набор данных находится в папке "train", а проверочный - в папке "val".</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Наконец, необходимо создать YAML-файл дескриптора набора данных, указывающий на созданные наборы данных и описывающий классы объектов в них. Вот пример такого файла для созданных выше данных:</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span></code></pre>
<p>train: ../train/images
val: ../val/images</p>
<p>nc: 2
names: [‘cat’,‘dog’]</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span></span></span>
<span class="line"><span>В первых двух строках необходимо указать пути к изображениям обучающего и проверочного наборов данных. Пути могут быть как относительными к текущей папке, так и абсолютными.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Затем в строке nc указывается количество классов, существующих в этих наборах данных, а names представляет собой массив имен классов, расположенных в правильном порядке.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Индексы этих элементов - это числа, которые вы использовали при аннотировании изображений, и эти индексы будут возвращены моделью при обнаружении объектов с помощью метода predict. Так, если для кошки использовалось число "0", то оно должно быть первым элементом в массиве имен.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Этот YAML-файл необходимо передать в метод train модели, чтобы запустить процесс обучения.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Для облегчения процесса аннотирования изображений существует множество программ, с помощью которых можно визуально аннотировать изображения для машинного обучения. Список таких программ можно найти в поисковой системе по запросу "software to annotate images for machine learning".</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Существует также множество онлайн-инструментов, которые могут выполнять всю эту работу, например Roboflow Annotate. С помощью этого сервиса достаточно загрузить изображения, нарисовать на них ограничительные рамки и задать классы для каждой ограничительной рамки. Затем инструмент автоматически создаст файлы аннотаций, разделит данные на обучающие и проверочные, а также создаст YAML-файл дескрипторов. Затем можно экспортировать и загрузить аннотированные данные в виде ZIP-файла.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>В приведенном ниже видеоролике я показываю, как использовать Roboflow для создания микронабора данных "кошки и собаки".</span></span>
<span class="line"><span></span></span>
<span class="line"><span>https://www.youtube.com/watch?v=sLZRfzaRBwg</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Для решения реальных задач эта база данных должна быть гораздо больше. Чтобы обучить отличную модель, необходимо иметь сотни или тысячи аннотированных изображений.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Кроме того, при подготовке базы изображений постарайтесь сделать ее сбалансированной. В ней должно быть равное количество объектов каждого класса, то есть в данном примере равное количество собак и кошек. В противном случае обученная на ней модель может предсказать один класс лучше, чем другой.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>После того как данные будут готовы, скопируйте их в папку с кодом на Python, который вы будете использовать для обучения, и вернитесь в Jupyter Notebook, чтобы начать процесс обучения.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>## Как обучить модель YOLOv8</span></span>
<span class="line"><span></span></span>
<span class="line"><span>После того как данные готовы, необходимо пропустить их через модель. Чтобы сделать ее более интересной, мы не будем использовать этот небольшой набор данных "кошки и собаки". Для обучения мы будем использовать другой пользовательский набор данных, содержащий светофоры и дорожные знаки. Это бесплатный набор данных, который я получил из Roboflow Universe. Нажмите "Download Dataset" и выберите формат "YOLOv8".</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Если на момент прочтения этой статьи она недоступна на Roboflow, то вы можете получить ее с моего Google Drive. С помощью этого набора данных можно научить YOLOv8 обнаруживать различные объекты на дорогах, как показано на следующем скриншоте.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>![светофоры](https://www.freecodecamp.org/news/content/images/2023/04/traffic_lights.png)</span></span>
<span class="line"><span>Демонстрация обнаружения светофоров</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Вы можете открыть загруженный zip-файл и убедиться, что он уже аннотирован и структурирован по описанным выше правилам. В архиве также можно найти файл дескриптора набора данных data.yaml.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Если вы скачали архив с Roboflow, то в нем будет содержаться дополнительный набор данных "test", который не используется в процессе обучения. Изображения из него можно использовать для дополнительного тестирования самостоятельно после обучения.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Распакуйте архив в папку с вашим Python-кодом и выполните метод train для запуска цикла обучения:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>```python</span></span>
<span class="line"><span>model.train(data="data.yaml", epochs=30)</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span></code></pre>
<p>Данные - единственная обязательная опция. В нее необходимо передать файл дескриптора YAML. Опция epochs задает количество циклов обучения (по умолчанию 100). Существуют и другие опции, которые могут повлиять на процесс и качество обучаемой модели.</p>
<p>Каждый цикл обучения состоит из двух фаз: фазы обучения и фазы проверки.</p>
<p>На этапе обучения метод train выполняет следующие действия:</p>
<ul>
<li>Извлекает из обучающего набора данных случайную выборку изображений (количество изображений в выборке может быть задано с помощью опции batch).</li>
<li>Пропускает эти изображения через модель и получает в результате граничные поля всех обнаруженных объектов и их классы.</li>
<li>Передает результат в функцию потерь, которая используется для сравнения полученного результата с корректным результатом из аннотационных файлов для этих изображений. Функция потерь вычисляет величину ошибки.</li>
<li>Результат функции потерь передается оптимизатору для корректировки весов модели в зависимости от величины ошибки в нужном направлении. Это позволяет уменьшить ошибки в следующем цикле. По умолчанию используется оптимизатор SGD (Stochastic Gradient Descent), но вы можете попробовать другие, например Adam, чтобы увидеть разницу.</li>
</ul>
<p>На этапе проверки train выполняет следующие действия:</p>
<ul>
<li>Извлекает изображения из набора данных для проверки.</li>
<li>Пропускает их через модель и получает найденные ограничительные рамки для этих изображений.</li>
<li>Сравнивает полученный результат с истинными значениями для этих изображений из текстовых файлов аннотаций.</li>
<li>Вычисляется точность модели на основе разницы между фактическими и ожидаемыми результатами.</li>
</ul>
<p>Ход и результаты каждого этапа для каждой эпохи отображаются на экране. Таким образом, вы можете видеть, как модель обучается и совершенствуется от эпохи к эпохе.</p>
<p>При выполнении кода обучения в цикле обучения вы увидите вывод, аналогичный приведенному ниже:</p>
<figure class="igorlov-figure"><img src="https://www.freecodecamp.org/news/content/images/2023/04/training.png" alt="обучение"><figcaption>обучение</figcaption></figure>
<p>Для каждой эпохи выводится сводка по фазам обучения и проверки: строки 1 и 2 показывают результаты фазы обучения, а строки 3 и 4 - результаты фазы проверки для каждой эпохи.</p>
<p>Этап обучения включает в себя расчет величины ошибки в функции потерь, поэтому наиболее ценными метриками здесь являются box_loss и cls_loss.</p>
<ul>
<li>box_loss показывает величину ошибки при определении ограничивающих рамок.</li>
<li>cls_loss показывает количество ошибок в обнаруженных классах объектов.</li>
</ul>
<p>Почему потери разделены на разные метрики? Потому что модель может правильно определить координаты ограничительной рамки вокруг объекта, но неправильно определить класс объекта в этой рамке. Например, в моей практике она определила собаку как лошадь, но размеры объекта были определены правильно.</p>
<p>Если модель действительно чему-то учится на данных, то вы должны видеть, что эти значения уменьшаются от эпохи к эпохе. На предыдущем снимке экрана box_loss уменьшился: 0.7751, 0.7473, 0.742, и cls_loss тоже уменьшился: 0.702, 0.6422, 0.6211.</p>
<p>На этапе валидации вычисляется качество модели после обучения на изображениях из валидационного набора данных.</p>
<p>Наиболее ценной метрикой качества является mAP50-95 - средняя точность (Mean Average Precision). Если модель обучается и совершенствуется, то точность должна расти от эпохи к эпохе. На предыдущем скриншоте видно, что она медленно растет: 0,788, 0,788, 0,791.</p>
<p>Если после последней эпохи не удалось добиться приемлемой точности, можно увеличить количество эпох и запустить обучение снова. Также можно настроить другие параметры, такие как batch, lr0, lrf, или изменить используемый оптимизатор. Здесь нет четких правил, но есть много рекомендаций.</p>
<p>Тема настройки параметров процесса обучения выходит за рамки статьи. Думаю, что об этом можно написать книгу, и многие из них уже существуют. Их легко можно найти в Интернете. Но если говорить кратко, то в большинстве из них говорится о том, что нужно экспериментировать, пробовать все возможные варианты и сравнивать результаты.</p>
<p>Помимо метрик, которые показываются в процессе обучения, программа пишет много статистики на диск. При начале обучения в текущей папке создается подпапка runs/detect/train, в которую после каждой эпохи записываются различные лог-файлы.</p>
<p>Кроме того, после каждой эпохи происходит экспорт обученной модели в файл /runs/detect/train/weights/last.pt, а модели с наибольшей точностью - в файл /runs/detect/train/weights/best.pt. Таким образом, после завершения обучения можно получить файл best.pt для использования в производстве.</p>
<p>Более подробно о том, как происходит процесс обучения, можно узнать из этого видеоролика. Я использовал Google Colab - облачную версию Jupyter Notebook, чтобы получить доступ к оборудованию с более мощными GPU для ускорения процесса обучения.</p>
<p>На видео показано, как обучить модель на 5 эпохах и загрузить итоговую модель best.pt. В реальных задачах требуется гораздо больше эпох, и будьте готовы ждать окончания обучения несколько часов, а может быть, и дней.</p>
<div class="remark-oembed-inline remark-oembed-you-tube" data-oembed=""><iframe width="200" height="150" src="https://www.youtube.com/embed/HZobbSjbAUc?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen title="How to train a YOLOv8 neural network model"></iframe></div>
<p>После завершения работы настало время запустить обученную модель в производство. В следующем разделе мы создадим веб-сервис для обнаружения объектов на изображениях в режиме онлайн в веб-браузере.</p>
<h2 id="как-создать-веб-сервис-для-обнаружения-объектов">Как создать веб-сервис для обнаружения объектов<a aria-hidden="true" tabindex="-1" href="#как-создать-веб-сервис-для-обнаружения-объектов"><span class="icon icon-link"></span></a></h2>
<p>На этом мы закончили эксперименты с моделью в Jupyter Notebook. Следующую порцию кода необходимо написать в виде отдельного проекта, используя любую Python IDE, например VS Code или PyCharm.</p>
<p>Веб-сервис, который мы собираемся создать, будет иметь веб-страницу с полем ввода файла и элементом HTML5 canvas.</p>
<p>Когда пользователь выбирает файл изображения с помощью поля ввода, интерфейс будет отправлять его на бэкенд. Затем бэкенд пропустит изображение через созданную и обученную нами модель и вернет на веб-страницу массив найденных ограничительных рамок.</p>
<p>Получив его, фронтенд отрисует изображение на элементе canvas, а поверх него - обнаруженные ограничительные рамки.</p>
<p>Сервис будет выглядеть и работать так, как показано на этом видео:</p>
<div class="remark-oembed-inline remark-oembed-you-tube" data-oembed=""><iframe width="200" height="150" src="https://www.youtube.com/embed/iOIfm_5QIiw?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen title="An object detector web service that uses YOLOv8 neural network to detect traffic lights on images."></iframe></div>
<p>После завершения работы настало время запустить обученную модель в производство. В следующем разделе мы создадим веб-сервис для обнаружения объектов на изображениях в режиме онлайн в веб-браузере.</p>
<h2 id="как-создать-веб-сервис-для-обнаружения-объектов-1">Как создать веб-сервис для обнаружения объектов<a aria-hidden="true" tabindex="-1" href="#как-создать-веб-сервис-для-обнаружения-объектов-1"><span class="icon icon-link"></span></a></h2>
<p>На этом мы закончили эксперименты с моделью в Jupyter Notebook. Следующую порцию кода необходимо написать в виде отдельного проекта, используя любую Python IDE, например VS Code или PyCharm.</p>
<p>Веб-сервис, который мы собираемся создать, будет иметь веб-страницу с полем ввода файла и элементом HTML5 canvas.</p>
<p>Когда пользователь выбирает файл изображения с помощью поля ввода, интерфейс будет отправлять его на бэкенд. Затем бэкенд пропустит изображение через созданную и обученную нами модель и вернет на веб-страницу массив найденных ограничительных рамок.</p>
<p>Получив его, фронтенд отрисует изображение на элементе canvas, а поверх него - обнаруженные ограничительные рамки.</p>
<p>Сервис будет выглядеть и работать так, как показано на этом видео:</p>
<div class="remark-oembed-inline remark-oembed-you-tube" data-oembed=""><iframe width="200" height="150" src="https://www.youtube.com/embed/iOIfm_5QIiw?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen title="An object detector web service that uses YOLOv8 neural network to detect traffic lights on images."></iframe></div>
<p>В видеоролике я использовал модель, обученную на 30 эпохах, и она все еще не обнаруживает некоторые светофоры. Для получения лучших результатов можно попробовать обучить ее еще больше. Но отличный способ улучшить качество модели машинного обучения - это добавлять все больше и больше данных.</p>
<p>Поэтому в качестве дополнительного упражнения можно импортировать папку с набором данных в Roboflow, добавить в нее новые изображения и аннотировать их, а затем использовать обновленные данные для продолжения обучения модели.</p>
<h2 id="как-создать-фронтенд">Как создать фронтенд<a aria-hidden="true" tabindex="-1" href="#как-создать-фронтенд"><span class="icon icon-link"></span></a></h2>
<p>Для начала создайте папку для нового проекта Python и в ней файл index.html для веб-страницы фронтенда. Вот содержимое этого файла:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#E4F0FB">&#x3C;!</span><span style="color:#5DE4C7">doctype</span><span style="color:#5FB3A1;font-style:italic"> html</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">&#x3C;</span><span style="color:#5DE4C7">html</span><span style="color:#5FB3A1;font-style:italic"> lang</span><span style="color:#A6ACCD">=</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">en</span><span style="color:#A6ACCD">"</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">	&#x3C;</span><span style="color:#5DE4C7">head</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;</span><span style="color:#5DE4C7">meta</span><span style="color:#5FB3A1;font-style:italic"> charset</span><span style="color:#A6ACCD">=</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">UTF-8</span><span style="color:#A6ACCD">"</span><span style="color:#E4F0FB"> /></span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;</span><span style="color:#5DE4C7">title</span><span style="color:#E4F0FB">></span><span style="color:#A6ACCD">YOLOv8 Object Detection</span><span style="color:#E4F0FB">&#x3C;/</span><span style="color:#5DE4C7">title</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;</span><span style="color:#5DE4C7">style</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#5DE4C7">			canvas</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#ADD7FF">				display</span><span style="color:#A6ACCD">: </span><span style="color:#ADD7FF">block</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#ADD7FF">				border</span><span style="color:#A6ACCD">: </span><span style="color:#5DE4C7">1px</span><span style="color:#ADD7FF"> solid</span><span style="color:#ADD7FF"> black</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#ADD7FF">				margin-top</span><span style="color:#A6ACCD">: </span><span style="color:#5DE4C7">10px</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">			}</span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;/</span><span style="color:#5DE4C7">style</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">	&#x3C;/</span><span style="color:#5DE4C7">head</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">	&#x3C;</span><span style="color:#5DE4C7">body</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;</span><span style="color:#5DE4C7">input</span><span style="color:#5FB3A1;font-style:italic"> id</span><span style="color:#A6ACCD">=</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">uploadInput</span><span style="color:#A6ACCD">"</span><span style="color:#5FB3A1;font-style:italic"> type</span><span style="color:#A6ACCD">=</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">file</span><span style="color:#A6ACCD">"</span><span style="color:#E4F0FB"> /></span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;</span><span style="color:#5DE4C7">canvas</span><span style="color:#E4F0FB">>&#x3C;/</span><span style="color:#5DE4C7">canvas</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;</span><span style="color:#5DE4C7">script</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">			/**</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">			 * "Upload" button onClick handler: uploads selected</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">			 * image file to backend, receives an array of</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">			 * detected objects and draws them on top of image</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">			 */</span></span>
<span class="line"><span style="color:#91B4D5">			const</span><span style="color:#E4F0FB"> input</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> document</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">getElementById</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">uploadInput</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">			input</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">addEventListener</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">change</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">async</span><span style="color:#A6ACCD"> (</span><span style="color:#E4F0FB">event</span><span style="color:#A6ACCD">) </span><span style="color:#91B4D5">=></span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#91B4D5">				const</span><span style="color:#E4F0FB"> file</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> event</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">target</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">files</span><span style="color:#A6ACCD">[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">];</span></span>
<span class="line"><span style="color:#91B4D5">				const</span><span style="color:#E4F0FB"> data</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7"> new</span><span style="color:#E4F0FBD0"> FormData</span><span style="color:#A6ACCD">();</span></span>
<span class="line"><span style="color:#E4F0FB">				data</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">append</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">image_file</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">file</span><span style="color:#A6ACCD">, </span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">image_file</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#91B4D5">				const</span><span style="color:#E4F0FB"> response</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7C0"> await</span><span style="color:#E4F0FBD0"> fetch</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">/detect</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, {</span></span>
<span class="line"><span style="color:#ADD7FF">					method</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">post</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#ADD7FF">					body</span><span style="color:#A6ACCD">:</span><span style="color:#E4F0FB"> data</span><span style="color:#A6ACCD">,</span></span>
<span class="line"><span style="color:#A6ACCD">				});</span></span>
<span class="line"><span style="color:#91B4D5">				const</span><span style="color:#E4F0FB"> boxes</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7C0"> await</span><span style="color:#E4F0FB"> response</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">json</span><span style="color:#A6ACCD">();</span></span>
<span class="line"><span style="color:#E4F0FBD0">				draw_image_and_boxes</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">file</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">boxes</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#A6ACCD">			});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">			/**</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">       * Function draws the image from provided file</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">       * and bounding boxes of detected objects on</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">       * top of the image</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">       * @param file Uploaded file object</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">       * @param boxes Array of bounding boxes in format</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">         [[x1,y1,x2,y2,object_type,probability],...]</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">       */</span></span>
<span class="line"><span style="color:#91B4D5">			function</span><span style="color:#ADD7FF"> draw_image_and_boxes</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">file</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">boxes</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#91B4D5">				const</span><span style="color:#E4F0FB"> img</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7"> new</span><span style="color:#E4F0FBD0"> Image</span><span style="color:#A6ACCD">();</span></span>
<span class="line"><span style="color:#E4F0FB">				img</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">src</span><span style="color:#91B4D5"> =</span><span style="color:#ADD7FF"> URL</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">createObjectURL</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">file</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">				img</span><span style="color:#A6ACCD">.</span><span style="color:#ADD7FF">onload</span><span style="color:#91B4D5"> =</span><span style="color:#A6ACCD"> () </span><span style="color:#91B4D5">=></span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#91B4D5">					const</span><span style="color:#E4F0FB"> canvas</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> document</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">querySelector</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">canvas</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">					canvas</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">width</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> img</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">width</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#E4F0FB">					canvas</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">height</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> img</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">height</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#91B4D5">					const</span><span style="color:#E4F0FB"> ctx</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> canvas</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">getContext</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">2d</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">					ctx</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">drawImage</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">img</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">					ctx</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">strokeStyle</span><span style="color:#91B4D5"> =</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">#00FF00</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#E4F0FB">					ctx</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">lineWidth</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7"> 3</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#E4F0FB">					ctx</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">font</span><span style="color:#91B4D5"> =</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">18px serif</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#E4F0FB">					boxes</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">forEach</span><span style="color:#A6ACCD">(([</span><span style="color:#E4F0FB">x1</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">y1</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">x2</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">y2</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">label</span><span style="color:#A6ACCD">]) </span><span style="color:#91B4D5">=></span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#E4F0FB">						ctx</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">strokeRect</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">x1</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">y1</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">x2</span><span style="color:#91B4D5"> -</span><span style="color:#E4F0FB"> x1</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">y2</span><span style="color:#91B4D5"> -</span><span style="color:#E4F0FB"> y1</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">						ctx</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">fillStyle</span><span style="color:#91B4D5"> =</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">#00ff00</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#91B4D5">						const</span><span style="color:#E4F0FB"> width</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> ctx</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">measureText</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">label</span><span style="color:#A6ACCD">).</span><span style="color:#E4F0FB">width</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#E4F0FB">						ctx</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">fillRect</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">x1</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">y1</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">width</span><span style="color:#91B4D5"> +</span><span style="color:#5DE4C7"> 10</span><span style="color:#A6ACCD">, </span><span style="color:#5DE4C7">25</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">						ctx</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">fillStyle</span><span style="color:#91B4D5"> =</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">#000000</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#E4F0FB">						ctx</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">fillText</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">label</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">x1</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">y1</span><span style="color:#91B4D5"> +</span><span style="color:#5DE4C7"> 18</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#A6ACCD">					});</span></span>
<span class="line"><span style="color:#A6ACCD">				};</span></span>
<span class="line"><span style="color:#A6ACCD">			}</span></span>
<span class="line"><span style="color:#E4F0FB">		&#x3C;/</span><span style="color:#5DE4C7">script</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">	&#x3C;/</span><span style="color:#5DE4C7">body</span><span style="color:#E4F0FB">></span></span>
<span class="line"><span style="color:#E4F0FB">&#x3C;/</span><span style="color:#5DE4C7">html</span><span style="color:#E4F0FB">></span></span>
<span class="line"></span></code></pre>
<p>HTML-часть очень мала и состоит только из поля ввода файла с идентификатором “uploadInput” и элемента canvas под ним.</p>
<p>Затем в JavaScript-части “onChange” мы определяем обработчик события для поля ввода. Когда пользователь выбирает файл изображения, обработчик с помощью функции fetch выполняет POST-запрос к конечной точке /detect backend (которую мы создадим позже) и отправляет ей этот файл изображения.</p>
<p>Бэкэнд должен обнаружить объекты на этом изображении и вернуть ответ с массивом боксов в формате JSON. Этот ответ декодируется и передается в функцию draw_image_and_boxes вместе с файлом изображения.</p>
<p>Функция draw_image_and_boxes загружает изображение из файла. Сразу после загрузки она рисует его на холсте. Затем поверх холста с изображением рисуется каждая ограничивающая рамка с меткой класса.</p>
<p>Итак, теперь давайте создадим бэкенд с конечной точкой /detect для него.</p>
<h2 id="как-создать-бэкенд">Как создать бэкенд<a aria-hidden="true" tabindex="-1" href="#как-создать-бэкенд"><span class="icon icon-link"></span></a></h2>
<p>Мы создадим бэкенд с помощью Flask. Flask имеет свой собственный внутренний веб-сервер, но, по мнению многих разработчиков Flask, он недостаточно надежен для productio. Поэтому мы будем использовать веб-сервер Waitress и запускать наше приложение Flask на нем.</p>
<p>Кроме того, мы будем использовать библиотеку Pillow для чтения загруженных бинарных файлов в виде изображений. Прежде чем продолжить, убедитесь, что все эти пакеты установлены в вашей системе:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">pip3</span><span style="color:#ADD7FF"> install</span><span style="color:#ADD7FF"> flask</span></span>
<span class="line"><span style="color:#91B4D5">pip3</span><span style="color:#ADD7FF"> install</span><span style="color:#ADD7FF"> waitress</span></span>
<span class="line"><span style="color:#91B4D5">pip3</span><span style="color:#ADD7FF"> install</span><span style="color:#ADD7FF"> pillow</span></span>
<span class="line"></span></code></pre>
<p>Бэкэнд будет находиться в одном файле. Назовем его object_detector.py:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> ultralytics </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> YOLO</span></span>
<span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> flask </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> request, Response, Flask</span></span>
<span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> waitress </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> serve</span></span>
<span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> PIL </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> Image</span></span>
<span class="line"><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">app </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> Flask(__name__)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">@</span><span style="color:#ADD7FF">app</span><span style="color:#A6ACCD">.</span><span style="color:#ADD7FF">route</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">/</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#91B4D5">def</span><span style="color:#ADD7FF"> root</span><span style="color:#A6ACCD">():</span></span>
<span class="line"><span style="color:#A6ACCD">    """</span></span>
<span class="line"><span style="color:#5DE4C7">    Site main page handler function.</span></span>
<span class="line"><span style="color:#5DE4C7">    :return: Content of index.html file</span></span>
<span class="line"><span style="color:#A6ACCD">    """</span></span>
<span class="line"><span style="color:#5DE4C7C0">    with</span><span style="color:#E4F0FBD0"> open</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">index.html</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">) </span><span style="color:#5DE4C7C0">as</span><span style="color:#A6ACCD"> file:</span></span>
<span class="line"><span style="color:#5DE4C7C0">        return</span><span style="color:#A6ACCD"> file.read()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">@</span><span style="color:#ADD7FF">app</span><span style="color:#A6ACCD">.</span><span style="color:#ADD7FF">route</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">/detect</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">methods</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">[</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">POST</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">])</span></span>
<span class="line"><span style="color:#91B4D5">def</span><span style="color:#ADD7FF"> detect</span><span style="color:#A6ACCD">():</span></span>
<span class="line"><span style="color:#A6ACCD">    """</span></span>
<span class="line"><span style="color:#5DE4C7">        Handler of /detect POST endpoint</span></span>
<span class="line"><span style="color:#5DE4C7">        Receives uploaded file with a name "image_file",</span></span>
<span class="line"><span style="color:#5DE4C7">        passes it through YOLOv8 object detection</span></span>
<span class="line"><span style="color:#5DE4C7">        network and returns an array of bounding boxes.</span></span>
<span class="line"><span style="color:#5DE4C7">        :return: a JSON array of objects bounding</span></span>
<span class="line"><span style="color:#5DE4C7">        boxes in format</span></span>
<span class="line"><span style="color:#5DE4C7">        [[x1,y1,x2,y2,object_type,probability],..]</span></span>
<span class="line"><span style="color:#A6ACCD">    """</span></span>
<span class="line"><span style="color:#A6ACCD">    buf </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> request.files[</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">image_file</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">]</span></span>
<span class="line"><span style="color:#A6ACCD">    boxes </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> detect_objects_on_image(Image.open(buf.stream))</span></span>
<span class="line"><span style="color:#5DE4C7C0">    return</span><span style="color:#A6ACCD"> Response(</span></span>
<span class="line"><span style="color:#A6ACCD">      json.dumps(boxes),</span></span>
<span class="line"><span style="color:#E4F0FB">      mimetype</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">application/json</span><span style="color:#A6ACCD">'</span></span>
<span class="line"><span style="color:#A6ACCD">    )</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">def</span><span style="color:#ADD7FF"> detect_objects_on_image</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">buf</span><span style="color:#A6ACCD">):</span></span>
<span class="line"><span style="color:#A6ACCD">    """</span></span>
<span class="line"><span style="color:#5DE4C7">    Function receives an image,</span></span>
<span class="line"><span style="color:#5DE4C7">    passes it through YOLOv8 neural network</span></span>
<span class="line"><span style="color:#5DE4C7">    and returns an array of detected objects</span></span>
<span class="line"><span style="color:#5DE4C7">    and their bounding boxes</span></span>
<span class="line"><span style="color:#5DE4C7">    :param buf: Input image file stream</span></span>
<span class="line"><span style="color:#5DE4C7">    :return: Array of bounding boxes in format</span></span>
<span class="line"><span style="color:#5DE4C7">    [[x1,y1,x2,y2,object_type,probability],..]</span></span>
<span class="line"><span style="color:#A6ACCD">    """</span></span>
<span class="line"><span style="color:#A6ACCD">    model </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> YOLO(</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">best.pt</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">    results </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> model.predict(buf)</span></span>
<span class="line"><span style="color:#A6ACCD">    result </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> results[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">]</span></span>
<span class="line"><span style="color:#A6ACCD">    output </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> []</span></span>
<span class="line"><span style="color:#5DE4C7C0">    for</span><span style="color:#A6ACCD"> box </span><span style="color:#5DE4C7C0">in</span><span style="color:#A6ACCD"> result.boxes:</span></span>
<span class="line"><span style="color:#A6ACCD">        x1, y1, x2, y2 </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> [</span></span>
<span class="line"><span style="color:#E4F0FBD0">          round</span><span style="color:#A6ACCD">(x) </span><span style="color:#5DE4C7C0">for</span><span style="color:#A6ACCD"> x </span><span style="color:#5DE4C7C0">in</span><span style="color:#A6ACCD"> box.xyxy[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].tolist()</span></span>
<span class="line"><span style="color:#A6ACCD">        ]</span></span>
<span class="line"><span style="color:#A6ACCD">        class_id </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> box.cls[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].item()</span></span>
<span class="line"><span style="color:#A6ACCD">        prob </span><span style="color:#91B4D5">=</span><span style="color:#E4F0FBD0"> round</span><span style="color:#A6ACCD">(box.conf[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">].item(), </span><span style="color:#5DE4C7">2</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">        output.append([</span></span>
<span class="line"><span style="color:#A6ACCD">          x1, y1, x2, y2, result.names[class_id], prob</span></span>
<span class="line"><span style="color:#A6ACCD">        ])</span></span>
<span class="line"><span style="color:#5DE4C7C0">    return</span><span style="color:#A6ACCD"> output</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">serve(app, </span><span style="color:#E4F0FB">host</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">0.0.0.0</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">port</span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7">8080</span><span style="color:#A6ACCD">)</span></span>
<span class="line"></span></code></pre>
<p>Сначала мы импортируем необходимые библиотеки:</p>
<ul>
<li>ultralytics для модели YOLOv8.</li>
<li>flask для создания веб-приложения Flask, которое будет принимать запросы от фронтенда и отправлять ему ответы.</li>
<li>waitress для запуска веб-сервера и обслуживания на нем веб-приложения Flask.</li>
<li>PIL для загрузки загруженного файла в виде объекта Image, что необходимо для YOLOv8.</li>
<li>json для преобразования массива ограничительных рамок в JSON перед возвратом его на фронтенд.</li>
</ul>
<p>Затем мы определили два маршрута:</p>
<ul>
<li>/, который служит корнем веб-сервиса. Он просто возвращает содержимое файла “index.html”.</li>
<li>/detect, который отвечает на запрос загрузки изображения с фронтенда. Он преобразует RAW-файл в объект Pillow Image, а затем передает это изображение функции detect_objects_on_image.
Функция detect_objects_on_image создает объект модели на основе модели best.pt, которую мы обучали в предыдущем разделе. Убедитесь, что этот файл существует в папке, где вы пишете код.</li>
</ul>
<p>Затем она вызывает метод predict для изображения. predict возвращает обнаруженные ограничивающие рамки.</p>
<p>Далее для каждой рамки извлекаются координаты, имя класса и вероятность, как мы делали это в начале урока. Эта информация добавляется в выходной массив.</p>
<p>Наконец, функция возвращает массив обнаруженных координат объектов и их классов.</p>
<p>После этого массив кодируется в JSON и возвращается на фронтенд.</p>
<p>Последняя строка кода запускает веб-сервер на порту 8080, который обслуживает приложение Flask.</p>
<p>Чтобы запустить сервис, выполните следующую команду:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">python3</span><span style="color:#ADD7FF"> object_detector.py</span></span>
<span class="line"></span></code></pre>
<p>Если все работает правильно, можно открыть http:///localhost:8080 в веб-браузере. На экране должна появиться страница index.html. При выборе любого файла изображения она будет обрабатывать его и выводить ограничительные рамки вокруг всех обнаруженных объектов (или просто выводить изображение, если на нем ничего не обнаружено).</p>
<p>Только что созданный нами веб-сервис является универсальным. Вы можете использовать его с любой моделью YOLOv8. В данный момент он определяет светофоры и дорожные знаки, используя созданную нами модель best.pt. Но вы можете изменить ее, чтобы использовать другую модель, например, модель yolov8m.pt, которую мы использовали ранее для обнаружения кошек, собак и всех других классов объектов, которые могут обнаруживать предварительно обученные модели YOLOv8.</p>
<h2 id="заключение">Заключение<a aria-hidden="true" tabindex="-1" href="#заключение"><span class="icon icon-link"></span></a></h2>
<p>В этом руководстве я рассказал вам о процессе создания веб-приложения с поддержкой искусственного интеллекта, использующего YOLOv8, современную конволюционную нейронную сеть для обнаружения объектов.</p>
<p>Я показал, как создавать модели с использованием предварительно обученных моделей и подготавливать данные для обучения пользовательских моделей. И наконец, мы создали веб-приложение с фронтендом и бэкендом, которое использует обученную модель YOLOv8 для обнаружения светофоров и дорожных знаков.</p>
<p>Исходный код этого приложения можно найти в <a href="https://github.com/AndreyGermanov/yolov8_pytorch_python" rel="noopener noreferrer nofollow" target="_blank">этом репозитории GitHub</a>.</p>
<p>Для решения всех этих задач мы использовали высокоуровневые API Ultralytics, которые по умолчанию поставляются с пакетом YOLOv8. Эти API основаны на фреймворке PyTorch, который использовался для создания большей части современных нейронных сетей.</p>
<p>С одной стороны, это достаточно удобно, но зависимость от этих высокоуровневых API имеет и негативный эффект. Если вам нужно запустить это веб-приложение в продакшене, то необходимо установить туда все эти среды, включая Python, PyTorch и другие зависимости.</p>
<p>Чтобы запустить его на новом чистом сервере, вам придется скачать и установить более 1 ГБ сторонних библиотек! Это определенно не самый отличный вариант.</p>
<p>Кроме того, что делать, если в вашей рабочей среде нет Python? А если весь остальной код написан на другом языке программирования, и вы не планируете использовать Python? Или если вы хотите запустить модель на мобильном телефоне с операционной системой Android или iOS?</p>
<p>Все это говорит о том, что использование пакетов Ultralytics отлично подходит для экспериментов, обучения и подготовки моделей к производству. Но в самом производстве необходимо загружать и использовать модель напрямую, не прибегая к помощи высокоуровневых API.</p>
<p>Для этого необходимо понять, как работает нейронная сеть YOLOv8 “под капотом”, и написать больше кода для подачи входных данных в модель и обработки полученных от нее результатов. Это позволит сделать ваши приложения более быстрыми и менее ресурсоемкими. Для запуска модели обнаружения объектов не требуется установка PyTorch.</p>
<p>Кроме того, вы сможете запускать свои модели даже без Python, используя многие другие языки программирования, включая Julia, C++, Go, Node.js на бэкенде или вообще без бэкенда. Вы можете запускать модели YOLOv8 прямо в браузере, используя только JavaScript на фронтенде.</p>
<p>Хотите узнать, как это делается? Этому будет посвящена моя следующая статья о YOLOv8.</p>
<p>Успехов вам в кодинге и не переставайте учиться!</p> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-obnaruzhitь-obuekty-na-izobrazheniyah-s-pomoshьyu-nejronnoj-seti-yolov8" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-obnaruzhitь-obuekty-na-izobrazheniyah-s-pomoshьyu-nejronnoj-seti-yolov8" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как обнаружить объекты на изображениях с помощью нейронной сети YOLOv8&url=https://igorlov.ru/blog/kak-obnaruzhitь-obuekty-na-izobrazheniyah-s-pomoshьyu-nejronnoj-seti-yolov8" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-obnaruzhitь-obuekty-na-izobrazheniyah-s-pomoshьyu-nejronnoj-seti-yolov8&title=Как обнаружить объекты на изображениях с помощью нейронной сети YOLOv8&summary=Обнаружение объектов - это задача компьютерного зрения, связанная с идентификацией и определением местоположения объектов на изображениях или видео. Она...
&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-obnaruzhitь-obuekty-na-izobrazheniyah-s-pomoshьyu-nejronnoj-seti-yolov8&media=&description=Обнаружение объектов - это задача компьютерного зрения, связанная с идентификацией и определением местоположения объектов на изображениях или видео. Она...
" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/kak-razobratь-stroku-v-python-obuyasnenie-razbora-strok" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> Как разобрать строку в Python - объяснение разбора строк </a> <a href="/blog/kak-dobavitь-tablicy-v-prilozhenie-react" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Как добавить таблицы в приложение React </a> </nav>  </div> </div> </article> <div class="container" data-astro-cid-axzg2cw6> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.D-6fTqBY.js" component-export="default" renderer-url="/_astro/client.Bd2Qst3j.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> </div> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="Z2a8j9B" component-url="/_astro/CommentBlock.ChJFdf82.js" component-export="default" renderer-url="/_astro/client.44T8euMP.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>