<!DOCTYPE html><html lang="ru"> <head><title>Знакомство с примитивными объектами в JavaScript (часть 1) - Igor Gorlov</title><link rel="canonical" href="https://igorlov.ru/blog/znakomstvo-s-primitivnymi-obektami-v-javascript-chast-1"><meta name="description" content="Пытаясь переписать часть разрозненной кодовой базы, Кирилл заново открыл для себя силу объектов JavaScript. Он снова и снова возвращался к шаблону, который..."><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.10.0"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.Dg72Zwgc.css">
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#0d52a1;color:rgba(13,82,161,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw)}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.container[data-astro-cid-vcbh62el]{padding:min(2rem,1.2125rem + 1.05vw)}.list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.link[data-astro-cid-vcbh62el]{font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s;padding:.125rem .75rem;font-size:min(1.5rem,1.1625rem + .45vw);line-height:var(--tw-lh)}
</style>
<link rel="stylesheet" href="/_astro/_single_.CzD8Xhhr.css">
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#27292d;border-color:rgba(39,41,45,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.comments[data-v-f9c4118f]{margin:auto;margin-top:1.25rem;width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.comments:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame[data-v-f9c4118f]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/hoisted.CUFolni_.js"></script><style>[data-astro-transition-scope="astro-xdjatz7t-1"] { view-transition-name: blog-image-znakomstvo-s-primitivnymi-obektami-v-javascript-chast-1; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-16 font-inter text-blue fluid:text-lg lg:pt-24 dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <symbol id="ai:local:logo-one"><g fill="currentColor"><path d="M1198.57 596.749c0 329.575-267.171 596.751-596.747 596.751-329.575 0-596.749-267.176-596.749-596.751S272.248 0 601.823 0c329.576 0 596.747 267.174 596.747 596.749Z"/><circle cx="3035.75" cy="617.751" r="596.749" transform="rotate(-90 3035.75 617.751)"/><path d="M3035.75 2736.81c329.57 0 596.75 267.18 596.75 596.75 0 329.58-267.18 596.75-596.75 596.75-329.58 0-596.75-267.17-596.75-596.75 0-329.57 267.17-596.75 596.75-596.75Z"/><circle cx="596.749" cy="1964.8" r="596.749"/><path d="M1193.5 3332.87c0 329.57-267.176 596.75-596.751 596.75S0 3662.44 0 3332.87c0-329.58 267.174-596.75 596.749-596.75 329.575 0 596.751 267.17 596.751 596.75Z"/><circle cx="5062.46" cy="617.751" r="596.749" transform="rotate(-90 5062.46 617.751)"/><circle cx="5062.46" cy="3333.56" r="596.749" transform="rotate(-90 5062.46 3333.56)"/></g></symbol><use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> Меню</button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> Закрыть</button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты </a> </li> </ul> </nav> </div>   <!-- <ThemeToggle client:only /> --> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <div class="container" data-astro-cid-vcbh62el> <ol class="list" role="list" data-astro-cid-vcbh62el> <li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </div> </nav>  <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <article data-astro-cid-axzg2cw6> <figure class="article__image" data-astro-cid-axzg2cw6> <picture data-astro-cid-axzg2cw6> <source srcset="/_astro/undefined-Feb-16-2023.Bt978EJ__Z1YMoAN.avif" type="image/avif"><source srcset="/_astro/undefined-Feb-16-2023.Bt978EJ__Z2oJXPP.webp" type="image/webp"> <img src="/_astro/undefined-Feb-16-2023.Bt978EJ__Z1Wl2Lm.png" alt="Знакомство с примитивными объектами в JavaScript (часть 1)" class="aspect-video h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-xdjatz7t-1" width="1120" height="580" decoding="async"> </picture> </figure> </article> <div class="container" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <ul class="article__categories categories" data-astro-cid-axzg2cw6> <li class="categories__item" data-astro-cid-axzg2cw6> <a href="/category/учебник" class="categories__link" data-astro-cid-axzg2cw6> Учебник  </a> </li> </ul> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Знакомство с примитивными объектами в JavaScript (часть 1) </h1> <ul class="article__tags tags" data-astro-cid-axzg2cw6> <li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/javascript" data-astro-cid-axzg2cw6> Javascript </a> </li> </ul> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 16 фев., 2023 by Igor Gorlov </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div> <div class="article__content prose prose-zinc max-w-full break-words text-blue dark:prose-invert prose-headings:text-blue prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <!-- <TextAds /> --> <!-- <AdfoxTocAds blockId="adfox_17062261612859555" /> --> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/znakomstvo-s-primitivnymi-obektami-v-javascript-chast-1" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/znakomstvo-s-primitivnymi-obektami-v-javascript-chast-1" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Знакомство с примитивными объектами в JavaScript (часть 1)&url=https://igorlov.ru/blog/znakomstvo-s-primitivnymi-obektami-v-javascript-chast-1" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/znakomstvo-s-primitivnymi-obektami-v-javascript-chast-1&title=Знакомство с примитивными объектами в JavaScript (часть 1)&summary=Пытаясь переписать часть разрозненной кодовой базы, Кирилл заново открыл для себя силу объектов JavaScript. Он снова и снова возвращался к шаблону, который...&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/znakomstvo-s-primitivnymi-obektami-v-javascript-chast-1&media=&description=Пытаясь переписать часть разрозненной кодовой базы, Кирилл заново открыл для себя силу объектов JavaScript. Он снова и снова возвращался к шаблону, который..." target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <p>Пытаясь переписать часть разрозненной кодовой базы, Кирилл заново открыл для себя силу объектов JavaScript. Он снова и снова возвращался к шаблону, который сохранял ясность кода и убирал ненужные операции. Приближение обычных объектов к примитивным значениям изменило ситуацию. Так были открыты Примитивные объекты. В первой части вы увидите, чем отличаются объекты и примитивные значения и как их сблизить.</p>
<p>Кажется естественным использовать строки для различения вещей. Вполне вероятно, что в вашей кодовой базе есть объекты со свойствами name, id или label, которые используются для определения того, является ли объект тем, который вы ищете.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">if (element.label === "title") {
    make_bold(element);
}
</code></pre>
<!-- /wp:code -->
<p>В определенный момент ваш проект растет (в размере, важности, популярности или во всем сразу). Ему требуется больше строк, поскольку появляется больше вещей, которые нужно отличать друг от друга. Строки становятся длиннее, как и стоимость опечаток или, скажем, изменения соглашения об именовании ярлыков. Теперь вам нужно найти все экземпляры этих строк и заменить их. Следовательно, коммит для этого изменения становится намного больше, чем должен быть. Это позволяет вам выглядеть лучше в глазах несведущих. Одновременно это делает вашу жизнь несчастной, поскольку теперь гораздо труднее найти причину регрессии в истории git.</p>
<p>Строки плохо подходят для идентификации. Вы должны учитывать уникальность и опечатки; ваш редактор или IDE не проверит, та ли это строка, которую вы имели в виду. Это плохо. Я слышу, как кто-то говорит: ”Просто поместите их в переменную, да”. Это хорошее предложение, и оно снимает часть моих опасений. Но посмотрите на Джона Смита:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const john_smith_a_person = "John Smith";
const john_smith_a_company = "John Smith";

// Do they have the same name?
john_smith_a_person === john_smith_a_company; // true

// Are they the same thing?
john_smith_a_person === john_smith_a_company; // true
</code></pre>
<!-- /wp:code -->
<p>Случилось так, что Джон носит имя одной компании. Что если я скажу вам, что у меня есть лучшее решение? То, которое устранит все проблемы и добавит больше ценности - позволит вам достичь большего. Что бы вы ответили? Ну, я не буду переписывать статью только потому, что ваш ответ не вписывается в мое изложение. Ответ - объекты. Вы используете сами объекты, чтобы понять, является ли объект тем, что вы ищете.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">// Do they have a same name?
john_smith_a_person.name === john_smith_a_company.name; // true

// Are they the same thing?
john_smith_a_person === john_smith_a_company; // false
</code></pre>
<!-- /wp:code -->
<p>Это делает намерение более ясным. Позвольте мне привести пример получше. Допустим, в вашем приложении есть ярлыки. Они локализованы, поэтому строка ярлыка определяется библиотекой локализации, которую вы используете, и процессом перевода вашей команды. Вы храните свои ярлыки в модуле, где все они аккуратно организованы и курируются. Когда вам нужно сделать что-то особенное для определенных меток, вы можете сравнить их непосредственно с теми, которые у вас есть.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">import React from "react";
import labels from "./labels.js";

const render_label(label) => (
    &#x3C;Label
        className={label === labels.title ? "bold" : "plain"}
        icon={label.icon}
        text={label.text}
    />
)

function TableOfContents({ items }) {
    return (
        &#x3C;ul className="my-menu">
            {items.map(render_label(item.label)}
        &#x3C;/ul>
    );
}
</code></pre>
<!-- /wp:code -->
<p>Видите, как много еще можно сделать с объектами? В модуле меток я выделил заголовок метки, который в данном случае должен быть выделен жирным шрифтом. Кроме того, будучи объектом, моя метка может содержать строку локализации (образно называемую текстом) и иконку. Все это аккуратно организовано заранее, что позволяет сохранить чистоту логики пользовательского интерфейса.</p>
<p>Но это только часть картины. Я знаю, что мы повсюду используем объекты, и нет ничего нового в том, чтобы группировать вещи в них. Но я готов поспорить, что вы не используете их именно так. Я редко вижу, чтобы два объекта сравнивали подобным образом, потому что вы никогда не знаете, что там внутри и откуда оно взялось. Объекты постоянно создаются и изменяются. Скорее всего, их будут сравнивать по значениям их свойств, чем по самим объектам. И причина этого в том, что объекты не подходят для такого использования. Они слишком многофункциональны. Чтобы разрешить этот и многие другие случаи использования, нам придется, с одной стороны, уменьшить некоторые возможности объектов, а с другой - реализовать еще несколько. И в итоге мы получим то, что я называю примитивными объектами. Th… решение al… некоторых проблем.</p>
<p>В первой части серии я хочу рассказать о некоторых аспектах JavaScript, которые помогают приблизить объекты к примитивным значениям, что в свою очередь позволит нам воспользоваться общими возможностями языка, которые обычно не ассоциируются с объектом, например, сравнением и арифметическими операторами. В следующей части мы подробно рассмотрим практические примеры и инструменты для работы с такими объектами. А сейчас давайте посмотрим, что представляют собой объекты в JavaScript.</p>
<p>Во-первых, давайте определим нашу цель. Давайте нарисуем картину того, где мы хотели бы оказаться впоследствии. Какими свойствами примитивных значений мы хотим, чтобы обладали наши объекты?</p>
<p>Неизменяемость<br>Примитивные значения доступны только для чтения. Мы хотим, чтобы наши объекты не могли быть отредактированы никем после их создания. Вспомните предыдущий пример. Что толку от ярлыка, если какой-то не зависящий от нас код изменил его текст или значок? Как только объект определен, его следует закрепить. Работайте с операторами.<br>Выражения с определенными операторами возвращают соответствующий тип. Арифметические операторы возвращают числа. Сравнение дает булевы числа. Используйте литеральный синтаксис.<br>Литералы для примитивов дают точное значение, точнее, объект, представляющий это значение. Такие объекты создаются один раз для каждого значения. Каждый раз, когда в вашем коде есть “hello”, вы получаете один и тот же объект.Иметь типы.<br>Оператор typeof говорит вам, с чем вы имеете дело (за исключением null). Мы не всегда знаем, какой тип объекта мы получаем. Поэтому, прежде чем тыкать в его свойства, было бы неплохо знать, с чем мы имеем дело.</p>
<p>Я перечислил их по степени непосредственной полезности. По счастливой случайности они также упорядочены по легкости получения. В этой статье я рассмотрю первое и часть второго. Мы увидим, как сделать объекты неизменяемыми. Мы также определим их представление в примитивных значениях, что позволит нам использовать некоторые операторы над ними. Переход от объектов к примитивным значениям прост, так как примитивные значения сами являются объектами - вроде как.</p>
<p>Объекты до самого конца, даже если это вроде как не так</p>
<p>Я помню свое замешательство, когда впервые увидел {} === {}; // false. Что это за язык, который даже не может различить две одинаковые вещи? Это казалось таким нелепым и забавным. Гораздо позже я узнал, что в JavaScript есть детали гораздо хуже, после чего перестал смеяться, наблюдая за разговором на wat.</p>
<p>Объект - это одна из фундаментальных вещей в JavaScript. Возможно, вы слышали, что в JavaScript все является объектом. Это действительно так. За исключением некоторых нижних значений, все примитивы являются объектами. Хотя технически это более тонко, с точки зрения нашего кода это правда. На самом деле, это достаточно верно, чтобы считать, что все является объектами, может быть полезной ментальной моделью. Но давайте сначала попробуем понять, что происходит с этим сравнением объекта с объектом, которое так забавляло младшего меня.</p>
<p>Синтаксис объектного литерала используется для создания новых объектов. Он позволяет нам объявить и инициировать объект в одном выражении.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">// Instead of this.
const my_object = new Object();
my_object.first_property = "First property";
my_object.nth_property = "Next property";

// You can do this.
const my_object = {
    first_property: "First property",
    nth_property: "Next property"
};
</code></pre>
<!-- /wp:code -->
<p>Намного чище, верно? Но теперь я думаю, что отсутствие строки инициализации объекта - это то, что заставило меня запутаться в этих двух пустых выражениях равенства объектов. Казалось, что оно показывает, что язык пытается распознать кажущееся равенство. Но на самом деле в этом выражении происходит следующее:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">new Object() === new Object(); // false
</code></pre>
<!-- /wp:code -->
<p>Теперь очевидно, что они не равны. Вы сравниваете два разных объекта, которые вы только что создали. Ожидать обратного - то же самое, что ожидать, что 5 === 3 вернет true. В обоих случаях это разные вещи.</p>
<p>Давайте проведем проверку на вменяемость. Будут ли две переменные, ссылающиеся на один и тот же объект, считаться равными?</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const my_object = {};
const other_thing = my_object;
my_object === other_thing; // true
</code></pre>
<!-- /wp:code -->
<p>В данном случае только в первой строке есть выражение, создающее объект. Во второй строке мы заставляем переменную other_thing ссылаться на только что созданный объект. Теперь две переменные ссылаются на один и тот же объект. Сравнивать их - все равно что сравнивать два одинаковых числа, не так ли?</p>
<p>Почему это важно? Потому что это дает нам возможность проверить, относится ли переменная к искомому объекту. И если мы подумаем об этом в контексте ”все есть объект”, то именно так работают числа и строки. Когда вы сравниваете две переменные, содержащие строки, движку не нужно проверять, одинаков ли каждый символ в этих строках. Достаточно сравнить, ссылаются ли переменные на один и тот же объект. Это происходит благодаря самому существенному различию между регулярными объектами и примитивными значениями - неизменяемости.</p>
<p>Как приблизить регулярные объекты к примитивным значениям</p>
<p>В JavaScript примитивные значения неизменяемы. Вы не можете изменить ни одного символа в строке, так же как не можете превратить число пять в шесть. Если вы используете const для инициализации переменной и поместите в нее примитивное значение, оно всегда будет оставаться неизменным. Никто не сможет изменить значение; оно неизменяемо. Никто не сможет переназначить переменную; она была создана с помощью const.</p>
<p>Давайте рассмотрим, как работают числа. Вы можете получить шесть из пяти, увеличив его на единицу, но это ничего не изменит в числе пять.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const five = 5;
const six = 5 + 1;
five === 5; // true
</code></pre>
<!-- /wp:code -->
<p>Кто-то может сказать, что использование let изменит это. Но посмотрите, оно не может изменить пять:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const five = 5;
let result = 5;
result++;
result === 6; // true
five === 5; // true
</code></pre>
<!-- /wp:code -->
<p>Пять - это все равно пять. Это потому, что ++ - это просто сокращение для += 1. Видите знак равенства? Произошло то, что я присвоил новое значение переменной result - значение, которое я получил из выражения result + 1 (именно так сокращенно обозначается += 1). Ключевое слово const предотвращает переназначение переменной. В приведенном выше примере именно оно дает мне возможность знать, что пять всегда ссылается на объект 5.</p>
<p>Можно предположить, что единственный способ изменения примитивных значений в JavaScript - это присваивание, что означает, что на самом деле мы изменяем то, на что ссылается переменная. Таким образом, изменяются именно переменные, а не значения. По крайней мере, не примитивные. Но как это работает с объектами?</p>
<p>После инициализации объекта вы можете изменить его свойства: удалить их, добавить новые и переназначить старые. Все мы знаем, как это делается. Но кроме этого, он ведет себя так же, как и примитивные значения. На самом деле, если вы привыкнете к модели, в которой объекты и примитивные значения - это одно и то же, вы будете по-другому смотреть на всевозможные проблемы в JavaScript.</p>
<p>Возможно, вы наткнулись на вопрос о том, как переменные передаются в функцию. Люди спрашивают, передаются ли переменные по значению или по ссылке. Обычный ответ - примитивные значения передаются по значению, а объекты - по ссылке. Но с той ментальной моделью, которую я навязываю вам здесь, вы, возможно, уже знаете, что я скажу по этому поводу. Перед этим позвольте мне показать вам, как этот вопрос не имеет особого смысла в JavaScript. Я также раскрою вам хитрость, которую используют многие статьи и учебники.</p>
<p>Когда вы передаете переменные в качестве параметров вызова функции, они присваиваются аргументам функции. Аргументы являются локальными переменными в области видимости функции и не имеют обратной связи с исходными переменными, что вполне логично. Если вы передаете выражение в функцию, вам нужно куда-то поместить его результат, не так ли?</p>
<p>Посмотрите на две следующие функции. Они делают одно и то же - передают значение, но одна из них определена с одним параметром, а другая - без него. Вторая демонстрирует, что происходит с параметром, который мы передали.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">function single(arg) {
    return arg;
}
    
function none() {
        
    // The first parameter is assigned to a variable `arg`.
    // Notice the `let`; it will be significant later.
    let arg = arguments[0];

    return arg;
}
    
single("hi"); // "hi"
none(5);      // 5
</code></pre>
<!-- /wp:code -->
<p>Вы видите, что они оба работают одинаково. Помня о том, как работают аргументы функции, давайте попробуем изменить некоторые значения. У нас будет функция, которая изменяет свой единственный аргумент и возвращает его. Я также создам несколько переменных, которые буду передавать в функцию по очереди. Попробуйте предсказать, что будет выведено в консоль. (Ответ находится во втором предложении следующего абзаца).</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">function reassign(arg) {
    arg = "OMG";
}

const unreassignable = "What";
let reassignable = "is";
let non_primitive = { val: "happening" };

reassign(unreassignable);
reassign(reassignable);
reassign(non_primitive);

console.log(unreassignable, reassignable, non_primitive.val, "😱");
</code></pre>
<!-- /wp:code -->
<p>Было ли в вашем предположении хоть одно “OMG”? Не должно быть, так как консоль покажет ”Что происходит 😱”. Независимо от того, что передается в функцию в JavaScript, переназначение изменяет только переменную аргумента. Таким образом, ни const, ни let здесь ничего не меняют, потому что функция не получает саму переменную. Но что произойдет, если мы попробуем изменить свойства аргумента?</p>
<p>Я создал еще одну функцию, которая пытается изменить свойство val своего аргумента. Попробуйте угадать, какое сообщение появится в консоли на этот раз.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">function change_val_prop(arg) {
    try {
        arg.val = "OMG";
    } catch (ignore) {}
}

const a_string = "What";
const a_number = 15;
const non_primitive = { val: "happening" };
const non_primitive_read_only = Object.freeze({ my_string: "here" });

change_val_prop(a_string);
change_val_prop(a_number);
change_val_prop(non_primitive);
change_val_prop(non_primitive_read_only);

console.log(
    a_string.val,
    a_number.val,
    non_primitive.val,
    non_primitive_read_only.val,
    "😱"
);
</code></pre>
<!-- /wp:code -->
<p>В вашей догадке теперь есть “OMG”? Отлично, сообщение “undefined undefined OMG undefined 😱”. Единственный раз, когда функция могла изменить свойство, это с общим объектом. О чем это нам говорит? Есть ли разница между тем, как передаются примитивные значения и как объекты? Неужели передача замороженного объекта внезапно меняет его на pass-by-value? Я думаю, что полезнее рассматривать их как равные.</p>
<p>Теперь о той ловкости рук, о которой я упоминал. Практически все ресурсы делают такую вещь, когда они говорят, что примитивы и объекты передаются по-разному, а затем сразу же приводят пример, где они обрабатываются по-разному. Посмотрите на описание функций в MDN. На момент написания этой статьи она описывалась так (выделение мое):</p>
<p>Аргументы могут передаваться по значению (в случае примитивных значений) или по ссылке (в случае объектов). Это означает, что если функция переназначит параметр примитивного типа, его значение не изменится за пределами функции. В случае с параметром объектного типа, если его свойства будут изменены, это изменение отразится за пределами функции.</p>
<p>Я только что показал, что переназначение также не изменит объект. Вы не можете изменить свойства примитивов, потому что они доступны только для чтения, что также относится к замороженным объектам. И большинство примеров, которые вы найдете, делают то же самое. Сначала они указывают разницу между двумя значениями, а затем демонстрируют ее, используя различные методы для каждого значения.</p>
<p>Я не пытаюсь критиковать, не поймите меня неправильно. Возможно, это было сделано потому, что это объясняет причуды JavaScript более привычным способом. Просто имейте в виду, что иногда объяснение дает вам модель мышления о проблеме. Но эта модель никогда не бывает полностью верной природе проблемы.</p>
<p>Взгляд на эту проблему с точки зрения того, что примитивы - это такие же застывшие объекты, поможет вам понять, что происходит на самом деле. Альтернативные решения становятся нелогичными. А теперь, открыв это понятие объекта-примитива, который никто не может изменить, давайте сделаем их более дружественными для остальной части вашей программы.</p>
<h2 class="wp-block-heading">Преобразование</h2>
<p>Примитивные значения стоят сами по себе; любая программа знает, как с ними работать. Объекты могут быть чем угодно. И даже если вы назовете их примитивными, этого недостаточно, чтобы они вдруг стали гражданами первого класса. Чтобы добиться этого, нам нужно проделать определенную работу.</p>
<p>Вы можете определить способ преобразования объектов в примитивные значения, такие как строки или числа. Например, давайте создадим объект, представляющий оценку от нуля до пяти. Нам нужно иметь возможность работать с числовым представлением для сравнения и сортировки. Нам также нужно иметь возможность выводить его в виде текста.</p>
<p>Существуют определенные методы, которые вы можете определить для описания представления объекта. Помните [объект Object]? Это то, что получается, когда вы пытаетесь превратить ваш объект в строку:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">String({}); // "[object Object]"
</code></pre>
<!-- /wp:code -->
<p>Давайте изменим это.</p>
<p>Представление строки</p>
<p>Этот вывод происходит из метода по умолчанию toString, определенного в прототипе объекта. Но вы можете переписать его, определив его в своем собственном объекте.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">String({ toString: () => "hello there" }); // "hello there"
</code></pre>
<!-- /wp:code -->
<p>Это то, что мы будем использовать для наших объектов рейтинга. Чтобы это было удобно, создадим функцию, которая инициализирует и замораживает такие объекты. Она также будет проверять, находится ли значение в диапазоне от нуля до пяти, и возвращать неопределенное значение в противном случае.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">function new_rating(value) {
    const max = 5;

    // That symbol forces textual representation (who needs emoji anyway 🙄).
    const text_only = "\ufe0e";

    const star = "⭑" + text_only;
    const no_star = "⭐" + text_only;
        
    if (
        !Number.isSafeInteger(value) ||
        (value &#x3C; 0 || value > max)
    ) {
        return undefined;
    }
        
    return Object.freeze({
        value,
        toString: () => star.repeat(value) + no_star.repeat(max - value)
    });
}
</code></pre>
<!-- /wp:code -->
<p>Теперь давайте оценим что-нибудь. Есть ручка, которая мне нравится. Она довольно замечательная, и я бы дал ей пять звезд.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const ratings = new WeakMap();
ratings.set(jetstream_pen, new_rating(5));
</code></pre>
<!-- /wp:code -->
<p>Этот WeakMap для рейтингов - это способ присвоения свойств объектам без их фактического изменения. Теперь, когда мы хотим получить рейтинг, мы можем преобразовать оба наших объекта в строки.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">if (ratings.has(jetstream_pen)) {
    console.log(`${jetstream_pen} ${ratings.get(jetstream_pen)}`);
    // "Uni-Ball Jetstream 0.5 ⭑︎⭑︎⭑︎⭑︎⭑︎"
}
</code></pre>
<!-- /wp:code -->
<p>Обернув оба объекта в литерал шаблона string, я использовал метод toString. В противном случае вы могли бы просто вызвать функцию String, как я сделал в начале этого раздела.</p>
<p>Для любителей чисел</p>
<p>Для чисел существует метод valueOf, который вызывается при каждой попытке преобразования в сравнение чисел или математические операторы (кроме +). Давайте добавим его в нашу функцию new_rating:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">function new_rating(value) {
    // ...
        
    return Object.freeze({
        value,
        toValue: () => value,
        toString: () => star.repeat(value) + no_star.repeat(max - value)
    });
}
</code></pre>
<!-- /wp:code -->
<p>Теперь может показаться излишним возвращать свойство value напрямую. Но помните, что никто, кроме нас, не знает, что оно есть. Возврат его из toValue - это универсальный способ получить числовое представление.</p>
<p>Допустим, у нас снова есть объект pen. И допустим, что рейтинг теперь является его свойством (просто для упрощения примера). Теперь мы можем отфильтровать товары с менее чем четырьмя звездами:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">articles.filter((item) => item.rating > 3);
// [ { name: "Uni-Ball Jetstream 0.5", ... } ]
</code></pre>
<!-- /wp:code -->
<p>Аналогичным образом мы можем сортировать элементы по рейтингу. Мы можем сделать это с помощью метода сортировки массивов. Вероятно, у вас уже есть любимая функция сортировки, которую вы хотели бы использовать, например, эта:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">function sorter(first, second) {
    return second.rating - first.rating;
}

const sorted_by_rating = array_of.sort(sorter);
</code></pre>
<!-- /wp:code -->
<p>Теперь в sorted_by_rating хранится массив самых лучших товаров.</p>
<p>Заключение</p>
<p>Я редко смотрел на объекты как на что-то, что может расширить возможности JavaScript. С примитивными объектами это то, что я пытаюсь исследовать. Есть вещи, которые мы все еще не можем добавить, например, новые операторы или литеральный синтаксис, но все же с помощью примитивных объектов мы можем определить новые типы значений.</p>
<p>В этой первой части серии ”Примитивные объекты” я попытался дать общее представление о том, как сделать объекты похожими на некоторые свойства примитивов. Вы замораживаете их, чтобы сделать доступными только для чтения. Вы также можете определить представление в примитивах, число или строку, чтобы заставить их работать с арифметическими операторами или выводить их в текст.</p>
<p>В следующих частях, которые появятся на следующей неделе, я постараюсь привести больше примеров использования и сравнения с другими подходами, с которыми я сталкивался. Вы увидите, как упростить создание примитивных объектов и превратить их в структуры.</p>
<p>В этой серии я стараюсь затронуть те возможности JavaScript, на которые можно положиться. Даже если не все из этого имеет смысл, я надеюсь, что, рассмотрев некоторые из приведенных здесь примеров, вы узнаете что-то полезное, что позволит сделать работу с JavaScript менее хрупкой без ненужного обращения к дополнительным инструментам.</p>
<!-- wp:acf/acf-donate {"id":"block_64678dc93985f","name":"acf/acf-donate","data":{"title":"Задонатить на поддержку!","_title":"field_646b621e8617c","list_0_name":"Donatepay","_list_0_name":"field_646b623e8617e","list_0_url":"https://new.donatepay.ru/@1117856","_list_0_url":"field_646b62528617f","list_0_address":"","_list_0_address":"field_646b625d86180","list_1_name":"Donationalerts","_list_1_name":"field_646b623e8617e","list_1_url":"https://www.donationalerts.com/c/woorg_","_list_1_url":"field_646b62528617f","list_1_address":"","_list_1_address":"field_646b625d86180","list_2_name":"USDT (TRC20)","_list_2_name":"field_646b623e8617e","list_2_url":"","_list_2_url":"field_646b62528617f","list_2_address":"TR121HxpTDF71TMm9idZkBaZxnjSMcCPWj","_list_2_address":"field_646b625d86180","list_3_name":"ETH","_list_3_name":"field_646b623e8617e","list_3_url":"","_list_3_url":"field_646b62528617f","list_3_address":"0x442721192987047eDeEC69Ca1D4c706f9Adb16B3","_list_3_address":"field_646b625d86180","list_4_name":"BTC","_list_4_name":"field_646b623e8617e","list_4_url":"","_list_4_url":"field_646b62528617f","list_4_address":"36dLKv5uRozphSQa55w2XgsF42AugPu2QT","_list_4_address":"field_646b625d86180","list":5,"_list":"field_646b62308617d"},"align":"","mode":"edit"} /--> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/znakomstvo-s-primitivnymi-obektami-v-javascript-chast-1" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/znakomstvo-s-primitivnymi-obektami-v-javascript-chast-1" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Знакомство с примитивными объектами в JavaScript (часть 1)&url=https://igorlov.ru/blog/znakomstvo-s-primitivnymi-obektami-v-javascript-chast-1" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/znakomstvo-s-primitivnymi-obektami-v-javascript-chast-1&title=Знакомство с примитивными объектами в JavaScript (часть 1)&summary=Пытаясь переписать часть разрозненной кодовой базы, Кирилл заново открыл для себя силу объектов JavaScript. Он снова и снова возвращался к шаблону, который...&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/znakomstvo-s-primitivnymi-obektami-v-javascript-chast-1&media=&description=Пытаясь переписать часть разрозненной кодовой базы, Кирилл заново открыл для себя силу объектов JavaScript. Он снова и снова возвращался к шаблону, который..." target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn>  <a href="/blog/zashhita-prilozhenij-next-js-ot-csrf-atak" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Защита приложений Next.js от CSRF-атак </a> </nav>  </div> </div> </article> <div class="container" data-astro-cid-axzg2cw6> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.D-6fTqBY.js" component-export="default" renderer-url="/_astro/client.Bd2Qst3j.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> </div> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="Z1U3gfI" component-url="/_astro/CommentBlock.ChJFdf82.js" component-export="default" renderer-url="/_astro/client.44T8euMP.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>