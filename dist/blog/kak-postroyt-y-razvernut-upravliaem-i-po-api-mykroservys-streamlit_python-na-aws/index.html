<!DOCTYPE html><html lang="ru"> <head><title>Как построить и развернуть управляемый по API микросервис Streamlit/Python на AWS | Игорь Горлов - Фронтeндер</title><link rel="canonical" href="https://igorlov.ru/blog/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws"><meta name="description" content="Мне нужна была функция, которой не было в используемой мной торговой платформе, поэтому я создал ее в виде микросервиса на базе Web App API. Чтобы добиться это"><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.9.1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.CyGIBtQS.css">
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#0d52a1;color:rgba(13,82,161,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw)}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.container[data-astro-cid-vcbh62el]{padding:min(2rem,1.2125rem + 1.05vw)}.list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.link[data-astro-cid-vcbh62el]{font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s;padding:.125rem .75rem;font-size:min(1.5rem,1.1625rem + .45vw);line-height:var(--tw-lh)}
</style>
<link rel="stylesheet" href="/_astro/_single_.C0aKA9dM.css">
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#27292d;border-color:rgba(39,41,45,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.comments[data-v-f9c4118f]{margin:auto;margin-top:1.25rem;width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.comments:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame[data-v-f9c4118f]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/hoisted.CUFolni_.js"></script><style>[data-astro-transition-scope="astro-r75ddqls-1"] { view-transition-name: blog-image-kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit__python-na-aws; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-16 font-inter text-blue fluid:text-lg lg:pt-24 dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <symbol id="ai:local:logo-one"><g fill="currentColor"><path d="M1198.57 596.749c0 329.575-267.171 596.751-596.747 596.751-329.575 0-596.749-267.176-596.749-596.751S272.248 0 601.823 0c329.576 0 596.747 267.174 596.747 596.749Z"/><circle cx="3035.75" cy="617.751" r="596.749" transform="rotate(-90 3035.75 617.751)"/><path d="M3035.75 2736.81c329.57 0 596.75 267.18 596.75 596.75 0 329.58-267.18 596.75-596.75 596.75-329.58 0-596.75-267.17-596.75-596.75 0-329.57 267.17-596.75 596.75-596.75Z"/><circle cx="596.749" cy="1964.8" r="596.749"/><path d="M1193.5 3332.87c0 329.57-267.176 596.75-596.751 596.75S0 3662.44 0 3332.87c0-329.58 267.174-596.75 596.749-596.75 329.575 0 596.751 267.17 596.751 596.75Z"/><circle cx="5062.46" cy="617.751" r="596.749" transform="rotate(-90 5062.46 617.751)"/><circle cx="5062.46" cy="3333.56" r="596.749" transform="rotate(-90 5062.46 3333.56)"/></g></symbol><use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> Меню</button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> Закрыть</button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты </a> </li> </ul> </nav> </div>   <!-- <ThemeToggle client:only /> --> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <div class="container" data-astro-cid-vcbh62el> <ol class="list" role="list" data-astro-cid-vcbh62el> <li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </div> </nav>  <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <div class="container" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <ul class="article__categories categories" data-astro-cid-axzg2cw6> <li class="categories__item" data-astro-cid-axzg2cw6> <a href="/category/учебник" class="categories__link" data-astro-cid-axzg2cw6> Учебник  </a> </li> </ul> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Как построить и развернуть управляемый по API микросервис Streamlit/Python на AWS </h1> <ul class="article__tags tags" data-astro-cid-axzg2cw6> <li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/aws" data-astro-cid-axzg2cw6> AWS </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/cicd" data-astro-cid-axzg2cw6> CI/CD </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/python" data-astro-cid-axzg2cw6> Python </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/streamlit" data-astro-cid-axzg2cw6> Streamlit </a> </li> </ul> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 16 дек., 2023 by Игорь Горлов </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div> <article data-astro-cid-axzg2cw6> <figure class="article__image" data-astro-cid-axzg2cw6> <picture data-astro-cid-axzg2cw6> <source srcset="/_astro/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws-Dec-16-2023.CILeGm4C_2mIL8L.avif" type="image/avif"><source srcset="/_astro/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws-Dec-16-2023.CILeGm4C_2hEFbd.webp" type="image/webp"> <img src="/_astro/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws-Dec-16-2023.CILeGm4C_25Jdpr.png" alt="Как построить и развернуть управляемый по API микросервис Streamlit/Python на AWS" class="aspect-video h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-r75ddqls-1" width="1120" height="580" decoding="async"> </picture> </figure> </article> <div class="article__content prose prose-zinc max-w-full break-words text-blue dark:prose-invert prose-headings:text-blue prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <div id="adfox_17062261612859555"></div> <script>(function(){const blockId = "adfox_17062261612859555";

	window.yaContextCb = window.yaContextCb || [];
	window.yaContextCb.push(() => {
		Ya.adfoxCode.createAdaptive(
			{
				ownerId: 1493338,
				containerId: blockId,
				params: {
					p1: 'dawgg',
					p2: 'p',
				},
			},
			['desktop', 'tablet', 'phone'],
			{
				tabletWidth: 830,
				phoneWidth: 480,
				isAutoReloads: true,
			},
		);
	});
})();</script> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как построить и развернуть управляемый по API микросервис Streamlit/Python на AWS&url=https://igorlov.ru/blog/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws&title=Как построить и развернуть управляемый по API микросервис Streamlit/Python на AWS&summary=Мне нужна была функция, которой не было в используемой мной торговой платформе, поэтому я создал ее в виде микросервиса на базе Web App API. Чтобы добиться это&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws&media=&description=Мне нужна была функция, которой не было в используемой мной торговой платформе, поэтому я создал ее в виде микросервиса на базе Web App API. Чтобы добиться это" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <details open  class="toc border border-blue text-blue fluid:p-8 cursor-pointer rounded-[50px]"><summary class="toc__title text-xl font-medium">Содержание</summary><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#приложение-streamlit">Приложение Streamlit</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#создание-микросервиса">Создание микросервиса</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#создание-ресурсов">Создание ресурсов</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#реализация">Реализация</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#шаг-1-создайте-реестр-и-базовый-образ-контейнера-amazon-elastic-container">Шаг 1: Создайте реестр и базовый образ контейнера Amazon Elastic Container</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-1a-создание-ecr-репозитория-для-базового-образа">Шаг 1a: Создание ECR-репозитория для базового образа</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-1b-создание-базового-изображения">Шаг 1b: Создание базового изображения</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-1c-создайте-ecr-репозиторий-для-образа-контейнера-веб-приложения">Шаг 1c: Создайте ECR-репозиторий для образа контейнера веб-приложения</a></li></ol></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#шаг-2-создайте-репозиторий-github">Шаг 2: Создайте репозиторий GitHub</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-2a-создайте-файл-python-requirementstxt">Шаг 2a: Создайте файл Python requirements.txt</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-2b-создание-dockerfile">Шаг 2b: Создание Dockerfile</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-2c-создание-сценариев-развертывания">Шаг 2c: Создание сценариев развертывания</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-2d-создайте-buildspecyml">Шаг 2d: Создайте buildspec.yml</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-2e-создание-файла-appspecyml">Шаг 2e: Создание файла appspec.yml</a></li></ol></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#шаг-3-создание-ролей-iam">Шаг 3: Создание ролей IAM</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-3a-роль-iam-для-экземпляра-ec2">Шаг 3a: Роль IAM для экземпляра EC2</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-3b-роль-iam-для-codedeploy">Шаг 3b: Роль IAM для CodeDeploy</a></li></ol></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#шаг-4-создайте-экземпляр-aws-ec2">Шаг 4: Создайте экземпляр AWS EC2</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#шаг-5-создание-балансировщика-нагрузки-приложений">Шаг 5: Создание балансировщика нагрузки приложений</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-5a-настройка-целевой-группы">Шаг 5a: Настройка целевой группы</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-5b-создание-балансировщика-нагрузки">Шаг 5b: Создание балансировщика нагрузки</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-5c-обновление-группы-безопасности-экземпляра-ec2">Шаг 5c: Обновление группы безопасности экземпляра EC2</a></li></ol></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#шаг-6-создайте-проект-codebuild">Шаг 6: Создайте проект CodeBuild</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#шаг-7-создание-приложения-aws-codedeploy">Шаг 7: Создание приложения AWS CodeDeploy</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#шаг-8-создание-aws-codepipeline">Шаг 8: Создание AWS CodePipeline</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-8a-настройка-конвейера">Шаг 8a: Настройка конвейера</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-8b-запуск-конвейера">Шаг 8b: Запуск конвейера</a></li></ol></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#шаг-9-распространение-через-cloudfront">Шаг 9: Распространение через CloudFront</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#шаг-9a-создание-дистрибутива-cloudfront">Шаг 9a: Создание дистрибутива CloudFront</a></li></ol></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#шаг-10-опубликуйте-веб-приложение">Шаг 10: Опубликуйте веб-приложение</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#заключение">Заключение</a></li></ol></details open ><p>Мне нужна была функция, которой не было в используемой мной торговой платформе, поэтому я создал ее в виде микросервиса на базе Web App API. Чтобы добиться этого, я сначала прочитал документацию по API платформы, чтобы собрать необходимые параметры.</p>
<p>Затем я начал создавать приложение, создав версию CLI с помощью Python. Чтобы убедиться в работоспособности каждого параметра API, я протестировал их по отдельности в демонстрационной среде, а затем протестировал все приложение в предпроизводственной среде.</p>
<p>Недавно я наткнулся на несколько семинаров по искусственному интеллекту, в которых использовался фреймворк Streamlit для создания простых приложений для черчения. Учитывая простоту использования Streamlit, я решил построить версию торгового веб-приложения с использованием Sreamlit в качестве микросервиса.</p>
<p>В этом сценарии связь между фронтендом и бэкендом осуществляется через API, фронтендом является веб-приложение, а бэкендом - торговая платформа.</p>
<figure class="igorlov-figure"><img  src="/_astro/gkbylbxocbnb1hjja9t4.DXl0a7oE_22Dpf9.webp" alt="gkbylbxocbnb1hjja9t4.png" width="513" height="184" loading="lazy" decoding="async"><figcaption>gkbylbxocbnb1hjja9t4.png</figcaption></figure>
<h2 id="приложение-streamlit">Приложение Streamlit<a aria-hidden="true" tabindex="-1" href="#приложение-streamlit"><span class="icon icon-link"></span></a></h2>
<p>Streamlit - это фреймворк приложений с открытым исходным кодом, написанный на Python. Он похож на Flask и используется для быстрого и простого создания простых веб-приложений. Хотя он обычно используется для проектов, связанных с машинным обучением и наукой о данных, он отлично работает с основными библиотеками Python и может включать HTML-код или markdown, что делает его отличным выбором для создания простых приложений.<br>
Будучи новичком в Streamlit, я использовал GenAI для преобразования моего кода на Python в код Streamlit. Мне не потребовалось много времени, чтобы создать функциональное веб-приложение. Затем я тестировал и рефакторил приложение, пока не достиг финальной версии.</p>
<h2 id="создание-микросервиса">Создание микросервиса<a aria-hidden="true" tabindex="-1" href="#создание-микросервиса"><span class="icon icon-link"></span></a></h2>
<p>На этапе подготовки к созданию микросервиса веб-приложения я сначала создал ECR-репозиторий под названием ‘webapp-base-image’ для хранения базового образа контейнера. Затем я поместил в него базовый образ Docker (python:3.10-slim-buster). Затем я создал еще один ECR-репозиторий для хранения образа контейнера Web App.</p>
<figure class="igorlov-figure"><img  src="/_astro/j7sck1uyb2wh11gobg7e.CrNosX6o_1vUw1R.webp" alt="j7sck1uyb2wh11gobg7e.png" width="286" height="175" loading="lazy" decoding="async"><figcaption>j7sck1uyb2wh11gobg7e.png</figcaption></figure>
<p>После этого я создал репозиторий GitHub и поместил исходный код и артефакты в каталог репозитория. Затем я создал Dockerfile, необходимый для сборки контейнера Web App. Наконец, чтобы построить конвейер CICD с помощью CodePipeline, я создал ‘buildspec.yml’ для CodeBuild и ‘appspec.yml’ для CodeDeploy.</p>
<figure class="igorlov-figure"><img  src="/_astro/s9ppszd0w3uo9pvzeg3r.Dq_x-s7T_1QmQ0.webp" alt="s9ppszd0w3uo9pvzeg3r.png" width="628" height="164" loading="lazy" decoding="async"><figcaption>s9ppszd0w3uo9pvzeg3r.png</figcaption></figure>
<p>Важно отметить, что использование и содержание этих файлов зависит от выбранного вычислительного сервиса.</p>
<p>Ниже перечислены доступные варианты вычислений на AWS для развертывания контейнера, каждый из которых потребует различных процедур и незначительных изменений в конфигурации.</p>
<ul>
<li>AWS App Runner (самый быстрый вариант, но ограничивает контроль над инфраструктурой)</li>
<li>Fargate (бессерверный контейнерный сервис)</li>
<li>Экземпляр EC2 (вычислительный сервис с большим контролем, но требует обслуживания ОС/приложений)</li>
</ul>
<p>После того как исходный код, артефакты и файлы конфигурации были добавлены в репозиторий веб-приложения, образ контейнера был готов к развертыванию. Я развернул контейнер на бесплатном уровне экземпляра EC2, как описано в следующем этапе.</p>
<h2 id="создание-ресурсов">Создание ресурсов<a aria-hidden="true" tabindex="-1" href="#создание-ресурсов"><span class="icon icon-link"></span></a></h2>
<p>Для создания и развертывания веб-приложения я сначала создал необходимые ресурсы, используя экземпляр EC2 в качестве хоста, Application Load Balancer для развязки TLS-соединения с экземпляром EC2 и обеспечения балансировки нагрузки для будущего масштабирования, проект Build для упаковки и сборки контейнера с помощью CodeBuild, приложение CodeDeploy для развертывания контейнера на экземпляре EC2 и, наконец, CodePipeline для запуска конвейера CICD.</p>
<p>После этого я создал остальные ресурсы, необходимые для доступа к веб-приложению через Интернет, включая дистрибутив CloudFront и запись зоны хостинга Route 53.</p>
<figure class="igorlov-figure"><img  src="/_astro/ohkvdklsq1dgzeoqhplz.D_Hxrqn0_Z1DBMtt.webp" alt="ohkvdklsq1dgzeoqhplz.png" width="800" height="582" loading="lazy" decoding="async"><figcaption>ohkvdklsq1dgzeoqhplz.png</figcaption></figure>
<p>В одной из следующих статей блога я расскажу, как оптимизировать это решение, чтобы улучшить масштабируемость и сделать его более экономичным.</p>
<p>Далее приведены шаги, необходимые для реализации этого решения.</p>
<h2 id="реализация">Реализация<a aria-hidden="true" tabindex="-1" href="#реализация"><span class="icon icon-link"></span></a></h2>
<p>Мы рассмотрим шаги, необходимые для создания и развертывания контейнера Web App.</p>
<h2 id="шаг-1-создайте-реестр-и-базовый-образ-контейнера-amazon-elastic-container">Шаг 1: Создайте реестр и базовый образ контейнера Amazon Elastic Container<a aria-hidden="true" tabindex="-1" href="#шаг-1-создайте-реестр-и-базовый-образ-контейнера-amazon-elastic-container"><span class="icon icon-link"></span></a></h2>
<p>Сначала мы создадим репозиторий ECR для хранения базового образа, возьмем образ из Docker Hub, а затем поместим его в репозиторий ECR.<br>
После этого мы создадим еще один репозиторий ECR для хранения образа контейнера Web App.</p>
<h3 id="шаг-1a-создание-ecr-репозитория-для-базового-образа">Шаг 1a: Создание ECR-репозитория для базового образа<a aria-hidden="true" tabindex="-1" href="#шаг-1a-создание-ecr-репозитория-для-базового-образа"><span class="icon icon-link"></span></a></h3>
<p>Выполните следующую команду aws для создания ECR-репозитория:</p>
<p><code>aws ecr create-repository --repository-name webapp-base-image --image-tag-mutability MUTABLE</code>.</p>
<h3 id="шаг-1b-создание-базового-изображения">Шаг 1b: Создание базового изображения<a aria-hidden="true" tabindex="-1" href="#шаг-1b-создание-базового-изображения"><span class="icon icon-link"></span></a></h3>
<p>Установите переменную Env на вашей машине</p>
<p><code>export AWS_ACCOUNT_ID=YourAWS-ID export AWS_DEFAULT_REGION=AWS-Region export ECR_PYTHON_URL="$AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/webapp-base-image"</code>.</p>
<p><code>aws ecr get-login-password --region $AWS_DEFAULT_REGION | docker login --username AWS --password-stdin "$AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com"</code></p>
<p>Извлеките образ из Docker Hub</p>
<p><code>docker pull python:3.10-slim-buster</code></p>
<p><code>docker tag python:3.10-slim-buster $ECR_PYTHON_URL:3.10-slim-buster</code></p>
<p>Передача изображения в хранилище ECR</p>
<p><code>docker push $ECR_PYTHON_URL:3.10-slim-buster</code></p>
<h3 id="шаг-1c-создайте-ecr-репозиторий-для-образа-контейнера-веб-приложения">Шаг 1c: Создайте ECR-репозиторий для образа контейнера веб-приложения<a aria-hidden="true" tabindex="-1" href="#шаг-1c-создайте-ecr-репозиторий-для-образа-контейнера-веб-приложения"><span class="icon icon-link"></span></a></h3>
<p>Выполните следующую команду aws для создания репозитория ECR:</p>
<p><code>aws ecr create-repository --repository-name webapp --image-tag-mutability MUTABLE</code>.</p>
<h2 id="шаг-2-создайте-репозиторий-github">Шаг 2: Создайте репозиторий GitHub<a aria-hidden="true" tabindex="-1" href="#шаг-2-создайте-репозиторий-github"><span class="icon icon-link"></span></a></h2>
<p>Нам нужно создать новый репозиторий GitHub для веб-приложения. После этого вы можете клонировать репозиторий на локальной машине и переместить исходный код и артефакты в корневой каталог репозитория.</p>
<h3 id="шаг-2a-создайте-файл-python-requirementstxt">Шаг 2a: Создайте файл Python requirements.txt<a aria-hidden="true" tabindex="-1" href="#шаг-2a-создайте-файл-python-requirementstxt"><span class="icon icon-link"></span></a></h3>
<p>Далее необходимо создать файл Python requirements.txt, который будет включать streamlit и другие необходимые пакеты и библиотеки для вашего веб-приложения.</p>
<p><code>$ touch requirements.txt $ echo 'streamlit' > requirements.txt</code></p>
<h3 id="шаг-2b-создание-dockerfile">Шаг 2b: Создание Dockerfile<a aria-hidden="true" tabindex="-1" href="#шаг-2b-создание-dockerfile"><span class="icon icon-link"></span></a></h3>
<p>Затем создайте Dockerfile, аналогичный следующему</p>
<p><code># app/Dockerfile # используем ссылку на базовый образ ECR-репо FROM [YourAccountID].dkr.ecr.[YourRegion].amazonaws.com/[ECR-repo-base-image]:3.10-slim-buster WORKDIR /app COPY requirements.txt requirements.txt RUN pip install -r requirements.txt &#x26;&#x26;\ apt-get update -y &#x26;&#x26;\ apt-get install curl -y COPY . .  EXPOSE 8501 HEALTHCHECK CMD curl --fail http://localhost:8501/_stcore/health # заменить YourWebApp.py на соответствующее имя файла ENTRYPOINT ["streamlit", "run", "YourWebApp.py", "--server.port=8501", "--server.address=0.0.0.0"]</code>.</p>
<h3 id="шаг-2c-создание-сценариев-развертывания">Шаг 2c: Создание сценариев развертывания<a aria-hidden="true" tabindex="-1" href="#шаг-2c-создание-сценариев-развертывания"><span class="icon icon-link"></span></a></h3>
<p>Затем создайте каталог ‘scripts’ в корневой директории репозитория, который будет содержать сценарии развертывания, аналогичные ‘start_app.sh’ и ‘stop_app.sh’.</p>
<h3 id="шаг-2d-создайте-buildspecyml">Шаг 2d: Создайте buildspec.yml<a aria-hidden="true" tabindex="-1" href="#шаг-2d-создайте-buildspecyml"><span class="icon icon-link"></span></a></h3>
<p>Создайте файл buildspec.yml в корневом каталоге репозитория GitHub.<br>
CodeBuild будет использовать конфигурационный файл buidlspec.yml для сборки образа контейнера и последующего его хранения в репозитории ECR.</p>
<h3 id="шаг-2e-создание-файла-appspecyml">Шаг 2e: Создание файла appspec.yml<a aria-hidden="true" tabindex="-1" href="#шаг-2e-создание-файла-appspecyml"><span class="icon icon-link"></span></a></h3>
<p>Создайте appspec.yml в корневом каталоге репозитория GitHub. CodeDeploy будет использовать файл конфигурации appspec.yml для развертывания контейнера на экземпляре EC2.</p>
<h2 id="шаг-3-создание-ролей-iam">Шаг 3: Создание ролей IAM<a aria-hidden="true" tabindex="-1" href="#шаг-3-создание-ролей-iam"><span class="icon icon-link"></span></a></h2>
<p>Прежде чем создавать необходимые ресурсы, вам нужно будет создать IAM-роли для экземпляра EC2 и CodeDeploy.<br>
Рекомендуется настроить каждую политику и создать встроенную политику для ограничения доступа к необходимым ресурсам, но для простоты мы будем использовать политики, управляемые AWS</p>
<h3 id="шаг-3a-роль-iam-для-экземпляра-ec2">Шаг 3a: Роль IAM для экземпляра EC2<a aria-hidden="true" tabindex="-1" href="#шаг-3a-роль-iam-для-экземпляра-ec2"><span class="icon icon-link"></span></a></h3>
<p>Эта роль имеет 2 политики, разрешающие доступ экземпляра EC2 к S3 и ECR (“AmazonEC2ContainerRegistryPowerUser”, “AmazonS3ReadOnlyAccess”)</p>
<h3 id="шаг-3b-роль-iam-для-codedeploy">Шаг 3b: Роль IAM для CodeDeploy<a aria-hidden="true" tabindex="-1" href="#шаг-3b-роль-iam-для-codedeploy"><span class="icon icon-link"></span></a></h3>
<p>Эта роль имеет 2 политики, чтобы разрешить CodeDeploy доступ к EC2, ELB, автомасштабированию и ECR (“AmazonEC2ContainerRegistryPowerUser”, “AWSCodeDeployRole”)</p>
<h2 id="шаг-4-создайте-экземпляр-aws-ec2">Шаг 4: Создайте экземпляр AWS EC2<a aria-hidden="true" tabindex="-1" href="#шаг-4-создайте-экземпляр-aws-ec2"><span class="icon icon-link"></span></a></h2>
<p>Вы создадите экземпляр и подключите этот файл пользовательских данных, который установит codedeploy-агент и docker.</p>
<figure class="igorlov-figure"><img  src="/_astro/3osb8yoyl60ji1kzwvjp.CJUmuRvn_2qJA8n.webp" alt="3osb8yoyl60ji1kzwvjp.png" width="412" height="164" loading="lazy" decoding="async"><figcaption>3osb8yoyl60ji1kzwvjp.png</figcaption></figure>
<p>Перейдите в консоль AWS EC2</p>
<p>Выберите Launch Instance.<br>
Введите имя экземпляра</p>
<p>Образы приложений и ОС: Выберите AMI ”например: Amazon Linux 2023 AMI”.</p>
<p>Выберите тип экземпляра ”например: t2.micro”.
Выберите пару ключей (логин)</p>
<p>Настройки сети: Введите следующие данные</p>
<p>VPC: ”например: VPC по умолчанию”.</p>
<p>Подсеть: ”например: SubnetPub1”</p>
<p>Автоматическое назначение публичного IP: Включить</p>
<p>Группа безопасности: Выберите Создать группу безопасности</p>
<p>Имя группы безопасности: ”например: WebApp-SG”.
Пока пропустите правила для входящих соединений</p>
<p>Настройте хранилище: добавьте том хранилища</p>
<p>Дополнительные сведения:</p>
<p>Профиль экземпляра IAM: Выберите роль IAM, созданную на предыдущем шаге.</p>
<p>Данные пользователя: загрузите файл с данными пользователя</p>
<p>Выберите экземпляр запуска.</p>
<h2 id="шаг-5-создание-балансировщика-нагрузки-приложений">Шаг 5: Создание балансировщика нагрузки приложений<a aria-hidden="true" tabindex="-1" href="#шаг-5-создание-балансировщика-нагрузки-приложений"><span class="icon icon-link"></span></a></h2>
<p>Перед созданием балансировщика нагрузки создайте группу безопасности с правилом входящего потока (тип: HTTPS; источник: пользовательский 0.0.0.0/0) и запишите идентификатор группы безопасности.</p>
<h3 id="шаг-5a-настройка-целевой-группы">Шаг 5a: Настройка целевой группы<a aria-hidden="true" tabindex="-1" href="#шаг-5a-настройка-целевой-группы"><span class="icon icon-link"></span></a></h3>
<p>Настройте целевую группу, а затем зарегистрируйте экземпляр EC2 в качестве целевого.</p>
<p>Перейдите в консоль AWS EC2
Выберите Целевые группы на панели навигации
Выберите Создать целевую группу</p>
<p>Базовая конфигурация:</p>
<p>Тип цели: Выберите экземпляр</p>
<p>Имя целевой группы: Введите имя “WebApp-TG”.
Выберите протокол и порт</p>
<p>Выберите тип IP-адреса: IPv4
Выберите VPC: ”например: Default VPC”.</p>
<p>Проверка работоспособности:</p>
<p>Выберите протокол проверки работоспособности: HTTP
Выберите путь проверки здоровья: введите маршрут проверки здоровья или сохраните значение по умолчанию / “eg: /HeathCheck”.</p>
<p>Выберите Далее, чтобы зарегистрировать цель</p>
<p>Зарегистрировать цели:</p>
<p>Выберите экземпляр, созданный ранее, и порт, а затем выберите Включить, как показано ниже</p>
<p>Выберите Создать группу целей.</p>
<h3 id="шаг-5b-создание-балансировщика-нагрузки">Шаг 5b: Создание балансировщика нагрузки<a aria-hidden="true" tabindex="-1" href="#шаг-5b-создание-балансировщика-нагрузки"><span class="icon icon-link"></span></a></h3>
<p>Когда целевая группа будет готова, настройтеn балансировщик нагрузки приложений.</p>
<p>Перейдите в консоль AWS EC2
Выберите Балансировщики нагрузки на панели навигации
Выберите Создать балансировщик нагрузки.<br>
В разделе Балансировщик нагрузки приложений выберите Создать</p>
<p>Базовая конфигурация:</p>
<p>Имя балансировщика нагрузки: введите имя для вашего балансировщика нагрузки, например: WebApp-ALB**.</p>
<p>Схема: выберите интернет-ориентированность</p>
<p>Тип IP-адреса: IPv4</p>
<p>Сопоставление сетей</p>
<p>VPC: выберите VPC ”например: Default VPC”.</p>
<p>Сопоставления: Выберите подсети</p>
<p>Группы безопасности: Выберите группу безопасности, созданную ранее</p>
<p>Слушатели и маршрутизация:</p>
<p>Протокол: HTTPS</p>
<p>Порт: 443</p>
<p>Действие по умолчанию: Выберите целевую группу, созданную выше</p>
<p>Настройки безопасного приемника:</p>
<p>Сертификат сервера SSL/TLS по умолчанию: Выберите источник сертификата</p>
<p>Выберите Создать балансировщик нагрузки</p>
<h3 id="шаг-5c-обновление-группы-безопасности-экземпляра-ec2">Шаг 5c: Обновление группы безопасности экземпляра EC2<a aria-hidden="true" tabindex="-1" href="#шаг-5c-обновление-группы-безопасности-экземпляра-ec2"><span class="icon icon-link"></span></a></h3>
<p>Теперь, когда ALB готов, обновите группу безопасности экземпляра EC2, чтобы разрешить входящее соединение с ALB через определенный порт</p>
<p>Перейдите в консоль AWS EC2
Выберите Группы безопасности на панели навигации
Выберите группу безопасности, созданную для экземпляра EC2
В разделе Входящие правила выберите Редактировать входящие правила</p>
<p>Выберите Добавить правило 1</p>
<p>Тип: Пользовательский TCP</p>
<p>Порт: введите порт веб-приложения</p>
<p>Источник: Пользовательский - выберите группу безопасности ALB</p>
<p>Выберите Добавить правило 2</p>
<p>Тип: ssh</p>
<p>Источник: выберите Мой IP</p>
<p>Выберите Сохранить правила</p>
<h2 id="шаг-6-создайте-проект-codebuild">Шаг 6: Создайте проект CodeBuild<a aria-hidden="true" tabindex="-1" href="#шаг-6-создайте-проект-codebuild"><span class="icon icon-link"></span></a></h2>
<p>Проект сборки будет создавать образ контейнера, а затем размещать его в репозитории ECR. Для создания проекта сборки необходимо выполнить следующие шаги.</p>
<figure class="igorlov-figure"><img  src="/_astro/eu14t49yevjf55hdmg4r.AoF3CB5L_ZFK5Wx.webp" alt="eu14t49yevjf55hdmg4r.png" width="534" height="127" loading="lazy" decoding="async"><figcaption>eu14t49yevjf55hdmg4r.png</figcaption></figure>
<p>Перейдите в консоль AWS CodeBuild
Выберите Create build project</p>
<p>Конфигурация проекта:</p>
<p>Имя проекта: Введите имя проекта</p>
<p>Источник:</p>
<p>Поставщик источника: Выберите Github
следуйте инструкциям, чтобы подключиться (или переподключиться) к GitHub и авторизовать доступ к AWS CodeBuild</p>
<p>Репозиторий: Выберите публичный репозиторий или репозиторий в вашем аккаунте GitHub</p>
<p>Репозиторий GitHub: Введите ссылку на репозиторий ”например: <a href="https://github.com/YourGitHubUser/RepoName.git" rel="noopener noreferrer nofollow" target="_blank">https://github.com/YourGitHubUser/RepoName.git</a>”.</p>
<p>Исходная версия: Введите имя ветки</p>
<p>Webhook опционально: Пересборка при каждом изменении кода в этом хранилище</p>
<p>Окружение:</p>
<p>Образ среды: Управляемый образ</p>
<p>Операционная система: Amazon Linux</p>
<p>Время(и) выполнения: Стандартный</p>
<p>Изображение: 5.0 или последняя версия
Выберите привилегированный</p>
<p>Роль службы: выберите Новая роль службы</p>
<p>Имя роли: введите имя роли службы</p>
<p>Buildspec:</p>
<p>Спецификации сборки: выберите Использовать файл спецификации сборки</p>
<p>По умолчанию CodeBuild ищет файл с именем buildspec.yml в корневом каталоге исходного кода</p>
<p>Артефакты: выберите Пока нет артефактов, они будут обновлены во время настройки CodePipeline
Выберите Создать проект сборки</p>
<p>Перейдите в консоль AWS IAM
Выберите Роли на панели навигации</p>
<p>Найдите и выберите имя роли службы, которое вы ввели при настройке проекта сборки
Выберите Добавить разрешения: выберите прикрепить политику</p>
<p>Найдите и выберите политику: AmazonEC2ContainerRegistryPowerUser
Выберите Добавить разрешение</p>
<h2 id="шаг-7-создание-приложения-aws-codedeploy">Шаг 7: Создание приложения AWS CodeDeploy<a aria-hidden="true" tabindex="-1" href="#шаг-7-создание-приложения-aws-codedeploy"><span class="icon icon-link"></span></a></h2>
<p>В этой демонстрации вы создадите приложение CodeDeploy для развертывания на месте с помощью консоли CodeDeploy. В противном случае рекомендуется создать Blue/Green развертывание с несколькими вычислительными ресурсами для обеспечения доступности веб-приложения.</p>
<figure class="igorlov-figure"><img  src="/_astro/m4boa2wqwv61v4v1bgb4.DXAYQcub_Z1iYI1t.webp" alt="m4boa2wqwv61v4v1bgb4.png" width="203" height="280" loading="lazy" decoding="async"><figcaption>m4boa2wqwv61v4v1bgb4.png</figcaption></figure>
<p>Создайте приложение</p>
<p>Перейдите в консоль AWS CodeDeploy.<br>
Разверните Deploy, а затем выберите Getting started.<br>
Выберите Create application (Создать приложение).</p>
<p>Конфигурация приложения:</p>
<p>Имя приложения: введите имя приложения.</p>
<p>Вычислительная платформа: EC2/On-premises.<br>
Выберите Создать приложение.</p>
<p>Выберите имя приложения.<br>
Выберите Создать группу развертывания на вкладке Группы развертывания.</p>
<p>Имя группы развертывания: введите имя группы развертывания.</p>
<p>Роль службы: Выберите роль службы, созданную ранее для CodeDeploy.</p>
<p>Тип развертывания: In-place.</p>
<p>Конфигурация среды:</p>
<p>Выбор экземпляров Amazon EC2</p>
<p>Введите ключ метки, использованный при создании экземпляра EC2.<br>
Введите значение метки.</p>
<p>Установите агент AWS CodeDeploy Agent: Никогда</p>
<p>Конфигурация развертывания: CodeDeployDefault.AllAtOnce
Выберите Создать группу развертывания.</p>
<h2 id="шаг-8-создание-aws-codepipeline">Шаг 8: Создание AWS CodePipeline<a aria-hidden="true" tabindex="-1" href="#шаг-8-создание-aws-codepipeline"><span class="icon icon-link"></span></a></h2>
<p>Теперь, когда репозиторий GitHub, проект сборки и приложение CodeDeploy готовы для конвейера, вам нужно выполнить следующие шаги для его настройки.</p>
<figure class="igorlov-figure"><img  src="/_astro/2ee96l6a8yfyfh9jki9z.DTBlqVnU_s3xs9.webp" alt="2ee96l6a8yfyfh9jki9z.png" width="800" height="315" loading="lazy" decoding="async"><figcaption>2ee96l6a8yfyfh9jki9z.png</figcaption></figure>
<h3 id="шаг-8a-настройка-конвейера">Шаг 8a: Настройка конвейера<a aria-hidden="true" tabindex="-1" href="#шаг-8a-настройка-конвейера"><span class="icon icon-link"></span></a></h3>
<p>Перейдите в консоль AWS CodePipeline.<br>
Выберите Создать конвейер.</p>
<p>Настройки конвейера:</p>
<p>Имя трубопровода: введите имя трубопровода.</p>
<p>Роль службы: Выберите Новая роль службы или Существующая роль службы, если у вас есть существующая роль.</p>
<p>Источник:</p>
<p>Поставщик источника: GitHub (версия 2)</p>
<p>Подключение: Выберите существующее соединение с Github или выберите Connect to Github, чтобы создать новое соединение.</p>
<p>Имя репозитория: введите имя репозитория ”например: YourGitHubUser/WebAppRepo”.</p>
<p>Имя ветки: введите имя ветки.</p>
<p>Формат выходного артефакта: CodePipeline по умолчанию.</p>
<p>Build:</p>
<p>Провайдер сборки: AWS CodeBuild.</p>
<p>Регион: Выберите свой регион.</p>
<p>Имя проекта Выберите имя проекта, созданное ранее.</p>
<p>Тип сборки: Одиночная сборка.</p>
<p>Развернуть:</p>
<p>Провайдер развертывания: AWS CodeDeploy</p>
<p>Регион: Введите свой регион.</p>
<p>Приложение nаме: Выберите приложение, созданное ранее.</p>
<p>Группа развертывания: Выберите группу развертывания, созданную ранее.</p>
<p>Просмотрите конфигурацию, затем выберите Создать трубопровод</p>
<h3 id="шаг-8b-запуск-конвейера">Шаг 8b: Запуск конвейера<a aria-hidden="true" tabindex="-1" href="#шаг-8b-запуск-конвейера"><span class="icon icon-link"></span></a></h3>
<p>Конвейер будет запущен после его создания. Начните с этапа Source, чтобы получить файлы из репозитория GitHub, затем запустите этап Build, чтобы собрать образ контейнера и отправить его в репозиторий ECR. Наконец, запустите этап Deploy, который развернет контейнер на экземпляре EC2.</p>
<h2 id="шаг-9-распространение-через-cloudfront">Шаг 9: Распространение через CloudFront<a aria-hidden="true" tabindex="-1" href="#шаг-9-распространение-через-cloudfront"><span class="icon icon-link"></span></a></h2>
<p>Вы можете использовать CloudFront для кэширования содержимого веб-приложения и приближения его к пользователям. Это поможет снизить нагрузку на ALB, что приведет к снижению затрат. Кроме того, вы можете добавить еще один уровень безопасности, настроив WAF/Shield. Однако важно отметить, что использование CloudFront - это необязательный шаг.</p>
<h3 id="шаг-9a-создание-дистрибутива-cloudfront">Шаг 9a: Создание дистрибутива CloudFront<a aria-hidden="true" tabindex="-1" href="#шаг-9a-создание-дистрибутива-cloudfront"><span class="icon icon-link"></span></a></h3>
<p>Выполните следующие шаги, чтобы создать дистрибутив CloudFront.</p>
<p>Перейдите в консоль AWS CloudFront.<br>
Выберите Создать дистрибутив</p>
<p>Происхождение:</p>
<p>Домен происхождения: Выберите имя ALB</p>
<p>Протокол: Только HTTPS</p>
<p>Порт HTTPS: 443</p>
<p>Поведение кэша по умолчанию:</p>
<p>Политика протокола просмотра: Перенаправление HTTP на HTTPS</p>
<p>Ключ кэша и запросы происхождения: Политика кэширования и политика исходных запросов</p>
<p>Политика кэширования: CachingDisabled</p>
<p>Политика запроса происхождения -: AllViewerAndCloudFrontHeaders</p>
<p>Настройки:</p>
<p>Пользовательский SSL-сертификат: Выберите сертификат ACM</p>
<p>Выберите Создать дистрибутив</p>
<h2 id="шаг-10-опубликуйте-веб-приложение">Шаг 10: Опубликуйте веб-приложение<a aria-hidden="true" tabindex="-1" href="#шаг-10-опубликуйте-веб-приложение"><span class="icon icon-link"></span></a></h2>
<p>После развертывания дистрибутива CloudFront последним шагом будет публикация веб-приложения с помощью Route 53. Если у вас уже есть доменное имя, вам следует создать новую запись A в качестве псевдонима, а затем выбрать URL ALB или URL дистрибутива CloudFront, если вы его уже создали. Если у вас нет доменного имени, вы можете создать новое с помощью Route 53, а затем добавить запись A.</p>
<p>В качестве альтернативы можно использовать URL-адрес CloudFront или URL-адрес ALB, если вы ищете временный вариант.</p>
<h2 id="заключение">Заключение<a aria-hidden="true" tabindex="-1" href="#заключение"><span class="icon icon-link"></span></a></h2>
<p>Мы разработали архитектуру MACH для создания и развертывания удобного веб-приложения Streamlit с помощью сервисов AWS. Используя CICD с AWS CodePipeline, мы можем динамически создавать и развертывать веб-приложение в контейнере, что ускоряет процесс, обеспечивает гибкость, динамичность и доступность. Решение обладает высокой адаптивностью и может быть развернуто в любой среде. Его также можно оптимизировать для масштабирования с помощью функции Auto-Scaling, которая снижает затраты в зависимости от требуемого трафика.</p> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как построить и развернуть управляемый по API микросервис Streamlit/Python на AWS&url=https://igorlov.ru/blog/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws&title=Как построить и развернуть управляемый по API микросервис Streamlit/Python на AWS&summary=Мне нужна была функция, которой не было в используемой мной торговой платформе, поэтому я создал ее в виде микросервиса на базе Web App API. Чтобы добиться это&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-postroyt-y-razvernut-upravliaem-i-po-api-mykroservys-streamlit_python-na-aws&media=&description=Мне нужна была функция, которой не было в используемой мной торговой платформе, поэтому я создал ее в виде микросервиса на базе Web App API. Чтобы добиться это" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/kak-sozdavat-y-razvorachyvat-statycheskye-sait-s-pomoschiu-gatsby-y-kinsta" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> Как создавать и разворачивать статические сайты с помощью Gatsby и Kinsta </a> <a href="/blog/kak-sozdat-komponent-akkordeon-s-pomoschiu-react-js" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Как создать компонент-аккордеон с помощью React.js </a> </nav>  </div> </div> </article> <div class="container" data-astro-cid-axzg2cw6> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.D-6fTqBY.js" component-export="default" renderer-url="/_astro/client.Bd2Qst3j.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> </div> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="Z2a8j9B" component-url="/_astro/CommentBlock.ChJFdf82.js" component-export="default" renderer-url="/_astro/client.44T8euMP.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>