<!DOCTYPE html><html lang="ru"> <head><title>Анимация пролета камеры при прокрутке с помощью Theatre.js и React Three Fiber - Igor Gorlov</title><link rel="canonical" href="https://igorlov.ru/blog/animacziya-proleta-kamery-pri-prokrutke-s-pomoshhyu-theatre-js-i-react-three-fiber"><meta name="description" content="В этом уроке мы покажем вам, как отобразить 3D-сцену на вашей веб-странице и провести камеру по ней, пока пользователь прокручивает страницу, всего за 50 строк кода."><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.9.1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.sihbnQqJ.css">
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#0d52a1;color:rgba(13,82,161,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw)}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.container[data-astro-cid-vcbh62el]{padding:min(2rem,1.2125rem + 1.05vw)}.list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.link[data-astro-cid-vcbh62el]{font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s;padding:.125rem .75rem;font-size:min(1.5rem,1.1625rem + .45vw);line-height:var(--tw-lh)}
</style>
<link rel="stylesheet" href="/_astro/_single_.CzD8Xhhr.css">
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#27292d;border-color:rgba(39,41,45,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.comments[data-v-f9c4118f]{margin:auto;margin-top:1.25rem;width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.comments:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame[data-v-f9c4118f]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/hoisted.CUFolni_.js"></script><style>[data-astro-transition-scope="astro-xdjatz7t-1"] { view-transition-name: blog-image-animacziya-proleta-kamery-pri-prokrutke-s-pomoshhyu-theatre-js-i-react-three-fiber; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-16 font-inter text-blue fluid:text-lg lg:pt-24 dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <symbol id="ai:local:logo-one"><g fill="currentColor"><path d="M1198.57 596.749c0 329.575-267.171 596.751-596.747 596.751-329.575 0-596.749-267.176-596.749-596.751S272.248 0 601.823 0c329.576 0 596.747 267.174 596.747 596.749Z"/><circle cx="3035.75" cy="617.751" r="596.749" transform="rotate(-90 3035.75 617.751)"/><path d="M3035.75 2736.81c329.57 0 596.75 267.18 596.75 596.75 0 329.58-267.18 596.75-596.75 596.75-329.58 0-596.75-267.17-596.75-596.75 0-329.57 267.17-596.75 596.75-596.75Z"/><circle cx="596.749" cy="1964.8" r="596.749"/><path d="M1193.5 3332.87c0 329.57-267.176 596.75-596.751 596.75S0 3662.44 0 3332.87c0-329.58 267.174-596.75 596.749-596.75 329.575 0 596.751 267.17 596.751 596.75Z"/><circle cx="5062.46" cy="617.751" r="596.749" transform="rotate(-90 5062.46 617.751)"/><circle cx="5062.46" cy="3333.56" r="596.749" transform="rotate(-90 5062.46 3333.56)"/></g></symbol><use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> Меню</button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> Закрыть</button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты </a> </li> </ul> </nav> </div>   <!-- <ThemeToggle client:only /> --> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <div class="container" data-astro-cid-vcbh62el> <ol class="list" role="list" data-astro-cid-vcbh62el> <li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </div> </nav>  <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <article data-astro-cid-axzg2cw6> <figure class="article__image" data-astro-cid-axzg2cw6> <picture data-astro-cid-axzg2cw6> <source srcset="/_astro/undefined-Feb-16-2023.Bt978EJ__1Vjq4l.avif" type="image/avif"><source srcset="/_astro/undefined-Feb-16-2023.Bt978EJ__Z255VwV.webp" type="image/webp"> <img src="/_astro/undefined-Feb-16-2023.Bt978EJ__Z18CCYU.png" alt="Анимация пролета камеры при прокрутке с помощью Theatre.js и React Three Fiber" class="aspect-video h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-xdjatz7t-1" width="1120" height="580" decoding="async"> </picture> </figure> </article> <div class="container" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <ul class="article__categories categories" data-astro-cid-axzg2cw6> <li class="categories__item" data-astro-cid-axzg2cw6> <a href="/category/учебник" class="categories__link" data-astro-cid-axzg2cw6> Учебник  </a> </li> </ul> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Анимация пролета камеры при прокрутке с помощью Theatre.js и React Three Fiber </h1> <ul class="article__tags tags" data-astro-cid-axzg2cw6> <li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/webgl" data-astro-cid-axzg2cw6> Webgl </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/scroll" data-astro-cid-axzg2cw6> Scroll </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/r3f" data-astro-cid-axzg2cw6> R3f </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/theatrejs" data-astro-cid-axzg2cw6> Theatre.js </a> </li> </ul> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 16 фев., 2023 by Igor Gorlov </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div> <div class="article__content prose prose-zinc max-w-full break-words text-blue dark:prose-invert prose-headings:text-blue prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <!-- <TextAds /> --> <!-- <AdfoxTocAds blockId="adfox_17062261612859555" /> --> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/animacziya-proleta-kamery-pri-prokrutke-s-pomoshhyu-theatre-js-i-react-three-fiber" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/animacziya-proleta-kamery-pri-prokrutke-s-pomoshhyu-theatre-js-i-react-three-fiber" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Анимация пролета камеры при прокрутке с помощью Theatre.js и React Three Fiber&url=https://igorlov.ru/blog/animacziya-proleta-kamery-pri-prokrutke-s-pomoshhyu-theatre-js-i-react-three-fiber" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/animacziya-proleta-kamery-pri-prokrutke-s-pomoshhyu-theatre-js-i-react-three-fiber&title=Анимация пролета камеры при прокрутке с помощью Theatre.js и React Three Fiber&summary=В этом уроке мы покажем вам, как отобразить 3D-сцену на вашей веб-странице и провести камеру по ней, пока пользователь прокручивает страницу, всего за 50 строк кода.&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/animacziya-proleta-kamery-pri-prokrutke-s-pomoshhyu-theatre-js-i-react-three-fiber&media=&description=В этом уроке мы покажем вам, как отобразить 3D-сцену на вашей веб-странице и провести камеру по ней, пока пользователь прокручивает страницу, всего за 50 строк кода." target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <!-- wp:image -->
<figure class="wp-block-image"><img src="https://i7x7p5b7.stackpathcdn.com/codrops/wp-content/uploads/2023/02/cameraflythrough-theatrejs.jpg" alt=""></figure>
<!-- /wp:image -->
<p>В этом уроке мы покажем вам, как отобразить 3D-сцену на вашей веб-странице и провести камеру по ней, пока пользователь прокручивает страницу, всего за 50 строк кода. Мы будем использовать Theatre.js, React Three Fiber, Drei (библиотека утилит React Three Fiber) и Vite в качестве нашего бандлера.</p>
<!-- wp:rank-math/toc-block {"title":"Оглавление","headings":[{"key":"13a05215-43ad-4725-8c96-6d91af34702a","content":"Требования:","level":2,"link":"#требования","disable":false,"isUpdated":false,"isGeneratedLink":true},{"key":"3e8b975a-56d4-43f8-8185-2fa96fda9c0f","content":"Создание анимации","level":2,"link":"#создание-анимации","disable":false,"isUpdated":false,"isGeneratedLink":true},{"key":"5e9258e4-f5fe-4aab-8850-fe705ccba549","content":"Готовимся к производству","level":2,"link":"#готовимся-к-производству","disable":false,"isUpdated":false,"isGeneratedLink":true},{"key":"0c9d174f-cce0-4b48-b07e-9e12497ab9ce","content":"Развертывание в производство","level":2,"link":"#развертывание-в-производство","disable":false,"isUpdated":false,"isGeneratedLink":true},{"key":"f087eec8-1371-4a62-960d-bde56d45fc66","content":"Пользовательские камеры Three.js от Theatre","level":2,"link":"#пользовательские-камеры-three-js-от-theatre","disable":false,"isUpdated":false,"isGeneratedLink":true}],"listStyle":"ul"} -->
<div class="wp-block-rank-math-toc-block" id="rank-math-toc"><h2>Оглавление</h2><nav><ul><li class=""><a href="#требования">Требования:</a></li><li class=""><a href="#создание-анимации">Создание анимации</a></li><li class=""><a href="#готовимся-к-производству">Готовимся к производству</a></li><li class=""><a href="#развертывание-в-производство">Развертывание в производство</a></li><li class=""><a href="#пользовательские-камеры-three-js-от-theatre">Пользовательские камеры Three.js от Theatre</a></li></ul></nav></div>
<!-- /wp:rank-math/toc-block -->
<h2 class="wp-block-heading" id="требования">Требования:</h2>
<p>Для начала создайте новый проект React с помощью Vite, выполнив команду</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">yarn create vite</code></pre>
<!-- /wp:code -->
<p>и выбираем шаблон React.</p>
<p>Удалите все файлы из каталога /src, чтобы мы начали с чистого листа. Теперь мы можем приступить к реализации нашего приложения.</p>
<p>Давайте начнем с добавления всех зависимостей, которые мы будем использовать. Мы будем использовать 6 тесно связанных библиотек:</p>
<p>Three.js: библиотека JavaScript, используемая для создания и отображения анимированной трехмерной компьютерной графики в веб-браузере с помощью WebGL. Она включает функции для создания 3D-геометрии, управления камерой, освещения, отображения текстур, анимации и многого другого. Его можно использовать для создания интерактивных 3D-воздействий и игр, а также для создания 3D-визуализации данных.</p>
<p>React Three Fiber: рендерер React для Three.js, обеспечивающий интуитивно понятный декларативный подход к созданию 3D-сцен и компонентов. React Three Fiber упрощает работу с Three.js, позволяя разработчикам создавать трехмерный опыт, пользуясь при этом компонентно-ориентированной структурой и управлением состояниями React.</p>
<p>Drei: библиотека React Three Fiber, состоящая из полезных компонентов и крючков. Она включает компоненты для загрузки объектов и текстур Three.js, управления камерой, освещением, анимацией и многое другое. Она позволяет разработчикам быстро создавать трехмерные эффекты без необходимости вручную создавать и подключать компоненты Three.js.</p>
<p>Theatre.js: библиотека анимации с профессиональным набором инструментов для создания движений. Она поможет вам создать любую анимацию, от кинематографических сцен в THREE.js до восхитительных взаимодействий пользовательского интерфейса. @theatre/core - это основная библиотека анимации, @theatre/studio - это анимационная студия времени разработки, которую мы будем использовать для создания анимации Theatre.js, а @theatre/r3f - это расширение Theatre.js, обеспечивающее глубокую интеграцию с React Three Fiber.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash"># three.js, r3f, drei
yarn add three @react-three/fiber @react-three/drei

# theatre.js
yarn add @theatre/core @theatre/studio @theatre/r3f
</code></pre>
<!-- /wp:code -->
<p>Затем загрузите файл environment.glb и поместите его в папку /public. Этот файл содержит 3D-сцену, через которую мы будем пролетать с камерой. Конечно, вы можете использовать любой другой GLTF-файл для вашей сцены.</p>
<p>Соединяем все части</p>
<p>Установив все зависимости, создайте 3 файла в папке /src</p>
<p>main.jsx - Высокоуровневый код настройки для React и Theatre.js</p>
<p>App.jsx - код нашего приложения</p>
<p>main.css - Немного CSS для правильного позиционирования нашего холста.</p>
<p>main.jsx будет выглядеть очень похоже на то, что Vite создает по умолчанию:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">import studio from "@theatre/studio";
import extension from "@theatre/r3f/dist/extension";
import React, { Suspense } from "react";
import ReactDOM from "react-dom/client";
import App from "./App";
import "./main.css";

studio.extend(extension);
studio.initialize();

ReactDOM.createRoot(document.getElementById("root")).render(
  &#x3C;React.StrictMode>
    &#x3C;Suspense fallback={null}>
      &#x3C;App />
    &#x3C;/Suspense>
  &#x3C;/React.StrictMode>
);
</code></pre>
<!-- /wp:code -->
<p>Единственные 2 отличия</p>
<p>Мы настраиваем React Suspense в строке 13, чтобы мы могли загружать наши 3D-модели.</p>
<p>Мы настраиваем Theatre.js Studio в строках 8-9, сначала расширив его расширением r3f, а затем вызвав initialize().</p>
<p>Мы собираемся использовать main.css для заполнения экрана холстом, который мы создадим в следующем шаге с помощью React Three Fiber:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="css" class="language-css">html,
body,
#root {
  padding: 0;
  margin: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

body {
  display: flex;
  align-items: center;
  align-content: center;
}
</code></pre>
<!-- /wp:code -->
<p>Далее, давайте заполним App.jsx кодом нашего приложения:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">import { Canvas, useFrame } from "@react-three/fiber";
import { Gltf, ScrollControls, useScroll } from "@react-three/drei";
import { getProject, val } from "@theatre/core";

import {
  SheetProvider,
  PerspectiveCamera,
  useCurrentSheet,
} from "@theatre/r3f";

export default function App() {
  const sheet = getProject("Fly Through").sheet("Scene");

  return (
    &#x3C;Canvas gl={{ preserveDrawingBuffer: true }}>
      &#x3C;ScrollControls pages={5}>
        &#x3C;SheetProvider sheet={sheet}>
          &#x3C;Scene />
        &#x3C;/SheetProvider>
      &#x3C;/ScrollControls>
    &#x3C;/Canvas>
  );
}

function Scene() {
  const sheet = useCurrentSheet();
  const scroll = useScroll();

  // our callback will run on every animation frame
  useFrame(() => {
    // the length of our sequence
    const sequenceLength = val(sheet.sequence.pointer.length);
    // update the "position" of the playhead in the sequence, as a fraction of its whole length
    sheet.sequence.position = scroll.offset * sequenceLength;
  });

  const bgColor = "#84a4f4";

  return (
    &#x3C;>
      &#x3C;color attach="background" args={[bgColor]} />
      &#x3C;fog attach="fog" color={bgColor} near={-4} far={10} />
      &#x3C;ambientLight intensity={0.5} />
      &#x3C;directionalLight position={[-5, 5, -5]} intensity={1.5} />
      &#x3C;Gltf src="/environment.glb" castShadow receiveShadow />
      &#x3C;PerspectiveCamera
        theatreKey="Camera"
        makeDefault
        position={[0, 0, 0]}
        fov={90}
        near={0.1}
        far={70}
      />
    &#x3C;/>
  );
}
</code></pre>
<!-- /wp:code -->
<p>Давайте разберемся, что здесь происходит.</p>
<p>В компоненте App (строки 11-23) мы устанавливаем все зависимости для нашего компонента Scene:</p>
<p>getProject(“Fly Through”).sheet(“Scene”) извлекает наш лист анимации. Листы - это контейнеры для анимируемых объектов. Мы собираемся сделать этот лист доступным для расширения Theatre.js r3f через SheetProvider, который будет автоматически использовать его, поэтому нам не нужно беспокоиться о его специфике.</p>
<p>Компонент Canvas из r3f создает элемент WebGL canvas, который растягивается до своего родительского элемента (элемента body, размер которого мы определили в предыдущем шаге, чтобы заполнить весь экран), и устанавливает цикл рендеринга. Позже мы подключимся к этому циклу рендеринга с помощью крючка useFrame.</p>
<p>Компонент ScrollControls из Drei устанавливает невидимый контейнер прокрутки, который мы будем использовать для привязки позиции прокрутки к воспроизведению анимации без фактической прокрутки видимого элемента HTML.</p>
<p>В компоненте Scene (строки 25-56):</p>
<p>Мы используем useCurrentSheet(), useScroll() и useFrame() для обновления позиции анимации с актуальной позицией прокрутки на каждом кадре.</p>
<p>Мы создаем сцену Three.js:</p>
<p>Мы создаем атмосферу, похожую на небо, используя объекты цвета и тумана (строки 41-42).</p>
<p>Мы создаем несколько огней (строки 43-44).</p>
<p>Мы отображаем нашу модель GLTF, которую мы ранее поместили в общую папку (строка 45).</p>
<p>Мы создаем нашу камеру с помощью PerspectiveCamera, которую мы будем анимировать с помощью Theatre.js. Этот компонент импортирован из библиотеки @theatre/r3f, благодаря чему Theatre.js Studio автоматически подхватывает его без каких-либо настроек. Хотя мы задаем здесь некоторые параметры по умолчанию, все они могут быть изменены или анимированы в пользовательском интерфейсе Studio.</p>
<p>Если все правильно, то после выполнения всех этих шагов вы должны увидеть следующее при запуске yarn dev:</p>
<!-- wp:image -->
<figure class="wp-block-image"><img src="https://res.craft.do/user/full/19b7adfa-234e-603e-dc22-061aa5a2817b/doc/1B44EC76-B04F-4755-A241-A6E2DDF668EB/7048CE9B-B2ED-4C6E-9A6A-776783C642BC_2/4GuzfUcC3cw51g0OWFu2ni1xlpTztnLYO1CJxai0mXIz/Vite%20%20React%20%20TS%202023-02-13T16.53.532x.png" alt="Vite + React + TS 2023-02-13T16.53.53@2x.png"></figure>
<!-- /wp:image -->
<p>Не так много, чтобы смотреть на это, но мы скоро это изменим.</p>
<h2 class="wp-block-heading" id="создание-анимации">Создание анимации</h2>
<p>Откройте редактор моментальных снимков, нажав на кнопку моментального снимка на панели инструментов:</p>
<!-- wp:image -->
<figure class="wp-block-image"><img src="https://res.craft.do/user/full/19b7adfa-234e-603e-dc22-061aa5a2817b/doc/1B44EC76-B04F-4755-A241-A6E2DDF668EB/1FF91453-2B89-4559-B78E-59C4E9A1AF1A_2/Y5H6Jcz4xQmKaEt0bQqDBVhqhxe3J5sUiSn80Y8imAMz/Vite%20%20React%20%20TS%202023-02-13T16.54.122x.png" alt="Vite + React + TS 2023-02-13T16.54.12@2x.png"></figure>
<!-- /wp:image -->
<p>При открытом редакторе снимков выберите объект Камера и переместите его в начало сцены.</p>
<p>Выбрав камеру, щелкните правой кнопкой мыши на свойстве position на панели справа и выберите Sequence all.</p>
<!-- wp:image {"id":70470} -->
<figure class="wp-block-image"><img src="https://i7x7p5b7.stackpathcdn.com/codrops/wp-content/uploads/2023/02/Vite-React-TS-2023-02-13T16.59.022x.png" alt="" class="wp-image-70470"></figure>
<!-- /wp:image -->
<p>Появится редактор последовательности:</p>
<!-- wp:image {"id":70471} -->
<figure class="wp-block-image"><img src="https://i7x7p5b7.stackpathcdn.com/codrops/wp-content/uploads/2023/02/Vite-React-TS-2023-02-13T18.25.492x.jpg" alt="" class="wp-image-70471"></figure>
<!-- /wp:image -->
<p>Поместите первый ключевой кадр, нажав на значок ключевого кадра рядом со свойством position на панели деталей:</p>
<!-- wp:image {"id":70473} -->
<figure class="wp-block-image"><img src="https://i7x7p5b7.stackpathcdn.com/codrops/wp-content/uploads/2023/02/Vite-React-TS-2023-02-13T18.26.162x-800x400.png" alt="" class="wp-image-70473"></figure>
<!-- /wp:image -->
<p>Затем прокрутите немного вниз. Обратите внимание, что индикатор головки воспроизведения переместился вперед в редакторе последовательности:</p>
<p>Обратите внимание, обычно вы можете перетаскивать головку воспроизведения по временной шкале, однако в данном случае, поскольку мы привязали положение головки воспроизведения к положению прокрутки, это невозможно. Вы можете временно восстановить эту функциональность, закомментировав хук useFrame в строках 30-33 в App.jsx.</p>
<p>Теперь немного подвигайте камеру в редакторе моментальных снимков. Обратите внимание, что для вас был создан новый набор ключевых кадров. Если теперь вы попытаетесь прокрутить кадр вверх и вниз, камера будет двигаться вместе с ним.</p>
<p>Повторив эти действия, попробуйте переместить камеру в другой конец сцены. Аналогичным образом можно создать ключевые кадры для вращения камеры, чтобы заставить ее оглядеться вокруг.</p>
<p>Когда вы закончите, вы можете заметить, что движение камеры немного дрожит. Это происходит потому, что стандартное смягчение по умолчанию смягчает движение между каждым ключевым кадром. Чтобы получить плавное движение по всему пути камеры, нужно установить линейную интерполяцию. Для этого выделите все ключевые кадры положения, удерживая Shift, и перетащите поле выделения на ключевые кадры. Когда все они будут выделены, щелкните на любой из соединительных линий и выберите линейный вариант.</p>
<p>Чтобы проверить, как выглядит наша страница без Студии, вы можете нажать Alt/Option + , чтобы скрыть ее. Также вы можете закомментировать studio.initialize().</p>
<p>После завершения анимации ваша готовая сцена может выглядеть примерно так, когда вы начнете прокрутку:</p>
<h2 class="wp-block-heading" id="готовимся-к-производству">Готовимся к производству</h2>
<p>Пока что все созданные вами ключевые кадры сохраняются в localStorage браузера, так что ваша анимация будет запоминаться между обновлениями страницы.</p>
<p>Чтобы распространить анимацию как часть вашего сайта, экспортируйте проект Theatre.js, нажав на “Fly Through” в контурном меню в верхней левой части пользовательского интерфейса, а затем нажмите кнопку “Export Fly Through to JSON” справа.</p>
<p>В результате будет загружен файл JSON. Мы можем переместить этот файл в наш каталог src и импортировать его.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">import flyThrougState from "./state.json"
</code></pre>
<!-- /wp:code -->
<p>Чтобы использовать его, достаточно заменить следующую строку (строка 12):</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const sheet = getProject("Fly Through").sheet("Scene");
</code></pre>
<!-- /wp:code -->
<p>Со следующими:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const sheet = getProject("Fly Through", {state: flyThroughState}).sheet("Scene");
</code></pre>
<!-- /wp:code -->
<p>Теперь мы передаем сохраненное состояние анимации в getProject. Благодаря этому проект Theatre.js будет инициализирован с сохраненной анимацией из state.json, а не с анимацией, сохраненной в localStorage. Не волнуйтесь, все изменения, внесенные в анимацию в Studio, будут сохранены в localStorage после того, как вы это сделаете (ваши правки сохранятся после обновления страницы).</p>
<h2 class="wp-block-heading" id="развертывание-в-производство">Развертывание в производство</h2>
<p>Когда мы закончили и готовы развернуть нашу веб-страницу на производстве, нам нужно сделать только две вещи.</p>
<p>Убедитесь, что у нас есть последнее состояние проекта, экспортированное в JSON-файл и переданное в getProject.</p>
<p>Удалить studio.initialize и studio.extend (строки 8-9 в main.jsx).</p>
<p>Советы для дальнейшего изучения</p>
<p>Утилита редактирования</p>
<p>Импортируйте экспорт editable из @theatre/r3f.</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">import { editable as e } from "@theatre/r3f"
</code></pre>
<!-- /wp:code -->
<p>После этого, если вы хотите сделать другие объекты threejs редактируемыми в редакторе снапшотов, например, свет или туман, просто добавьте к ним префикс e., и добавьте реквизит theatreKey=”ваше имя здесь”:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">&#x3C;color attach="background" args={[bgColor]} />
&#x3C;e.fog theatreKey="Fog" attach="fog" color={bgColor} near={-4} far={10} />
&#x3C;ambientLight intensity={0.5} />
&#x3C;e.directionalLight theatreKey="Sun" position={[-5, 5, -5]} intensity={1.5} />
&#x3C;Gltf src="/environment.glb" castShadow receiveShadow />
&#x3C;PerspectiveCamera
  theatreKey="Camera"
  makeDefault
  position={[0, 0, 0]}
  fov={90}
  near={0.1}
  far={70}
/>
</code></pre>
<!-- /wp:code -->
<p>После этого вы можете свободно регулировать или даже анимировать их свойства в редакторе, как мы это делали с камерой.</p>
<h2 class="wp-block-heading" id="пользовательские-камеры-three-js-от-theatre">Пользовательские камеры Three.js от Theatre</h2>
<p>PerspectiveCamera и OrthogramphicCamera от @theatre/r3f имеют идентичный API, что и камеры, экспортируемые @react-three/drei, с одной дополнительной фишкой: вы можете передать Vector3 или любой объект Three.js ref в свойство lookAt, чтобы камера сфокусировалась на нем. Это можно использовать для упрощения работы с камерой, например, так:</p>
<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">&#x3C;PerspectiveCamera
  lookAt={cameraTargetRef}
  theatreKey="Camera"
  makeDefault
/>
&#x3C;e.mesh theatreKey="Camera Target" visible="editor" ref={cameraTargetRef}>
  &#x3C;octahedronBufferGeometry args={[0.1, 0]} />
  &#x3C;meshPhongMaterial color="yellow" />
&#x3C;/e.mesh>
</code></pre>
<!-- /wp:code --> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/animacziya-proleta-kamery-pri-prokrutke-s-pomoshhyu-theatre-js-i-react-three-fiber" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/animacziya-proleta-kamery-pri-prokrutke-s-pomoshhyu-theatre-js-i-react-three-fiber" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Анимация пролета камеры при прокрутке с помощью Theatre.js и React Three Fiber&url=https://igorlov.ru/blog/animacziya-proleta-kamery-pri-prokrutke-s-pomoshhyu-theatre-js-i-react-three-fiber" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/animacziya-proleta-kamery-pri-prokrutke-s-pomoshhyu-theatre-js-i-react-three-fiber&title=Анимация пролета камеры при прокрутке с помощью Theatre.js и React Three Fiber&summary=В этом уроке мы покажем вам, как отобразить 3D-сцену на вашей веб-странице и провести камеру по ней, пока пользователь прокручивает страницу, всего за 50 строк кода.&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/animacziya-proleta-kamery-pri-prokrutke-s-pomoshhyu-theatre-js-i-react-three-fiber&media=&description=В этом уроке мы покажем вам, как отобразить 3D-сцену на вашей веб-странице и провести камеру по ней, пока пользователь прокручивает страницу, всего за 50 строк кода." target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/animacziya-tipografiki-pri-prokrutke" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> Анимация типографики при прокрутке </a> <a href="/blog/angular-signals-vs-observables-kak-y-kohda-yspolzovat-kazhd-i-yz-nykh" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Angular signals vs. observables: Как и когда использовать каждый из них </a> </nav>  </div> </div> </article> <div class="container" data-astro-cid-axzg2cw6> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.D-6fTqBY.js" component-export="default" renderer-url="/_astro/client.Bd2Qst3j.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> </div> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="Z2a8j9B" component-url="/_astro/CommentBlock.ChJFdf82.js" component-export="default" renderer-url="/_astro/client.44T8euMP.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>