<!DOCTYPE html><html lang="ru"> <head><title>Как включить аппаратное ускорение в Chrome, Chromium и Puppeteer на AWS в режиме Headless | Игорь Горлов - Фронтeндер</title><link rel="canonical" href="https://igorlov.ru/blog/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless"><meta name="description" content="Как мы повысили производительность Remotion благодаря рендерингу на стороне сервера с GPUускорениемЗапуск Google Chrome с аппаратным ускорением в режиме hea"><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.9.1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.sihbnQqJ.css">
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#0d52a1;color:rgba(13,82,161,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw)}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.container[data-astro-cid-vcbh62el]{padding:min(2rem,1.2125rem + 1.05vw)}.list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.link[data-astro-cid-vcbh62el]{font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s;padding:.125rem .75rem;font-size:min(1.5rem,1.1625rem + .45vw);line-height:var(--tw-lh)}
</style>
<link rel="stylesheet" href="/_astro/_single_.CpmbJtnn.css">
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#27292d;border-color:rgba(39,41,45,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.comments[data-v-f9c4118f]{margin:auto;margin-top:1.25rem;width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.comments:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame[data-v-f9c4118f]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/hoisted.CUFolni_.js"></script><style>[data-astro-transition-scope="astro-xdjatz7t-1"] { view-transition-name: blog-image-kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-16 font-inter text-blue fluid:text-lg lg:pt-24 dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <symbol id="ai:local:logo-one"><g fill="currentColor"><path d="M1198.57 596.749c0 329.575-267.171 596.751-596.747 596.751-329.575 0-596.749-267.176-596.749-596.751S272.248 0 601.823 0c329.576 0 596.747 267.174 596.747 596.749Z"/><circle cx="3035.75" cy="617.751" r="596.749" transform="rotate(-90 3035.75 617.751)"/><path d="M3035.75 2736.81c329.57 0 596.75 267.18 596.75 596.75 0 329.58-267.18 596.75-596.75 596.75-329.58 0-596.75-267.17-596.75-596.75 0-329.57 267.17-596.75 596.75-596.75Z"/><circle cx="596.749" cy="1964.8" r="596.749"/><path d="M1193.5 3332.87c0 329.57-267.176 596.75-596.751 596.75S0 3662.44 0 3332.87c0-329.58 267.174-596.75 596.749-596.75 329.575 0 596.751 267.17 596.751 596.75Z"/><circle cx="5062.46" cy="617.751" r="596.749" transform="rotate(-90 5062.46 617.751)"/><circle cx="5062.46" cy="3333.56" r="596.749" transform="rotate(-90 5062.46 3333.56)"/></g></symbol><use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> Меню</button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> Закрыть</button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты </a> </li> </ul> </nav> </div>   <!-- <ThemeToggle client:only /> --> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <div class="container" data-astro-cid-vcbh62el> <ol class="list" role="list" data-astro-cid-vcbh62el> <li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </div> </nav>  <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <article data-astro-cid-axzg2cw6> <figure class="article__image" data-astro-cid-axzg2cw6> <picture data-astro-cid-axzg2cw6> <source srcset="/_astro/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless-Dec-16-2023.BRXhK0EO_ZW9Soc.avif" type="image/avif"><source srcset="/_astro/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless-Dec-16-2023.BRXhK0EO_Z1yVaiH.webp" type="image/webp"> <img src="/_astro/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless-Dec-16-2023.BRXhK0EO_TSaKR.png" alt="Как включить аппаратное ускорение в Chrome, Chromium и Puppeteer на AWS в режиме Headless" class="aspect-video h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-xdjatz7t-1" width="1120" height="580" decoding="async"> </picture> </figure> </article> <div class="container" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <!-- <ul class="article__categories categories">
				{
					categories.map((category: string, index: number) => (
						<li class="categories__item">
							<a href={`/category/${slugify(category)}`} class="categories__link">
								{humanize(category)}
								{index !== categories.length - 1 && ','}
							</a>
						</li>
					))
				}
			</ul> --> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Как включить аппаратное ускорение в Chrome, Chromium и Puppeteer на AWS в режиме Headless </h1> <!-- <ul class="article__tags tags">
				{
					tags.map((tag: string) => (
						<li class="tags__item">
							<a class="tags__link" href={`/tag/${slugify(tag)}`}>
								{humanize(tag)}
							</a>
						</li>
					))
				}
			</ul> --> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 16 дек., 2023 by Игорь Горлов </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div> <div class="article__content prose prose-zinc max-w-full break-words text-blue dark:prose-invert prose-headings:text-blue prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <div class="flex flex-col border-b border-blue bg-box font-bold transition-colors text-xs fluid:py-5 lg:text-lg" data-astro-cid-2umh5aky> <span class="title" data-astro-cid-2umh5aky>Задонатить на пиво</span> <ul class="list" data-astro-cid-2umh5aky> <li class="item" data-astro-cid-2umh5aky>usdt trc20 (tron): TCgbLvPt8fe8n4jqbTjVNkzyPTqhEWxW3k</li><li class="item" data-astro-cid-2umh5aky>btc: bc1qslfl8efv733sgr489yxmf9hduw6ptjvvlq2mwx</li><li class="item" data-astro-cid-2umh5aky>eth: 0x316577c4071a5738DD5C0242A97C44bdd3CD6304</li> </ul> </div>  <!-- <AdfoxTocAds blockId="adfox_17062261612859555" /> --> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как включить аппаратное ускорение в Chrome, Chromium и Puppeteer на AWS в режиме Headless&url=https://igorlov.ru/blog/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless&title=Как включить аппаратное ускорение в Chrome, Chromium и Puppeteer на AWS в режиме Headless&summary=Как мы повысили производительность Remotion благодаря рендерингу на стороне сервера с GPUускорением

Запуск Google Chrome с аппаратным ускорением в режиме hea&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless&media=&description=Как мы повысили производительность Remotion благодаря рендерингу на стороне сервера с GPUускорением

Запуск Google Chrome с аппаратным ускорением в режиме hea" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <details open class="toc border-b border-blue text-blue fluid:p-8 overflow-auto cursor-pointer bg-box"><summary class="toc__title text-xl font-medium">Содержание</summary><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#аппаратное-ускорение-в-браузерном-рендеринге">Аппаратное ускорение в браузерном рендеринге</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#dlami-из-marketplace">DLAMI из Marketplace?</a></li></ol></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#свежий-старт">Свежий старт</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#запуск-экземпляра-ec2">Запуск экземпляра EC2</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#обновление-ubuntu">Обновление Ubuntu</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#установка-драйверов-nvidia-gpu">Установка драйверов Nvidia GPU</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#настройка-службы-запуска">Настройка службы запуска</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#тестирование-установки">Тестирование установки</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#chromium">Chromium</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#google-chrome">Google Chrome</a></li></ol></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#работа-с-puppeteer">Работа с Puppeteer</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#примечание-от-создателя">Примечание от создателя</a></li></ol></details open><p>Как мы повысили производительность Remotion благодаря рендерингу на стороне сервера с GPU-ускорением</p>
<p>Запуск Google Chrome с аппаратным ускорением в режиме headless может оказаться сложнее, чем кажется. Мы отправились в это путешествие с Remotion, который является отличным фреймворком, позволяющим разработчикам ”делать видео программно”. По пути мы изучили различные версии драйверов Nvidia, в том числе с сайта Nvidia и из официальных репозиториев Ubuntu.</p>
<p>Мы сотрудничали с активным сообществом разработчиков Remotion Open-source, чтобы найти ответ на вопрос об использовании GPU с Remotion для рендеринга на стороне сервера. Встретив на своем пути несколько неудач, мы в конце концов смогли заставить Remotion работать. Мы объединили наши находки в документах Remotion в разделе ”Использование GPU в облаке” и упростили инструкции для разработчиков Remotion, чтобы они могли извлечь из этого максимум пользы. Хотя все исследование было проведено для Remotion, этот же процесс подойдет для любого приложения, требующего мощности GPU, особенно в режиме headless.</p>
<h2 id="аппаратное-ускорение-в-браузерном-рендеринге">Аппаратное ускорение в браузерном рендеринге<a aria-hidden="true" tabindex="-1" href="#аппаратное-ускорение-в-браузерном-рендеринге"><span class="icon icon-link"></span></a></h2>
<p>Аппаратное ускорение для вашего браузера - это то же самое, что ”азотное топливо” для бензинового автомобиля. Оно использует возможности специализированного оборудования, например графических процессоров, чтобы веб-страницы загружались быстрее, а видео воспроизводилось плавно. Аппаратное ускорение улучшает процесс отображения веб-страницы, называемый рендерингом. В результате веб-страницы загружаются более плавно и быстро.</p>
<h3 id="dlami-из-marketplace">DLAMI из Marketplace?<a aria-hidden="true" tabindex="-1" href="#dlami-из-marketplace"><span class="icon icon-link"></span></a></h3>
<p>Кто-то может удивиться, почему мы не выбрали AWS Deep Learning AMI или DLAMI. Но нам нужен был тонкий контроль над драйверами и утилитами GPU, и устаревший DLAMI, несмотря на все нагромождения, не подходил. Такие задачи часто сложно решить с помощью готовых AMI, о чем мы рассказывали в статье ”Почему Deep Learning AMI сдерживает вас”. Настройка среды в соответствии с нашими требованиями также помогла нам эффективно устранять неполадки.</p>
<p>Мы экспериментировали с несколькими пакетами, чтобы определить ключевые, необходимые для распознавания GPU в Google Chrome. Несмотря на все эти усилия, распознавание GPU оставалось неуловимым, а в некоторых случаях драйверы GPU выходили из строя даже при инициализации. Долгий и трудный путь привел нас к концу туннеля, но тьма не рассеивается, а решение остается таким же труднодостижимым, как и прежде. Когда мы решили на этом закончить, мы наткнулись на эту тему на Github проблем Puppeteer, которая не дала нам никакой надежды, но дала нам новую перспективу и стремление к достижению нашей цели.</p>
<figure class="igorlov-figure"><img  src="/_astro/kmh1l1gpmzn5k9ssvfaj.BPI5JAlx_Z1pjrDj.webp" alt="Разработчики сталкиваются с аналогичными проблемами с аппаратным ускорением в безголовом режиме" width="800" height="449" loading="lazy" decoding="async"><figcaption>Разработчики сталкиваются с аналогичными проблемами с аппаратным ускорением в безголовом режиме</figcaption></figure>
<h2 id="свежий-старт">Свежий старт<a aria-hidden="true" tabindex="-1" href="#свежий-старт"><span class="icon icon-link"></span></a></h2>
<p>Пришло время вернуться к чертежной доске и начать все заново. Мы начали с чистой базовой Ubuntu AMI на AWS EC2 Instance. После этого мы скачали и установили драйверы Nvidia Tesla T4G с официального сайта Nvidia.</p>
<p>Убедившись, что GPU работает правильно с помощью <code>nvidia-smi</code>, мы установили Google Chrome и протестировали его на аппаратное ускорение, к нашему облегчению Google Chrome наконец-то дал добро на работу с аппаратным ускорением.</p>
<h2 id="запуск-экземпляра-ec2">Запуск экземпляра EC2<a aria-hidden="true" tabindex="-1" href="#запуск-экземпляра-ec2"><span class="icon icon-link"></span></a></h2>
<p>Запуск экземпляра EC2 может быть осуществлен различными способами, среди которых выделяются веб-консоль AWS и AWS CLI. Независимо от способа, важными параметрами являются тип экземпляра и выбор AMI. На момент написания статьи идентификатор AMI для выбранного нами экземпляра <code>g4dn.xlarge</code> - <code>ami-053b0d53c279acc90</code>. Для запуска экземпляра EC2 через <code>aws-cli</code> можно использовать следующую команду, заменив пропуски на реальные значения.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">aws</span><span style="color:#ADD7FF"> ec2</span><span style="color:#ADD7FF"> run-instances</span><span style="color:#5FB3A1"> \</span></span>
<span class="line"><span style="color:#ADD7FF">    --instance-initiated-shutdown-behavior</span><span style="color:#A6ACCD"> "</span><span style="color:#5DE4C7">terminate</span><span style="color:#A6ACCD">"</span><span style="color:#5FB3A1"> \</span></span>
<span class="line"><span style="color:#ADD7FF">    --image-id</span><span style="color:#A6ACCD"> "</span><span style="color:#5DE4C7">ami-053b0d53c279acc90</span><span style="color:#A6ACCD">"</span><span style="color:#5FB3A1"> \</span></span>
<span class="line"><span style="color:#ADD7FF">    --instance-type</span><span style="color:#A6ACCD"> "</span><span style="color:#5DE4C7">g4dn.xlarge</span><span style="color:#A6ACCD">"</span><span style="color:#5FB3A1"> \</span></span>
<span class="line"><span style="color:#ADD7FF">    --key-name</span><span style="color:#A6ACCD"> "</span><span style="color:#5DE4C7">&#x3C;KEY_NAME></span><span style="color:#A6ACCD">"</span><span style="color:#5FB3A1"> \</span></span>
<span class="line"><span style="color:#ADD7FF">    --subnet-id</span><span style="color:#A6ACCD"> "</span><span style="color:#5DE4C7">&#x3C;SUBNET_ID></span><span style="color:#A6ACCD">"</span><span style="color:#5FB3A1"> \</span></span>
<span class="line"><span style="color:#ADD7FF">    --security-group-ids</span><span style="color:#A6ACCD"> "</span><span style="color:#5DE4C7">&#x3C;SECURITY_GROUP_ID></span><span style="color:#A6ACCD">"</span><span style="color:#5FB3A1"> \</span></span>
<span class="line"><span style="color:#ADD7FF">    -iam-instance-profile</span><span style="color:#ADD7FF"> Arn=</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">&#x3C;ARN></span><span style="color:#A6ACCD">"</span><span style="color:#5FB3A1"> \</span></span>
<span class="line"><span style="color:#ADD7FF">    --block-device-mappings</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">[ { "DeviceName": "/dev/sda1", "Ebs": { "VolumeSize": 8, "VolumeType": "gp3" } } ]</span><span style="color:#A6ACCD">'</span></span>
<span class="line"></span></code></pre>
<h2 id="обновление-ubuntu">Обновление Ubuntu<a aria-hidden="true" tabindex="-1" href="#обновление-ubuntu"><span class="icon icon-link"></span></a></h2>
<p>Ubuntu 22.04 AMI <code>ami-053b0d53c279acc90</code> на AWS поставляется с ядром Linux <code>v5</code> (конкретно <code>5.19.0-1025-aws</code>). На данный момент у нас есть два варианта: либо мы остаемся с ядром <code>v5</code>, либо обновляем его до <code>v6</code> (<code>v6.2.0-1013-aws</code>), мы решили обновить ядро. Это решение очень важно, так как драйвер Nvidia, скомпилированный для одной версии, не будет работать для другой.</p>
<p>После запуска экземпляра подключитесь к нему по SSH и запустите процесс обновления пакетов Ubuntu. Чтобы обновить все установленные пакеты, включая ядро Linux, выполните следующую команду.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">sudo</span><span style="color:#ADD7FF"> bash</span><span style="color:#ADD7FF"> -c</span><span style="color:#A6ACCD"> "</span><span style="color:#5DE4C7">apt update &#x26;&#x26; export DEBIAN_FRONTEND=noninteractive &#x26;&#x26; export NEEDRESTART_MODE=a &#x26;&#x26; apt upgrade -y &#x26;&#x26; reboot</span><span style="color:#A6ACCD">"</span></span>
<span class="line"></span></code></pre>
<p>Мы также можем разделить <code>apt update</code>, <code>apt upgrade -y</code> и <code>reboot</code>. Но причина в том, чтобы установить эти обновления в неинтерактивном режиме.</p>
<p>После выполнения система перезагрузится с ядром Linux версии 6. Мы можем подтвердить обновление ядра с помощью <code>uname -r</code>. Перезагрузка - это essВажно при обновлении системы Ubuntu, поскольку при следующей загрузке загружается новое ядро, а драйверы Nvidia впоследствии будут созданы для обновленной версии.</p>
<h2 id="установка-драйверов-nvidia-gpu">Установка драйверов Nvidia GPU<a aria-hidden="true" tabindex="-1" href="#установка-драйверов-nvidia-gpu"><span class="icon icon-link"></span></a></h2>
<p>Процесс установки драйверов GPU прост, если у нас есть правильный драйвер для GPU и соответствующая совместимая версия. Перед началом установки нам необходимо установить несколько пакетов: <code>build-essential</code> и <code>libvulkan1</code> . Первый представляет собой пакет с различными инструментами компиляции, необходимыми для компиляции драйвера Nvidia. Вторая, хотя и не является обязательной, требуется Google Chrome. Поэтому нелишним будет установить его заранее, чтобы включить поддержку загрузчика Vulkan ICD для Nvidia, если она понадобится нам в будущем.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">sudo</span><span style="color:#ADD7FF"> apt</span><span style="color:#ADD7FF"> install</span><span style="color:#ADD7FF"> -y</span><span style="color:#ADD7FF"> build-essential</span><span style="color:#ADD7FF"> libvulkan1</span></span>
<span class="line"></span></code></pre>
<p>После установки инструментов сборки мы можем перейти к загрузке и установке драйверов GPU с помощью следующих команд:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#E4F0FB">DRIVER_URL</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">https://us.download.nvidia.com/tesla/535.104.12/NVIDIA-Linux-x86_64-535.104.12.run</span><span style="color:#A6ACCD">"</span><span style="color:#E4F0FB"> DRIVER_NAME</span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD">"</span><span style="color:#5DE4C7">NVIDIA-Linux-driver.run</span><span style="color:#A6ACCD">"</span><span style="color:#91B4D5"> wget</span><span style="color:#ADD7FF"> -O</span><span style="color:#A6ACCD"> "</span><span style="color:#E4F0FB">$DRIVER_NAME</span><span style="color:#A6ACCD">"</span><span style="color:#A6ACCD"> "</span><span style="color:#E4F0FB">$DRIVER_URL</span><span style="color:#A6ACCD">"</span><span style="color:#ADD7FF"> sudo</span><span style="color:#ADD7FF"> sh</span><span style="color:#A6ACCD"> "</span><span style="color:#E4F0FB">$DRIVER_NAME</span><span style="color:#A6ACCD">"</span><span style="color:#ADD7FF"> --disable-nouveau</span><span style="color:#ADD7FF"> --silent</span><span style="color:#ADD7FF"> rm</span><span style="color:#A6ACCD"> "</span><span style="color:#E4F0FB">$DRIVER_NAME</span><span style="color:#A6ACCD">"</span></span>
<span class="line"></span></code></pre>
<p>Теперь мы можем запустить <code>nvidia-smi</code>, чтобы подтвердить установку драйверов GPU. Результат будет выглядеть примерно так:</p>
<figure class="igorlov-figure"><img  src="/_astro/gm1ig2rq3b6hzs0pqq3p.FDID3hw0_Z263Oqa.webp" alt="nvidia-smi output" width="800" height="353" loading="lazy" decoding="async"><figcaption>nvidia-smi output</figcaption></figure>
<h2 id="настройка-службы-запуска">Настройка службы запуска<a aria-hidden="true" tabindex="-1" href="#настройка-службы-запуска"><span class="icon icon-link"></span></a></h2>
<p>Мы узнали об этом нелегким путем: однократный запуск <code>nvidia-smi</code> необходим для правильной инициализации <code>EGL</code> и <code>ANGLE</code>. Google Chrome и Chromium не могут инициализировать <code>EGL</code> без этой предварительной настройки. Чтобы автоматизировать этот процесс, мы создадим службу, которая будет запускать <code>nvidia-smi</code> во время загрузки, используя следующие команды:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">echo</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">[Unit] Description=Run nvidia-smi at system startup [Service] ExecStart=/usr/bin/nvidia-smi Type=oneshot RemainAfterExit=yes [Install] WantedBy=multi-user.target</span><span style="color:#A6ACCD">'</span><span style="color:#91B4D5"> |</span><span style="color:#91B4D5"> sudo</span><span style="color:#ADD7FF"> tee</span><span style="color:#ADD7FF"> /etc/systemd/system/nvidia-smi.service</span><span style="color:#ADD7FF"> sudo</span><span style="color:#ADD7FF"> systemctl</span><span style="color:#ADD7FF"> enable</span><span style="color:#ADD7FF"> nvidia-smi.service</span><span style="color:#ADD7FF"> sudo</span><span style="color:#ADD7FF"> systemctl</span><span style="color:#ADD7FF"> start</span><span style="color:#ADD7FF"> nvidia-smi.service</span></span>
<span class="line"></span></code></pre>
<h2 id="тестирование-установки">Тестирование установки<a aria-hidden="true" tabindex="-1" href="#тестирование-установки"><span class="icon icon-link"></span></a></h2>
<p>Чтобы протестировать аппаратное ускорение в Google Chrome или Chromium, мы можем выполнить следующие шаги. Стоит отметить, что Google Chrome имеет больше зависимостей, что делает его более простым выбором, если мы планируем использовать библиотеку Node.js, Puppeteer.</p>
<p>С другой стороны, Chromium - это облегченный вариант с меньшим количеством зависимостей, но мы все равно можем использовать Puppeteer с Chromium, установив несколько дополнительных зависимостей.</p>
<h3 id="chromium">Chromium<a aria-hidden="true" tabindex="-1" href="#chromium"><span class="icon icon-link"></span></a></h3>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">sudo</span><span style="color:#ADD7FF"> apt</span><span style="color:#ADD7FF"> install</span><span style="color:#ADD7FF"> -y</span><span style="color:#ADD7FF"> chromium-browser</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">chromium-browser</span><span style="color:#ADD7FF"> --headless</span><span style="color:#ADD7FF"> --use-gl=angle</span><span style="color:#5FB3A1"> \ </span><span style="color:#ADD7FF">--use-angle=gl-egl</span><span style="color:#ADD7FF"> --use-cmd-decoder=passthrough</span><span style="color:#5FB3A1"> \ </span><span style="color:#ADD7FF">--print-to-pdf=output.pdf</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">chrome://gpu</span><span style="color:#A6ACCD">'</span></span>
<span class="line"></span></code></pre>
<p>Чтобы использовать Puppeteer с Chromium вместо Google Chrome, необходимо установить несколько дополнительных зависимостей.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">sudo</span><span style="color:#ADD7FF"> apt</span><span style="color:#ADD7FF"> install</span><span style="color:#ADD7FF"> ca-certificates</span><span style="color:#ADD7FF"> fonts-liberation</span><span style="color:#5FB3A1"> \ </span><span style="color:#ADD7FF">libasound2</span><span style="color:#ADD7FF"> libatk-bridge2.0-0</span><span style="color:#ADD7FF"> libatk1.0-0</span><span style="color:#ADD7FF"> libc6</span><span style="color:#5FB3A1"> \ </span><span style="color:#ADD7FF">libcairo2</span><span style="color:#ADD7FF"> libcups2</span><span style="color:#ADD7FF"> libdbus-1-3</span><span style="color:#ADD7FF"> libexpat1</span><span style="color:#ADD7FF"> libfontconfig1</span><span style="color:#5FB3A1"> \ </span><span style="color:#ADD7FF">libgbm1</span><span style="color:#ADD7FF"> libgcc1</span><span style="color:#ADD7FF"> libglib2.0-0</span><span style="color:#ADD7FF"> libgtk-3-0</span><span style="color:#ADD7FF"> libnspr4</span><span style="color:#ADD7FF"> libnss3</span><span style="color:#5FB3A1"> \ </span><span style="color:#ADD7FF">libpango-1.0-0</span><span style="color:#ADD7FF"> libpangocairo-1.0-0</span><span style="color:#ADD7FF"> libstdc++6</span><span style="color:#ADD7FF"> libx11-6</span><span style="color:#5FB3A1"> \ </span><span style="color:#ADD7FF">libx11-xcb1</span><span style="color:#ADD7FF"> libxcb1</span><span style="color:#ADD7FF"> libxcomposite1</span><span style="color:#ADD7FF"> libxcursor1</span><span style="color:#ADD7FF"> libxdamage1</span><span style="color:#5FB3A1"> \ </span><span style="color:#ADD7FF">libxext6</span><span style="color:#ADD7FF"> libxfixes3</span><span style="color:#ADD7FF"> libxi6</span><span style="color:#ADD7FF"> libxrandr2</span><span style="color:#ADD7FF"> libxrender1</span><span style="color:#ADD7FF"> libxss1</span><span style="color:#5FB3A1"> \ </span><span style="color:#ADD7FF">libxtst6</span><span style="color:#ADD7FF"> lsb-release</span><span style="color:#ADD7FF"> wget</span><span style="color:#ADD7FF"> xdg-utils</span></span>
<span class="line"></span></code></pre>
<h3 id="google-chrome">Google Chrome<a aria-hidden="true" tabindex="-1" href="#google-chrome"><span class="icon icon-link"></span></a></h3>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">curl</span><span style="color:#ADD7FF"> -fsSL</span><span style="color:#ADD7FF"> https://dl.google.com/linux/linux_signing_key.pub</span><span style="color:#91B4D5"> |</span><span style="color:#91B4D5"> sudo</span><span style="color:#ADD7FF"> gpg</span><span style="color:#ADD7FF"> --dearmor</span><span style="color:#ADD7FF"> -o</span><span style="color:#ADD7FF"> /usr/share/keyrings/googlechrom-keyring.gpg</span><span style="color:#ADD7FF"> echo</span><span style="color:#A6ACCD"> "</span><span style="color:#5DE4C7">deb [arch=amd64 signed-by=/usr/share/keyrings/googlechrom-keyring.gpg] http://dl.google.com/linux/chrome/deb/ stable main</span><span style="color:#A6ACCD">"</span><span style="color:#91B4D5"> |</span><span style="color:#91B4D5"> sudo</span><span style="color:#ADD7FF"> tee</span><span style="color:#ADD7FF"> /etc/apt/sources.list.d/google-chrome.list</span><span style="color:#ADD7FF"> sudo</span><span style="color:#ADD7FF"> apt</span><span style="color:#ADD7FF"> update</span><span style="color:#ADD7FF"> sudo</span><span style="color:#ADD7FF"> apt</span><span style="color:#ADD7FF"> install</span><span style="color:#ADD7FF"> -y</span><span style="color:#ADD7FF"> google-chrome-stable</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">google-chrome-stable</span><span style="color:#ADD7FF"> --headless</span><span style="color:#ADD7FF"> --use-gl=angle</span><span style="color:#5FB3A1"> \ </span><span style="color:#ADD7FF">--use-angle=gl-egl</span><span style="color:#ADD7FF"> --use-cmd-decoder=passthrough</span><span style="color:#5FB3A1"> \ </span><span style="color:#ADD7FF">--print-to-pdf=output.pdf</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">chrome://gpu</span><span style="color:#A6ACCD">'</span></span>
<span class="line"></span></code></pre>
<p>Приведенные выше команды создадут файл <code>output.pdf</code> и перенесут его на локальную машину, чтобы проверить состояние аппаратного ускорения в Google Chrome или Chromium. Если процесс прошел гладко, то полученный <code>PDF</code> будет выглядеть следующим образом.</p>
<figure class="igorlov-figure"><img  src="/_astro/bphbiqpu6shcbwj0jbau.uMZcJjgH_Z2rPfCd.webp" alt="Скриншот состояния GPU в Chrome" width="800" height="600" loading="lazy" decoding="async"><figcaption>Скриншот состояния GPU в Chrome</figcaption></figure>
<h2 id="работа-с-puppeteer">Работа с Puppeteer<a aria-hidden="true" tabindex="-1" href="#работа-с-puppeteer"><span class="icon icon-link"></span></a></h2>
<p>Чтобы проверить ускорение GPU с помощью Node.js-библиотеки Puppeteer, выполните следующие действия:</p>
<p>Установите Node.js, так как чистый Ubuntu AMI не содержит лишних пакетов. Используйте следующие команды:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">curl</span><span style="color:#ADD7FF"> -fsSL</span><span style="color:#ADD7FF"> https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key</span><span style="color:#91B4D5"> |</span><span style="color:#91B4D5"> sudo</span><span style="color:#ADD7FF"> gpg</span><span style="color:#ADD7FF"> --dearmor</span><span style="color:#ADD7FF"> -o</span><span style="color:#ADD7FF"> /etc/apt/keyrings/nodesource.gpg</span><span style="color:#ADD7FF"> NODE_MAJOR=</span><span style="color:#5DE4C7">18</span><span style="color:#ADD7FF"> echo</span><span style="color:#A6ACCD"> "</span><span style="color:#5DE4C7">deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_</span><span style="color:#E4F0FB">$NODE_MAJOR</span><span style="color:#5DE4C7">.x nodistro main</span><span style="color:#A6ACCD">"</span><span style="color:#91B4D5"> |</span><span style="color:#91B4D5"> sudo</span><span style="color:#ADD7FF"> tee</span><span style="color:#ADD7FF"> /etc/apt/sources.list.d/nodesource.list</span><span style="color:#ADD7FF"> sudo</span><span style="color:#ADD7FF"> apt</span><span style="color:#ADD7FF"> update</span><span style="color:#ADD7FF"> sudo</span><span style="color:#ADD7FF"> apt</span><span style="color:#ADD7FF"> install</span><span style="color:#ADD7FF"> nodejs</span></span>
<span class="line"></span></code></pre>
<p>После установки Node.js мы можем вЗапустите Puppeteer, выполнив команду <code>npm i puppeteer</code> в нашем каталоге кода. Вот пример файла <code>index.js</code> для проверки аппаратного ускорения:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#91B4D5">const</span><span style="color:#ADD7FF"> puppeteer</span><span style="color:#ADD7FF"> =</span><span style="color:#ADD7FF"> require</span><span style="color:#A6ACCD">(</span><span style="color:#91B4D5">'puppeteer'</span><span style="color:#A6ACCD">); (</span><span style="color:#ADD7FF">async</span><span style="color:#A6ACCD"> () => { </span><span style="color:#91B4D5">const</span><span style="color:#ADD7FF"> browser</span><span style="color:#ADD7FF"> =</span><span style="color:#ADD7FF"> await</span><span style="color:#ADD7FF"> puppeteer.launch</span><span style="color:#A6ACCD">({ headless: true, args: ['--use-gl=angle', '--use-angle=gl-egl'], }); const page = await browser.newPage(); await page.goto('chrome://gpu'); await page.waitForTimeout(2000); await page.screenshot({ path: 'output.png' }); await browser.close(); })();</span></span>
<span class="line"></span></code></pre>
<p>Запустите скрипт с помощью <code>node index.js</code>. В результате будет сгенерирован файл <code>output.png</code>, содержащий информацию об аппаратном ускорении.</p>
<h2 id="примечание-от-создателя">Примечание от создателя<a aria-hidden="true" tabindex="-1" href="#примечание-от-создателя"><span class="icon icon-link"></span></a></h2>
<p>Мирза оказал огромную помощь сообществу “Remotion” в освоении рендеринга с GPU-ускорением.</p>
<p>Он изучил и написал о том, как правильно получить, настроить и запустить контейнеры EC2 и headless Chrome, чтобы воспользоваться преимуществами графического ускорения.</p>
<p>Эту область было особенно сложно взломать, и без Мирзы мы бы не смогли добиться огромного прироста скорости.</p>
<p>Мы очень благодарны ему за это!</p>
<p>—</p>
<p>Джонни Бургер</p>
<p>Создатель / Remotion.dev</p>
<p>Заключение</p>
<p>Благодаря аппаратному ускорению, которое теперь доступно в режиме headless, мы можем использовать мощь GPU для более быстрых и сложных задач рендеринга. Наши следующие шаги включают создание пользовательского AMI из этого экземпляра и оптимизацию процесса с помощью AWS Image Builder Pipelines для повышения эффективности. Кроме того, мы планируем распространить аппаратные возможности на контейнеры Docker, что еще больше расширит наши возможности.</p> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как включить аппаратное ускорение в Chrome, Chromium и Puppeteer на AWS в режиме Headless&url=https://igorlov.ru/blog/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless&title=Как включить аппаратное ускорение в Chrome, Chromium и Puppeteer на AWS в режиме Headless&summary=Как мы повысили производительность Remotion благодаря рендерингу на стороне сервера с GPUускорением

Запуск Google Chrome с аппаратным ускорением в режиме hea&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-vkliuchyt-apparatnoe-uskorenye-v-chrome-chromium-y-puppeteer-na-aws-v-rezhyme-headless&media=&description=Как мы повысили производительность Remotion благодаря рендерингу на стороне сервера с GPUускорением

Запуск Google Chrome с аппаратным ускорением в режиме hea" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/kak-yspravyt-oshybku-tsykla-terraform" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> Как исправить ошибку цикла Terraform </a> <a href="/blog/kak-lehko-perenesty-bazu-dann-kh-heroku-postgres-mezhdu-prylozhenyiamy" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Как легко перенести базу данных Heroku Postgres между приложениями. </a> </nav>  </div> </div> </article> <div class="container" data-astro-cid-axzg2cw6> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.D-6fTqBY.js" component-export="default" renderer-url="/_astro/client.Bd2Qst3j.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> </div> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="Z2a8j9B" component-url="/_astro/CommentBlock.ChJFdf82.js" component-export="default" renderer-url="/_astro/client.44T8euMP.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>