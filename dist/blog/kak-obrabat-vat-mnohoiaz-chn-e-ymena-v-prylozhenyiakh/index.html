<!DOCTYPE html><html lang="ru"> <head><title>Как обрабатывать многоязычные имена в приложениях | Игорь Горлов - Fullstack Developer</title><link rel="canonical" href="https://igorlov.ru/blog/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh"><meta name="description" content="В начале этого года я и моя команда на работе изучали ошибки, возникающие в одном из наших API для регистрации. Мы увидели, что почти 5 % наших запросов не вып"><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.9.1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.sihbnQqJ.css">
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#0d52a1;color:rgba(13,82,161,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw)}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.container[data-astro-cid-vcbh62el]{padding:min(2rem,1.2125rem + 1.05vw)}.list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.link[data-astro-cid-vcbh62el]{font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s;padding:.125rem .75rem;font-size:min(1.5rem,1.1625rem + .45vw);line-height:var(--tw-lh)}
</style>
<link rel="stylesheet" href="/_astro/_single_.CpmbJtnn.css">
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#27292d;border-color:rgba(39,41,45,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.comments[data-v-f9c4118f]{margin:auto;margin-top:1.25rem;width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.comments:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame[data-v-f9c4118f]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/hoisted.CUFolni_.js"></script><style>[data-astro-transition-scope="astro-xdjatz7t-1"] { view-transition-name: blog-image-kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-16 font-inter text-blue fluid:text-lg lg:pt-24 dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <symbol id="ai:local:logo-one"><g fill="currentColor"><path d="M1198.57 596.749c0 329.575-267.171 596.751-596.747 596.751-329.575 0-596.749-267.176-596.749-596.751S272.248 0 601.823 0c329.576 0 596.747 267.174 596.747 596.749Z"/><circle cx="3035.75" cy="617.751" r="596.749" transform="rotate(-90 3035.75 617.751)"/><path d="M3035.75 2736.81c329.57 0 596.75 267.18 596.75 596.75 0 329.58-267.18 596.75-596.75 596.75-329.58 0-596.75-267.17-596.75-596.75 0-329.57 267.17-596.75 596.75-596.75Z"/><circle cx="596.749" cy="1964.8" r="596.749"/><path d="M1193.5 3332.87c0 329.57-267.176 596.75-596.751 596.75S0 3662.44 0 3332.87c0-329.58 267.174-596.75 596.749-596.75 329.575 0 596.751 267.17 596.751 596.75Z"/><circle cx="5062.46" cy="617.751" r="596.749" transform="rotate(-90 5062.46 617.751)"/><circle cx="5062.46" cy="3333.56" r="596.749" transform="rotate(-90 5062.46 3333.56)"/></g></symbol><use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> Меню</button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> Закрыть</button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты </a> </li> </ul> </nav> </div>   <!-- <ThemeToggle client:only /> --> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <div class="container" data-astro-cid-vcbh62el> <ol class="list" role="list" data-astro-cid-vcbh62el> <li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </div> </nav>  <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <article data-astro-cid-axzg2cw6> <figure class="article__image" data-astro-cid-axzg2cw6> <picture data-astro-cid-axzg2cw6> <source srcset="/_astro/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh-Feb-09-2024.vf1Kqz88_ZNbC1e.avif" type="image/avif"><source srcset="/_astro/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh-Feb-09-2024.vf1Kqz88_Z1JOvKO.webp" type="image/webp"> <img src="/_astro/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh-Feb-09-2024.vf1Kqz88_OnVcg.png" alt="Как обрабатывать многоязычные имена в приложениях" class="aspect-video h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-xdjatz7t-1" width="1120" height="580" decoding="async"> </picture> </figure> </article> <div class="container" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <!-- <ul class="article__categories categories">
				{
					categories.map((category: string, index: number) => (
						<li class="categories__item">
							<a href={`/category/${slugify(category)}`} class="categories__link">
								{humanize(category)}
								{index !== categories.length - 1 && ','}
							</a>
						</li>
					))
				}
			</ul> --> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Как обрабатывать многоязычные имена в приложениях </h1> <!-- <ul class="article__tags tags">
				{
					tags.map((tag: string) => (
						<li class="tags__item">
							<a class="tags__link" href={`/tag/${slugify(tag)}`}>
								{humanize(tag)}
							</a>
						</li>
					))
				}
			</ul> --> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 09 фев., 2024 by Игорь Горлов </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div> <div class="article__content prose prose-zinc max-w-full break-words text-blue dark:prose-invert prose-headings:text-blue prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <div class="flex flex-col border-b border-blue bg-box font-bold transition-colors text-xs fluid:py-5 lg:text-lg" data-astro-cid-2umh5aky> <span class="title" data-astro-cid-2umh5aky>Задонатить на пиво</span> <ul class="list" data-astro-cid-2umh5aky> <li class="item" data-astro-cid-2umh5aky>usdt trc20 (tron): TCgbLvPt8fe8n4jqbTjVNkzyPTqhEWxW3k</li><li class="item" data-astro-cid-2umh5aky>btc: bc1qslfl8efv733sgr489yxmf9hduw6ptjvvlq2mwx</li><li class="item" data-astro-cid-2umh5aky>eth: 0x316577c4071a5738DD5C0242A97C44bdd3CD6304</li> </ul> </div>  <!-- <AdfoxTocAds blockId="adfox_17062261612859555" /> --> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как обрабатывать многоязычные имена в приложениях&url=https://igorlov.ru/blog/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh&title=Как обрабатывать многоязычные имена в приложениях&summary=В начале этого года я и моя команда на работе изучали ошибки, возникающие в одном из наших API для регистрации. Мы увидели, что почти 5 % наших запросов не вып&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh&media=&description=В начале этого года я и моя команда на работе изучали ошибки, возникающие в одном из наших API для регистрации. Мы увидели, что почти 5 % наших запросов не вып" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <details open class="toc border-b border-blue text-blue fluid:p-8 overflow-auto cursor-pointer bg-box"><summary class="toc__title text-xl font-medium">Содержание</summary><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#проблемы-связанные-с-обработкой-многоязычных-имен">Проблемы, связанные с обработкой многоязычных имен</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#как-мы-решали-эти-проблемы">Как мы решали эти проблемы</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#ключевые-аспекты-проектирования">Ключевые аспекты проектирования</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#начальный-код">Начальный код</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#бета-версия-и-проблемы-производства">Бета-версия и проблемы производства</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#улучшенное-решение">Улучшенное решение</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#заключение">Заключение</a></li></ol></details open><p>В начале этого года я и моя команда на работе изучали ошибки, возникающие в одном из наших API для регистрации. Мы увидели, что почти 5 % наших запросов не выполняются, все из-за ошибок 400 BAD REQUEST. А первопричиной стала проверка regex.</p>
<p>Этот regex был ограничением, когда наша система позволяла людям использовать только английские символы для ввода имени и фамилии. Проблема заключалась в том, что многие люди предпочитали вводить свои имена на родном языке.</p>
<p>Эти клиенты были заинтересованы в приобретении медицинских полисов на нашей платформе, что делает их важнейшим сегментом нашей пользовательской базы.</p>
<p>В ответ на это мы решили решить проблему этих 5% наших пользователей, предоставив им возможность вводить свои имена на любом языке, который они предпочитают. Но при этом возникло множество проблем, которые нам нужно было решить, и я расскажу, как мы это сделали.</p>
<h2 id="проблемы-связанные-с-обработкой-многоязычных-имен">Проблемы, связанные с обработкой многоязычных имен<a aria-hidden="true" tabindex="-1" href="#проблемы-связанные-с-обработкой-многоязычных-имен"><span class="icon icon-link"></span></a></h2>
<ol>
<li>Стратегия хранения данных</li>
</ol>
<p>Для хранения и поиска имен пользователей мы полагаемся на MongoDB. Хотя MongoDB позволяет хранить все символы, совместимые с UTF-8, проблема возникает при поиске.</p>
<p>Для английских имен мы используем метод простой свертки. Соответствующие поля соответствующим образом индексируются, чтобы оптимизировать производительность запросов.</p>
<p>Хотя возможность реализовать индекс свертки для других языков также существует в MongoDB, такой подход означает, что вы должны сообщить БД о конкретном языке, на котором вы собираетесь искать. Сложность заключается в том, что наша база пользователей охватывает множество языков, а в одной только Индии насчитывается более 20 различных языков.</p>
<p>Нашей целью было расширить поддержку по крайней мере всех индийских языков. Но это означало, что реализация индексов свертки для каждого поддерживаемого языка приведет к увеличению количества индексов, а также к увеличению размера индекса со временем.</p>
<p>Такой подход также возлагает на разработчиков ответственность за то, чтобы не забывать добавлять индекс для каждого нового языка по мере расширения нашей языковой поддержки, что далеко не всегда является эффективным решением.</p>
<ol start="2">
<li>Ограничение на шлюз API</li>
</ol>
<p>Все наши API открыты через API-шлюз. Непосредственно перед тем, как шлюз направляет запрос к соответствующему API-сервису, входящая политика проверяет статус аутентификации пользователя. После того как пользователь аутентифицирован, она получает основные данные пользователя, такие как имя, номер мобильного телефона и другие метаданные, и добавляет их в заголовок запроса к API.</p>
<p>Многие API полагаются на эти пользовательские данные, содержащиеся в заголовках, для их дальнейшей обработки.</p>
<p>Но есть ограничение, накладываемое шлюзом, - он допускает для обработки и включения в заголовки только символы ASCII. Поэтому мы должны были убедиться, что даже если имя может быть написано на любом другом языке, ответ, которым мы поделились, должен быть исключительно на английском.</p>
<p>Кроме того, этот процесс должен быть быстрым, поскольку любая задержка в аутентификации может привести к снижению производительности API.</p>
<ol start="3">
<li>Проблемы внешних партнеров, связанные с использованием виртуозных названий</li>
</ol>
<p>Даже если мы начали принимать имена на нескольких языках, есть наши партнеры, которые должны принимать эти имена от нас. Если они не поддерживают многоязычные имена, пользовательский путь ломается.</p>
<p>Одним из таких примеров был наш платежный партнер. Мы должны были убедиться, что наша команда по платежам всегда получает английское имя, даже если пользователи указывали имена на других языках.</p>
<p>Кроме того, мы хотели избежать назойливых всплывающих окон, предлагающих пользователям вводить свои имена на английском языке, когда это было возможно. Учитывая все эти проблемы, мы должны были создать жизнеспособное решение.</p>
<h2 id="как-мы-решали-эти-проблемы">Как мы решали эти проблемы<a aria-hidden="true" tabindex="-1" href="#как-мы-решали-эти-проблемы"><span class="icon icon-link"></span></a></h2>
<p>Хотя использование сторонней службы транслитерации могло бы быть самым простым решением, мы решили разработать собственное решение, чтобы контролировать расходы и сохранять полный контроль.</p>
<p>Учитывая API-шлюз и требования платежных партнеров, стало ясно, что нам необходимо преобразовывать неанглийские имена в английские эквиваленты. Но представление этого английского имени пользователю было нелогичным - например, вводить имя на хинди, а при входе в систему видеть его преобразованным в английское, казалось противоречивым.</p>
<p>Чтобы справиться с этой проблемой, мы разработали стратегию двойного именования. Оригинальные поля, <code>"firstName"</code> и <code>"lastName"</code>, сохраняли введенные пользователем имена на их языке. Затем мы ввели два дополнительных поля, <code>"englishFirstName"</code> и <code>"englishLastName"</code>, которые предназначались для хранения английских аналогов этих имен. Эти английские имена можно было передавать API-шлюзу и нашим платежным партнерам.</p>
<p>Возвращаясь к проблеме эффективного хранения этих названий, мы предполагали, что управление индексами сглаживания по мере роста числа поддерживаемых языков станет неуправляемым. Кроме того, для поиска нужно будет указывать коллизию для каждого запроса, что создаст дополнительный уровень сложности. Поэтому мы решили отказаться от этого подхода.</p>
<p>Второй подход предполагал использование Юникода. Поскольку мы стремились поддерживать множество языков без ограничений, мы поняли, что Юникод может эффективно представлять символы почти всех языков. Поэтому мы решили хранить представления Unicode для имен и фамилий в соответствующих полях MongoDB.</p>
<p>Мы просто добавили еще один слой между нашей БД и приложением. Он преобразует эти строки Unicode в исходные значения на местном языке, получая имена из БД и преобразуя местные имена в соответствующие английские. Затем он сохраняет их в <code>englishFirstName</code> и <code>englishLastName</code> во время любой вставки или обновления.</p>
<figure class="igorlov-figure"><img  src="/_astro/79ebd2a2-aeda-4f06-8bef-25ca6a7f0a6c.CmsL_ioT_2h2wGQ.webp" alt="79ebd2a2-aeda-4f06-8bef-25ca6a7f0a6c" width="817" height="277" loading="lazy" decoding="async"><figcaption>79ebd2a2-aeda-4f06-8bef-25ca6a7f0a6c</figcaption></figure>
<p>Эта стратегия обеспечила гибкость, необходимую нам для удобного управления многоязычными названиями.</p>
<h2 id="ключевые-аспекты-проектирования">Ключевые аспекты проектирования<a aria-hidden="true" tabindex="-1" href="#ключевые-аспекты-проектирования"><span class="icon icon-link"></span></a></h2>
<ol>
<li>Оптимизация юникода</li>
</ol>
<p>Представление Юникода обычно состоит из 6 символов, где ‘a’ представлено как ‘U+0061’, а ‘P’ - как ‘U+0050’, обычно начинающихся с ‘U+00’. Для экономии места в нашей базе данных мы решили опустить префикс ‘U+’ и ведущие нули, оптимизировав хранение данных.</p>
<ol start="2">
<li>Транслитерация и перевод</li>
</ol>
<p>Изначально нашей целью была транслитерация, которая предполагает перевод имен из одной письменности в другую с сохранением их фонетического звучания.</p>
<p>Например, слово на хинди <code>"प्रतीक्षा"</code> должно быть преобразовано в <code>"Partiksha"</code>, а не переведено в его английский эквивалент, <code>"Wait"</code>.</p>
<p>Но мы понимали, что Google Translate в первую очередь ориентирован на перевод, а не на транслитерацию. Поэтому мы не хотели сразу переходить на платный сервис транслитерации Google, поэтому мы разработали наш сервис транслитерации, используя бесплатную версию Google Translate.</p>
<ol start="3">
<li>Контекстные улучшения</li>
</ol>
<p>Еще одним и наиболее важным наблюдением, которое мы сделали, было предоставление контекста API Google Translate, который повлиял на его ответы.</p>
<p>Чтобы использовать эту возможность, мы экспериментировали с добавлением префиксов к неанглийским именам для определения контекста. После нескольких пробных попыток мы поняли, что для коротких имен (менее 5 символов) более обширные префиксы не дают желаемых результатов, и Google часто возвращает одно и то же слово на хинди. Для более длинных имен мы использовали более длинные префиксы, определяя оптимальный баланс методом проб и ошибок.</p>
<p>Перевод имен обычно приводил к их буквальному переводу. Например, ”प्रतीक्षा” - “Жди” вместо “Пратикша”:</p>
<figure class="igorlov-figure"><img  src="/_astro/b8b39f05-928b-4801-a2e8-7fc6db3279b1.qW6fRMtc_ZWAoss.webp" alt="b8b39f05-928b-4801-a2e8-7fc6db3279b1" width="715" height="325" loading="lazy" decoding="async"><figcaption>b8b39f05-928b-4801-a2e8-7fc6db3279b1</figcaption></figure>
<p>Добавление префикса исправляет ситуацию:</p>
<figure class="igorlov-figure"><img  src="/_astro/3e1dd55c-dfa1-4106-8f7f-abef22b4e880.CwcNkJeO_1m1kXF.webp" alt="3e1dd55c-dfa1-4106-8f7f-abef22b4e880" width="746" height="365" loading="lazy" decoding="async"><figcaption>3e1dd55c-dfa1-4106-8f7f-abef22b4e880</figcaption></figure>
<p>Хорошо, теперь давайте посмотрим, как мы все это реализовали.</p>
<h2 id="начальный-код">Начальный код<a aria-hidden="true" tabindex="-1" href="#начальный-код"><span class="icon icon-link"></span></a></h2>
<p>После первой итерации мы разработали приведенный ниже код для транслитерации. Здесь мы используем библиотеку <code>@iamtraction/google-translate</code>, которая представляет собой обертку, написанную над бесплатным API Google translate.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> translate</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FBD0"> require</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">@iamtraction/google-translate</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91B4D5">function</span><span style="color:#ADD7FF"> getGoogleTranslateText</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">	/* Adding an English sentence before the name so that it doesn't get translated to its literal meaning. For eg परीक्षा to Exam instead of Pariksha. */</span></span>
<span class="line"><span style="color:#A6ACCD">	if (</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">length</span><span style="color:#91B4D5"> &#x3C;=</span><span style="color:#5DE4C7"> 5</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#5DE4C7C0">		return</span><span style="color:#A6ACCD"> `</span><span style="color:#5DE4C7">name: </span><span style="color:#A6ACCD">${</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">}`</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">	}</span></span>
<span class="line"><span style="color:#5DE4C7C0">	return</span><span style="color:#A6ACCD"> `</span><span style="color:#5DE4C7">your name is: </span><span style="color:#A6ACCD">${</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">}`</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#5DE4C7">async</span><span style="color:#91B4D5"> function</span><span style="color:#ADD7FF"> translateNameToEnglish</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#A6ACCD">	if (</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">match</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">/^[</span><span style="color:#5FB3A1">a-zA-Z </span><span style="color:#A6ACCD">]</span><span style="color:#91B4D5">+</span><span style="color:#A6ACCD">$/</span><span style="color:#5DE4C7">i</span><span style="color:#A6ACCD">)) {</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">		// If the name is already in English just return</span></span>
<span class="line"><span style="color:#5DE4C7C0">		return</span><span style="color:#E4F0FB"> localName</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">	}</span></span>
<span class="line"><span style="color:#D0679D">	try</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#91B4D5">		const</span><span style="color:#E4F0FB"> res</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7C0"> await</span><span style="color:#E4F0FBD0"> translate</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FBD0">getGoogleTranslateText</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">), {</span><span style="color:#ADD7FF"> to</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">en</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD"> });</span></span>
<span class="line"><span style="color:#91B4D5">		const</span><span style="color:#E4F0FB"> translatedName</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> res</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">text</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">split</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">:</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">)[</span><span style="color:#5DE4C7">1</span><span style="color:#A6ACCD">].</span><span style="color:#E4F0FBD0">trim</span><span style="color:#A6ACCD">();</span></span>
<span class="line"><span style="color:#5DE4C7C0">		return</span><span style="color:#E4F0FB"> translatedName</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">	} </span><span style="color:#D0679D">catch</span><span style="color:#A6ACCD"> (</span><span style="color:#E4F0FB">err</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">		// In case of error, Return the Unicode string</span></span>
<span class="line"><span style="color:#5DE4C7C0">		return</span><span style="color:#E4F0FB"> localName</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">	}</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span></code></pre>
<h2 id="бета-версия-и-проблемы-производства">Бета-версия и проблемы производства<a aria-hidden="true" tabindex="-1" href="#бета-версия-и-проблемы-производства"><span class="icon icon-link"></span></a></h2>
<p>Как только мы создали эту функцию, мы выпустили ее в бета-версию, и в течение первых нескольких дней около 250 пользователей зарегистрировались с неанглийскими именами.</p>
<p>Просто просмотрев несколько переведенных текстов, мы обнаружили, что процесс преобразования имени из местного языка в Юникод работает отлично, и пользователи могут правильно отображать свои имена в приложении на том языке, который они предпочитают.</p>
<p>Тем не менее, мы выявили две проблемы, связанные с процессом транслитерации на английский язык:</p>
<p>Некоторые имена были неверно транслитерированы. Это может быть связано с тем, что мы использовали Google Translate, общую службу перевода, а не специализированную службу транслитерации. Некоторые имена остались без изменений и не были транслитерированы. Эти имена были возвращены на том же языке, что и оригинал. Это означало, что добавление контекста с префиксными предложениями перед переводом вызывало проблемы для конкретных имен.</p>
<p>Это побудило нас к дальнейшему расследованию, которое привело нас к другому пакету npm под названием “unidecode”, который преобразует Unicode в оригинальную строку. Хотя первые тесты с unidecode показали точность, они также выявили незначительные орфографические несоответствия. В отличие от этого, Google постоянно предоставлял переводы с правильным написанием. Нам просто нужно было найти способ использовать лучшее из двух миров.</p>
<p>Поэтому мы включили unidecode в наш алгоритм как часть нашего решения.</p>
<h2 id="улучшенное-решение">Улучшенное решение<a aria-hidden="true" tabindex="-1" href="#улучшенное-решение"><span class="icon icon-link"></span></a></h2>
<p>Вот что мы придумали:</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> translate</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FBD0"> require</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">@iamtraction/google-translate</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> unidecode</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FBD0"> require</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">unidecode</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#A6ACCD"> { </span><span style="color:#E4F0FB">isAlmostEqualStrings</span><span style="color:#A6ACCD"> } </span><span style="color:#91B4D5">=</span><span style="color:#E4F0FBD0"> require</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">./levenshtein</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">/**</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> * Generates text for Google (shorter statement context for short names) based on localName length</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> * </span><span style="color:#A6ACCD;font-style:italic">@</span><span style="color:#91B4D5;font-style:italic">param</span><span style="color:#A6ACCD;font-style:italic"> {</span><span style="color:#A6ACCDC0;font-style:italic">String</span><span style="color:#A6ACCD;font-style:italic">}</span><span style="color:#E4F0FB;font-style:italic"> localName</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> * </span><span style="color:#A6ACCD;font-style:italic">@</span><span style="color:#91B4D5;font-style:italic">returns</span><span style="color:#A6ACCD;font-style:italic"> {</span><span style="color:#A6ACCDC0;font-style:italic">String</span><span style="color:#A6ACCD;font-style:italic">}</span><span style="color:#767C9DB0;font-style:italic"> returns text to translate</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> */</span></span>
<span class="line"><span style="color:#91B4D5">function</span><span style="color:#ADD7FF"> getGoogleTranslateText</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">	// Adding an English sentence before name so that it doesn't get translated to its literal meaning. For eg परीक्षा to Exam instead of Pariksha.</span></span>
<span class="line"><span style="color:#A6ACCD">	if (</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">length</span><span style="color:#91B4D5"> &#x3C;=</span><span style="color:#5DE4C7"> 5</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#5DE4C7C0">		return</span><span style="color:#A6ACCD"> `</span><span style="color:#5DE4C7">name: </span><span style="color:#A6ACCD">${</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">}`</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">	}</span></span>
<span class="line"><span style="color:#5DE4C7C0">	return</span><span style="color:#A6ACCD"> `</span><span style="color:#5DE4C7">your name is: </span><span style="color:#A6ACCD">${</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">}`</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">/**</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> * Give an ALMOST transliterated name</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> * </span><span style="color:#A6ACCD;font-style:italic">@</span><span style="color:#91B4D5;font-style:italic">param</span><span style="color:#A6ACCD;font-style:italic"> {</span><span style="color:#A6ACCDC0;font-style:italic">String</span><span style="color:#A6ACCD;font-style:italic">}</span><span style="color:#E4F0FB;font-style:italic"> localName</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> * </span><span style="color:#A6ACCD;font-style:italic">@</span><span style="color:#91B4D5;font-style:italic">param</span><span style="color:#A6ACCD;font-style:italic"> {</span><span style="color:#A6ACCDC0;font-style:italic">String</span><span style="color:#A6ACCD;font-style:italic">}</span><span style="color:#E4F0FB;font-style:italic"> googleTranslatedName</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> * </span><span style="color:#A6ACCD;font-style:italic">@</span><span style="color:#91B4D5;font-style:italic">returns</span><span style="color:#A6ACCD;font-style:italic"> {</span><span style="color:#A6ACCDC0;font-style:italic">String</span><span style="color:#A6ACCD;font-style:italic">}</span><span style="color:#767C9DB0;font-style:italic"> returns a converted transliterated name from the local language</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> */</span></span>
<span class="line"><span style="color:#91B4D5">function</span><span style="color:#ADD7FF"> transliterate</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">googleTranslatedName</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#91B4D5">	const</span><span style="color:#E4F0FB"> decodedName</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FBD0"> unidecode</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#A6ACCD">	if (</span></span>
<span class="line"><span style="color:#E4F0FB">		decodedName</span><span style="color:#91B4D5"> &#x26;&#x26;</span></span>
<span class="line"><span style="color:#E4F0FB">		Array</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">from</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">decodedName</span><span style="color:#A6ACCD">)[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">]?.</span><span style="color:#E4F0FBD0">toLowerCase</span><span style="color:#A6ACCD">() </span><span style="color:#91B4D5">!==</span></span>
<span class="line"><span style="color:#E4F0FB">			Array</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">from</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">googleTranslatedName</span><span style="color:#A6ACCD">)[</span><span style="color:#5DE4C7">0</span><span style="color:#A6ACCD">]?.</span><span style="color:#E4F0FBD0">toLowerCase</span><span style="color:#A6ACCD">() </span><span style="color:#91B4D5">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#91B4D5">		!</span><span style="color:#E4F0FBD0">isAlmostEqualStrings</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">decodedName</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">googleTranslatedName</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#A6ACCD">	) {</span></span>
<span class="line"><span style="color:#5DE4C7C0">		return</span><span style="color:#E4F0FB"> decodedName</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">	}</span></span>
<span class="line"><span style="color:#5DE4C7C0">	return</span><span style="color:#E4F0FB"> googleTranslatedName</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">/**</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> * translates non-english string to English</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> * </span><span style="color:#A6ACCD;font-style:italic">@</span><span style="color:#91B4D5;font-style:italic">param</span><span style="color:#A6ACCD;font-style:italic"> {</span><span style="color:#A6ACCDC0;font-style:italic">String</span><span style="color:#A6ACCD;font-style:italic">}</span><span style="color:#E4F0FB;font-style:italic"> localName</span><span style="color:#767C9DB0;font-style:italic"> - Input non English string</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> * </span><span style="color:#A6ACCD;font-style:italic">@</span><span style="color:#91B4D5;font-style:italic">returns</span><span style="color:#A6ACCD;font-style:italic"> {</span><span style="color:#A6ACCDC0;font-style:italic">String</span><span style="color:#A6ACCD;font-style:italic">}</span><span style="color:#767C9DB0;font-style:italic"> returns translated string</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic"> */</span></span>
<span class="line"><span style="color:#5DE4C7">async</span><span style="color:#91B4D5"> function</span><span style="color:#ADD7FF"> translateNameToEnglish</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#A6ACCD">	if (</span><span style="color:#91B4D5">!</span><span style="color:#E4F0FB">localName</span><span style="color:#91B4D5"> ||</span><span style="color:#E4F0FB"> localName</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">match</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">/^[</span><span style="color:#5FB3A1">a-zA-Z </span><span style="color:#A6ACCD">]</span><span style="color:#91B4D5">+</span><span style="color:#A6ACCD">$/</span><span style="color:#5DE4C7">i</span><span style="color:#A6ACCD">)) {</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">		// If name is already in English just return</span></span>
<span class="line"><span style="color:#5DE4C7C0">		return</span><span style="color:#E4F0FB"> localName</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">	}</span></span>
<span class="line"><span style="color:#D0679D">	try</span><span style="color:#A6ACCD"> {</span></span>
<span class="line"><span style="color:#91B4D5">		const</span><span style="color:#E4F0FB"> res</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7C0"> await</span><span style="color:#E4F0FBD0"> translate</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FBD0">getGoogleTranslateText</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">), {</span><span style="color:#ADD7FF"> to</span><span style="color:#A6ACCD">:</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">en</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD"> });</span></span>
<span class="line"><span style="color:#91B4D5">		const</span><span style="color:#E4F0FB"> translatedName</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FB"> res</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FB">text</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">split</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">:</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">)[</span><span style="color:#5DE4C7">1</span><span style="color:#A6ACCD">].</span><span style="color:#E4F0FBD0">trim</span><span style="color:#A6ACCD">();</span></span>
<span class="line"><span style="color:#5DE4C7C0">		return</span><span style="color:#E4F0FBD0"> transliterate</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">localName</span><span style="color:#A6ACCD">, </span><span style="color:#E4F0FB">translatedName</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#A6ACCD">	} </span><span style="color:#D0679D">catch</span><span style="color:#A6ACCD"> (</span><span style="color:#E4F0FB">err</span><span style="color:#A6ACCD">) {</span></span>
<span class="line"><span style="color:#767C9DB0;font-style:italic">		// In case of error, Return original string</span></span>
<span class="line"><span style="color:#5DE4C7C0">		return</span><span style="color:#E4F0FB"> localName</span><span style="color:#A6ACCD">;</span></span>
<span class="line"><span style="color:#A6ACCD">	}</span></span>
<span class="line"><span style="color:#A6ACCD">}</span></span>
<span class="line"></span></code></pre>
<p>Получив переведенное имя, мы отправляем его в недавно появившуюся функцию <code>transliterate</code>. Внутри этой функции на первом этапе мы извлекаем декодированную строку с помощью библиотеки <code>Unidecode</code>. Но тут возникает главный вопрос: как определить, какому результату отдать предпочтение - декодированной или переведенной строке?</p>
<p>Для решения этой проблемы мы применили Levenshtein Distance - алгоритм, который вычисляет сходство между двумя строками.</p>
<p>Сначала мы проверяем, совпадает ли первый символ расшифрованного имени с первым символом переведенного имени. Если не совпадает, то наверняка переведенное имя было неверным, поэтому мы возвращаем расшифрованное имя, даже если оно может содержать незначительные орфографические несоответствия, лучше использовать его, чем неверный перевод.</p>
<p>Если они совпадают, то мы используем алгоритм расстояния Левенштейна.</p>
<p>Расстояние Левенштейна - это число, которое показывает, насколько похожи две струны. Чем выше число, тем более несхожи две струны.</p>
<p>Расстояние Левенштейна - это число, которое показывает, насколько похожи две струны. Чем выше число, тем более несхожи две струны.</p>
<p>В реализации у нас есть функция <code>isAlmostEqualStrings</code>, которая генерирует значение от 0 до 1 и возвращает true, если значение выше определенного порога. В нашем случае мы установили порог на 0,8</p>
<p>В реализации у нас есть функция <code>isAlmostEqualStrings</code>, которая генерирует значение от 0 до 1 и возвращает true, если значение выше определенного порога. В нашем случае мы установили порог на 0,8</p>
<p>Если расстояние Левенштейна показывает совпадение более 80 %, мы возвращаем переведенное имя. В противном случае мы возвращаем декодированное имя. Такой подход обеспечивает приоритет точности, предлагая надежный результат, основанный на установленном пороге сходства.</p>
<p>Если расстояние Левенштейна показывает совпадение более 80 %, мы возвращаем переведенное имя. В противном случае мы возвращаем декодированное имя. Такой подход обеспечивает приоритет точности, предлагая надежный результат, основанный на установленном пороге сходства.</p>
<p>Этот обновленный алгоритм существенно снизил вероятность возникновения вышеупомянутых проблем. Несмотря на то что он не на 100% точен, он очень хорошо справился с нашими 5% случаев.</p>
<p>Этот обновленный алгоритм существенно снизил вероятность возникновения вышеупомянутых проблем. Несмотря на то что он не на 100% точен, он очень хорошо справился с нашими 5% случаев.</p>
<h2 id="заключение">Заключение<a aria-hidden="true" tabindex="-1" href="#заключение"><span class="icon icon-link"></span></a></h2>
<p>Разработанный нами алгоритм был полностью собственным и не потребовал никаких затрат. Хотя инвестиции в платное решение потенциально могли бы дать лучшие результаты, мудрые инженерные решения, принятые итеративно, и несколько умных хаков сыграли важную роль в снижении затрат и эффективном решении конкретной проблемы, с которой мы столкнулись.</p>
<p>Полный код приведенной выше реализации вместе с алгоритмом расстояния Левенштейна можно найти на GitHub (вклад/исправления приветствуются).</p> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Как обрабатывать многоязычные имена в приложениях&url=https://igorlov.ru/blog/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh&title=Как обрабатывать многоязычные имена в приложениях&summary=В начале этого года я и моя команда на работе изучали ошибки, возникающие в одном из наших API для регистрации. Мы увидели, что почти 5 % наших запросов не вып&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kak-obrabat-vat-mnohoiaz-chn-e-ymena-v-prylozhenyiakh&media=&description=В начале этого года я и моя команда на работе изучали ошибки, возникающие в одном из наших API для регистрации. Мы увидели, что почти 5 % наших запросов не вып" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/how-to-use-datadog-to-find-utilisation-of-aws-ebs-volume" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> Как использовать DataDog для определения использования тома AWS EBS </a> <a href="/blog/how-to-handle-file-uploads-on-the-back-end-in-node-js-and-nuxt" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Как обрабатывать загрузку файлов на задней стороне в Node.js и Nuxt </a> </nav>  </div> </div> </article> <div class="container" data-astro-cid-axzg2cw6> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.D-6fTqBY.js" component-export="default" renderer-url="/_astro/client.Bd2Qst3j.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> </div> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="Z2a8j9B" component-url="/_astro/CommentBlock.ChJFdf82.js" component-export="default" renderer-url="/_astro/client.44T8euMP.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>