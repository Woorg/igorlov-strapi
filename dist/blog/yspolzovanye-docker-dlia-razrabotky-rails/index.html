<!DOCTYPE html><html lang="ru"> <head><title>Использование Docker для разработки Rails | Игорь Горлов - Фронтeндер</title><link rel="canonical" href="https://igorlov.ru/blog/yspolzovanye-docker-dlia-razrabotky-rails"><meta name="description" content="Недавно мне поручили старый проект, и хотя, к счастью, в Read.me были инструкции по его локальной настройке, количество шагов было чертовски велико. Поэтому вм"><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.5.1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.uIaUWrkB.css" />
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw);padding-left:min(2rem,1.2125rem + 1.05vw);padding-right:min(2rem,1.2125rem + 1.05vw);padding-top:1rem;padding-bottom:1rem}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.breadcrumbs__list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.breadcrumbs__link[data-astro-cid-vcbh62el]{border-radius:9999px;--tw-bg-opacity: 1;background-color:#fef9f8;background-color:rgba(254,249,248,var(--tw-bg-opacity));font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.breadcrumbs__link[data-astro-cid-vcbh62el]:hover{--tw-bg-opacity: 1;background-color:#fce4e1;background-color:rgba(252,228,225,var(--tw-bg-opacity))}.breadcrumbs__link[data-astro-cid-vcbh62el]{padding:.125rem .75rem}.breadcrumbs__link[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#6a6a6a;background-color:rgba(106,106,106,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.breadcrumbs__link[data-astro-cid-vcbh62el]:hover:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#8a8a93;background-color:rgba(138,138,147,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}
</style>
<link rel="stylesheet" href="/_astro/_single_.CyWP_2Jq.css" />
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#020202;border-color:rgba(2,2,2,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-bg-opacity: 1;background-color:#fef9f8;background-color:rgba(254,249,248,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.comments[data-v-533071ec]{margin:auto;margin-top:1.25rem;max-width:42rem;--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity))}.comments:where([class=dark][data-v-533071ec],[class=dark] *[data-v-533071ec]){--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity))}.giscus-frame[data-v-533071ec]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-533071ec],[class=dark] *[data-v-533071ec]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
.theme-toggle[data-v-8d8d9c54]{width:1.25rem;height:1.25rem}
</style><script type="module" src="/_astro/hoisted.DYPnEDpO.js"></script><style>[data-astro-transition-scope="astro-vgmtzcrq-1"] { view-transition-name: blog-image-yspolzovanye-docker-dlia-razrabotky-rails; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-14 font-inter text-dark fluid:text-lg dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-extrabold lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-dark  dark:text-gray" aria-label="logo" data-astro-cid-ijoll5s5>ИГ ФCВР</a>  <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> <span class="nav__open-line" data-astro-cid-7wkmezxd></span> <span class="nav__open-line" data-astro-cid-7wkmezxd></span> <span class="nav__open-line" data-astro-cid-7wkmezxd></span> </button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> <span class="nav__close-line" data-astro-cid-7wkmezxd></span> <span class="nav__close-line" data-astro-cid-7wkmezxd></span> <span class="nav__close-line" data-astro-cid-7wkmezxd></span> </button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/projects" class="nav__link" data-astro-cid-7wkmezxd> Работы. </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог. </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты. </a> </li> </ul> </nav> </div>   <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var v=Object.defineProperty;var A=(c,s,a)=>s in c?v(c,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[s]=a;var d=(c,s,a)=>(A(c,typeof s!="symbol"?s+"":s,a),a);var u;{let c={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},s=t=>{let[e,n]=t;return e in c?c[e](n):void 0},a=t=>t.map(s),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,s(n)]));customElements.get("astro-island")||customElements.define("astro-island",(u=class extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var f;if(!this.hydrator||!this.isConnected)return;let e=(f=this.parentElement)==null?void 0:f.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),r={},l=this.querySelectorAll("template[data-astro-template]");for(let o of l){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("data-astro-template")||"default"]=o.innerHTML,o.remove())}for(let o of n){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("name")||"default"]=o.innerHTML)}let h;try{h=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(o){let i=this.getAttribute("component-url")||"<unknown>",b=this.getAttribute("component-export");throw b&&(i+=` (export ${b})`),console.error(`[hydrate] Error parsing props for component ${i}`,this.getAttribute("props"),o),o}let p;await this.hydrator(this)(this.Component,h,r,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),n.disconnect(),this.childrenConnectedCallback()},n=new MutationObserver(()=>{var r;((r=this.lastChild)==null?void 0:r.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});n.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}try{await Astro[n](async()=>{let r=this.getAttribute("renderer-url"),[l,{default:h}]=await Promise.all([import(this.getAttribute("component-url")),r?import(r):()=>()=>{}]),p=this.getAttribute("component-export")||"default";if(!p.includes("."))this.Component=l[p];else{this.Component=l;for(let y of p.split("."))this.Component=this.Component[y]}return this.hydrator=h,this.hydrate},e,this)}catch(r){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,r)}}attributeChangedCallback(){this.hydrate()}},d(u,"observedAttributes",["props"]),u))}})();</script><astro-island uid="IJ3dh" component-url="/_astro/ThemeToggle.kpN4JrWQ.js" component-export="default" renderer-url="/_astro/client.DtEXyQF-.js" props="{&quot;data-astro-cid-rq644orq&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;ThemeToggle&quot;,&quot;value&quot;:true}"></astro-island> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <div class="blocks__container container"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <ol class="breadcrumbs__list" role="list" data-astro-cid-vcbh62el> <li class="breadcrumbs__item" role="listitem" data-astro-cid-vcbh62el> <a class="breadcrumbs__link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="breadcrumbs__item" role="listitem" data-astro-cid-vcbh62el> <a class="breadcrumbs__link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="breadcrumbs__item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </nav>  </div> <div class="blocks__container container"> <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <ul class="article__categories categories" data-astro-cid-axzg2cw6> <li class="categories__item" data-astro-cid-axzg2cw6> <a href="/category/учебник" class="categories__link" data-astro-cid-axzg2cw6> Учебник  </a> </li> </ul> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Использование Docker для разработки Rails </h1> <ul class="article__tags tags" data-astro-cid-axzg2cw6> <li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/rails" data-astro-cid-axzg2cw6> Rails </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/docker" data-astro-cid-axzg2cw6> Docker </a> </li> </ul> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 18 дек., 2023 by Игорь Горлов </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div>  <figure class="article__image" data-astro-cid-axzg2cw6> <picture> <source srcset="/_astro/yspolzovanye-docker-dlia-razrabotky-rails-Dec-18-2023.DbouC8Gs_1ByhPf.avif" type="image/avif"><source srcset="/_astro/yspolzovanye-docker-dlia-razrabotky-rails-Dec-18-2023.DbouC8Gs_ZIIfYw.webp" type="image/webp"> <img src="/_astro/yspolzovanye-docker-dlia-razrabotky-rails-Dec-18-2023.DbouC8Gs_1GDef5.png" alt="Использование Docker для разработки Rails" class="aspect-auto h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-vgmtzcrq-1" width="1200" height="500" decoding="async"> </picture> </figure>  <div class="article__content prose prose-zinc max-w-full dark:prose-invert prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:-mx-12 prose-figure:w-screen prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <div id="adfox_17062261612859555"></div> <script>(function(){const blockId = "adfox_17062261612859555";

	window.yaContextCb = window.yaContextCb || [];
	window.yaContextCb.push(() => {
		Ya.adfoxCode.createAdaptive(
			{
				ownerId: 1493338,
				containerId: blockId,
				params: {
					p1: 'dawgg',
					p2: 'p',
				},
			},
			['desktop', 'tablet', 'phone'],
			{
				tabletWidth: 830,
				phoneWidth: 480,
				isAutoReloads: true,
			},
		);
	});
})();</script> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/yspolzovanye-docker-dlia-razrabotky-rails" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/yspolzovanye-docker-dlia-razrabotky-rails" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Использование Docker для разработки Rails&#38;url=https://igorlov.ru/blog/yspolzovanye-docker-dlia-razrabotky-rails" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://igorlov.ru/blog/yspolzovanye-docker-dlia-razrabotky-rails&#38;title=Использование Docker для разработки Rails&#38;summary=Недавно мне поручили старый проект, и хотя, к счастью, в Read.me были инструкции по его локальной настройке, количество шагов было чертовски велико. Поэтому вм&#38;source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/yspolzovanye-docker-dlia-razrabotky-rails&#38;media=&#38;description=Недавно мне поручили старый проект, и хотя, к счастью, в Read.me были инструкции по его локальной настройке, количество шагов было чертовски велико. Поэтому вм" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <details open class="toc px-5 border border-gray-light lg:px-10 py-2 cursor-pointer"><summary class="toc__title text-xl font-medium">Содержание</summary><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#уровень-0-просто-запустить-приложение-на-docker">Уровень 0: просто запустить приложение на docker</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#уровень-1-добавьте-несколько-конфигураций-качества-жизни-для-разработчиков">Уровень 1: добавьте несколько конфигураций качества жизни для разработчиков</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#уровень-2-добавление-возможности-повторного-использования-и-sidekiq">Уровень 2: добавление возможности повторного использования и sidekiq</a></li></ol></details open><p>Недавно мне поручили старый проект, и хотя, к счастью, в Read.me были инструкции по его локальной настройке, количество шагов было чертовски велико. Поэтому вместо того, чтобы потратить полдня на их выполнение, я потратил 2 дня на их автоматизацию (будущие разработчики скажут мне спасибо… возможно).<br>
Я хотел максимально приблизиться к настройке локального env одной командой.</p>
<p>Чтобы упростить процесс, как вы уже догадались из названия статьи, я решил настроить docker и docker-compose. Я начал с примера конфигурации из awesome-compose.</p>
<h2 id="уровень-0-просто-запустить-приложение-на-docker">Уровень 0: просто запустить приложение на docker<a aria-hidden="true" tabindex="-1" href="#уровень-0-просто-запустить-приложение-на-docker"><span class="icon icon-link"></span></a></h2>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#91B4D5">FROM</span><span style="color:#ADD7FF"> ruby:2.6.5</span><span style="color:#ADD7FF"> WORKDIR</span><span style="color:#ADD7FF"> /myapp</span><span style="color:#ADD7FF"> COPY</span><span style="color:#ADD7FF"> Gemfile</span><span style="color:#ADD7FF"> /myapp/Gemfile</span><span style="color:#ADD7FF"> COPY</span><span style="color:#ADD7FF"> Gemfile.lock</span><span style="color:#ADD7FF"> /myapp/Gemfile.lock</span><span style="color:#ADD7FF"> RUN</span><span style="color:#ADD7FF"> bundle</span><span style="color:#ADD7FF"> install</span><span style="color:#ADD7FF"> COPY</span><span style="color:#ADD7FF"> .</span><span style="color:#ADD7FF"> /myapp</span><span style="color:#ADD7FF"> COPY</span><span style="color:#ADD7FF"> config/database.yml.example</span><span style="color:#ADD7FF"> /myapp/config/database.yml</span><span style="color:#ADD7FF"> CMD</span><span style="color:#ADD7FF"> bundle</span><span style="color:#ADD7FF"> exec</span><span style="color:#ADD7FF"> rails</span><span style="color:#ADD7FF"> s</span><span style="color:#ADD7FF"> -p</span><span style="color:#5DE4C7"> 8080</span><span style="color:#ADD7FF"> -b</span><span style="color:#A6ACCD"> '</span><span style="color:#5DE4C7">0.0.0.0</span><span style="color:#A6ACCD">'</span></span>
<span class="line"></span></code></pre>
<p>Я не буду сильно вдаваться в подробности, основная концепция такова:</p>
<p>сначала копируем только gem-файлы и устанавливаем gems (это делается для того, чтобы воспользоваться преимуществами механизма кэширования при сборке образов для ускорения пересборки) копируем остальной код приложения Создаем файл конфигурации для базы данных на основе шаблона (детали будут передаваться через переменные ENV)</p>
<p>Поскольку на этот раз целью являются локальные разработки, компиляция активов не является проблемой, которую мы хотим оптимизировать.</p>
<p>Далее, маэстро организует локальный env: docker-compose</p>
<p><code>services: db: image: postgres volumes: - ./tmp/db:/var/lib/postgresql/data environment: POSTGRES_PASSWORD: пароль web: build: . command: bash -c "rm -f tmp/pids/server.pid &#x26;&#x26; bundle exec rails s -p 3000 -b '0.0.0.0'" ports: - "3000:3000" environment: POSTGRES_HOST: db REDIS_URL: redis://redis REDIS_HOST: redis depends_on: - db - redis redis: image: 'redis:5-alpine' команда: redis-server</code></p>
<p>Большая часть этого - благодаря помощи awesome-compose.
Чего мы хотим добиться:</p>
<p>Запустить наше приложение вместе с базой данных postgres и сервером redis Чтобы данные базы postgres сохранялись Использовать переменные env для передачи имен компонентов для маршрутизации</p>
<p>В качестве предупреждения: избегайте маппинга портов, которые не являются необходимыми. Так что не нужно использовать порт 3456:3456 для базы данных postgres. Хотя это не проблема для локальной разработки, если вы используете подобную конфигурацию на рабочем сервере, это может привести к атакам методом грубой силы.</p>
<p>Странный момент: вы могли заметить, что у нас есть и REDIS_URL, и REDIS_HOST env. Это потому, что использование кэша redis по умолчанию требует, чтобы параметр url имел протокол redis:// в начале, но наше приложение также использует redis_store для session_store, который требует только host без протокола. Скорее всего, вы не используете redis_store и можете смело удалить ненужный env.</p>
<h2 id="уровень-1-добавьте-несколько-конфигураций-качества-жизни-для-разработчиков">Уровень 1: добавьте несколько конфигураций качества жизни для разработчиков<a aria-hidden="true" tabindex="-1" href="#уровень-1-добавьте-несколько-конфигураций-качества-жизни-для-разработчиков"><span class="icon icon-link"></span></a></h2>
<p>Итак, этого конфига мне хватило, чтобы начать работать над проектом и вносить свой вклад, но он не самый удобный из-за нескольких проблем:</p>
<p>Любое изменение в коде требовало отключения инстансов docker-compose, перестройки и повторного включения инфраструктуры, а это уже много.<br>
Я не могу использовать binding.pry для отладки</p>
<p>Поэтому, чтобы сократить количество необходимых перезагрузок и автоматически обновлять код, мы будем использовать тома:</p>
<p><code>web: build: . volumes: - .:/myapp</code>.</p>
<p>Добавление тома будет зеркально отражать текущий каталог в каталог приложения в образе и автоматически отражать любые изменения, которые мы вносим в код. Хотя это и не поможет с изменениями в конфигурационных файлах, оно будет обрабатывать большинство изменений в реальном времени (предполагается, что мы работаем на типичных конфигурациях dev env)</p>
<p>Чтобы включить доступ к binding.pry, необходимо добавить в веб-сервис следующее</p>
<p><code>web: build: . volumes: - .:/myapp tty: true # для binding.pry stdin_open: true # для binding.pry</code>.</p>
<p>Но добавление этого не позволит нам просто получить доступ к отладочной консоли из консоли, используемой для запуска docker-compose, нам нужно будет найти id веб-процесса и подключиться к нему:</p>
<p><code>docker ps docker attach 75cde1ab8133</code>.</p>
<h2 id="уровень-2-добавление-возможности-повторного-использования-и-sidekiq">Уровень 2: добавление возможности повторного использования и sidekiq<a aria-hidden="true" tabindex="-1" href="#уровень-2-добавление-возможности-повторного-использования-и-sidekiq"><span class="icon icon-link"></span></a></h2>
<p>Последнее, чего не хватало в моем случае - это возможности запускать sidekiq. Вначале в этом не было необходимости, но когда разработка продолжилась, нам понадобилось работать над некоторыми асинхронными задачами для обработки длинных процессов импорта данных.</p>
<p><code>x-my-app: &#x26;my_app build: . volumes: - .:/myapp environment: POSTGRES_HOST: db REDIS_URL: redis://redis REDIS_HOST: redis depends_on: - db - redis tty: true # для binding.pry stdin_open: true # для binding.pry services: db: image: postgres volumes: - ./tmp/db:/var/lib/postgresql/data environment: POSTGRES_PASSWORD: пароль web: &#x3C;&#x3C;: *my_app команда: bash -c "rm -f tmp/pids/server.pid &#x26;&#x26; bundle exec rails s -p 3000 -b '0.0.0.0'" порты: - "3000:3000" sidekiq: &#x3C;&#x3C;: *my_app command: 'sidekiq -L ./log/sidekiq.log -C ./config/sidekiq-dev.yml -P tmp/pids/sidekiq.pid' redis: image: 'redis:5-alpine' Команда: redis-server</code></p>
<p>Итак, как вы можете видеть, прежде чем приступить к определению сервисов, мы создали блок, который будет содержать все общие настройки между приложением rails и контейнерами процессов sidekiq. Единственные различия - это команда и порты, так как sidekiq не нуждается в открытых портах, и мы не можем иметь два контейнера, пытающихся занять один и тот же порт в любом случае.</p>
<p>И смекалкапосле этого дополнения я бы считал конфигурацию docker готовой для этого проекта. Хотя для первоначальной настройки с созданием/миграцией/посевом базы данных все еще требуется более одной команды, это шаг, требующий дополнительных сценариев поверх docker-compose. Возможно, для другой статьи.<br>
Набор команд</p>
<p>На прощание я хотел бы перечислить команды docker, которые я использовал чаще всего:</p>
<ul>
<li>docker-compose up —build // запустить приложение - docker-compose down // остановить его, если оно работает в фоновом режиме</li>
<li>docker-compose ps // проверить статус запущенных образов</li>
<li>docker-compose run web bash // выполнить команды</li>
<li>docker images // показать список собранных образов</li>
<li>docker image prune // удалить неиспользуемые образы, поскольку они могут занимать много места на жестком диске</li>
<li>docker ps / docker</li>
<li>kill // если docker-compose не справляется с работой</li>
</ul>
<p>Совет: вы можете создать псевдоним для docker-compose, чтобы не набирать его каждый раз.</p>
<p><a href="https://dev.to/2nit/using-docker-for-rails-development-1928" rel="noopener noreferrer nofollow" target="_blank">Источник</a></p> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/yspolzovanye-docker-dlia-razrabotky-rails" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/yspolzovanye-docker-dlia-razrabotky-rails" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Использование Docker для разработки Rails&#38;url=https://igorlov.ru/blog/yspolzovanye-docker-dlia-razrabotky-rails" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://igorlov.ru/blog/yspolzovanye-docker-dlia-razrabotky-rails&#38;title=Использование Docker для разработки Rails&#38;summary=Недавно мне поручили старый проект, и хотя, к счастью, в Read.me были инструкции по его локальной настройке, количество шагов было чертовски велико. Поэтому вм&#38;source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/yspolzovanye-docker-dlia-razrabotky-rails&#38;media=&#38;description=Недавно мне поручили старый проект, и хотя, к счастью, в Read.me были инструкции по его локальной настройке, количество шагов было чертовски велико. Поэтому вм" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/yspolzovanye-laravel-scout-dlia-vkliuchenyia-polnotekstovoho-poyska" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> Использование Laravel Scout для включения полнотекстового поиска </a> <a href="/blog/razblokyrovanye-kodov-kh-prostranstv-github-dlia-provedenyia-semynarov" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Разблокирование кодовых пространств GitHub для проведения семинаров </a> </nav>  </div> </article> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.svLg6TOn.js" component-export="default" renderer-url="/_astro/client.D9Vng9vH.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> <astro-island uid="Z2a8j9B" component-url="/_astro/CommentBlock.BwogX8bT.js" component-export="default" renderer-url="/_astro/client.DtEXyQF-.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  </div> <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-extrabold lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-dark  dark:text-gray" aria-label="logo" data-astro-cid-ijoll5s5>ИГ ФCВР</a>  <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>