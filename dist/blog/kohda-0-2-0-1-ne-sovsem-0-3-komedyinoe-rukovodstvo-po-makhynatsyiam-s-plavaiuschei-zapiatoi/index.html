<!DOCTYPE html><html lang="ru"> <head><title>Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой | Игорь Горлов - Fullstack Developer</title><link rel="canonical" href="https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi"><meta name="description" content="Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получа"><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.5.1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ViewTransitions.astro_astro_type_script_index_0_lang.DqfSmqP7.js"></script><link rel="stylesheet" href="/_astro/_regular_.Dd2YhbvP.css" />
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw);padding-left:min(2rem,1.2125rem + 1.05vw);padding-right:min(2rem,1.2125rem + 1.05vw);padding-top:1rem;padding-bottom:1rem}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.breadcrumbs__list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.breadcrumbs__link[data-astro-cid-vcbh62el]{border-radius:9999px;--tw-bg-opacity: 1;background-color:#fef9f8;background-color:rgba(254,249,248,var(--tw-bg-opacity));font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.breadcrumbs__link[data-astro-cid-vcbh62el]:hover{--tw-bg-opacity: 1;background-color:#fce4e1;background-color:rgba(252,228,225,var(--tw-bg-opacity))}.breadcrumbs__link[data-astro-cid-vcbh62el]{padding:.125rem .75rem}.breadcrumbs__link[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#6a6a6a;background-color:rgba(106,106,106,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.breadcrumbs__link[data-astro-cid-vcbh62el]:hover:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#8a8a93;background-color:rgba(138,138,147,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}
</style>
<link rel="stylesheet" href="/_astro/_single_.CyWP_2Jq.css" />
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#020202;border-color:rgba(2,2,2,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-bg-opacity: 1;background-color:#fef9f8;background-color:rgba(254,249,248,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.theme-toggle[data-v-8d8d9c54]{width:1.25rem;height:1.25rem}
.comments[data-v-533071ec]{margin:auto;margin-top:1.25rem;max-width:42rem;--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity))}.comments:where([class=dark][data-v-533071ec],[class=dark] *[data-v-533071ec]){--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity))}.giscus-frame[data-v-533071ec]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#020202;color:rgba(2,2,2,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-533071ec],[class=dark] *[data-v-533071ec]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/page.CFW0rSNk.js"></script><style>[data-astro-transition-scope="astro-vgmtzcrq-1"] { view-transition-name: blog-image-kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-14 font-inter text-white fluid:text-lg dark:bg-black"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-extrabold lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-dark  dark:text-gray" aria-label="logo" data-astro-cid-ijoll5s5>ФCВР</a>  <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> <span class="nav__open-line" data-astro-cid-7wkmezxd></span> <span class="nav__open-line" data-astro-cid-7wkmezxd></span> <span class="nav__open-line" data-astro-cid-7wkmezxd></span> </button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> <span class="nav__close-line" data-astro-cid-7wkmezxd></span> <span class="nav__close-line" data-astro-cid-7wkmezxd></span> <span class="nav__close-line" data-astro-cid-7wkmezxd></span> </button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/projects" class="nav__link" data-astro-cid-7wkmezxd> Работы. </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог. </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты. </a> </li> </ul> </nav> </div>  <script type="module">document.addEventListener("astro:page-load",()=>{const t=document.querySelector(".nav__open"),n=document.querySelector(".nav__close"),e=document.querySelector(".nav__container"),o=document.querySelectorAll(".nav__item");t?.addEventListener("click",()=>{e?.classList.toggle("nav__container--open"),e?.classList.toggle("fade-in-bottom")}),n?.addEventListener("click",()=>{e?.classList.toggle("nav__container--open"),e?.classList.toggle("fade-in-bottom")}),o.forEach(a=>{window.matchMedia("( max-width: 1024px)").matches&&a.addEventListener("click",()=>{e?.classList.toggle("nav__container--open"),e?.classList.toggle("fade-in-bottom")})})});</script> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var v=Object.defineProperty;var A=(c,s,a)=>s in c?v(c,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[s]=a;var d=(c,s,a)=>(A(c,typeof s!="symbol"?s+"":s,a),a);var u;{let c={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},s=t=>{let[e,n]=t;return e in c?c[e](n):void 0},a=t=>t.map(s),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,s(n)]));customElements.get("astro-island")||customElements.define("astro-island",(u=class extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var f;if(!this.hydrator||!this.isConnected)return;let e=(f=this.parentElement)==null?void 0:f.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),r={},l=this.querySelectorAll("template[data-astro-template]");for(let o of l){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("data-astro-template")||"default"]=o.innerHTML,o.remove())}for(let o of n){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("name")||"default"]=o.innerHTML)}let h;try{h=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(o){let i=this.getAttribute("component-url")||"<unknown>",b=this.getAttribute("component-export");throw b&&(i+=` (export ${b})`),console.error(`[hydrate] Error parsing props for component ${i}`,this.getAttribute("props"),o),o}let p;await this.hydrator(this)(this.Component,h,r,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),n.disconnect(),this.childrenConnectedCallback()},n=new MutationObserver(()=>{var r;((r=this.lastChild)==null?void 0:r.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});n.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}try{await Astro[n](async()=>{let r=this.getAttribute("renderer-url"),[l,{default:h}]=await Promise.all([import(this.getAttribute("component-url")),r?import(r):()=>()=>{}]),p=this.getAttribute("component-export")||"default";if(!p.includes("."))this.Component=l[p];else{this.Component=l;for(let y of p.split("."))this.Component=this.Component[y]}return this.hydrator=h,this.hydrate},e,this)}catch(r){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,r)}}attributeChangedCallback(){this.hydrate()}},d(u,"observedAttributes",["props"]),u))}})();</script><astro-island uid="IJ3dh" component-url="/_astro/ThemeToggle.kpN4JrWQ.js" component-export="default" renderer-url="/_astro/client.DtEXyQF-.js" props="{&quot;data-astro-cid-rq644orq&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;ThemeToggle&quot;,&quot;value&quot;:true}"></astro-island> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <div class="blocks__container container"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <ol class="breadcrumbs__list" role="list" data-astro-cid-vcbh62el> <li class="breadcrumbs__item" role="listitem" data-astro-cid-vcbh62el> <a class="breadcrumbs__link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="breadcrumbs__item" role="listitem" data-astro-cid-vcbh62el> <a class="breadcrumbs__link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="breadcrumbs__item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </nav>  </div> <div class="blocks__container container"> <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <ul class="article__categories categories" data-astro-cid-axzg2cw6> <li class="categories__item" data-astro-cid-axzg2cw6> <a href="/category/как-закодить" class="categories__link" data-astro-cid-axzg2cw6> Как закодить  </a> </li> </ul> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой </h1> <ul class="article__tags tags" data-astro-cid-axzg2cw6> <li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/python" data-astro-cid-axzg2cw6> Python </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/javascript" data-astro-cid-axzg2cw6> JavaScript </a> </li> </ul> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 18 янв., 2024 by Игорь Горлов </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div>  <figure class="article__image" data-astro-cid-axzg2cw6> <picture> <source srcset="/_astro/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi-Jan-18-2024.CD3GcPw3_2gQDEX.avif" type="image/avif"><source srcset="/_astro/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi-Jan-18-2024.CD3GcPw3_Z1py5qD.webp" type="image/webp"> <img src="/_astro/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi-Jan-18-2024.CD3GcPw3_Z2swD2.png" alt="Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой" class="aspect-auto h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-vgmtzcrq-1" width="1200" height="500" decoding="async"> </picture> </figure>  <div class="article__content prose prose-zinc max-w-full dark:prose-invert prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:-mx-12 prose-figure:w-screen prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <div id="adfox_17062261612859555"></div> <script>(function(){const blockId = "adfox_17062261612859555";

	window.yaContextCb = window.yaContextCb || [];
	window.yaContextCb.push(() => {
		Ya.adfoxCode.createAdaptive(
			{
				ownerId: 1493338,
				containerId: blockId,
				params: {
					p1: 'dawgg',
					p2: 'p',
				},
			},
			['desktop', 'tablet', 'phone'],
			{
				tabletWidth: 830,
				phoneWidth: 480,
				isAutoReloads: true,
			},
		);
	});
})();</script> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой&#38;url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi&#38;title=Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой&#38;summary=Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получа&#38;source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi&#38;media=&#38;description=Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получа" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <details class="toc px-5 border border-gray-light lg:px-10 py-2 cursor-pointer"><summary class="title">Оглавление</summary><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#понимание-основ">Понимание основ</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#бальный-зал-двоичный-код">Бальный зал ”Двоичный код</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#эффект-домино-при-округлении">Эффект домино при округлении:</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#последствия-для-реального-мира">Последствия для реального мира</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#стратегии-по-борьбе-с-причудами-плавающей-точки">Стратегии по борьбе с причудами плавающей точки</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#десятичный-модуль-python">Десятичный модуль Python:</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#nodejss-bigjs">NodeJS’s big.js:</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#призыв-к-осознанности">Призыв к осознанности</a></li></ol></details><p>Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получали результат вроде 0,30000000000000004. Добро пожаловать в интригующий мир чисел с плавающей точкой, где точность встречается с ограничениями компьютерного представления.</p>
<h2 id="понимание-основ">Понимание основ<a aria-hidden="true" tabindex="-1" href="#понимание-основ"><span class="icon icon-link"></span></a></h2>
<p>В компьютерах числа представляются в двоичном виде, в том числе и десятичные. Однако не все десятичные числа могут быть точно представлены в двоичном виде. Например, десятичная дробь 0,1 превращается в повторяющуюся двоичную дробь (0,00011001100110011…). При сложении этих дробей вы можете столкнуться с крошечными ошибками, обусловленными конечной точностью двоичного представления.</p>
<p>Ограничения, связанные с представлением десятичных чисел в двоичном виде, приводят к ошибкам округления. Такие операции, как сложение, вычитание, умножение и деление, могут приводить к значениям, близким, но не совсем тем, которые вы ожидали.</p>
<p>Давайте разберемся в этом явлении на более понятном для человека примере.</p>
<h2 id="бальный-зал-двоичный-код">Бальный зал ”Двоичный код<a aria-hidden="true" tabindex="-1" href="#бальный-зал-двоичный-код"><span class="icon icon-link"></span></a></h2>
<p>Представьте себе, что десятичные числа можно представить как дроби, но вместо десяти цифр (0-9) у вас будет только две (0 и 1). Именно такая логика лежит в основе двоичного кода - языка, который понимают компьютеры. Хотя это хорошо работает для целых чисел, представление десятичных дробей становится сложнее.</p>
<p>Считайте, что числа вроде 0,1 - это гости, которые пытаются разместиться на переполненном танцполе, состоящем из двоичного кода. В идеале каждый гость занимает одно место, но некоторые числа, например 0,1, имеют бесконечное количество десятичных знаков, что требует бесконечного танцпола! Поэтому компьютеры аппроксимируют эти числа, присваивая им ближайшее доступное место на переполненном двоичном полу. Это приближение, наряду с ограничениями двоичного представления, вносит крошечные ошибки округления.</p>
<h2 id="эффект-домино-при-округлении">Эффект домино при округлении:<a aria-hidden="true" tabindex="-1" href="#эффект-домино-при-округлении"><span class="icon icon-link"></span></a></h2>
<p>Эти, казалось бы, незначительные ошибки могут накапливаться, приводя к неожиданным результатам. Представьте, что каждое вычисление - это домино, падающее на следующее. Крошечное колебание в одной доминошке (ошибка округления) может вызвать значительные отклонения в последующих доминошках, что приведет к неожиданным результатам. Вот почему простые сложения типа 0,2 + 0,1 не всегда равны 0,3 в мире вычислений с плавающей запятой - ошибки округления каждого числа накапливаются, как домино, влияя на результат.</p>
<h2 id="последствия-для-реального-мира">Последствия для реального мира<a aria-hidden="true" tabindex="-1" href="#последствия-для-реального-мира"><span class="icon icon-link"></span></a></h2>
<p>Финансовые расчеты: В финансовых приложениях точность имеет решающее значение. Ошибки округления в расчетах могут накапливаться, что приводит к расхождениям в финансовых отчетах. Разработчики, работающие над финансовым программным обеспечением, часто сталкиваются с проблемой баланса между эффективностью вычислений и необходимостью получения точных результатов.</p>
<p>Игровая физика: В игровом мире физические симуляции зависят от точности расчетов. Ошибка в траектории движения виртуального объекта из-за неточности вычислений с плавающей запятой может привести к тому, что персонаж упадет или перепрыгнет, что негативно скажется на игровом процессе.</p>
<p>Научное моделирование: Научное моделирование требует точности для получения точных результатов. При работе со сложными численными вычислениями даже мельчайшая ошибка округления может привести к неожиданным последствиям. Исследователи и ученые должны учитывать эти нюансы в своих вычислительных моделях.</p>
<h2 id="стратегии-по-борьбе-с-причудами-плавающей-точки">Стратегии по борьбе с причудами плавающей точки<a aria-hidden="true" tabindex="-1" href="#стратегии-по-борьбе-с-причудами-плавающей-точки"><span class="icon icon-link"></span></a></h2>
<ol>
<li>Десятичные библиотеки: Для сценариев, где точность имеет первостепенное значение, рассмотрите возможность использования десятичных библиотек. Они могут стать вашими рыцарями в сияющих доспехах. Эти библиотеки обеспечивают более точный способ представления и манипулирования десятичными значениями, предлагая уровень точности, которого может не хватать стандартным числам с плавающей точкой.</li>
</ol>
<h3 id="десятичный-модуль-python">Десятичный модуль Python:<a aria-hidden="true" tabindex="-1" href="#десятичный-модуль-python"><span class="icon icon-link"></span></a></h3>
<p>Модуль Decimal в Python предоставляет тип данных Decimal, который поддерживает арифметику с произвольной точностью. Вы можете установить уровень точности в соответствии с вашими требованиями.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> decimal </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> Decimal, getcontext</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">getcontext().prec </span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7"> 10</span><span style="color:#767C9DB0;font-style:italic">  # Set precision to 10 decimal places</span></span>
<span class="line"><span style="color:#A6ACCD">result </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> Decimal(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">0.1</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">) </span><span style="color:#91B4D5">+</span><span style="color:#A6ACCD"> Decimal(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">0.2</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(result)  </span><span style="color:#767C9DB0;font-style:italic"># Output: 0.3</span></span>
<span class="line"></span></code></pre>
<h3 id="nodejss-bigjs">NodeJS’s big.js:<a aria-hidden="true" tabindex="-1" href="#nodejss-bigjs"><span class="icon icon-link"></span></a></h3>
<p>NodeJS - это big.js:</p>
<p>big.js - это библиотека для десятичной арифметики произвольной точности в JavaScript. Она позволяет выполнять вычисления с заданной точностью.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> Big</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FBD0"> require</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">big.js</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> result</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7"> new</span><span style="color:#E4F0FBD0"> Big</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">0.1</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">).</span><span style="color:#E4F0FBD0">plus</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">0.2</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">console</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">log</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">result</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">toString</span><span style="color:#A6ACCD">()); </span><span style="color:#767C9DB0;font-style:italic">// Output: 0.3</span></span>
<span class="line"></span></code></pre>
<p>Использование этих библиотек гарантирует, что ваши вычисления не будут зависеть от ограничений стандартного представления с плавающей точкой.</p>
<ol start="2">
<li>Сравнение Предостережение: Прямые проверки равенства с числами с плавающей точкой могут ввести в заблуждение из-за ошибок округления, присущих их представлению. Чтобы преодолеть эту проблему, используйте осторожный подход:</li>
</ol>
<p>Уровни толерантности: Вместо использования прямого равенства (==) рассмотрите возможность использования уровня допуска. Определите допустимый диапазон, в котором два числа с плавающей точкой считаются равными.</p>
<p><code>tolerance = 1e-10 result = 0.1 + 0.2  if abs(result - 0.3) &#x3C; tolerance: print("Equal") else: print("Not Equal")</code></p>
<p>Специализированные функции: Используйте специализированные функции, предоставляемые языками программирования или библиотеками для сравнения с плавающей точкой. Эти функции предназначены для обработки ошибок округления и обеспечения точности сравнений.</p>
<p><code>from math import isclose  result = 0.1 + 0.2  if isclose(result, 0.3): print("Close enough") else: print("Not close")</code></p>
<p>Используя уровни допуска или специализированные функции, вы смягчаете влияние неточности плавающей точки на проверку равенства.</p>
<ol start="3">
<li>Освоение режимов округления: Различные режимы округления предлагают разные стратегии обработки округлений при выполнении операций с плавающей точкой.</li>
</ol>
<p>Округлить наполовину вверх: Округляет до ближайшего целого числа. Если дробь находится ровно на полпути между двумя целыми числами, она округляется до большего из них.</p>
<p>Round Half Down: аналогично Round Half Up, но округляет до меньшего целого числа, если дробь равна ровно половине.</p>
<p>Округлить до половины четного (округление банкиров): Округляет до ближайшего четного целого числа, если дробь равна ровно половине. Это помогает избежать погрешности при накоплении ошибок округления.</p>
<p>Освоение режимов округления позволяет адаптировать подход к округлению в зависимости от конкретных требований к вычислениям, обеспечивая последовательность и предсказуемость результатов.</p>
<h2 id="призыв-к-осознанности">Призыв к осознанности<a aria-hidden="true" tabindex="-1" href="#призыв-к-осознанности"><span class="icon icon-link"></span></a></h2>
<p>Понимание чисел с плавающей точкой крайне важно для всех, кто работает с цифровыми вычислениями. Раскрывая их причуды и ограничения, мы можем делать осознанный выбор, обеспечивая точность там, где это важно, и принимая присущее им очарование нечеткой логики.</p>
<p>Так что в следующий раз, когда ваш компьютер подкинет вам неожиданную арифметику, помните - это не всегда ошибка, это просто причудливый мир чисел с плавающей точкой играет в свою уникальную игру. Поделитесь своими впечатлениями от встречи с этими цифровыми фантомами в комментариях ниже! Давайте прольем свет на эти скрытые тайны и будем ориентироваться в вычислительном мире с точностью и осознанностью.</p> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой&#38;url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi&#38;title=Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой&#38;summary=Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получа&#38;source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi&#38;media=&#38;description=Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получа" target="_blank" rel="noreferrer noopener" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/5-sovetov-po-uluchsheniyu-integraczii-bekenda-react-s-axios" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> 5 советов по улучшению интеграции бэкенда, React с Axios </a> <a href="/blog/razblokyrovka-proyzvodytelnosty-ustanovka-ruby-s-pomoschiu-yjit-na-macos" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Разблокировка производительности: Установка Ruby с помощью YJIT на MacOS </a> </nav>  </div> </article> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.svLg6TOn.js" component-export="default" renderer-url="/_astro/client.D9Vng9vH.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> <astro-island uid="Z2a8j9B" component-url="/_astro/CommentBlock.BwogX8bT.js" component-export="default" renderer-url="/_astro/client.DtEXyQF-.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  </div> <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-extrabold lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-dark  dark:text-gray" aria-label="logo" data-astro-cid-ijoll5s5>ФCВР</a>  <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>