<!DOCTYPE html><html lang="ru"> <head><title>Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой | Игорь Горлов - Fullstack Developer</title><link rel="canonical" href="https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi"><meta name="description" content="Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получа"><meta name="robots" content="index, follow"><!-- favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- theme meta --><meta name="theme-name" content="igorlov.ru"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="generator" content="Astro v4.9.1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- responsive meta --><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><meta name="google-adsense-account" content="ca-pub-0634695143666394"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_regular_.sihbnQqJ.css">
<style>.breadcrumbs[data-astro-cid-vcbh62el]{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#0d52a1;color:rgba(13,82,161,var(--tw-text-opacity));border-radius:min(1.5rem,1.1625rem + .45vw)}.breadcrumbs[data-astro-cid-vcbh62el]:where([class=dark],[class=dark] *){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#fff;color:rgba(255,255,255,var(--tw-text-opacity))}.container[data-astro-cid-vcbh62el]{padding:min(2rem,1.2125rem + 1.05vw)}.list[data-astro-cid-vcbh62el]{display:flex;align-items:center;gap:.125rem}.link[data-astro-cid-vcbh62el]{font-weight:500;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s;padding:.125rem .75rem;font-size:min(1.5rem,1.1625rem + .45vw);line-height:var(--tw-lh)}
</style>
<link rel="stylesheet" href="/_astro/_single_.CzD8Xhhr.css">
<style>.circular-pagination[data-astro-cid-ihkjvfsn]{display:flex;width:100%;flex-wrap:wrap;align-items:center;justify-content:center;overflow:hidden;border-top-width:1px;--tw-border-opacity: 1;border-color:#27292d;border-color:rgba(39,41,45,var(--tw-border-opacity));margin-top:min(1.25rem,1.1375rem + .15vw)}.circular-pagination__link[data-astro-cid-ihkjvfsn]{width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity));text-decoration-line:none}.circular-pagination__link[data-astro-cid-ihkjvfsn]:hover{--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.circular-pagination__link[data-astro-cid-ihkjvfsn]{padding-left:min(1.5rem,1.1625rem + .45vw);padding-right:min(1.5rem,1.1625rem + .45vw);padding-top:.5rem;padding-bottom:.5rem}
.comments[data-v-f9c4118f]{margin:auto;margin-top:1.25rem;width:100%;--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.comments:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame[data-v-f9c4118f]{width:100%;--tw-bg-opacity: 1;background-color:#fff;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity: 1;color:#27292d;color:rgba(39,41,45,var(--tw-text-opacity))}.giscus-frame:where([class=dark][data-v-f9c4118f],[class=dark] *[data-v-f9c4118f]){--tw-bg-opacity: 1;background-color:#131315;background-color:rgba(19,19,21,var(--tw-bg-opacity))}
</style><script type="module" src="/_astro/hoisted.CUFolni_.js"></script><style>[data-astro-transition-scope="astro-xdjatz7t-1"] { view-transition-name: blog-image-kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi; }</style></head> <body class="flex min-h-screen flex-col bg-gray-light pt-16 font-inter text-blue fluid:text-lg lg:pt-24 dark:bg-black dark:text-white"> <header class="header" data-astro-cid-rq644orq> <div class="header__container container" data-astro-cid-rq644orq> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg header__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <symbol id="ai:local:logo-one"><g fill="currentColor"><path d="M1198.57 596.749c0 329.575-267.171 596.751-596.747 596.751-329.575 0-596.749-267.176-596.749-596.751S272.248 0 601.823 0c329.576 0 596.747 267.174 596.747 596.749Z"/><circle cx="3035.75" cy="617.751" r="596.749" transform="rotate(-90 3035.75 617.751)"/><path d="M3035.75 2736.81c329.57 0 596.75 267.18 596.75 596.75 0 329.58-267.18 596.75-596.75 596.75-329.58 0-596.75-267.17-596.75-596.75 0-329.57 267.17-596.75 596.75-596.75Z"/><circle cx="596.749" cy="1964.8" r="596.749"/><path d="M1193.5 3332.87c0 329.57-267.176 596.75-596.751 596.75S0 3662.44 0 3332.87c0-329.58 267.174-596.75 596.749-596.75 329.575 0 596.751 267.17 596.751 596.75Z"/><circle cx="5062.46" cy="617.751" r="596.749" transform="rotate(-90 5062.46 617.751)"/><circle cx="5062.46" cy="3333.56" r="596.749" transform="rotate(-90 5062.46 3333.56)"/></g></symbol><use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <div class="nav header__nav" data-astro-cid-7wkmezxd> <button class="nav__open" title="Открыть меню" data-astro-cid-7wkmezxd> Меню</button> <nav class="nav__container" data-astro-cid-7wkmezxd> <button class="nav__close" title="Закрыть меню" data-astro-cid-7wkmezxd> Закрыть</button> <ul class="nav__list" data-astro-cid-7wkmezxd> <li class="nav__item" data-astro-cid-7wkmezxd> <a href="/blog" class="nav__link nav__link--active" data-astro-cid-7wkmezxd> Блог </a> </li><li class="nav__item" data-astro-cid-7wkmezxd> <a href="#cta" class="nav__link" data-astro-cid-7wkmezxd> Контакты </a> </li> </ul> </nav> </div>   <!-- <ThemeToggle client:only /> --> </div> </header>  <main id="main-content" class="main flex-1">  <div class="blocks"> <nav aria-label="Breadcrumbs" class="breadcrumbs" data-astro-cid-vcbh62el> <div class="container" data-astro-cid-vcbh62el> <ol class="list" role="list" data-astro-cid-vcbh62el> <li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/" data-astro-cid-vcbh62el> Главная </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el> <a class="link" href="/blog" data-astro-cid-vcbh62el> Blog </a> </li><li class="item" role="listitem" data-astro-cid-vcbh62el>  </li> </ol> </div> </nav>  <!-- <TextAds class="fade-in-bottom fluid:my-2" style="--delay: .8s;" /> --><article class="article" data-astro-cid-axzg2cw6> <article data-astro-cid-axzg2cw6> <figure class="article__image" data-astro-cid-axzg2cw6> <picture data-astro-cid-axzg2cw6> <source srcset="/_astro/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi-Jan-18-2024.CD3GcPw3_Z1MNoxR.avif" type="image/avif"><source srcset="/_astro/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi-Jan-18-2024.CD3GcPw3_Z1VjSfU.webp" type="image/webp"> <img src="/_astro/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi-Jan-18-2024.CD3GcPw3_Z7JNVH.png" alt="Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой" class="aspect-video h-full w-full object-cover object-center" loading="eager" data-astro-cid-axzg2cw6 data-astro-transition-scope="astro-xdjatz7t-1" width="1120" height="580" decoding="async"> </picture> </figure> </article> <div class="container" data-astro-cid-axzg2cw6> <div class="article__header" data-astro-cid-axzg2cw6> <ul class="article__categories categories" data-astro-cid-axzg2cw6> <li class="categories__item" data-astro-cid-axzg2cw6> <a href="/category/как-закодить" class="categories__link" data-astro-cid-axzg2cw6> Как закодить  </a> </li> </ul> <h1 class="article__title text-wrap" data-astro-cid-axzg2cw6> Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой </h1> <ul class="article__tags tags" data-astro-cid-axzg2cw6> <li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/python" data-astro-cid-axzg2cw6> Python </a> </li><li class="tags__item" data-astro-cid-axzg2cw6> <a class="tags__link" href="/tag/javascript" data-astro-cid-axzg2cw6> JavaScript </a> </li> </ul> <time class="article__date" data-astro-cid-axzg2cw6>
Опубликовано 18 янв., 2024 by Игорь Горлов </time> <time class="article__date" data-astro-cid-axzg2cw6> Последнее изменение: 21 мар., 2024 </time> </div> <div class="article__content prose prose-zinc max-w-full break-words text-blue dark:prose-invert prose-headings:text-blue prose-p:text-balance prose-a:no-underline hover:prose-a:underline prose-figure:bg-gray-light prose-figure:p-10 prose-figcaption:text-dark dark:prose-figure:bg-dark dark:prose-figcaption:text-white" data-astro-cid-axzg2cw6> <!-- <TextAds /> --> <!-- <AdfoxTocAds blockId="adfox_17062261612859555" /> --> <div class="article__meta" data-astro-cid-axzg2cw6> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой&url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi&title=Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой&summary=Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получа&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi&media=&description=Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получа" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <a class="article__meta-section" href="#comments" data-astro-cid-axzg2cw6> Комментарии</a> </div> <details open class="toc border-b border-blue text-blue fluid:p-8 overflow-auto cursor-pointer bg-box"><summary class="toc__title text-xl font-medium">Содержание</summary><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#понимание-основ">Понимание основ</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#бальный-зал-двоичный-код">Бальный зал ”Двоичный код</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#эффект-домино-при-округлении">Эффект домино при округлении:</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#последствия-для-реального-мира">Последствия для реального мира</a></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#стратегии-по-борьбе-с-причудами-плавающей-точки">Стратегии по борьбе с причудами плавающей точки</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#десятичный-модуль-python">Десятичный модуль Python:</a></li><li class="toc-item toc-item-h3"><a class="text-blue text-blue-h3" href="#nodejss-bigjs">NodeJS’s big.js:</a></li></ol></li><li class="toc-item toc-item-h2"><a class="text-blue text-blue-h2" href="#призыв-к-осознанности">Призыв к осознанности</a></li></ol></details open><p>Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получали результат вроде 0,30000000000000004. Добро пожаловать в интригующий мир чисел с плавающей точкой, где точность встречается с ограничениями компьютерного представления.</p>
<h2 id="понимание-основ">Понимание основ<a aria-hidden="true" tabindex="-1" href="#понимание-основ"><span class="icon icon-link"></span></a></h2>
<p>В компьютерах числа представляются в двоичном виде, в том числе и десятичные. Однако не все десятичные числа могут быть точно представлены в двоичном виде. Например, десятичная дробь 0,1 превращается в повторяющуюся двоичную дробь (0,00011001100110011…). При сложении этих дробей вы можете столкнуться с крошечными ошибками, обусловленными конечной точностью двоичного представления.</p>
<p>Ограничения, связанные с представлением десятичных чисел в двоичном виде, приводят к ошибкам округления. Такие операции, как сложение, вычитание, умножение и деление, могут приводить к значениям, близким, но не совсем тем, которые вы ожидали.</p>
<p>Давайте разберемся в этом явлении на более понятном для человека примере.</p>
<h2 id="бальный-зал-двоичный-код">Бальный зал ”Двоичный код<a aria-hidden="true" tabindex="-1" href="#бальный-зал-двоичный-код"><span class="icon icon-link"></span></a></h2>
<p>Представьте себе, что десятичные числа можно представить как дроби, но вместо десяти цифр (0-9) у вас будет только две (0 и 1). Именно такая логика лежит в основе двоичного кода - языка, который понимают компьютеры. Хотя это хорошо работает для целых чисел, представление десятичных дробей становится сложнее.</p>
<p>Считайте, что числа вроде 0,1 - это гости, которые пытаются разместиться на переполненном танцполе, состоящем из двоичного кода. В идеале каждый гость занимает одно место, но некоторые числа, например 0,1, имеют бесконечное количество десятичных знаков, что требует бесконечного танцпола! Поэтому компьютеры аппроксимируют эти числа, присваивая им ближайшее доступное место на переполненном двоичном полу. Это приближение, наряду с ограничениями двоичного представления, вносит крошечные ошибки округления.</p>
<h2 id="эффект-домино-при-округлении">Эффект домино при округлении:<a aria-hidden="true" tabindex="-1" href="#эффект-домино-при-округлении"><span class="icon icon-link"></span></a></h2>
<p>Эти, казалось бы, незначительные ошибки могут накапливаться, приводя к неожиданным результатам. Представьте, что каждое вычисление - это домино, падающее на следующее. Крошечное колебание в одной доминошке (ошибка округления) может вызвать значительные отклонения в последующих доминошках, что приведет к неожиданным результатам. Вот почему простые сложения типа 0,2 + 0,1 не всегда равны 0,3 в мире вычислений с плавающей запятой - ошибки округления каждого числа накапливаются, как домино, влияя на результат.</p>
<h2 id="последствия-для-реального-мира">Последствия для реального мира<a aria-hidden="true" tabindex="-1" href="#последствия-для-реального-мира"><span class="icon icon-link"></span></a></h2>
<p>Финансовые расчеты: В финансовых приложениях точность имеет решающее значение. Ошибки округления в расчетах могут накапливаться, что приводит к расхождениям в финансовых отчетах. Разработчики, работающие над финансовым программным обеспечением, часто сталкиваются с проблемой баланса между эффективностью вычислений и необходимостью получения точных результатов.</p>
<p>Игровая физика: В игровом мире физические симуляции зависят от точности расчетов. Ошибка в траектории движения виртуального объекта из-за неточности вычислений с плавающей запятой может привести к тому, что персонаж упадет или перепрыгнет, что негативно скажется на игровом процессе.</p>
<p>Научное моделирование: Научное моделирование требует точности для получения точных результатов. При работе со сложными численными вычислениями даже мельчайшая ошибка округления может привести к неожиданным последствиям. Исследователи и ученые должны учитывать эти нюансы в своих вычислительных моделях.</p>
<h2 id="стратегии-по-борьбе-с-причудами-плавающей-точки">Стратегии по борьбе с причудами плавающей точки<a aria-hidden="true" tabindex="-1" href="#стратегии-по-борьбе-с-причудами-плавающей-точки"><span class="icon icon-link"></span></a></h2>
<ol>
<li>Десятичные библиотеки: Для сценариев, где точность имеет первостепенное значение, рассмотрите возможность использования десятичных библиотек. Они могут стать вашими рыцарями в сияющих доспехах. Эти библиотеки обеспечивают более точный способ представления и манипулирования десятичными значениями, предлагая уровень точности, которого может не хватать стандартным числам с плавающей точкой.</li>
</ol>
<h3 id="десятичный-модуль-python">Десятичный модуль Python:<a aria-hidden="true" tabindex="-1" href="#десятичный-модуль-python"><span class="icon icon-link"></span></a></h3>
<p>Модуль Decimal в Python предоставляет тип данных Decimal, который поддерживает арифметику с произвольной точностью. Вы можете установить уровень точности в соответствии с вашими требованиями.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#5DE4C7">from</span><span style="color:#A6ACCD"> decimal </span><span style="color:#5DE4C7">import</span><span style="color:#A6ACCD"> Decimal, getcontext</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD">getcontext().prec </span><span style="color:#91B4D5">=</span><span style="color:#5DE4C7"> 10</span><span style="color:#767C9DB0;font-style:italic">  # Set precision to 10 decimal places</span></span>
<span class="line"><span style="color:#A6ACCD">result </span><span style="color:#91B4D5">=</span><span style="color:#A6ACCD"> Decimal(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">0.1</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">) </span><span style="color:#91B4D5">+</span><span style="color:#A6ACCD"> Decimal(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">0.2</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">)</span></span>
<span class="line"><span style="color:#E4F0FBD0">print</span><span style="color:#A6ACCD">(result)  </span><span style="color:#767C9DB0;font-style:italic"># Output: 0.3</span></span>
<span class="line"></span></code></pre>
<h3 id="nodejss-bigjs">NodeJS’s big.js:<a aria-hidden="true" tabindex="-1" href="#nodejss-bigjs"><span class="icon icon-link"></span></a></h3>
<p>NodeJS - это big.js:</p>
<p>big.js - это библиотека для десятичной арифметики произвольной точности в JavaScript. Она позволяет выполнять вычисления с заданной точностью.</p>
<pre class="astro-code poimandres" style="background-color:#1b1e28;color:#a6accd; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> Big</span><span style="color:#91B4D5"> =</span><span style="color:#E4F0FBD0"> require</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">big.js</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#91B4D5">const</span><span style="color:#E4F0FB"> result</span><span style="color:#91B4D5"> =</span><span style="color:#5DE4C7"> new</span><span style="color:#E4F0FBD0"> Big</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">0.1</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">).</span><span style="color:#E4F0FBD0">plus</span><span style="color:#A6ACCD">(</span><span style="color:#A6ACCD">'</span><span style="color:#5DE4C7">0.2</span><span style="color:#A6ACCD">'</span><span style="color:#A6ACCD">);</span></span>
<span class="line"><span style="color:#E4F0FB">console</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">log</span><span style="color:#A6ACCD">(</span><span style="color:#E4F0FB">result</span><span style="color:#A6ACCD">.</span><span style="color:#E4F0FBD0">toString</span><span style="color:#A6ACCD">()); </span><span style="color:#767C9DB0;font-style:italic">// Output: 0.3</span></span>
<span class="line"></span></code></pre>
<p>Использование этих библиотек гарантирует, что ваши вычисления не будут зависеть от ограничений стандартного представления с плавающей точкой.</p>
<ol start="2">
<li>Сравнение Предостережение: Прямые проверки равенства с числами с плавающей точкой могут ввести в заблуждение из-за ошибок округления, присущих их представлению. Чтобы преодолеть эту проблему, используйте осторожный подход:</li>
</ol>
<p>Уровни толерантности: Вместо использования прямого равенства (==) рассмотрите возможность использования уровня допуска. Определите допустимый диапазон, в котором два числа с плавающей точкой считаются равными.</p>
<p><code>tolerance = 1e-10 result = 0.1 + 0.2  if abs(result - 0.3) &#x3C; tolerance: print("Equal") else: print("Not Equal")</code></p>
<p>Специализированные функции: Используйте специализированные функции, предоставляемые языками программирования или библиотеками для сравнения с плавающей точкой. Эти функции предназначены для обработки ошибок округления и обеспечения точности сравнений.</p>
<p><code>from math import isclose  result = 0.1 + 0.2  if isclose(result, 0.3): print("Close enough") else: print("Not close")</code></p>
<p>Используя уровни допуска или специализированные функции, вы смягчаете влияние неточности плавающей точки на проверку равенства.</p>
<ol start="3">
<li>Освоение режимов округления: Различные режимы округления предлагают разные стратегии обработки округлений при выполнении операций с плавающей точкой.</li>
</ol>
<p>Округлить наполовину вверх: Округляет до ближайшего целого числа. Если дробь находится ровно на полпути между двумя целыми числами, она округляется до большего из них.</p>
<p>Round Half Down: аналогично Round Half Up, но округляет до меньшего целого числа, если дробь равна ровно половине.</p>
<p>Округлить до половины четного (округление банкиров): Округляет до ближайшего четного целого числа, если дробь равна ровно половине. Это помогает избежать погрешности при накоплении ошибок округления.</p>
<p>Освоение режимов округления позволяет адаптировать подход к округлению в зависимости от конкретных требований к вычислениям, обеспечивая последовательность и предсказуемость результатов.</p>
<h2 id="призыв-к-осознанности">Призыв к осознанности<a aria-hidden="true" tabindex="-1" href="#призыв-к-осознанности"><span class="icon icon-link"></span></a></h2>
<p>Понимание чисел с плавающей точкой крайне важно для всех, кто работает с цифровыми вычислениями. Раскрывая их причуды и ограничения, мы можем делать осознанный выбор, обеспечивая точность там, где это важно, и принимая присущее им очарование нечеткой логики.</p>
<p>Так что в следующий раз, когда ваш компьютер подкинет вам неожиданную арифметику, помните - это не всегда ошибка, это просто причудливый мир чисел с плавающей точкой играет в свою уникальную игру. Поделитесь своими впечатлениями от встречи с этими цифровыми фантомами в комментариях ниже! Давайте прольем свет на эти скрытые тайны и будем ориентироваться в вычислительном мире с точностью и осознанностью.</p> <div class="share article__share" data-astro-cid-g7nhfqu5> <h3 class="share__title" data-astro-cid-g7nhfqu5>Поделиться:</h3> <ul class="share__list" data-astro-cid-g7nhfqu5> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://vk.com/share.php?url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Vk
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="facebook share button" href="https://facebook.com/sharer/sharer.php?u=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Fb
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="twitter share button" href="https://twitter.com/share?title=Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой&url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
X
</a> </li><li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="linkedin share button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi&title=Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с плавающей запятой&summary=Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получа&source=https://igorlov.ru/" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Linkd
</a> </li> <li class="share__item" data-astro-cid-g7nhfqu5> <a class="share__link" aria-label="pinterest share button" href="https://pinterest.com/pin/create/button/?url=https://igorlov.ru/blog/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi&media=&description=Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получа" target="_blank" rel="noreferrer noopener nofollow" data-astro-cid-g7nhfqu5>
Pint
</a> </li> </ul>  </div> <nav class="circular-pagination" aria-label="Circular Pagination" data-astro-cid-ihkjvfsn> <a href="/blog/5-sovetov-po-uluchsheniyu-integraczii-bekenda-react-s-axios" class="circular-pagination__link circular-pagination__link--prev" data-astro-cid-ihkjvfsn> 5 советов по улучшению интеграции бэкенда, React с Axios </a> <a href="/blog/razblokyrovka-proyzvodytelnosty-ustanovka-ruby-s-pomoschiu-yjit-na-macos" class="circular-pagination__link circular-pagination__link--next" data-astro-cid-ihkjvfsn> Разблокировка производительности: Установка Ruby с помощью YJIT на MacOS </a> </nav>  </div> </div> </article> <div class="container" data-astro-cid-axzg2cw6> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1T5Wnr" prefix="r0" component-url="/_astro/YandexRelatedAds.D-6fTqBY.js" component-export="default" renderer-url="/_astro/client.Bd2Qst3j.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;YandexRelatedAds&quot;,&quot;value&quot;:true}" await-children=""><div id="yandex_rtb_C-A-2592503-2"></div><!--astro:end--></astro-island> </div> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="Z2a8j9B" component-url="/_astro/CommentBlock.ChJFdf82.js" component-export="default" renderer-url="/_astro/client.44T8euMP.js" props="{&quot;data-astro-cid-axzg2cw6&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;CommentBlock&quot;,&quot;value&quot;:true}"></astro-island>  <!-- <div class="blocks__container container">
			<CtaBlock id="cta" class=""
			/>
		</div> --> </div>    </main> <footer class="footer" data-astro-cid-dwelrhxs> <div class="footer__container container" data-astro-cid-dwelrhxs> <a href="/" class="logo font-medium lowercase transition-colors fluid:text-lg footer__logo dark:hover:text-light text-blue dark:text-white" aria-label="logo" data-astro-cid-ijoll5s5> <svg width="1.44em" height="1em" viewBox="0 0 5660 3931" class="icon" data-astro-cid-ijoll5s5 data-icon="logo-one">  <use xlink:href="#ai:local:logo-one"></use>  </svg>  </a> <small class="footer__copyright" data-astro-cid-dwelrhxs>все права защищены. © 2024</small> </div> </footer>  </body></html>