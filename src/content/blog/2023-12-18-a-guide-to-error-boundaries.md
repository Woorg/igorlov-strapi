---
title: Путеводитель по границам ошибок
meta_title: 'Путеводитель по границам ошибок | Игорь Горлов - Fullstack Developer '
description: >-
  Эффективное управление ошибками жизненно важно для создания устойчивых и
  удобных приложений React. Когда ваше приложение сталкивается с непредвиденной
  ошибкой,
date: 2023-12-18T00:00:00.000Z
categories:
  - uchebniki
  - Как закодить
author: Игорь Горлов
draft: false
slug: putevodytel-po-hranytsam-oshybok
translatedPosition: 59
tags:
  - React
image: ../../assets/images/putevodytel-po-hranytsam-oshybok-Dec-18-2023.avif
lastmod: 2024-03-20T21:26:48.433Z
---

Эффективное управление ошибками жизненно важно для создания устойчивых и удобных приложений React. Когда ваше приложение сталкивается с непредвиденной ошибкой, важно обеспечить изящный способ обработки и представления этих ошибок пользователям, сохраняя при этом функциональность. Границы ошибок React предлагают мощный механизм для достижения этой цели, и в этой статье мы рассмотрим, что это такое, как их реализовать и лучшие практики для них.

Границы ошибок React действуют как защитные сетки для вашего приложения. Когда ошибка возникает в любом компоненте в их дереве, эти границы ловят ее, предотвращая падение всего приложения. Они позволяют обрабатывать ошибки более изящно, предоставляя возможность отображать резервный пользовательский интерфейс и записывать подробности ошибки в журнал. Это отличный инструмент для улучшения пользовательского опыта и помощи разработчикам в выявлении и устранении проблем без нарушения работы всего приложения. Внедрение границ ошибок - разумный шаг для стабильности фронтенда.

## Почему границы ошибок важны для React-приложений?

Без границ ошибок одна-единственная ошибка в компоненте может привести к краху всего приложения, что вызовет недовольство пользователей и усложнит задачу разработчиков по выявлению первопричины. Границы ошибок важны для приложений React по нескольким причинам:

Предотвращение сбоев приложения: Границы ошибок ловят ошибки внутри дерева компонентов и не позволяют им распространяться вверх по иерархии компонентов, вызывая крах всего приложения. Это обеспечивает более стабильную и отзывчивую работу пользователей даже при возникновении ошибок. Улучшение пользовательского опыта: Вместо резкого аварийного завершения работы приложения границы ошибок отображают резервный пользовательский интерфейс, который информирует пользователя об ошибке и обеспечивает более контролируемый ответ. Это предотвращает разочарование и позволяет пользователям продолжать работать с приложением. Изолировать ошибки: Границы ошибок помогают изолировать ошибки от конкретных компонентов, что облегчает выявление и отладку источника проблемы. Это упрощает процесс разработки и сокращает время отладки, поскольку разработчики могут сосредоточиться на конкретном компоненте, в котором произошла ошибка. Регистрация ошибок: Границы ошибок можно использовать для регистрации ошибок во внешних сервисах или аналитических платформах. Это дает ценные сведения о поведении приложения и потенциальных проблемах, помогая разработчикам выявлять закономерности, отслеживать возникновение ошибок и определять приоритеты усилий по отладке. Ремонтопригодный код: Границы ошибок способствуют удобству обслуживания кода, поскольку инкапсулируют логику обработки ошибок в определенные компоненты. Это облегчает понимание и изменение поведения обработки ошибок, не затрагивая другие части приложения. Грациозная обработка ошибок: Границы ошибок обеспечивают изящную обработку ошибок, позволяя разработчикам предоставлять пользователям содержательную обратную связь и поддерживать постоянный пользовательский опыт даже при возникновении ошибок. Это улучшает общий пользовательский опыт и повышает доверие к приложению.

В целом, границы ошибок играют важную роль в обеспечении стабильности и удобства использования приложений React. Они предотвращают неожиданные сбои, улучшают пользовательский опыт, упрощают отладку и дают ценные сведения о поведении приложения.

## Поиск неработающих вызовов API

Перехватывайте полезную нагрузку HTTP, отслеживайте неудачные вызовы API и многое другое с помощью консольных журналов, ошибок и управления состоянием. Ознакомьтесь с нашим репозиторием на Github и выразите свою поддержку, поставив нам звезду.

## Практическая реализация границ ошибок в приложении React

В этом разделе мы углубимся в работу границ ошибок, разбив сложное на простые сегменты. Мы построим приложение React и создадим компонент Error Boundary. Обернув наши компоненты этим защитным слоем, мы укрепим наше приложение от ошибок, обеспечив более плавный пользовательский опыт.

## Как создать компонент границы ошибки

Компонент границы ошибок - это специальный компонент React, который может перехватывать ошибки, возникающие в его дочерних компонентах. Это позволяет отобразить резервный пользовательский интерфейс вместо того, чтобы обрушить все приложение. Границы ошибок должны быть компонентами класса в React, потому что они полагаются на два специфических метода жизненного цикла, доступных только компонентам класса. Обратите внимание, что функциональные компоненты не могут использовать эти методы жизненного цикла, поэтому они не могут быть границами ошибок.

Чтобы создать компонент границы ошибок, необходимо создать класс компонента, который реализует один или оба из следующих методов жизненного цикла:

`static getDerivedStateFromError()`: Этот метод отображает резервный пользовательский интерфейс после возникновения ошибки. `componentDidCatch()`: Этот метод записывает информацию об ошибке в консоль или службу отчетов об ошибках.

Начните с создания нового компонента ErrorBoundary.js, который будет выступать в качестве границы ошибки. Этот компонент должен определить методы жизненного цикла: static getDerivedStateFromError() и componentDidCatch().

```ts
import React, { Component } from 'react';

class ErrorBoundary extends Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    // You can log the error
    console.error('Error:', error);
    console.error('Error Info:', errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <div>
          <h2>Something went wrong. Please try again later.</h2>
        </div>
      );
    }
    return this.props.children;
  }
}

export default ErrorBoundary;
```

Приведенный выше код определяет компонент React под названием ErrorBoundary, предназначенный для отлова ошибок в дочерних компонентах. Давайте разберем этот код:

Импортные заявления:

`import React, { Component } from 'react';`

Эта строка импортирует объект React и класс Component из библиотеки `react`. Класс Component необходим для создания компонентов класса в React.

Определение класса:

`class ErrorBoundary extends Component {`

Здесь определен класс `ErrorBoundary`, расширяющий класс Component. Это означает, что `ErrorBoundary` является компонентом класса React.

Строитель:

`constructor(props) { super(props); this.state = { hasError: false }; }`

Метод `constructor` используется для инициализации состояния компонента. В данном случае он устанавливает начальное состояние `hasError` и свойство `false`. Вызов `super(props)` необходим для вызова конструктора родительского класса (`Component`).

Статический метод - `getDerivedStateFromError`:

`static getDerivedStateFromError(error) { return { hasError: true }; }`

Этот статический метод является методом жизненного цикла, появившимся в React 16. Он вызывается при возникновении ошибки во время рендеринга, и его цель - обновить состояние компонента на основе возникновения ошибки. В данном случае он устанавливает `hasError` в `true`.

Метод - componentDidCatch:

`componentDidCatch(error, errorInfo) { console.error('Error:', error); console.error('Error Info:', errorInfo); }`

`componentDidCatch` - еще один метод жизненного цикла, который вызывается после возникновения ошибки во время рендеринга. Он дает возможность записать в журнал подробности ошибки. В этом примере он записывает информацию об ошибке в консоль.

Метод рендеринга:

```ts
render() {
  if (this.state.hasError) {
    return (
      <div>
        <h2>Something went wrong. Please try again later.</h2>
      </div>
    );
  }
  return this.props.children;
}
```

Метод `render` отвечает за рендеринг компонента. Если `hasError` имеет значение `true`, он возвращает аварийный пользовательский интерфейс, указывающий на то, что что-то пошло не так. В противном случае он рендерит дочерние компоненты (`this.props.children`), позволяя нормально рендерить дочерние компоненты компонента при отсутствии ошибок.

Заявление на экспорт:

`export default ErrorBoundary;`

Эта строка экспортирует компонент `ErrorBoundary`, делая его доступным для использования в других частях приложения.

В общем, этот компонент `ErrorBoundary` будет использоваться в качестве обертки для других компонентов. Если внутри обернутых компонентов произойдет какая-либо ошибка, `ErrorBoundary` поймает ее, обновит свое состояние, сообщит об ошибке в журнал и отобразит резервный пользовательский интерфейс, чтобы сообщить пользователю, что что-то пошло не так.

## Как использовать компонент границы ошибки

Чтобы использовать этот компонент границы ошибок, оберните его вокруг компонентов, в которых вы хотите отлавливать ошибки. Перед этим мы обновим вспомогательный пользовательский интерфейс в компоненте Error Boundary, чтобы он выдавал более подходящее сообщение.

```ts
// ErrorBoundary.js
import React, { Component } from "react";

class ErrorBoundary extends Component {
  constructor(props) {
    super(props);
    this.state = {
      hasError: false
    };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    this.setState({
      error: error,
      errorInfo: errorInfo,
      hasError: true
    });
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4">
          <p className="font-bold">Oops! Something went wrong.
          This is not a car.
        </div>
      );
    }
    return this.props.children;
  }
}

export default ErrorBoundary;
```

Если в пределах `ErrorBoundary` произойдет какая-либо ошибка, он поймает ее, обновит состояние и выдаст удобное для пользователя сообщение, а не обрушит все приложение.

Теперь мы создадим компонент и назовем его `Carsection`. В компоненте `CarSection` мы будем использовать оператор throw new Error, чтобы сгенерировать ошибку при определенном условии. В данном случае, если переданный компоненту параметр `carName` равен `Airbus`, он вызовет ошибку с сообщением `не автомобиль`.

```ts
import React from 'react';

const CarSection = ({ carName }) => {
  if (carName === 'Airbus') {
    throw new Error('not a car');
  }
  return (
    <div>
      {carName}
    </div>
  );
};

export default CarSection;
```

По сути, компонент `CarSection` предназначен для условного выброса ошибки на основе значения свойства `carName`, демонстрируя, как границы ошибок могут быть реализованы для управления ошибками в приложениях React.

Следующий шаг - обернуть компонент или код, который может выдать ошибку, компонентом `ErrorBoundary` в компоненте `App.js`.

```ts
import React from "react";
import CarSection from "./CarSection";
import ErrorBoundary from "./ErrorBoundary";

function App() {
  return (
    <div className="container mx-auto p-4">
      <ErrorBoundary>
        <CarSection carName={"Toyota"} />
      </ErrorBoundary>
      <ErrorBoundary>
        <CarSection carName={"Honda"} />
      </ErrorBoundary>
      <ErrorBoundary>
        <CarSection carName={"Ford"} />
      </ErrorBoundary>
      <ErrorBoundary>
        <CarSection carName={"Airbus"} />
      </ErrorBoundary>
    </div>
  );
}

export default App;
```

Когда компонент `CarSection` получает свойство `carName` со значением “Airbus”, он вызывает ошибку с помощью `throw new Error('not a car')`. Компонент `ErrorBoundary` перехватывает эту ошибку и выводит сообщение, указанное в свойстве `errorMessage`. В данном случае `ErrorBoundary` настроен на отображение “Not a car” в качестве сообщения об ошибке. Таким образом, когда компонент `CarSection` получит сообщение `"Airbus"`, пользовательский интерфейс отобразит сообщение об ошибке “Not a car”.

![---](../../assets/images/image.png)

## Ограничения границ ошибок

Хотя границы ошибок в React являются мощным инструментом для обработки ошибок в компонентах, есть некоторые ограничения и соображения, о которых следует знать:

Асинхронный код: Ошибки в асинхронном коде, такие как `setTimeout` или сетевые запросы, не будут пойманы границей ошибок, поскольку они происходят вне обычного жизненного цикла компонента. Невозможно поймать ошибки в обработчиках событий: Границы ошибок работают на этапе рендеринга, поэтому они не будут ловить ошибки, возникающие в обработчиках событий или асинхронном коде. Ошибки в самой границе ошибок: Если ошибка возникает в собственных методах `render`, `componentDidCatch` или конструкторах, граница ошибок не будет перехватывать эти ошибки. Это может привести к тому, что сама граница ошибок не сработает. Рендеринг на стороне сервера: Границы ошибок не предназначены для отлова ошибок, возникающих при рендеринге на стороне сервера. Лучше всего они работают в клиентских React-приложениях.

Несмотря на эти ограничения, Error Boundaries по-прежнему являются ценным инструментом для повышения надежности вашего приложения, предотвращая сбои и обеспечивая лучший пользовательский опыт при возникновении ошибок.

## Заключение

В этом руководстве мы изучили концепцию границ ошибок в React, поняли их роль в отлове ошибок на этапе рендеринга и в методах жизненного цикла компонентов класса. Мы углубились в их использование, настраивая их для создания резервных пользовательских интерфейсов, и обсудили их ограничения.

Границы ошибок - это мощный механизм для предотвращения страшного белого экрана смерти и повышения устойчивости React-приложений. Стратегически грамотно размещая их в иерархии компонентов, разработчики могут перехватывать ошибки, выводить удобные сообщения и поддерживать более плавный пользовательский опыт.

В заключение следует отметить, что освоение реализации Error Boundaries позволяет разработчикам React создавать более надежные приложения, которые изящно обрабатывают ошибки, обеспечивая более устойчивый и удобный веб-опыт.
