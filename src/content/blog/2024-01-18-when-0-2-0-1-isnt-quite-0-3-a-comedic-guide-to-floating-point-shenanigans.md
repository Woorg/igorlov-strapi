---
title: >-
  Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с
  плавающей запятой
meta_title: >-
  Когда 0,2 + 0,1 не совсем 0,3: комедийное руководство по махинациям с
  плавающей запятой | Игорь Горлов - Fullstack Developer
description: >-
  Сталкивались ли вы с неожиданными результатами при работе с десятичными
  числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3,
  но получа
date: 2024-01-18T00:00:00.000Z
categories:
  - Как закодить
author: Игорь Горлов
type: blog
draft: false
slug: >-
  kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi
translatedPosition: 42
tags:
  - Python
  - JavaScript
image: >-
  ../../assets/images/kohda-0-2-0-1-ne-sovsem-0-3-komedyinoe-rukovodstvo-po-makhynatsyiam-s-plavaiuschei-zapiatoi-Jan-18-2024.avif
lastmod: 2024-03-20T21:26:42.815Z
---

Сталкивались ли вы с неожиданными результатами при работе с десятичными числами в своем коде? Возможно, вы складывали 0,1 и 0,2, ожидая получить 0,3, но получали результат вроде 0,30000000000000004. Добро пожаловать в интригующий мир чисел с плавающей точкой, где точность встречается с ограничениями компьютерного представления.

## Понимание основ

В компьютерах числа представляются в двоичном виде, в том числе и десятичные. Однако не все десятичные числа могут быть точно представлены в двоичном виде. Например, десятичная дробь 0,1 превращается в повторяющуюся двоичную дробь (0,00011001100110011…). При сложении этих дробей вы можете столкнуться с крошечными ошибками, обусловленными конечной точностью двоичного представления.

Ограничения, связанные с представлением десятичных чисел в двоичном виде, приводят к ошибкам округления. Такие операции, как сложение, вычитание, умножение и деление, могут приводить к значениям, близким, но не совсем тем, которые вы ожидали.

Давайте разберемся в этом явлении на более понятном для человека примере.

## Бальный зал ”Двоичный код

Представьте себе, что десятичные числа можно представить как дроби, но вместо десяти цифр (0-9) у вас будет только две (0 и 1). Именно такая логика лежит в основе двоичного кода - языка, который понимают компьютеры. Хотя это хорошо работает для целых чисел, представление десятичных дробей становится сложнее.

Считайте, что числа вроде 0,1 - это гости, которые пытаются разместиться на переполненном танцполе, состоящем из двоичного кода. В идеале каждый гость занимает одно место, но некоторые числа, например 0,1, имеют бесконечное количество десятичных знаков, что требует бесконечного танцпола! Поэтому компьютеры аппроксимируют эти числа, присваивая им ближайшее доступное место на переполненном двоичном полу. Это приближение, наряду с ограничениями двоичного представления, вносит крошечные ошибки округления.

## Эффект домино при округлении:

Эти, казалось бы, незначительные ошибки могут накапливаться, приводя к неожиданным результатам. Представьте, что каждое вычисление - это домино, падающее на следующее. Крошечное колебание в одной доминошке (ошибка округления) может вызвать значительные отклонения в последующих доминошках, что приведет к неожиданным результатам. Вот почему простые сложения типа 0,2 + 0,1 не всегда равны 0,3 в мире вычислений с плавающей запятой - ошибки округления каждого числа накапливаются, как домино, влияя на результат.

## Последствия для реального мира

Финансовые расчеты: В финансовых приложениях точность имеет решающее значение. Ошибки округления в расчетах могут накапливаться, что приводит к расхождениям в финансовых отчетах. Разработчики, работающие над финансовым программным обеспечением, часто сталкиваются с проблемой баланса между эффективностью вычислений и необходимостью получения точных результатов.

Игровая физика: В игровом мире физические симуляции зависят от точности расчетов. Ошибка в траектории движения виртуального объекта из-за неточности вычислений с плавающей запятой может привести к тому, что персонаж упадет или перепрыгнет, что негативно скажется на игровом процессе.

Научное моделирование: Научное моделирование требует точности для получения точных результатов. При работе со сложными численными вычислениями даже мельчайшая ошибка округления может привести к неожиданным последствиям. Исследователи и ученые должны учитывать эти нюансы в своих вычислительных моделях.

## Стратегии по борьбе с причудами плавающей точки

1. Десятичные библиотеки: Для сценариев, где точность имеет первостепенное значение, рассмотрите возможность использования десятичных библиотек. Они могут стать вашими рыцарями в сияющих доспехах. Эти библиотеки обеспечивают более точный способ представления и манипулирования десятичными значениями, предлагая уровень точности, которого может не хватать стандартным числам с плавающей точкой.

### Десятичный модуль Python:

Модуль Decimal в Python предоставляет тип данных Decimal, который поддерживает арифметику с произвольной точностью. Вы можете установить уровень точности в соответствии с вашими требованиями.

```python
from decimal import Decimal, getcontext

getcontext().prec = 10  # Set precision to 10 decimal places
result = Decimal('0.1') + Decimal('0.2')
print(result)  # Output: 0.3
```

### NodeJS’s big.js:

NodeJS - это big.js:

big.js - это библиотека для десятичной арифметики произвольной точности в JavaScript. Она позволяет выполнять вычисления с заданной точностью.

```javascript
const Big = require('big.js');
const result = new Big('0.1').plus('0.2');
console.log(result.toString()); // Output: 0.3
```

Использование этих библиотек гарантирует, что ваши вычисления не будут зависеть от ограничений стандартного представления с плавающей точкой.

2. Сравнение Предостережение: Прямые проверки равенства с числами с плавающей точкой могут ввести в заблуждение из-за ошибок округления, присущих их представлению. Чтобы преодолеть эту проблему, используйте осторожный подход:

Уровни толерантности: Вместо использования прямого равенства (==) рассмотрите возможность использования уровня допуска. Определите допустимый диапазон, в котором два числа с плавающей точкой считаются равными.

`tolerance = 1e-10 result = 0.1 + 0.2  if abs(result - 0.3) < tolerance: print("Equal") else: print("Not Equal")`

Специализированные функции: Используйте специализированные функции, предоставляемые языками программирования или библиотеками для сравнения с плавающей точкой. Эти функции предназначены для обработки ошибок округления и обеспечения точности сравнений.

`from math import isclose  result = 0.1 + 0.2  if isclose(result, 0.3): print("Close enough") else: print("Not close")`

Используя уровни допуска или специализированные функции, вы смягчаете влияние неточности плавающей точки на проверку равенства.

3. Освоение режимов округления: Различные режимы округления предлагают разные стратегии обработки округлений при выполнении операций с плавающей точкой.

Округлить наполовину вверх: Округляет до ближайшего целого числа. Если дробь находится ровно на полпути между двумя целыми числами, она округляется до большего из них.

Round Half Down: аналогично Round Half Up, но округляет до меньшего целого числа, если дробь равна ровно половине.

Округлить до половины четного (округление банкиров): Округляет до ближайшего четного целого числа, если дробь равна ровно половине. Это помогает избежать погрешности при накоплении ошибок округления.

Освоение режимов округления позволяет адаптировать подход к округлению в зависимости от конкретных требований к вычислениям, обеспечивая последовательность и предсказуемость результатов.

## Призыв к осознанности

Понимание чисел с плавающей точкой крайне важно для всех, кто работает с цифровыми вычислениями. Раскрывая их причуды и ограничения, мы можем делать осознанный выбор, обеспечивая точность там, где это важно, и принимая присущее им очарование нечеткой логики.

Так что в следующий раз, когда ваш компьютер подкинет вам неожиданную арифметику, помните - это не всегда ошибка, это просто причудливый мир чисел с плавающей точкой играет в свою уникальную игру. Поделитесь своими впечатлениями от встречи с этими цифровыми фантомами в комментариях ниже! Давайте прольем свет на эти скрытые тайны и будем ориентироваться в вычислительном мире с точностью и осознанностью.
