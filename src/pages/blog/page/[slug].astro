---
export const prerender = true;
import Pagination from '@/components/Pagination.astro';
import config from '@/config/config.json';
import Base from '@/layouts/Base.astro';
import { getSinglePage } from '@/lib/contentParser.astro';
import { getAllTaxonomy, getTaxonomy } from '@/lib/taxonomyParser.astro';
import { sortByDate } from '@/lib/utils/sortFunctions';
import YandexFloorAds from '@/components/YandexFloorAds.astro';

import { getEntryBySlug } from 'astro:content';
import ArticlesBlock from '@/components/ArticlesBlock.astro';
import CtaBlock from '@/components/CtaBlock.astro';

const { blog_folder } = config.settings;
const { slug } = Astro.params;
const postIndex = await getEntryBySlug<any, string>(blog_folder, '-index');
const posts = await getSinglePage(blog_folder);
const sortedPosts = sortByDate(posts);
const totalPages = Math.ceil(posts.length / config.settings.pagination);
const currentPage = slug && !isNaN(Number(slug)) ? Number(slug) : 1;
const indexOfLastPost = currentPage * config.settings.pagination;
const indexOfFirstPost = indexOfLastPost - config.settings.pagination;
const currentPosts = sortedPosts.slice(indexOfFirstPost, indexOfLastPost);

export async function getStaticPaths() {
	const posts = await getSinglePage(config.settings.blog_folder);
	const totalPages = Math.ceil(posts.length / config.settings.pagination);
	const paths = [];

	for (let i = 1; i < totalPages; i++) {
		paths.push({
			params: {
				slug: (i + 1).toString(),
			},
		});
	}
	return paths;
}
---

<Base
	title={`Посты из блога: страница ${currentPage} . ${postIndex.data.title}`}
	meta_title={`Посты из блога: страница ${currentPage} . ${postIndex.data.meta_title}`}
	image={postIndex.data.image}
	description={`Посты из блога: страница ${currentPage} . ${postIndex.data.description}`}
>
	<div class="blocks">
		<ArticlesBlock
			sectionTitle={`Посты из блога: страница ${currentPage}`}
			posts={currentPosts}
			class=""
		/>

		<Pagination section={blog_folder} currentPage={currentPage} totalPages={totalPages} />

		<!-- <CtaBlock id="cta" class="" /> -->
	</div>
</Base>

<YandexFloorAds blockId="R-A-2592503-6" platform="touch" />
<YandexFloorAds blockId="R-A-2592503-5" platform="desktop" />
